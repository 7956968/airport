(function(){var e,i=utility.getLocalStorage("language"),t=(utility.getLocalStorage("userInfo"),utility.getLocalStorage("bizParam")),a=new Vue({el:"#js-vue",data:{language:i?i.language:"CN",isTableLoading:!0,isShowModal:!1,isShowTerminal:!1,isModalLoading:!0,modalTitle:"",tableHeight:(e=$(".tableContainer").height(),e-100),terminalStatusList:t.terminalStatus,vehicleColorList:t.vehicleColor,vehicleTypeList:t.vehicleType,vehicleBrandList:t.vehicleBrand,vehiclePositonPageInfo:{span:"",count:0,pageNum:1,deptId:"",pageSize:20,companyId:"",vihecleId:"",vehicleName:"",vehicleCode:"",licenseNumber:"",gpsDeviceCode:"",vehicleTypeId:"",vehicleStatus:"",vehicleColorId:"",vehicleBrandId:"",centerPosition:""},columnsList:[{type:"index",align:"center",title:"序号",width:60,fixed:"left"},{title:"公司",key:"companyName",width:180,fixed:"left"},{title:"部门",key:"deptName",width:180},{title:"车牌号",key:"licenseNumber",width:120},{title:"终端",key:"gpsDeviceCode",width:150},{title:"违规",key:"illegalNum",width:60,render:function(e,i){return e("div",[e("span",{},i.row.illegalNum+"次")])}},{title:"里程",key:"currMiles",width:120,sortable:!0,render:function(e,i){return e("div",[e("span",{},i.row.currMiles+"（公里）")])}},{title:"时间",width:150,key:"modifyTime"},{title:"坐标",width:150,render:function(e,i){var t="";if(a.dataList[i.index].lastPosition){var o=JSON.parse(a.dataList[i.index].lastPosition).coordinates;t=0!=o[0]&&0!=o[1]?o.join(","):""}else t="";return e("div",t)}},{title:"地点",width:450,render:function(e,i){return e("div",[e("span",{},a.dataList[i.index].lastAddress)])}}],dataList:[],allVehicleList:[],vehicleInfo:[],errInfo:{xAxisData:[],seriesData:[]},mileInfo:{xAxisData:[],seriesData:[]}},watch:{},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},pageSizeChange:function(e){var i=this;i.vehiclePositonPageInfo.pageNum=parseInt(e,10),setTimeout(function(){i.getVehicleList(!1)},200)},pageRowChange:function(e){var i=this;i.vehiclePositonPageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getVehicleList(!1)},200)},getVehicleList:function(e){var i=this;i.vehiclePositionList=[],1==e&&(i.vehiclePositonPageInfo.pageNum=1),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{span:i.vehiclePositonPageInfo.span,deptId:i.vehiclePositonPageInfo.deptId,pageNum:i.vehiclePositonPageInfo.pageNum,pageSize:i.vehiclePositonPageInfo.pageSize,vihecleId:i.vehiclePositonPageInfo.vihecleId,companyId:i.vehiclePositonPageInfo.companyId,gpsDeviceCode:i.vehiclePositonPageInfo.gpsDeviceCode,vehicleTypeId:i.vehiclePositonPageInfo.vehicleTypeId,vehicleStatus:i.vehiclePositonPageInfo.vehicleStatus,vehicleColorId:i.vehiclePositonPageInfo.vehicleColorId,vehicleBrandId:i.vehiclePositonPageInfo.vehicleBrandId,centerPosition:i.vehiclePositonPageInfo.centerPosition,vehicleName:encodeURI(i.vehiclePositonPageInfo.vehicleName),vehicleCode:encodeURI(i.vehiclePositonPageInfo.vehicleCode),licenseNumber:encodeURI(i.vehiclePositonPageInfo.licenseNumber)},beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){if(200==e.code){var t=[];i.vehiclePositonPageInfo.count=e.count;for(var a=0,o=e.data.length;a<o;a++)t.push(e.data[a]),t[a].lastAddress="";i.dataList=t;for(var l=0;l<e.data.length;l++)(function(t){if(e.data[t].lastPosition){var a=JSON.parse(e.data[t].lastPosition).coordinates;0!=a[0]&&0!=a[1]?utility.convertorByBaidu(a,gcoord,BMap,function(e,a,o){utility.getAdressDetail([a,o],BMap,function(e){i.dataList[t].lastAddress=e})}):i.dataList[t].lastAddress="--"}else i.dataList[t].lastAddress="--"})(l)}}})},drawVehicle:function(e){var i=this,t=echarts.init(document.getElementById(e.id));option={title:{text:e.title,top:10,textStyle:{fontSize:13,align:"center"}},color:[e.color],tooltip:{trigger:"axis",textStyle:{fontSize:13},formatter:function(e){var t=e[0].axisValue,a=i.vehicleInfo[t].info,o=[];return o.push("结果："+e[0].value+"<br/>"),o.push("公司："+a.companyName+"<br/>"),o.push("部门："+a.deptName+"<br/>"),o.push("车辆："+a.vehicleName+"<br/>"),o.push("类型："+a.vehicleTypeName+"<br/>"),o.push("品牌："+a.vehicleBrandName+"<br/>"),o.push("颜色："+a.vehicleColorName+"<br/>"),o.push("终端："+a.gpsDeviceCode),o.join(" ")}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:e.data.xAxisData,axisTick:{alignWithLabel:!0}}],yAxis:[{type:"value"}],series:[{name:"",type:"bar",barWidth:"60%",data:e.data.seriesData}]},t.setOption(option)},formatVehicle:function(){for(var e=this,i={},t=0,a=e.allVehicleList.length;t<a;t++)i[e.allVehicleList[t].vehicleCode]={info:e.allVehicleList[t],list:[]};for(var o in i)if(i.hasOwnProperty(o))for(var l=0,n=e.allVehicleList.length;l<n;l++)e.allVehicleList[l].vehicleCode==o&&i[o].list.push(e.allVehicleList[l]);for(var s in i)if(i.hasOwnProperty(s)){var c=0,r=0;e.errInfo.xAxisData.push(s),e.mileInfo.xAxisData.push(s);for(var h=0,d=i[s].list.length;h<d;h++)c+=i[s].list[h].illegalNum,r+=i[s].list[h].currMiles;e.errInfo.seriesData.push(c),e.mileInfo.seriesData.push(r)}e.vehicleInfo=i},getAllVehicleList:function(){var e=this;e.errInfo.xAxisData=[],e.errInfo.seriesData=[],e.mileInfo.xAxisData=[],e.mileInfo.seriesData=[],utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getAllVehiclePositonList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{},successCallback:function(i){200==i.code&&(e.allVehicleList=i.data,e.formatVehicle(),e.drawVehicle({id:"illegaInfo",color:"#C23531",data:e.errInfo,title:"车辆违章情况统计(单位/次)"}),e.drawVehicle({id:"milleInfo",color:"#2d8cf0",data:e.mileInfo,title:"车辆行驶里程统计(单位/公里)"}))}})},getDataBySearch:function(){var e=this;e.getVehicleList(!0),e.getAllVehicleList()}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getVehicleList(!0),e.getAllVehicleList()},500),e.$watch("vehiclePositonPageInfo",function(){e.getVehicleList(!0)},{deep:!0})}})})();
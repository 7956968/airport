(function(){var e=utility.getLocalStorage("language"),i=(utility.getLocalStorage("userInfo"),utility.getLocalStorage("bizParam")),t=new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!0,isShowModal:!1,isShowTerminal:!1,isModalLoading:!0,modalTitle:"",tableHeight:function(){var e=$(".tableContainer").height();return e-100}(),terminalStatusList:i.terminalStatus,vehicleColorList:i.vehicleColor,vehicleTypeList:i.vehicleType,vehicleBrandList:i.vehicleBrand,vehiclePositonPageInfo:{span:"",count:0,pageNum:1,deptId:"",pageSize:20,companyId:"",vihecleId:"",vehicleName:"",vehicleCode:"",gpsDeviceCode:"",vehicleTypeId:"",vehicleStatus:"",vehicleColorId:"",vehicleBrandId:"",centerPosition:""},columnsList:[{title:{CN:"公司",EN:"Company",TW:"公司"}[e.language],key:"companyName"},{title:{CN:"部门",EN:"Department",TW:"部門"}[e.language],key:"deptName"},{title:{CN:"车辆",EN:"Name",TW:"車輛"}[e.language],key:"vehicleName"},{title:{CN:"类型",EN:"Type",TW:"類型"}[e.language],key:"vehicleTypeName"},{title:{CN:"颜色",EN:"Color",TW:"顔色"}[e.language],key:"vehicleColorName"},{title:{CN:"品牌",EN:"Brand",TW:"品牌"}[e.language],key:"vehicleBrandName"},{title:{CN:"终端",EN:"Terminal",TW:"終端"}[e.language],key:"gpsDeviceCode"},{title:{CN:"违规",EN:"Violation",TW:"違規"}[e.language],key:"illegalNum"},{title:{CN:"里程(km)",EN:"Mileage(km)",TW:"里程(km)"}[e.language],key:"currMiles",sortable:!0,width:110},{title:{CN:"时间",EN:"Time",TW:"時間"}[e.language],key:"modifyTime",width:150},{title:{CN:"坐标",EN:"Coordinate",TW:"座標"}[e.language],key:"currPosition",width:250,render:function(e,i){var a=JSON.parse(t.dataList[i.index].lastPosition).coordinates.join(",");return e("div",a)}}],dataList:[],allVehicleList:[],vehicleInfo:[],errInfo:{xAxisData:[],seriesData:[]},mileInfo:{xAxisData:[],seriesData:[]}},watch:{},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},pageSizeChange:function(e){var i=this;i.vehiclePositonPageInfo.pageNum=parseInt(e,10),setTimeout(function(){i.getVehicleList(!1)},200)},pageRowChange:function(e){var i=this;i.vehiclePositonPageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getVehicleList(!1)},200)},getVehicleList:function(){var e=this;e.vehiclePositionList=[],utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getAllVehiclePositonList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{span:e.vehiclePositonPageInfo.span,deptId:e.vehiclePositonPageInfo.deptId,pageNum:e.vehiclePositonPageInfo.pageNum,pageSize:e.vehiclePositonPageInfo.pageSize,vihecleId:e.vehiclePositonPageInfo.vihecleId,companyId:e.vehiclePositonPageInfo.companyId,gpsDeviceCode:e.vehiclePositonPageInfo.gpsDeviceCode,vehicleTypeId:e.vehiclePositonPageInfo.vehicleTypeId,vehicleStatus:e.vehiclePositonPageInfo.vehicleStatus,vehicleColorId:e.vehiclePositonPageInfo.vehicleColorId,vehicleBrandId:e.vehiclePositonPageInfo.vehicleBrandId,centerPosition:e.vehiclePositonPageInfo.centerPosition,vehicleName:encodeURI(e.vehiclePositonPageInfo.vehicleName),vehicleCode:encodeURI(e.vehiclePositonPageInfo.vehicleCode)},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(i){200==i.code&&(e.dataList=i.data,e.vehiclePositonPageInfo.count=i.count)}})},drawVehicle:function(e){var i=this,t=echarts.init(document.getElementById(e.id));option={title:{text:e.title,top:10,textStyle:{fontSize:13,align:"center"}},color:[e.color],tooltip:{trigger:"axis",textStyle:{fontSize:13},formatter:function(e){var t=e[0].axisValue,a=i.vehicleInfo[t].info,l=[];return l.push("结果："+e[0].value+"<br/>"),l.push("公司："+a.companyName+"<br/>"),l.push("部门："+a.deptName+"<br/>"),l.push("车辆："+a.vehicleName+"<br/>"),l.push("类型："+a.vehicleTypeName+"<br/>"),l.push("品牌："+a.vehicleBrandName+"<br/>"),l.push("颜色："+a.vehicleColorName+"<br/>"),l.push("终端："+a.gpsDeviceCode),l.join(" ")}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:e.data.xAxisData,axisTick:{alignWithLabel:!0}}],yAxis:[{type:"value"}],series:[{name:"",type:"bar",barWidth:"60%",data:e.data.seriesData}]},t.setOption(option)},formatVehicle:function(){for(var e=this,i={},t=0,a=e.allVehicleList.length;t<a;t++)i[e.allVehicleList[t].vehicleCode]={info:e.allVehicleList[t],list:[]};for(var l in i)if(i.hasOwnProperty(l))for(var o=0,n=e.allVehicleList.length;o<n;o++)e.allVehicleList[o].vehicleCode==l&&i[l].list.push(e.allVehicleList[o]);for(var c in i)if(i.hasOwnProperty(c)){var s=0,r=0;e.errInfo.xAxisData.push(c),e.mileInfo.xAxisData.push(c);for(var h=0,g=i[c].list.length;h<g;h++)s+=i[c].list[h].illegalNum,r+=i[c].list[h].currMiles;e.errInfo.seriesData.push(s),e.mileInfo.seriesData.push(r)}e.vehicleInfo=i},getAllVehicleList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getAllVehiclePositonList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{pageNum:1,pageSize:1e7},successCallback:function(i){200==i.code&&(e.allVehicleList=i.data,e.formatVehicle(),e.drawVehicle({id:"illegaInfo",color:"#C23531",data:e.errInfo,title:"车辆违章情况统计(单位/次)"}),e.drawVehicle({id:"milleInfo",color:"#2d8cf0",data:e.mileInfo,title:"车辆行驶里程统计(单位/公里)"}))}})}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getVehicleList(),e.getAllVehicleList()},500)}})})();
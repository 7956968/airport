(function(){var e=utility.getLocalStorage("language"),t=utility.getLocalStorage("userInfo"),i=utility.getLocalStorage("bizParam"),a=new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!0,isShowModal:!1,isModalLoading:!0,modalTitle:"",isShowMember:!1,isShowGroupTypeList:!1,isPermissions:!1,tableHeight:function(){var e=$(".tableContainer").height();return e-100}(),groupTypeList:i.groupType,index:0,pageInfo:{id:0,count:0,pageNum:1,pageSize:15,id:"",groupTypeId:"",groupName:"",companyId:""},selectItem:null,itemInfo:{id:"",companyId:"",groupTypeId:"",groupName:"",groupDesc:"",isValid:"1",createUserId:t.id,modifyUserId:t.id},columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"所在公司",EN:"Company Name",TW:"所在公司"}[e.language],key:"companyName"},{title:{CN:"组名称",EN:"Group Name",TW:"組名稱"}[e.language],key:"groupName"},{title:{CN:"分组类型",EN:"Gruop Type",TW:"分組類型"}[e.language],key:"groupTypeName"},{title:{CN:"组描述",EN:"Role Description",TW:"組描述"}[e.language],key:"groupDesc"},{title:{CN:"是否可用",EN:"Availability",TW:"是否可用"}[e.language],key:"isValid"},{title:{CN:"创建时间",EN:"Creation Time",TW:"創建時間"}[e.language],key:"createTime"},{title:{CN:"操作",EN:"State",TW:"操作"}[e.language],key:"state",width:200,align:"center",render:function(t,i){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){a.groupMemberPageInfo.groupId=a.groupList[i.index].id,a.groupMemberPageInfo.companyId=a.groupList[i.index].companyId,a.groupTypeId=a.groupList[i.index].groupTypeId,a.itemInfo.id=a.groupList[i.index].id,a.isShowMember=!0,a.getGroupMemberList(!0)}}},{CN:"组成员",EN:"Group Members",TW:"組成員"}[e.language]),t("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){a.isPermissions=!0}}},{CN:"数据权限",EN:"Data Permissions",TW:"數據權限"}[e.language])])}}],tableRowList:[],groupList:[],companyList:[],memberIndex:0,groupMemberList:[],groupMemberItem:{id:"",groupId:"",objectId:"",companyId:"",objectName:"",createUserName:"",modifyUserName:""},groupMemberPageInfo:{count:0,pageNum:1,pageSize:20,groupId:"",companyId:""},selectGroupMember:[],groupMemberColumsList:[{type:"selection",width:60,align:"center"},{title:{CN:"ID",EN:"ID",TW:"ID"}[e.language],width:60,key:"id"},{title:{CN:"公司名称",EN:"Company Name",TW:"公司名稱"}[e.language],key:"companyName"},{title:{CN:"组名称",EN:"Group Name",TW:"組名稱"}[e.language],key:"groupName"},{title:{CN:"成员名称",EN:"Member Name",TW:"成員名稱"}[e.language],key:"objectName"}],groupMemberDataList:[],groupTypeId:"121",groupTypePageInfo:{count:0,pageNum:1,pageSize:20},groupTypeColumsList:[],groupTypeDataList:[],selectTypeMember:[],groupTypeInterFace:{121:{service:CONFIG.SERVICE.userService,action:CONFIG.ACTION.getUserList,columnsList:"userColumnsList",tableRowList:"userTableRowList",dataList:"userList"},122:{service:CONFIG.SERVICE.areaService,action:CONFIG.ACTION.getSecureAreaList,columnsList:"areaColumnsList",tableRowList:"areaTableRowList",dataList:"areaList"},123:{service:CONFIG.SERVICE.vehicleService,action:CONFIG.ACTION.getVehicleList,columnsList:"vehicleColumnsList",tableRowList:"vehicleTableRowList",dataList:"vehicleList"},124:{service:CONFIG.SERVICE.vehicleService,action:CONFIG.ACTION.getDeviceList,columnsList:"deviceColumnsList",tableRowList:"deviceTableRowList",dataList:"deviceList"},125:{service:CONFIG.SERVICE.deviceService,action:CONFIG.ACTION.getCameraList,columnsList:"cameraColumnsList",tableRowList:"cameraTableRowList",dataList:"deviceList"}},sexTypeList:i.sexType,userStatusTypeList:i.userStatusType,userList:[],userColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"ID",EN:"ID",TW:"ID"}[e.language],width:60,key:"id"},{title:{CN:"用户姓名",EN:"Name",TW:"姓名"}[e.language],key:"userName"},{title:{CN:"性别",EN:"Gender",TW:"性別"}[e.language],key:"sex"},{title:{CN:"手机号",EN:"cellPhone No.",TW:"手機號"}[e.language],key:"mobile"},{title:{CN:"所属公司",EN:"Company",TW:"所屬公司"}[e.language],key:"company"},{title:{CN:"员工工号",EN:"Staff Number",TW:"員工工號"}[e.language],key:"userSeq"}],userTableRowList:[],areaList:[],areaColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"防区姓名",EN:"Name",TW:"姓名"}[e.language],key:"userName"},{title:{CN:"性别",EN:"Gender",TW:"性別"}[e.language],key:"sex"},{title:{CN:"手机号",EN:"cellPhone No.",TW:"手機號"}[e.language],key:"mobile"},{title:{CN:"所属公司",EN:"Company",TW:"所屬公司"}[e.language],key:"company"},{title:{CN:"员工工号",EN:"Staff Number",TW:"員工工號"}[e.language],key:"userSeq"}],areaTableRowList:[{userCode:"账号",userName:"员工姓名",userSeq:"员工工号",sex:"性别",mobile:"固话",telephone:"手机号",company:"所属公司",remark:"备注"}],vehicleList:[],vehicleColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"车辆姓名",EN:"Name",TW:"姓名"}[e.language],key:"userName"},{title:{CN:"性别",EN:"Gender",TW:"性別"}[e.language],key:"sex"},{title:{CN:"手机号",EN:"cellPhone No.",TW:"手機號"}[e.language],key:"mobile"},{title:{CN:"所属公司",EN:"Company",TW:"所屬公司"}[e.language],key:"company"},{title:{CN:"员工工号",EN:"Staff Number",TW:"員工工號"}[e.language],key:"userSeq"}],vehicleTableRowList:[{userCode:"账号",userName:"员工姓名",userSeq:"员工工号",sex:"性别",mobile:"固话",telephone:"手机号",company:"所属公司",remark:"备注"}],deviceList:[],deviceColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"定位设备姓名",EN:"Name",TW:"姓名"}[e.language],key:"userName"},{title:{CN:"性别",EN:"Gender",TW:"性別"}[e.language],key:"sex"},{title:{CN:"手机号",EN:"cellPhone No.",TW:"手機號"}[e.language],key:"mobile"},{title:{CN:"所属公司",EN:"Company",TW:"所屬公司"}[e.language],key:"company"},{title:{CN:"员工工号",EN:"Staff Number",TW:"員工工號"}[e.language],key:"userSeq"}],deviceTableRowList:[{userCode:"账号",userName:"员工姓名",userSeq:"员工工号",sex:"性别",mobile:"固话",telephone:"手机号",company:"所属公司",remark:"备注"}],cameraList:[],cameraColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"摄像头姓名",EN:"Name",TW:"姓名"}[e.language],key:"userName"},{title:{CN:"性别",EN:"Gender",TW:"性別"}[e.language],key:"sex"},{title:{CN:"手机号",EN:"cellPhone No.",TW:"手機號"}[e.language],key:"mobile"},{title:{CN:"所属公司",EN:"Company",TW:"所屬公司"}[e.language],key:"company"},{title:{CN:"员工工号",EN:"Staff Number",TW:"員工工號"}[e.language],key:"userSeq"}],cameraTableRowList:[{userCode:"账号",userName:"员工姓名",userSeq:"员工工号",sex:"性别",mobile:"固话",telephone:"手机号",company:"所属公司",remark:"备注"}],permissionsId:"931",permissionsIndex:0,permissionsItem:null,permissionInterface:{931:{service:CONFIG.SERVICE.areaService,action:CONFIG.ACTION.getSecureAreaList,columnsList:"areaColumnsList",tableRowList:"areaTableRowList"},932:{service:CONFIG.SERVICE.vehicleService,action:CONFIG.ACTION.getVehicleList,columnsList:"vehicleColumnsList",tableRowList:"vehicleTableRowList"},933:{service:CONFIG.SERVICE.deviceService,action:CONFIG.ACTION.getCameraList,columnsList:"cameraColumnsList",tableRowList:"cameraTableRowList"},934:{service:CONFIG.SERVICE.areaService,action:CONFIG.ACTION.getSecureAreaList,columnsList:"areaColumnsList",tableRowList:"areaTableRowList"},935:{service:CONFIG.SERVICE.vehicleService,action:CONFIG.ACTION.getVehicleList,columnsList:"vehicleColumnsList",tableRowList:"vehicleTableRowList"},936:{service:CONFIG.SERVICE.deviceService,action:CONFIG.ACTION.getCameraList,columnsList:"cameraColumnsList",tableRowList:"cameraTableRowList"}},permissionsPageInfo:{count:0,pageNum:1,pageSize:20},permissionsColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"组名称",EN:"Group Name",TW:"組名稱"}[e.language],key:"groupName"},{title:{CN:"公司名",EN:"Company Name",TW:"公司名稱"}[e.language],key:"companyName"},{title:{CN:"业务对象",EN:"Business Object",TW:"業務對象"}[e.language],key:"resName"}],permissionsTableRowList:[{groupName:"组名称",companyName:"公司名",resName:"业务对象"},{groupName:"组名称",companyName:"公司名",resName:"业务对象"},{groupName:"组名称",companyName:"公司名",resName:"业务对象"},{groupName:"组名称",companyName:"公司名",resName:"业务对象"},{groupName:"组名称",companyName:"公司名",resName:"业务对象"},{groupName:"组名称",companyName:"公司名",resName:"业务对象"}]},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",companyId:"",groupTypeId:"",groupName:"",groupDesc:"",isValid:"",createUserId:t.id,modifyUserId:t.id}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.groupList[e.index],e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},delItem:function(){var e=this;e.itemInfo=e.groupList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.delGroup+"&ids="+e.itemInfo.id+"&modifyUserId="+t.id,actionUrl:CONFIG.SERVICE.groupService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code?e.getGroupList(!0):e.$Message.error(t.message)}})})},selectMembers:function(){var e=this;utility.showMessageTip(e,function(){e.isShowMember=!0})},setCurrentRowData:function(e,t){var i=this;e&&(i.index=t,i.selectItem=e)},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.saveGroup,actionUrl:CONFIG.SERVICE.groupService,dataObj:{id:e.itemInfo.id,companyId:e.itemInfo.companyId,groupTypeId:e.itemInfo.groupTypeId,groupName:encodeURI(e.itemInfo.groupName),groupDesc:encodeURI(e.itemInfo.groupDesc),isValid:e.itemInfo.isValid,createUserId:t.id,modifyUserId:t.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(t){200==t.code?(e.getGroupList(!0),e.isShowModal=!1):e.$Message.error(t.message)}})},pageSizeChange:function(e){var t=this;t.pageInfo.pageNum=parseInt(e,10)-1,setTimeout(function(){t.getDataList(!1)},200)},pageRowChange:function(e){var t=this;t.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getDataList(!1)},200)},formatGroupData:function(){for(var e=this,t=0,i=e.groupList.length;t<i;t++)e.tableRowList.push({groupName:decodeURI(e.groupList[t].groupName),companyName:decodeURI(e.groupList[t].companyName),groupTypeName:e.groupList[t].groupTypeName,createTime:e.groupList[t].createTime,groupDesc:decodeURI(e.groupList[t].groupDesc),isValid:{1:{CN:"可用",EN:"Available",TW:"可用"}[e.language],0:{CN:"不可用",EN:"Unavailable",TW:"不可用"}[e.language]}[e.groupList[t].isValid+""]})},getGroupList:function(e){var t=this;1==e&&(t.tableRowList=[],t.pageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.getGroupList,actionUrl:CONFIG.SERVICE.groupService,dataObj:t.pageInfo,beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.groupList=e.data,t.pageInfo.count=e.count,t.formatGroupData())}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(t){200==t.code&&(e.companyList=t.data)}})},formatGroupMember:function(){for(var e=this,t=0,i=e.groupMemberList.length;t<i;t++)e.groupMemberDataList.push({id:decodeURI(e.groupMemberList[t].id),groupName:decodeURI(e.groupMemberList[t].groupTypeName),objectName:decodeURI(e.groupMemberList[t].objectName),companyName:decodeURI(e.groupMemberList[t].companyName)})},getGroupMemberList:function(e){var t=this;1==e&&(t.groupMemberDataList=[],t.groupMemberPageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.getGroupMemberList,actionUrl:CONFIG.SERVICE.groupService,dataObj:t.groupMemberPageInfo,beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.groupMemberList=e.data,t.groupMemberPageInfo.count=e.count,t.formatGroupMember())}})},setGroupMembeItem:function(e,t){var i=this;e&&(i.memberIndex=t,i.groupMemberItem=e)},deleteGroupMember:function(){var e=this;return 0==e.selectMember.length?void e.$Message.error({content:{CN:"请选择一条数据",EN:"Please select a data",TW:"請選擇一條數據"}[e.language],top:200,duration:3}):(e.isModalLoading=!0,void utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.delGroupMember,actionUrl:CONFIG.SERVICE.groupService,dataObj:{objectIds:e.selectMember.join(","),modifyUserId:t.id},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code&&(200==t.code?e.getGroupMemberList(!0):e.$Message.error(t.message))}}))},selectMemberChange:function(e){for(var t=this,i=[],a=0,o=e.length;a<o;a++)i.push(e[a].id);t.selectMember=i},groupMemberPageSizeChange:function(e){var t=this;t.groupMemberPageInfo.pageNum=parseInt(e,10)-1,setTimeout(function(){t.getGroupMemberList(!1)},200)},groupMemberPageRowChange:function(e){var t=this;t.groupMemberPageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getGroupMemberList(!1)},200)},groupTypePageSizeChange:function(e){var t=this;t.groupTypePageInfo.pageNum=parseInt(e,10)-1,setTimeout(function(){t.getGroupMemberList(!1)},200)},groupTypePageRowChange:function(e){var t=this;t.groupTypePageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getGroupMemberList(!1)},200)},showPermissionsList:function(){var e=this;e.groupTypeColumsList=e[e.permissionInterface[e.permissionsId].columnsList],e.groupTypeDataList=e[e.permissionInterface[e.permissionsId].tableRowList],e.isShowGroupTypeList=!0},groupTypeChange:function(e){var t=this;t.groupTypeId=e,setTimeout(function(){t.showGroupTypeList(!1)},500)},formatGroupTypeData:function(){var e=this,t=e[e.groupTypeInterFace[e.groupTypeId].dataList];if("121"==e.groupTypeId)for(var i=0,a=t.length;i<a;i++)e[e.groupTypeInterFace[e.groupTypeId].tableRowList].push({id:t[i].id,userCode:t[i].userCode,userName:decodeURI(t[i].userName),userSeq:t[i].userSeq,mobile:t[i].mobile,telephone:t[i].telephone,company:decodeURI(t[i].companyName),remark:decodeURI(t[i].remark),sex:function(){for(var a="",o=0,r=e.sexTypeList.length;o<r;o++)if(e.sexTypeList[o].type==t[i].sex){a=e.sexTypeList[o].name;break}return a}(),state:function(){for(var a="",o=0,r=e.userStatusTypeList.length;o<r;o++)if(e.userStatusTypeList[o].type==t[i].status){a=e.userStatusTypeList[o].name;break}return a}()})},getGroupTypeDataList:function(e){var t=this;t[t.groupTypeInterFace[t.groupTypeId].tableRowList]=[],t.groupTypePageInfo.pageNum=0,utility.interactWithServer({url:CONFIG.HOST+t.groupTypeInterFace[t.groupTypeId].service+"?action="+t.groupTypeInterFace[t.groupTypeId].action,actionUrl:t.groupTypeInterFace[t.groupTypeId].service,dataObj:t.groupTypePageInfo,beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(i){200==i.code&&(t[t.groupTypeInterFace[t.groupTypeId].dataList]=i.data,t.groupTypePageInfo.count=i.count,t.formatGroupTypeData(),!!e&&e())}})},showGroupTypeList:function(e){var t=this;t.getGroupTypeDataList(function(){t.groupTypeColumsList=t[t.groupTypeInterFace[t.groupTypeId].columnsList],t.groupTypeDataList=t[t.groupTypeInterFace[t.groupTypeId].tableRowList],t.isShowGroupTypeList=e})},selectTypeMemberChange:function(e){for(var t=this,i=[],a=0,o=e.length;a<o;a++)i.push(e[a].id);t.selectTypeMember=i},addGroupTypeMember:function(){var e=this;return 0==e.selectTypeMember.length?void e.$Message.error({content:{CN:"请选择一条数据",EN:"Please select a data",TW:"請選擇一條數據"}[e.language],top:200,duration:3}):void utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.saveGroupMember,actionUrl:CONFIG.SERVICE.groupService,dataObj:{groupId:e.itemInfo.id,objectIds:e.selectTypeMember.join(","),modifyUserId:t.id,createUserId:t.id},beforeSendCallback:function(){e.isModalLoading=!0},completeCallback:function(){e.isModalLoading=!1},successCallback:function(t){200==t.code?(e.getGroupMemberList(!0),e.isShowGroupTypeList=!1):e.$Message.error(t.message)}})},getUserGroupDataResList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.getUserGroupDataResList,actionUrl:CONFIG.SERVICE.groupService,dataObj:{groupId:e.permissionsItem.id,modifyUserId:t.id},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(e){200==e.code}})},setPermissionsItem:function(e,t){var i=this;e&&(i.permissionsIndex=t,i.permissionsItem=e)},deletePermissions:function(){},permissionsPageSizeChange:function(e){var t=this;t.permissionsPageInfo.pageNum=parseInt(e,10)-1,setTimeout(function(){t.getGroupMemberList(!1)},200)},permissionsPageRowChange:function(e){var t=this;console.log(e),t.permissionsPageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getGroupMemberList(!1)},200)},permissionsChange:function(e){var t=this;t.permissionsId=e}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getGroupList(!0),e.getCompanyList()},500)}})})();
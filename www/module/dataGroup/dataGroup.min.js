(function(){var e,i=utility.getLocalStorage("language"),t=utility.getLocalStorage("userInfo"),a=utility.getLocalStorage("bizParam"),o=new Vue({el:"#js-vue",data:{language:i?i.language:"CN",isTableLoading:!0,isAddTableLoading:!0,isShowModal:!1,isModalLoading:!0,modalTitle:"",isShowMember:!1,isShowGroupTypeList:!1,isPermissions:!1,isFunctionList:!1,tableHeight:(e=$(".tableContainer").height(),e-100),groupTypeList:a.groupType,index:0,pageInfo:{id:"",count:0,pageNum:1,pageSize:20,groupName:"",companyId:"",groupTypeId:123},selectItem:null,itemInfo:{id:"",companyId:"",groupName:"",groupDesc:"",isValid:1,groupTypeId:123,createUserId:t.id,modifyUserId:t.id},columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"所在公司",EN:"Company Name",TW:"所在公司"}[i.language],key:"companyName",width:180},{title:{CN:"组名称",EN:"Group Name",TW:"組名稱"}[i.language],key:"groupName"},{title:{CN:"分组类型",EN:"Gruop Type",TW:"分組類型"}[i.language],key:"groupTypeName"},{title:{CN:"组描述",EN:"Role Description",TW:"組描述"}[i.language],key:"groupDesc"},{title:{CN:"是否可用",EN:"Availability",TW:"是否可用"}[i.language],key:"isValid"},{title:{CN:"创建时间",EN:"Creation Time",TW:"創建時間"}[i.language],key:"createTime"},{title:{CN:"操作",EN:"State",TW:"操作"}[i.language],key:"state",width:200,align:"center",render:function(e,t){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.groupMemberPageInfo.groupId=o.groupList[t.index].id,o.groupMemberPageInfo.companyId=o.groupList[t.index].companyId,o.groupTypeId=123,o.itemInfo.id=o.groupList[t.index].id,o.isShowMember=!0,o.getGroupMemberList(!0)}}},{CN:"组成员",EN:"Group Members",TW:"組成員"}[i.language]),e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.index=t.index,o.selectItem=t.row,o.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[i.language]),e("Button",{props:{type:"error",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.index=t.index,o.selectItem=t.row,o.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[i.language])])}}],tableRowList:[],groupList:[],companyList:[],groupMemberList:[],groupMemberItem:{id:"",groupId:"",objectId:"",companyId:"",objectName:"",createUserId:t.id,modifyUserId:t.id},groupMemberPageInfo:{count:0,pageNum:1,pageSize:20,groupId:"",companyId:""},selectGroupMember:[],groupMemberColumsList:[{type:"selection",width:60,align:"center"},{title:{CN:"公司名称",EN:"Company Name",TW:"公司名稱"}[i.language],key:"companyName"},{title:{CN:"组名称",EN:"Group Name",TW:"組名稱"}[i.language],key:"groupName"},{title:{CN:"成员名称",EN:"Member Name",TW:"成員名稱"}[i.language],key:"objectName"}],groupMemberDataList:[],groupTypeId:123,groupTypePageInfo:{count:0,pageNum:1,pageSize:1e4},groupTypeColumsList:[],groupTypeDataList:[],selectTypeMember:[],selectMember:[],groupTypeInterFace:{121:{service:CONFIG.SERVICE.userService,action:CONFIG.ACTION.getUserList,columnsList:"userColumnsList",tableRowList:"userTableRowList",dataList:"userList"},122:{service:CONFIG.SERVICE.areaService,action:CONFIG.ACTION.getSecureAreaList,columnsList:"areaColumnsList",tableRowList:"areaTableRowList",dataList:"areaList"},123:{service:CONFIG.SERVICE.vehicleService,action:CONFIG.ACTION.getVehicleList,columnsList:"vehicleColumnsList",tableRowList:"vehicleTableRowList",dataList:"vehicleList"},124:{service:CONFIG.SERVICE.deviceService,action:CONFIG.ACTION.getDeviceList,columnsList:"deviceColumnsList",tableRowList:"deviceTableRowList",dataList:"deviceList"},125:{service:CONFIG.SERVICE.deviceService,action:CONFIG.ACTION.getCameraList,columnsList:"cameraColumnsList",tableRowList:"cameraTableRowList",dataList:"deviceList"}},sexTypeList:a.sexType,userStatusTypeList:a.userStatusType,userList:[],userColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"用户姓名",EN:"Name",TW:"姓名"}[i.language],key:"userName"},{title:{CN:"性别",EN:"Gender",TW:"性別"}[i.language],key:"sex"},{title:{CN:"手机号",EN:"cellPhone No.",TW:"手機號"}[i.language],key:"mobile"},{title:{CN:"所属公司",EN:"Company",TW:"所屬公司"}[i.language],key:"company"},{title:{CN:"员工工号",EN:"Staff Number",TW:"員工工號"}[i.language],key:"userSeq"}],userTableRowList:[],areaList:[],areaColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"名称",EN:"Name",TW:"名稱"}[i.language],key:"areaName"},{title:{CN:"编码",EN:"Code",TW:"編碼"}[i.language],key:"areaCode"},{title:{CN:"状态",EN:"Status",TW:"狀態"}[i.language],key:"secureStatus"},{title:{CN:"速度上限",EN:"Speed Limit",TW:"速度上限"}[i.language],key:"speedLimit"},{title:{CN:"停留时长",EN:"Length Of Stay",TW:"停留時長"}[i.language],key:"staySecond"}],areaTableRowList:[],vehicleList:[],vehicleColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"公司",EN:"Company",TW:"公司"}[i.language],key:"companyName"},{title:{CN:"车牌号",EN:"Name",TW:"名稱"}[i.language],key:"licenseNumber"},{title:{CN:"类型",EN:"Type",TW:"類型"}[i.language],key:"vehicleTypeName"}],vehicleTableRowList:[],deviceList:[],deviceColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"公司",EN:"Company",TW:"公司"}[i.language],key:"companyName"},{title:{CN:"运行状态",EN:"Working Condition",TW:"運行狀態"}[i.language],key:"deviceStatusName"},{title:{CN:"供应商",EN:"Supplier",TW:"廠家名稱"}[i.language],key:"providerName"},{title:{CN:"系统版本",EN:"System Version",TW:"系統版本"}[i.language],key:"versionName"},{title:{CN:"系统版本号",EN:"System Version No.",TW:"系統版本號"}[i.language],key:"versionNum"}],deviceTableRowList:[],cameraList:[],cameraColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"公司",EN:"Company",TW:"公司"}[i.language],key:"companyName"},{title:{CN:"名称",EN:"Name",TW:"名稱"}[i.language],key:"cameraName"},{title:{CN:"公司",EN:"Company",TW:"公司"}[i.language],key:"companyName"},{title:{CN:"编码",EN:"Code",TW:"編碼"}[i.language],key:"cameraCode"},{title:{CN:"描述",EN:"Describe",TW:"描述"}[i.language],key:"cameraDesc"}],cameraTableRowList:[],permissionsItem:{id:"",groupId:"",groupName:"",companyId:"",companyName:"",resId:"",resName:"",resTypeId:"",resTypeName:"",createUserName:"",modifyUserName:""},selectPermission:[],permissionList:[],permissionsPageInfo:{count:0,pageNum:1,pageSize:20,groupId:"",companyId:""},permissionsColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"组名称",EN:"Group Name",TW:"組名稱"}[i.language],key:"groupName"},{title:{CN:"公司名",EN:"Company Name",TW:"公司名稱"}[i.language],key:"companyName"},{title:{CN:"业务对象",EN:"Business Object",TW:"業務對象"}[i.language],key:"resName"}],permissionsTableRowList:[],functionsPageInfo:{count:0,pageNum:1,pageSize:20},functionList:[],selectFunction:[],permissionFunctionTypeLis:a.permissionFunctionType,functionsColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"功能层级",EN:"Functions Name",TW:"功能層級"}[i.language],key:"functionLevel"},{title:{CN:"功能类型",EN:"Functions Type",TW:"功能類型"}[i.language],key:"functionType"},{title:{CN:"功能名称",EN:"Functions Name",TW:"功能名稱"}[i.language],key:"functionName"},{title:{CN:"是否可用",EN:"isValid",TW:"是否可用"}[i.language],key:"isValid"}],functionsTableRowList:[]},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",companyId:"",groupTypeId:123,groupName:"",groupDesc:"",isValid:1,createUserId:t.id,modifyUserId:t.id}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.groupList[e.index],e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.groupList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.delGroup+"&ids="+e.itemInfo.id+"&modifyUserId="+t.id,actionUrl:CONFIG.SERVICE.groupService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(i){200==i.code?e.getGroupList(!0):e.$Message.error(i.message)}})})}})},selectMembers:function(){var e=this;utility.showMessageTip(e,function(){e.isShowMember=!0})},setCurrentRowData:function(e,i){var t=this;e&&(t.index=i,t.selectItem=e)},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.saveGroup,actionUrl:CONFIG.SERVICE.groupService,dataObj:{id:e.itemInfo.id,companyId:e.itemInfo.companyId,groupTypeId:e.itemInfo.groupTypeId,groupName:encodeURI(e.itemInfo.groupName),groupDesc:encodeURI(e.itemInfo.groupDesc),isValid:e.itemInfo.isValid,createUserId:t.id,modifyUserId:t.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(i){200==i.code?(e.getGroupList(!0),e.isShowModal=!1):e.$Message.error(i.message)}})},pageSizeChange:function(e){var i=this;i.pageInfo.pageNum=parseInt(e,10),setTimeout(function(){i.getDataList(!1)},200)},pageRowChange:function(e){var i=this;i.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getDataList(!1)},200)},formatGroupData:function(){for(var e=this,i=0,t=e.groupList.length;i<t;i++)e.tableRowList.push({groupName:decodeURI(e.groupList[i].groupName),companyName:decodeURI(e.groupList[i].companyName),groupTypeName:e.groupList[i].groupTypeName,createTime:e.groupList[i].createTime,groupDesc:decodeURI(e.groupList[i].groupDesc),isValid:{1:{CN:"可用",EN:"Available",TW:"可用"}[e.language],0:{CN:"不可用",EN:"Unavailable",TW:"不可用"}[e.language]}[e.groupList[i].isValid+""]})},getGroupList:function(e){var i=this;i.tableRowList=[],1==e&&(i.pageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.getGroupList,actionUrl:CONFIG.SERVICE.groupService,dataObj:i.pageInfo,beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.groupList=e.data,i.pageInfo.count=e.count,i.formatGroupData())}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(i){200==i.code&&(e.companyList=i.data)}})},formatGroupMember:function(){for(var e=this,i=0,t=e.groupMemberList.length;i<t;i++)e.groupMemberDataList.push({id:decodeURI(e.groupMemberList[i].id),groupName:decodeURI(e.groupMemberList[i].groupTypeName),objectName:decodeURI(e.groupMemberList[i].objectName),companyName:decodeURI(e.groupMemberList[i].companyName)})},getGroupMemberList:function(e){var i=this;i.groupMemberDataList=[],1==e&&(i.groupMemberPageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.getGroupMemberList,actionUrl:CONFIG.SERVICE.groupService,dataObj:i.groupMemberPageInfo,beforeSendCallback:function(){i.isAddTableLoading=!0},completeCallback:function(){i.isAddTableLoading=!1},successCallback:function(e){200==e.code&&(i.groupMemberList=e.data,i.groupMemberPageInfo.count=e.count,i.formatGroupMember())}})},deleteGroupMember:function(){var e=this;0!=e.selectMember.length?(e.isModalLoading=!0,utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.delGroupMember,actionUrl:CONFIG.SERVICE.groupService,dataObj:{objectIds:e.selectMember.join(","),modifyUserId:t.id},beforeSendCallback:function(){e.isAddTableLoading=!0},completeCallback:function(){e.isAddTableLoading=!1},successCallback:function(i){200==i.code&&(200==i.code?e.getGroupMemberList(!0):e.$Message.error(i.message))}})):e.$Message.error({content:{CN:"请选择一条数据",EN:"Please select a data",TW:"請選擇一條數據"}[e.language],top:200,duration:3})},selectMemberChange:function(e){for(var i=this,t=[],a=0,o=e.length;a<o;a++)t.push(e[a].id);i.selectMember=t},groupMemberPageSizeChange:function(e){var i=this;i.groupMemberPageInfo.pageNum=parseInt(e,10),setTimeout(function(){i.getGroupMemberList(!1)},200)},groupMemberPageRowChange:function(e){var i=this;i.groupMemberPageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getGroupMemberList(!1)},200)},groupTypePageSizeChange:function(e){var i=this;i.groupTypePageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.showGroupTypeList(!1)},200)},groupTypePageRowChange:function(e){var i=this;i.groupTypePageInfo.pageNum=parseInt(e,10),setTimeout(function(){i.showGroupTypeList(!1)},200)},formatGroupTypeData:function(){var e=this,i=e[e.groupTypeInterFace[e.groupTypeId].dataList];e[e.groupTypeInterFace[e.groupTypeId].tableRowList]=i},getGroupTypeDataList:function(e,i){var t=this;t[t.groupTypeInterFace[t.groupTypeId].dataList]=[],t[t.groupTypeInterFace[t.groupTypeId].tableRowList]=[],1==e&&(t.groupTypePageInfo.pageNum=1),utility.interactWithServer({url:CONFIG.HOST+t.groupTypeInterFace[t.groupTypeId].service+"?action="+t.groupTypeInterFace[t.groupTypeId].action,actionUrl:t.groupTypeInterFace[t.groupTypeId].service,dataObj:{companyId:t.groupMemberPageInfo.companyId,pageNum:t.groupTypePageInfo.pageNum,pageSize:t.groupTypePageInfo.pageSize},beforeSendCallback:function(){t.isAddTableLoading=!0},completeCallback:function(){t.isAddTableLoading=!1},successCallback:function(e){200==e.code&&(t[t.groupTypeInterFace[t.groupTypeId].dataList]=e.data.reverse(),t.groupTypePageInfo.count=e.count,t.formatGroupTypeData(),i&&i())}})},showGroupTypeList:function(e){var i=this;i.getGroupTypeDataList(e,function(){i.groupTypeColumsList=i[i.groupTypeInterFace[i.groupTypeId].columnsList],i.groupTypeDataList=i[i.groupTypeInterFace[i.groupTypeId].tableRowList],0!=i.groupTypeDataList.lengt?i.isShowGroupTypeList=!0:i.$Message.error("没有成员数组")})},selectTypeMemberChange:function(e){for(var i=this,t=[],a=0,o=e.length;a<o;a++)t.push(e[a].id);i.selectTypeMember=t},addGroupTypeMember:function(){var e=this;0!=e.selectTypeMember.length?utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.saveGroupMember,actionUrl:CONFIG.SERVICE.groupService,dataObj:{groupId:e.itemInfo.id,objectIds:e.selectTypeMember.join(","),modifyUserId:t.id,createUserId:t.id},beforeSendCallback:function(){e.isModalLoading=!0},completeCallback:function(){e.isModalLoading=!1},successCallback:function(i){200==i.code?(e.getGroupMemberList(!0),e.isShowGroupTypeList=!1):e.$Message.error(i.message)}}):e.$Message.error({content:{CN:"请选择一条数据",EN:"Please select a data",TW:"請選擇一條數據"}[e.language],top:200,duration:3})},getUserGroupDataResList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.getUserGroupDataResList,actionUrl:CONFIG.SERVICE.groupService,dataObj:{groupId:e.permissionsItem.id,modifyUserId:t.id},beforeSendCallback:function(){e.isAddTableLoading=!0},completeCallback:function(){e.isAddTableLoading=!1},successCallback:function(e){e.code}})},selectPermissionChange:function(e){for(var i=this,t=[],a=0,o=e.length;a<o;a++)t.push(e[a].id);i.selectPermission=t},permissionsPageSizeChange:function(e){var i=this;i.permissionsPageInfo.pageNum=parseInt(e,10),setTimeout(function(){i.getPermissionsDataList(!1)},200)},permissionsPageRowChange:function(e){var i=this;i.permissionsPageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getPermissionsDataList(!1)},200)},formatPermission:function(){for(var e=this,i=0,t=e.permissionList.length;i<t;i++)e.permissionsTableRowList.push({id:decodeURI(e.permissionList[i].id),groupName:decodeURI(e.permissionList[i].groupName),companyName:decodeURI(e.permissionList[i].companyName),resName:decodeURI(e.permissionList[i].resName)})},getPermissionsDataList:function(e){var i=this;i.permissionsTableRowList=[],1==e&&(i.permissionsPageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.getUserGroupDataResList,actionUrl:CONFIG.SERVICE.permissionService,dataObj:i.permissionsPageInfo,beforeSendCallback:function(){i.isAddTableLoading=!0},completeCallback:function(){i.isAddTableLoading=!1},successCallback:function(e){200==e.code?(i.permissionList=e.data,i.permissionsPageInfo.count=e.count,i.formatPermission()):i.$Message.error(e.message)}})},deletePermissions:function(){var e=this;0!=e.selectPermission.length?(e.isModalLoading=!0,utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.delUserGroupDataResList,actionUrl:CONFIG.SERVICE.permissionService,dataObj:{resIds:e.selectPermission.join(","),modifyUserId:t.id},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(i){200==i.code&&(200==i.code?e.getPermissionsDataList(!0):e.$Message.error(i.message))}})):e.$Message.error({content:{CN:"请选择一条数据",EN:"Please select a data",TW:"請選擇一條數據"}[e.language],top:200,duration:3})},uploadPermissionsDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.saveUserGroupDataRes,actionUrl:CONFIG.SERVICE.permissionService,dataObj:{groupId:e.permissionsPageInfo.groupId,resIds:e.selectFunction.join(","),createUserId:t.id,modifyUserId:t.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(i){200==i.code?(e.getPermissionsDataList(!0),e.isFunctionList=!1):e.$Message.error(i.message)}})},showFunctionsLayer:function(){var e=this;e.isFunctionList=!0,e.getFunctionsDataList(!0)},selectFunctionsChange:function(e){for(var i=this,t=[],a=0,o=e.length;a<o;a++)t.push(e[a].id);i.selectFunction=t},formatFunctions:function(){for(var e=this,i=0,t=e.functionList.length;i<t;i++)e.functionsTableRowList.push({id:e.functionList[i].id,functionLevel:e.functionList[i].functionLevel,functionType:function(){for(var i="",t=0,a=e.permissionFunctionTypeLis.length;t<a;t++)if(e.permissionFunctionTypeLis[t].type==e.functionList[t].functionType){i=e.permissionFunctionTypeLis[t].name;break}return i}(),functionName:decodeURI(e.functionList[i].functionName),functionCode:decodeURI(e.functionList[i].functionCode),isValid:{1:{CN:"是",EN:"Yes",TW:"是"}[e.language],0:{CN:"否",EN:"No",TW:"否"}[e.language]}[e.functionList[i].isValid+""]})},getFunctionsDataList:function(e){var i=this;i.functionsTableRowList=[],1==e&&(i.functionsPageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.getFunctionList,actionUrl:CONFIG.SERVICE.permissionService,dataObj:i.functionsPageInfo,beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code?(i.functionList=e.data,i.functionsPageInfo.count=e.count,i.formatFunctions()):i.$Message.error(e.message)}})},functionsPageSizeChange:function(e){var i=this;i.functionsPageInfo.pageNum=parseInt(e,10)-1,setTimeout(function(){i.getFunctionsDataList(!1)},200)},functionsPageRowChange:function(e){var i=this;console.log(e),i.functionsPageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getFunctionsDataList(!1)},200)}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getGroupList(!0),e.getCompanyList()},500)}})})();
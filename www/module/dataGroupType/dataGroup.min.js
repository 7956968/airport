(function(){var e,t=utility.getLocalStorage("language"),i=utility.getLocalStorage("userInfo"),a=utility.getLocalStorage("bizParam"),s=new Vue({el:"#js-vue",data:{language:t?t.language:"CN",isTableLoading:!0,isAddTableLoading:!0,isShowModal:!1,isModalLoading:!0,modalTitle:"",isShowMember:!1,isShowGroupTypeList:!1,isPermissions:!1,isFunctionList:!1,tableHeight:(e=$(".tableContainer").height(),e-100),groupTypeList:a.groupType,index:0,count:0,pageInfo:{groupName:"",userName:"",userCode:"",companyId:""},page:{pageNum:1,pageSize:20},selectUser:[],selectGroup:[],selectItem:{companyId:"",groupIds:[],userIds:[],createUserId:i.id,modifyUserId:i.id},columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"所在公司",EN:"Company Name",TW:"所在公司"}[t.language],key:"companyName"},{title:{CN:"组名称",EN:"Group Name",TW:"組名稱"}[t.language],key:"groupName"},{title:{CN:"用户名",EN:"Gruop Type",TW:"分組類型"}[t.language],key:"userName"},{title:{CN:"操作",EN:"State",TW:"操作"}[t.language],key:"state",width:200,align:"center",render:function(e,i){return e("div",[e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){s.index=i.index,s.selectItem=i.row,s.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[t.language]),e("Button",{props:{type:"error",size:"small"},style:{marginRight:"5px"},on:{click:function(){s.index=i.index,s.selectItem=i.row,s.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[t.language])])}}],tableRowList:[],companyList:[],userList:[],groupList:[]},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.selectUser=[],e.selectGroup=[],e.selectItem={id:"",companyId:"",groupIds:"",userIds:"",createUserId:i.id,modifyUserId:i.id}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.selectItem=e.tableRowList[e.index],e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.selectItem=e.tableRowList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.delUserGroups+"&ids="+e.selectItem.id+"&modifyUserId="+i.id,actionUrl:CONFIG.SERVICE.permissionService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code?e.getUserGroupList(!0):e.$Message.error(t.message)}})})}})},setCurrentRowData:function(e,t){var i=this;e&&(i.index=t,i.selectItem=e,i.selectItem.userIds=e.userId,i.selectItem.groupIds=e.resId,i.selectUser=[e.userId],i.selectGroup=[e.resId],i.getUserList(),i.getGroupList())},companyChange:function(e){var t=this;t.selectItem.companyId=e,t.selectUser=[],t.selectGroup=[],t.getUserList(),t.getGroupList()},userListChange:function(e){var t=this;t.selectItem.userIds=e.join(",")},groupListChange:function(e){var t=this;t.selectItem.groupIds=e.join(",")},uploadDataToServer:function(){var e=this;""!=e.selectItem.companyId?""!=e.selectItem.userIds?""!=e.selectItem.groupIds?utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.saveUserGroups,actionUrl:CONFIG.SERVICE.permissionService,dataObj:{id:e.selectItem.id,groupIds:e.selectItem.groupIds,userIds:e.selectItem.userIds,createUserId:i.id,modifyUserId:i.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(t){200==t.code?(e.getUserGroupList(!0),e.isShowModal=!1):e.$Message.error(t.message)}}):e.$Message.error("请选择资源组"):e.$Message.error("请选择用户"):e.$Message.error("请选择公司")},pageSizeChange:function(e){var t=this;t.page.pageNum=parseInt(e,10),setTimeout(function(){t.getUserGroupList(!1)},200)},pageRowChange:function(e){var t=this;t.page.pageSize=parseInt(e,10),setTimeout(function(){t.getUserGroupList(!0)},200)},forMatUserGroupList:function(e){for(var t={},i=0,a=e.length;i<a;i++)t[e[i].userId]={companyName:"",companyId:"",userName:"",resIds:"",userIds:"",groupNames:"",createTime:"2019-12-29 15:44:49",id:""};for(var s in t){var o=0;for(e.length;o<a;o++)e[o].userId==s&&(t[s].companyName=e[o].companyName,t[s].companyId=e[o].companyId,t[s].userName=e[o].userName,t[s].resIds=t[s].resIds?t[s].resIds+","+e[o].resId:e[o].resId,t[s].userIds=t[s].userIds?t[s].userIds+","+e[o].userId:e[o].userId,t[s].groupNames=t[s].groupNames?t[s].groupNames+","+e[o].groupName:e[o].groupName)}},getUserGroupList:function(e){var t=this;t.tableRowList=[],1==e&&(t.page.pageNum=0,t.page.count=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.getUserGroupList,actionUrl:CONFIG.SERVICE.permissionService,dataObj:{pageNum:t.page.pageNum,pageSize:t.page.pageSize,groupName:encodeURI(t.pageInfo.groupName),userName:encodeURI(t.pageInfo.userName),userCode:encodeURI(t.pageInfo.userCode),companyId:t.pageInfo.companyId},beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.count=e.count,t.forMatUserGroupList(e.data),t.tableRowList=e.data)}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(t){200==t.code&&(e.companyList=t.data)}})},getUserList:function(){var e=this;if(null==e.selectItem.companyId)return e.userList=[],void(e.selectUser=[]);utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.getUserList,actionUrl:CONFIG.SERVICE.userService,dataObj:{pageNum:1,pageSize:1e5,companyId:e.selectItem.companyId},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code&&(e.userList=t.data)}})},getGroupList:function(e){var t=this;if(null==t.selectItem.companyId)return t.groupList=[],void(t.selectGroup=[]);utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.groupService+"?action="+CONFIG.ACTION.getGroupList,actionUrl:CONFIG.SERVICE.groupService,dataObj:{pageNum:1,pageSize:1e5,companyId:t.selectItem.companyId},beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.groupList=e.data)}})}},created:function(){var e=this,t=null;utility.isLogin(!1),setTimeout(function(){e.getUserGroupList(!0),e.getCompanyList()},500),e.$watch("pageInfo",function(){clearTimeout(t),t=setTimeout(()=>{e.getUserGroupList(!0)},200)},{deep:!0})}})})();
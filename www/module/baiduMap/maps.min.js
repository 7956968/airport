(function(){var e,i=utility.getLocalStorage("language"),a=utility.getLocalStorage("airPort"),n=utility.getLocalStorage("userInfo"),t=utility.getLocalStorage("bizParam"),o=utility.getLocalStorage("userFuncList"),s=function(){var e={isViewVideo:!1,isSearch:!1,isTrack:!1};for(var i in o)if(o.hasOwnProperty(i))for(var a=0,n=o[i].length;a<n;a++)"device_manage_view_video"==o[i][a].functionCode&&(e.isViewVideo=!0),"map_query_live_vehicle"==o[i][a].functionCode&&(e.isSearch=!0),"map_view_track"==o[i][a].functionCode&&(e.isTrack=!0),"device_manage_secure_area"==o[i][a].functionCode&&(e.isDefense=!0),"device_manage_camera"==o[i][a].functionCode&&(e.isCamera=!0);return e}();Vue.use(VueBaiduMap.default,{ak:"eCaU3zoABU2Ggtuc8vAoTrkc"}),window.pageVue=new Vue({el:"#js-vue",components:{"bml-marker-clusterer":VueBaiduMap.BmlMarkerClusterer},data:{functionInfo:s,isShenZhen:!1,deleteLoading:!1,addLoading:!1,language:i?i.language:"CN",airPort:a?[parseFloat(a.airPort.split(",")[0],10),parseFloat(a.airPort.split(",")[1],10)]:[113.8077,22.6286],companyList:[],departmentList:[],userFuncList:o,searchId:"",searchCode:"",openInfoWidth:0,openInfoHeight:0,baiduMapInfo:{BMap:null,map:null,mapType:"BMAP_NORMAL_MAP",center:{lng:0,lat:0},zoom:18,overviewMapControl:null,speed:60,vehicleMarkers:{},markerClusterer:null,openInfoWindow:{type:"",show:!1,show:!1,position:{lng:0,lat:0}},animationInfo:{timeInterval:null,coordinates:[],trajectoryInfo:[],curveInfo:[],pointInfo:[],zeroPointInfo:[],startPoint:{url:CONFIG.HOST+"/airport/assets/img/start.png",size:{width:30,height:42}},endPoint:{url:CONFIG.HOST+"/airport/assets/img/end.png",size:{width:30,height:42}},moveVehicle:null,speed:90,trajectoryItem:{time:"",speed:"",coordinate:[],position:{lng:0,lat:0},vehicleCode:"",companyName:"",deptName:"",vehicleName:"",licenseNumber:"",lastGpsTime:"",vehicleTypeName:"",address:""}},camera:{},cameraClusterer:null,cameraMarkers:[],defensList:{},defensPath:[],isCloseDefensPath:!1,defensPathEdit:!0,layersInfo:{isSeat:!0,isAlarm:!0,isVehicle:!0,isDefense:!0,isCamera:!0}},modal:{isLayer:!1,isAlarm:!1,isCamera:!1,isSearch:!1,isVehicle:!1,isHistory:!1,isDefense:!1},layerControl:["seat","alarm","vehicle","defens","camera"],vehiclePageInfo:{id:"",count:0,pageNum:1,deptId:"",pageSize:15,vehicleName:"",vehicleCode:"",gpsDeviceCode:""},vehiclePositonPageInfo:{span:1e3,count:0,pageNum:1,deptId:"",pageSize:15,companyId:"",id:"",vehicleName:"",vehicleCode:"",licenseNumber:"",gpsDeviceCode:"",vehicleTypeId:"",vehicleStatus:"",useStatus:-1,vehicleColorId:"",vehicleBrandId:"",centerPosition:""},vehicleItem:{id:"",speed:"",power:"",deptId:"",deptName:"",modifyTime:"",gpsDeviceId:"",companyName:"",vehicleName:"",vehicleCode:"",lastPosition:"",vehicleTypeId:"",gpsDeviceCode:"",vehicleStatus:"",vehicleColorId:"",vehicleBrandId:"",vehicleStatusName:""},vehicleItemPop:null,vehicleList:[],isAddVehiclePosition:!1,isDbClickSearch:!1,terminalStatusList:t.terminalStatus,vehicleColorList:t.vehicleColor,vehicleTypeList:t.vehicleType,vehicleBrandList:t.vehicleBrand,secureAreaLimitTypeList:t.secureAreaLimitType,vehicleColumns:[{title:{CN:"名称",EN:"Name",TW:"名稱"}[i.language],key:"vehicleName"},{title:{CN:"类型",EN:"Type",TW:"類型"}[i.language],key:"vehicleTypeId"},{title:{CN:"编码",EN:"Code",TW:"編碼"}[i.language],key:"vehicleCode"},{title:{CN:"状态",EN:"State",TW:"狀態"}[i.language],key:"vehicleStatus"}],vehicleDatas:[],vehiclePositionItem:{o:"",id:"",speed:"",power:"",deptId:"",deptName:"",modifyTime:"",gpsDeviceId:"",companyName:"",vehicleName:"",vehicleCode:"",lastPosition:"",vehicleTypeId:"",gpsDeviceCode:"",vehicleStatus:"",vehicleColorId:"",vehicleBrandId:"",vehicleStatusName:""},vehiclePositionList:[],hasDrawVehicleList:[],singleVehiclePageInfo:{date:new Date,endTime:"",id:"",beginTime:"",lastGpsTime:"",vehicleCode:"",licenseNumber:"",gpsDeviceCode:""},vehicleAddressDetail:"",trackItem:{coordinate:[],licenseNumber:""},isTrackItem:!1,dateTimeInfo:{date:new Date,beginDate:(e=utility.getDateDetailInfo(),e.year+"-"+e.month+"-"+e.date),endDate:function(){var e=utility.getDateDetailInfo();return e.year+"-"+e.month+"-"+e.date}(),beginTime:"00:00:00",endTime:"23:59:59"},singleVehicleItem:{},historyColumns:[],historyDatas:[],isAddDefensAction:!1,isAddDefensDetailInfo:!1,isDrawDefening:!1,isDeleteDefens:!1,secureAreaStatusList:t.secureAreaStatus,defensPageInfo:{count:0,pageNum:1,pageSize:15,areaName:"",companyId:"",secureStatus:"",fromInfo:!1},defensAreaDetailInfo:{id:"",opType:1,companyId:"",deptId:"",deptIds:[],areaName:"",areaCode:"",secureStatus:"",areaRangeStr:"",speedLimit:"",staySecond:"",canEnter:"",canExit:"",canStay:"",remark:"",createUserId:n.id,modifyUserId:n.id},defensColumns:[{title:{CN:"名称",EN:"Name",TW:"名稱"}[i.language],key:"areaName",fixed:"left",width:120},{title:{CN:"编码",EN:"Code",TW:"編碼"}[i.language],key:"areaCode",width:120},{title:{CN:"状态",EN:"Status",TW:"狀態"}[i.language],key:"secureStatus",width:120},{title:{CN:"速度上限",EN:"Speed Limit",TW:"速度上限"}[i.language],key:"speedLimit",width:120},{title:"停留时长",key:"staySecond",width:120,render:function(e,i){return e("div",[e("span",{},i.row.staySecond+"（秒）")])}},{title:{CN:"操作",EN:"Operation",TW:"操作"}[i.language],key:"operation",fixed:"right",width:80,render:function(e,a){var n=JSON.stringify(o.menu_map),t="";return t=-1!=n.indexOf("device_manage_secure_area")?{CN:"删除",EN:"Delete",TW:"删除"}[i.language]:{CN:"查看",EN:"View",TW:"查看"}[i.language],e("div",[e("Button",{props:{type:"error",size:"small"},on:{click:function(){setTimeout(function(){pageVue.deleteDefensArea()},500)}}},t)])}}],defensDatas:[],defensList:[],defensColor:{_701:{fill:"rgb(4, 159, 228)",stroke:"rgb(33, 121, 160)"},_702:{fill:"rgb(255, 0, 0)",stroke:"rgba(5, 174, 253)"},_703:{fill:"rgb(255, 173, 51)",stroke:"rgba(99, 71, 31)"},_704:{fill:"rgb(180, 191, 195)",stroke:"rgba(122, 150, 162)"}},isAddCameraAction:!1,isAddcameraDetailInfo:!1,isDeleteCamera:!1,monitorStatusList:t.monitorStatusId,cameraPageInfo:{count:0,pageNum:1,pageSize:15,monitorStatus:""},cameraDetailInfo:{id:"",companyId:"",companyName:"",deptId:"",deptIds:[],deptName:"",cameraName:"",cameraCode:"",cameraDesc:"",cameraPositionStr:"",radius:"",angle:"",monitorStatus:"",remark:"",rtspLiveUrl:"",rtspHisUrl:"",createUserId:n.id,modifyUserId:n.id},cameraColumns:[{title:{CN:"名称",EN:"Name",TW:"名稱"}[i.language],key:"cameraName",fixed:"left",width:100},{title:{CN:"状态",EN:"State",TW:"狀態"}[i.language],key:"monitorStatus",width:100},{title:{CN:"公司",EN:"Company",TW:"公司"}[i.language],key:"companyName",width:150},{title:{CN:"编码",EN:"Code",TW:"編碼"}[i.language],key:"cameraCode",width:150},{title:{CN:"描述",EN:"Describe",TW:"描述"}[i.language],key:"cameraDesc",width:150},{title:{CN:"Rtsp直播地址",EN:"Live URL",TW:"Rtsp直播地址"}[i.language],key:"rtspLiveUrl",width:150},{title:{CN:"Rtsp录播地址",EN:"Delayed URL",TW:"Rtsp錄播地址"}[i.language],key:"rtspHisUrl",width:150},{title:{CN:"视野角度",EN:"Angle",TW:"視野角度"}[i.language],key:"angle",width:100},{title:{CN:"半径",EN:"Radius",TW:"半徑"}[i.language],key:"radius",width:100},{title:{CN:"操作",EN:"Operation",TW:"操作"}[i.language],key:"operation",width:80,fixed:"right",render:function(e,a){var n="";return n=pageVue.functionInfo.isDefense?{CN:"删除",EN:"Delete",TW:"删除"}[i.language]:{CN:"查看",EN:"View",TW:"查看"}[i.language],e("div",[e("Button",{props:{type:"error",size:"small"},on:{click:function(){}}},n)])}}],camersDatas:[],cameraList:[],alarmColumns:[],alarmDatas:[],isSearchLoading:!1,vehicleUseStatusList:t.vehicleUseStatus,vehicleTypeInfo:function(){for(var e={},i=0,a=t.vehicleType.length;i<a;i++)e[t.vehicleType[i].name]=t.vehicleType[i].type+"";return e}(),vehicleTypeIconList:["108","108","109","110","111","112","300","301","302","303","304","305","306","307","308","309","310","311"],searchColumns:[{title:{CN:"车牌号",EN:"Plate No.",TW:"車牌號"}[i.language],key:"licenseNumber",fixed:"left",width:110},{title:{CN:"运动状态",EN:"Vehicle State",TW:"車輛狀態"}[i.language],key:"vehicleStatus",align:"center",width:100},{title:{CN:"车辆名称",EN:"Vehicle Name",TW:"車輛名稱"}[i.language],key:"vehicleName",width:130},{title:{CN:"车辆编号",EN:"Vehicle Number",TW:"車輛編號"}[i.language],key:"vehicleCode",width:130},{title:{CN:"操作",EN:"Operation",TW:"操作"}[i.language],key:"operation",width:s.isViewVideo?120:80,fixed:"right",render:function(e,a){var n=e("Button",{props:{size:"small"}},{CN:"详情",EN:"Detail",TW:"詳情"}[i.language]),t=null;return s.isViewVideo&&pageVue.vehiclePositionList[a.index].licenseNumber&&pageVue.vehiclePositionList[a.index].providerId<100&&(401!=pageVue.vehiclePositionList[a.index].vehicleStatus&&402!=pageVue.vehiclePositionList[a.index].vehicleStatus||(n=e("Button",{props:{type:"primary",size:"small"},on:{click:function(){pageVue.showLiveVideo(pageVue.vehiclePositionList[a.index],0)}}},"实时"),2!=pageVue.vehiclePositionList[a.index].providerId&&(t=e("Button",{props:{size:"small",type:"warning"},class:"backPlay",style:{marginLeft:"2px"},on:{click:function(){pageVue.showLiveVideo(pageVue.vehiclePositionList[a.index],1)}}},"回放")))),e("div",[n,t])}}],searchDatas:[],disabledDate:{disabledDate:e=>e&&e.valueOf()>Date.now()}},watch:{layerControl:function(e){var i=this,a=(e.indexOf("seat"),e.indexOf("satellite"),e.indexOf("alarm"),-1!=e.indexOf("defens")),n=-1!=e.indexOf("camera"),t=-1!=e.indexOf("vehicle");e.indexOf("background");i.baiduMapInfo.layersInfo.isVehicle=t,i.baiduMapInfo.layersInfo.isCamera=n,i.baiduMapInfo.layersInfo.isDefense=a}},methods:{refresh:function(){var e=window.location.href.split("?");window.location.href=e[0]+"?v="+Date.parse(new Date)},autoFocus:function(){$("body").find(".detailInfoModal input").on("click",function(){$(this).focus()})},showModal:function(e){var i=this;for(var a in i.modal)i.modal[a]=!1;i.modal[e]=!0},resetView:function(){var e=this;e.baiduMapInfo.map.centerAndZoom(new BMap.Point(e.airPort[0],e.airPort[1]),16)},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(i){200==i.code&&(e.companyList=i.data)}})},getSuper:function(e,i,a){for(var n=this,t=0,o=e.length;t<o;t++)if(e[t].value==i){if(a.push(i),0==e[t].paraDeptId)return;n.getSuper(n.departmentList,e[t].paraDeptId,a)}else n.getSuper(e[t].children,i,a)},formatSuperiorDeprt:function(e){var i=this,a=JSON.stringify(e).replace(/id/g,"value").replace(/deptName/g,"label").replace(/subDeptList/g,"children");i.departmentList=JSON.parse(a)},getDepartmentList:function(e){var i=this;i.departmentList=[],utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptTreeList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:0,pageSize:1e4,companyId:i[e].companyId||0},successCallback:function(a){if(200==a.code){var n=[];i[e].deptIds=[],i.formatSuperiorDeprt(a.data),i.getSuper(i.departmentList,i[e].deptId,n),i[e].deptIds=n.reverse()}}})},openInfoWindowClose:function(){var e=this;e.baiduMapInfo.openInfoWindow.show=!1,e.baiduMapInfo.openInfoWindow.type="",e.openInfoWidth=0,e.openInfoHeight=0,e.vehiclePositonPageInfo.licenseNumber="",e.getAllVehiclePositonList(),0==e.baiduMapInfo.animationInfo.pointInfo.length&&(e.isTrackItem=!1)},setLayerTypeNormal:function(e){var i=this;i.baiduMapInfo.mapType="BMAP_NORMAL_MAP"},setLayerTypeHybrid:function(e){var i=this;i.baiduMapInfo.mapType="BMAP_HYBRID_MAP"},hindBaiduCopyRight:function(){$("body").find(".anchorBL").css({display:"none"}),$("body").find(".BMap_scaleCtrl").css({display:"block"})},baiduMapHandle:function(e){var i=this,a=[],n=utility.getSessionStorage("vehicleInfoFrom"),t=utility.getSessionStorage("vehicleTrackFrom");if(n&&(a=n.lastPosition&&"null"!=n.lastPosition?JSON.parse(n.lastPosition).coordinates:"",i.vehiclePositonPageInfo.licenseNumber=n.licenseNumber),i.hindBaiduCopyRight(),i.baiduMapInfo.center.lng=i.airPort[0],i.baiduMapInfo.center.lat=i.airPort[1],i.baiduMapInfo.zoom=16,i.baiduMapInfo.map=e.map,BMap=e.BMap,i.getAllVehiclePositonList(),i.getCompanyList(),i.functionInfo.isCamera&&i.getCameraList(!0),i.functionInfo.isDefense&&i.getDefensAreaList(!0),i.getAllVehicleInterval(),i.baiduMapInfo.overviewMapControl=new BMap.OverviewMapControl({isOpen:!0,size:new BMap.Size(300,200)}),i.baiduMapInfo.map.addControl(i.baiduMapInfo.overviewMapControl),n&&(a?i.setAnimationByBaidu(a,function(e){setTimeout(function(){i.baiduMapInfo.map.panTo(new BMap.Point(e.lng-89867e-8,e.lat+99867e-8)),utility.setSessionStorage("vehicleInfoFrom",null)},1e3)}):i.$Message.error("车辆【"+i.vehiclePositonPageInfo.licenseNumber+"】没有定位数据")),t){var o=t.gpsPositionStr.split(","),s=[o[0],o[1]];if(s){var r=t.alarmTime.split(" "),l=r[1].split(":");i.vehicleItemPop={},i.vehicleItemPop=t,i.vehicleItemPop.gpsDeviceCode=t.deviceCode,i.dateTimeInfo.beginDate=r[0],i.dateTimeInfo.endDate=r[0],i.dateTimeInfo.beginTime=r[1],i.dateTimeInfo.endTime=parseInt(l[0],10)+1+":"+l[1]+":"+l[2],i.singleVehiclePageInfo.licenseNumber=t.licenseNumber,i.showModal("isHistory"),i.getSingleVehicleTrackByBaidu(),i.setAnimationByBaidu(s,function(e){setTimeout(function(){i.baiduMapInfo.map.panTo(new BMap.Point(e.lng-89867e-8,e.lat+99867e-8)),utility.setSessionStorage("vehicleTrackFrom",null)},1e3)})}else i.$Message.error("车辆【"+t.licenseNumber+"】没有定位数据")}$(".radar")[0]&&new Radar($(".radar")[0]).init({scanSpeed:2})},baiduMapClick:function(e){var i=this;if(null==e.overlay)if(1==i.isAddCameraAction){if(0==i.baiduMapInfo.layersInfo.isCamera)return i.$Message.destroy(),void i.$Message.error("请在图层控制开启摄像机层");i.cameraDetailInfo={id:"",companyId:"",companyName:"",deptId:"",deptIds:[],deptName:"",cameraName:"",cameraCode:"",cameraDesc:"",cameraPosition:JSON.stringify({coordinates:[e.point.lng,e.point.lat]}),cameraPositionStr:e.point.lng+","+e.point.lat,radius:"",angle:"",monitorStatus:"",remark:"",rtspLiveUrl:"",rtspHisUrl:"",index:i.baiduMapInfo.cameraMarkers.length,createUserId:n.id,modifyUserId:n.id},i.createCameraFeature(i.cameraDetailInfo,function(a,n){i.baiduMapInfo.map.panTo(new BMap.Point(e.point.lng,e.point.lat)),i.baiduMapInfo.openInfoWindow.position={lng:e.point.lng,lat:e.point.lat},i.openInfoWidth=450,i.openInfoHeight=290,i.baiduMapInfo.openInfoWindow.type="isCameraPop",i.baiduMapInfo.openInfoWindow.show=!0,i.isAddCameraAction=!1})}else if(1==i.isAddDefensAction){if(0==i.baiduMapInfo.layersInfo.isDefense)return i.$Message.destroy(),void i.$Message.error("请在图层控制开启防区层");i.baiduMapInfo.defensPath.push({lng:e.point.lng,lat:e.point.lat}),i.defensAreaDetailInfo={id:"",opType:1,companyId:"",fill:"#ffffff",stroke:"blue",deptId:"",deptIds:[],areaName:"",areaCode:"",secureStatus:"",areaRangeStr:"",speedLimit:"",staySecond:"",canEnter:"",canExit:"",canStay:"",remark:"",createUserId:n.id,modifyUserId:n.id};var a=[],t=i.baiduMapInfo.defensPath;if(t.length>0){for(var o=0,s=t.length;o<s;o++)a.push(i.convertorByBaiduToGPS([t[o].lng,t[o].lat]).join(","));a.push(a[0]),i.defensAreaDetailInfo.areaRangeStr=a.join(";")}}else{if(!i.baiduMapInfo.openInfoWindow.show)return!1;setTimeout(function(){i.openInfoWindowClose()},250)}},resetClickSearch:function(){$("#ol-dbClickSearch").css({opacity:0,left:"-300px",top:"auto",bottom:"120px"})},dbClickBaiduMap:function(e){var i=this,a=e.pixel,n=e.point;i.isTrackItem=!1,$("#ol-dbClickSearch").css({opacity:1,left:a.x-280,top:a.y-230,bottom:"auto"}),setTimeout(function(){i.convertorByBaiduToGPS([n.lng,n.lat],function(e,a){i.baiduMapInfo.vehicleMarkers={},i.vehiclePositonPageInfo.centerPosition=e+","+a,i.getAllVehiclePositonList(),i.modal.isSearch=!0})},2e3)},cancelAreaSearch:function(){var e=this;e.vehiclePositonPageInfo.centerPosition="",e.vehiclePositonPageInfo.span=1e3,e.getAllVehiclePositonList()},endDefensEdite:function(){var e=this;1==e.isAddDefensAction&&e.deleteDefensAction()},convertorByBaidu:function(e,i){var a=gcoord.transform([parseFloat(e[0]),parseFloat(e[1])],gcoord.WGS84,gcoord.BD09),n=new BMap.Point(a[0],a[1]);i&&i(n,a[0],a[1])},convertorByBaiduToGPS:function(e,i){var a=gcoord.transform([parseFloat(e[0]),parseFloat(e[1])],gcoord.BD09,gcoord.WGS84);return i&&i(a[0],a[1]),a},setAnimationByBaidu:function(e,i){var a=this;a.convertorByBaidu(e,function(e){i&&i(e)})},setDefensRowData:function(e,i){var a=this,n=[],t=[];a.defensAreaDetailInfo=a.defensList[i],a.defensAreaDetailInfo.remark=decodeURI(a.defensList[i].remark),a.defensAreaDetailInfo.opType=2,a.defensAreaDetailInfo.areaRange?(n=JSON.parse(a.defensAreaDetailInfo.areaRange).coordinates[0],t=utility.convertorByBaidu(n[0],gcoord,BMap),a.getDepartmentList("defensAreaDetailInfo"),a.openInfoWidth=550,a.openInfoHeight=290,a.baiduMapInfo.openInfoWindow.position={lng:t[0],lat:t[1]},a.baiduMapInfo.openInfoWindow.type="isDefenPop",a.baiduMapInfo.openInfoWindow.show=!0,a.baiduMapInfo.map.setZoom(18),a.baiduMapInfo.map.panTo(new BMap.Point(t[0]-89867e-8,t[1]+59867e-8)),a.defensPageInfo.fromInfo=!1):a.$Message.error("没有防区定位数据")},showDefensPop:function(e,i){var a=this,n=i.point;a.defensAreaDetailInfo=e,a.getDepartmentList("defensAreaDetailInfo"),a.openInfoWidth=550,a.openInfoHeight=290,a.baiduMapInfo.openInfoWindow.position={lng:n.lng,lat:n.lat},a.baiduMapInfo.openInfoWindow.type="isDefenPop",a.baiduMapInfo.openInfoWindow.show=!0,a.baiduMapInfo.map.setZoom(18),a.baiduMapInfo.map.panTo(new BMap.Point(n.lng-89867e-8,n.lat+59867e-8))},defensStatuChange:function(e,i){var a=this;e.id?(a.baiduMapInfo.defensList["_"+e.id].fill=a.defensColor["_"+i].fill,a.baiduMapInfo.defensList["_"+e.id].stroke=a.defensColor["_"+i].stroke):(a.defensAreaDetailInfo.fill=a.defensColor["_"+i].fill,a.defensAreaDetailInfo.stroke=a.defensColor["_"+i].stroke)},editDefense:function(e){var i=this;i.baiduMapInfo.defensList["_"+e.id].canEdit=!i.baiduMapInfo.defensList["_"+e.id].canEdit,i.openInfoWindowClose()},drawAllDefens:function(){var e=this;if(0!=e.defensList.length){for(var i=0,a=e.defensList.length;i<a;i++)if(e.defensList[i].areaRange){var n=JSON.parse(e.defensList[i].areaRange).coordinates[0],t=function(){for(var e=[],i=0,a=n.length;i<a;i++)utility.convertorByBaidu(n[i],gcoord,BMap,function(i,a,n){e.push({lng:a,lat:n})});return e}();e.baiduMapInfo.defensList["_"+e.defensList[i].id]?e.baiduMapInfo.defensList["_"+e.defensList[i].id].paths=t:e.baiduMapInfo.defensList["_"+e.defensList[i].id]={id:"_"+e.defensList[i].id,canEdit:!1,style:e.functionInfo.isDefense?"dashed":"solid",fill:e.defensColor["_"+e.defensList[i].secureStatus].fill,stroke:e.defensColor["_"+e.defensList[i].secureStatus].stroke,paths:t,item:e.defensList[i]}}1==e.defensPageInfo.fromInfo&&e.setDefensRowData(e.baiduMapInfo.defensList["_"+e.defensList[0].id],0)}},updateDefensPath:function(e,i){var a=this,n=[],t=i.target.getPath();if(a.defensAreaDetailInfo=e,a.defensAreaDetailInfo.remark=decodeURI(e.remark),a.getDepartmentList("defensAreaDetailInfo"),t.length>0){for(var o=0,s=t.length;o<s;o++)n.push(a.convertorByBaiduToGPS([t[o].lng,t[o].lat]).join(","));n.push(n[0]),a.defensAreaDetailInfo.areaRangeStr=n.join(";"),e.id&&(a.defensAreaDetailInfo.opType=3,setTimeout(function(){a.uploadDefensAreaDetailInfoToServer()},500))}},formatDefensData:function(){for(var e=this,i=0,a=e.defensList.length;i<a;i++)e.defensDatas.push({areaName:decodeURI(e.defensList[i].areaName),areaCode:decodeURI(e.defensList[i].areaCode),secureStatus:function(){for(var a="",n=0,t=e.secureAreaStatusList.length;n<t;n++)if(e.secureAreaStatusList[n].type==e.defensList[i].secureStatus){a=e.secureAreaStatusList[n].name;break}return a}(),speedLimit:e.defensList[i].speedLimit,staySecond:e.defensList[i].staySecond})},getDefensAreaList:function(e){var i=this;1==e&&(i.defensDatas=[],i.defensList=[],i.defensPageInfo.pageNum=1),setTimeout(function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.getSecureAreaList,actionUrl:CONFIG.SERVICE.areaService,dataObj:{pageNum:i.defensPageInfo.pageNum,pageSize:i.defensPageInfo.pageSize,areaName:encodeURI(i.defensPageInfo.areaName),companyId:i.defensPageInfo.companyId,secureStatus:i.defensPageInfo.secureStatus},successCallback:function(e){200==e.code&&(i.defensList=e.data,i.defensPageInfo.count=e.count,i.formatDefensData(),i.drawAllDefens())}})},500)},defensPageSizeChange:function(){var e=this;e.defensPageInfo.pageNum=parseInt(value,10),setTimeout(function(){e.getDefensAreaList(!1)},200)},addDefensAction:function(){var e=this;e.isAddDefensAction=!0,e.baiduMapInfo.defensPath=[],e.baiduMapInfo.map.setDefaultCursor("crosshair")},deleteDefensAction:function(){var e=this;e.isAddDefensAction=!1,e.baiduMapInfo.isCloseDefensPath=!0,e.baiduMapInfo.map.setDefaultCursor("pointer"),e.showDefensPop(e.defensAreaDetailInfo,{point:e.baiduMapInfo.defensPath[0]})},deleteDefensArea:function(){var e=this;e.baiduMapInfo.openInfoWindow.type="",e.baiduMapInfo.openInfoWindow.show=!1,e.defensAreaDetailInfo.id?0==e.addLoading&&utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.delSecureArea,actionUrl:CONFIG.SERVICE.areaService,dataObj:{ids:e.defensAreaDetailInfo.id,modifyUserId:n.id},beforeSendCallback:function(){e.addLoading=!0},completeCallback:function(){e.addLoading=!1},successCallback:function(i){200==i.code?(delete e.baiduMapInfo.defensList["_"+e.defensAreaDetailInfo.id],e.getDefensAreaList(!0),e.deleteLoading=!1,e.isDeleteDefens=!1,e.defensAreaDetailInfo={id:"",opType:1,companyId:"",fill:"#ffffff",stroke:"blue",deptId:"",deptIds:[],areaName:"",areaCode:"",secureStatus:"",areaRangeStr:"",speedLimit:"",staySecond:"",canEnter:"",canExit:"",canStay:"",remark:"",createUserId:n.id,modifyUserId:n.id}):e.$Message.error(i.message)}}):e.baiduMapInfo.defensPath=[]},uploadDefensAreaDetailInfoToServer:function(){var e=this;0==e.addLoading&&utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.saveSecureArea,actionUrl:CONFIG.SERVICE.areaService,dataObj:{id:e.defensAreaDetailInfo.id,opType:e.defensAreaDetailInfo.opType,companyId:e.defensAreaDetailInfo.companyId,deptId:e.defensAreaDetailInfo.deptIds[e.defensAreaDetailInfo.deptIds.length-1]||0,areaName:encodeURI(e.defensAreaDetailInfo.areaName),areaCode:encodeURI(e.defensAreaDetailInfo.areaCode),secureStatus:e.defensAreaDetailInfo.secureStatus,areaRangeStr:e.defensAreaDetailInfo.areaRangeStr,speedLimit:e.defensAreaDetailInfo.speedLimit,staySecond:e.defensAreaDetailInfo.staySecond,canEnter:e.defensAreaDetailInfo.canEnter||720,canExit:e.defensAreaDetailInfo.canExit||720,canStay:e.defensAreaDetailInfo.canStay||720,remark:encodeURI(e.defensAreaDetailInfo.remark),createUserId:e.defensAreaDetailInfo.createUserId,modifyUserId:e.defensAreaDetailInfo.modifyUserId},beforeSendCallback:function(){e.addLoading=!0},completeCallback:function(){e.addLoading=!1},successCallback:function(i){200==i.code?(e.getDefensAreaList(!0),e.baiduMapInfo.defensPath=[]):e.$Message.error(i.message)}})},formatCameraData:function(){for(var e=this,i=0,a=e.cameraList.length;i<a;i++)e.camersDatas.push({id:e.cameraList[i].id,companyId:e.cameraList[i].companyId,companyName:decodeURI(e.cameraList[i].companyName),deptId:e.cameraList[i].deptId,deptName:decodeURI(e.cameraList[i].deptName),cameraName:decodeURI(e.cameraList[i].cameraName),cameraCode:decodeURI(e.cameraList[i].cameraCode),cameraDesc:decodeURI(e.cameraList[i].cameraDesc),radius:e.cameraList[i].radius,cameraPositionStr:e.cameraList[i].cameraPositionStr,angle:e.cameraList[i].angle,monitorStatus:e.cameraList[i].monitorStatusName,remark:decodeURI(e.cameraList[i].remark),rtspLiveUrl:e.cameraList[i].rtspLiveUrl,rtspHisUrl:e.cameraList[i].rtspHisUrl})},getCameraList:function(e){var i=this;i.camersDatas=[],i.cameraList=[],1==e&&(i.cameraPageInfo.pageNum=1),setTimeout(function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.getCameraList,actionUrl:CONFIG.SERVICE.deviceService,dataObj:i.cameraPageInfo,successCallback:function(e){200==e.code&&(i.cameraList=e.data,i.cameraPageInfo.count=e.count,i.formatCameraData(),i.drawAllCamera())}})},500)},createCameraFeature:function(e,i){var a=this,n=JSON.parse(e.cameraPosition).coordinates;a.baiduMapInfo.cameraMarkers.push({icon:{url:CONFIG.HOST+"/airport/assets/img/camera.png?v="+Date.parse(new Date),size:{width:50,height:50}},position:{lng:n[0],lat:n[1]},item:e}),i&&i(e.id,n)},dragendCamera:function(e,i){var a=this,n=i.point;a.cameraDetailInfo=a.baiduMapInfo.cameraMarkers[e].item,a.cameraDetailInfo.cameraPosition=JSON.stringify({coordinates:[n.lng,n.lat]}),a.cameraDetailInfo.cameraPositionStr=n.lng+","+n.lat,a.baiduMapInfo.cameraMarkers[e].position={lng:n.lng,lat:n.lat},a.baiduMapInfo.openInfoWindow.position={lng:n.lng,lat:n.lat},a.cameraDetailInfo.id&&a.uploadCameraDetailInfoToServer()},drawAllCamera:function(){var e=this;e.baiduMapInfo.cameraMarkers=[];for(var i=0,a=e.cameraList.length;i<a;i++)e.createCameraFeature(e.cameraList[i])},setCameraRowData:function(e,i){var a=this,n=[];a.cameraDetailInfo=a.cameraList[i],a.cameraDetailInfo.remark=decodeURI(a.cameraList[i].remark),a.cameraDetailInfo.cameraName=decodeURI(a.cameraList[i].cameraName),a.cameraDetailInfo.cameraCode=decodeURI(a.cameraList[i].cameraCode),a.cameraDetailInfo.cameraDesc=decodeURI(a.cameraList[i].cameraDesc),n=JSON.parse(a.cameraDetailInfo.cameraPosition).coordinates,a.getDepartmentList("cameraDetailInfo"),a.openInfoWidth=450,a.openInfoHeight=290,a.baiduMapInfo.openInfoWindow.position={lng:n[0],lat:n[1]},a.baiduMapInfo.map.setZoom(19),a.baiduMapInfo.map.panTo(new BMap.Point(n[0]-89867e-8,n[1]+59867e-8)),a.baiduMapInfo.openInfoWindow.type="isCameraPop",a.baiduMapInfo.openInfoWindow.show=!0},cameraOpenPop:function(e,i){var a=this;a.baiduMapInfo.openInfoWindow.type="",a.baiduMapInfo.openInfoWindow.show=!1,a.getDepartmentList("cameraDetailInfo"),a.openInfoWidth=450,a.openInfoHeight=290,setTimeout(function(){a.baiduMapInfo.openInfoWindow.show=!0,a.baiduMapInfo.openInfoWindow.position=e.position,a.baiduMapInfo.openInfoWindow.type="isCameraPop",a.cameraDetailInfo=e.item,a.baiduMapInfo.map.setZoom(19),a.baiduMapInfo.map.panTo(new BMap.Point(e.position.lng-89867e-8,e.position.lat+59867e-8))},250)},cameraPageSizeChange:function(){var e=this;e.cameraPageInfo.pageNum=parseInt(value,10),setTimeout(function(){e.getCameraList(!1)},200)},deleteCamera:function(e){var i=this;i.baiduMapInfo.openInfoWindow.type="",i.baiduMapInfo.openInfoWindow.show=!1,i.cameraDetailInfo.id?utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.delCamera,actionUrl:CONFIG.SERVICE.deviceService,dataObj:{ids:i.cameraDetailInfo.id,modifyUserId:n.id},successCallback:function(e){200==e.code?(i.getCameraList(!0),setTimeout(function(){i.deleteLoading=!1,i.isDeleteCamera=!1,i.cameraDetailInfo={id:"",companyId:"",companyName:"",deptId:"",deptIds:[],deptName:"",cameraName:"",cameraCode:"",cameraDesc:"",cameraPositionStr:"",radius:"",angle:"",monitorStatus:"",remark:"",rtspLiveUrl:"",rtspHisUrl:"",createUserId:n.id,modifyUserId:n.id}},500)):i.$Message.error(e.message)}}):i.baiduMapInfo.cameraMarkers.splice(i.cameraDetailInfo.index,1)},uploadCameraDetailInfoToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.saveCamera,actionUrl:CONFIG.SERVICE.deviceService,dataObj:{id:e.cameraDetailInfo.id,companyId:e.cameraDetailInfo.companyId,deptId:e.cameraDetailInfo.deptIds[e.cameraDetailInfo.deptIds.length-1]||0,cameraName:encodeURI(e.cameraDetailInfo.cameraName),cameraCode:encodeURI(e.cameraDetailInfo.cameraCode),cameraDesc:encodeURI(e.cameraDetailInfo.cameraDesc),radius:e.cameraDetailInfo.radius,angle:e.cameraDetailInfo.angle,cameraPositionStr:e.cameraDetailInfo.cameraPositionStr,monitorStatus:e.cameraDetailInfo.monitorStatus,remark:encodeURI(e.cameraDetailInfo.remark),rtspLiveUrl:e.cameraDetailInfo.rtspLiveUrl,rtspHisUrl:e.cameraDetailInfo.rtspHisUrl,createUserId:n.id,modifyUserId:n.id},successCallback:function(i){200==i.code?(e.getCameraList(!0),setTimeout(function(){e.baiduMapInfo.openInfoWindow.type="",e.baiduMapInfo.openInfoWindow.show=!1,e.addLoading=!1},500)):e.$Message.error(i.message)}})},getAllVehiclePositonList:function(e){var i=this;1==e&&(i.baiduMapInfo.vehicleMarkers={}),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getAllVehiclePositonList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{span:i.vehiclePositonPageInfo.span||1e3,deptId:i.vehiclePositonPageInfo.deptId,pageNum:i.vehiclePositonPageInfo.pageNum,pageSize:i.vehiclePositonPageInfo.pageSize,id:i.vehiclePositonPageInfo.id,companyId:i.vehiclePositonPageInfo.companyId,gpsDeviceCode:i.vehiclePositonPageInfo.gpsDeviceCode,vehicleTypeId:i.vehiclePositonPageInfo.vehicleTypeId,vehicleStatus:i.vehiclePositonPageInfo.vehicleStatus,useStatus:i.vehiclePositonPageInfo.useStatus,vehicleColorId:i.vehiclePositonPageInfo.vehicleColorId,vehicleBrandId:i.vehiclePositonPageInfo.vehicleBrandId,centerPosition:i.vehiclePositonPageInfo.centerPosition,vehicleName:encodeURI(i.vehiclePositonPageInfo.vehicleName),vehicleCode:encodeURI(i.vehiclePositonPageInfo.vehicleCode),licenseNumber:encodeURI(i.vehiclePositonPageInfo.licenseNumber)},beforeSendCallback:function(){i.isSearchLoading=!0},completeCallback:function(){i.isSearchLoading=!1},successCallback:function(e){200==e.code&&(i.vehiclePositonPageInfo.count=e.count,i.vehiclePositionList=e.data,i.formatVehiclePositon(),i.resetClickSearch(),i.drawAlVehicleByBaidu())}})},formatVehiclePositon:function(){for(var e,i=this,a=[],n=0,t=i.vehiclePositionList.length;n<t;n++)a.push({o:i.vehiclePositionList[n].o,id:i.vehiclePositionList[n].id,speed:i.vehiclePositionList[n].speed,power:i.vehiclePositionList[n].power,alarmEventTypeDesc:i.vehiclePositionList[n].alarmEventTypeDesc,deptId:i.vehiclePositionList[n].deptId,deptName:i.vehiclePositionList[n].deptName,modifyTime:i.vehiclePositionList[n].modifyTime,gpsDeviceId:i.vehiclePositionList[n].gpsDeviceId,companyName:i.vehiclePositionList[n].companyName,vehicleName:i.vehiclePositionList[n].vehicleName,vehicleCode:i.vehiclePositionList[n].vehicleCode,licenseNumber:i.vehiclePositionList[n].licenseNumber,lastPosition:i.vehiclePositionList[n].lastPosition?JSON.parse(i.vehiclePositionList[n].lastPosition).coordinates:null,lastPositionAddress:"",vehicleTypeId:i.vehiclePositionList[n].vehicleTypeName,gpsDeviceCode:i.vehiclePositionList[n].gpsDeviceCode,providerId:i.vehiclePositionList[n].providerId,vehicleStatus:(e=void 0,e=$.grep(i.terminalStatusList,function(e){return e.type==i.vehiclePositionList[n].vehicleStatus}),e&&0!=e.length?e[0].name:"--"),useStatus:i.vehiclePositionList[n].useStatusName,vehicleColorId:i.vehiclePositionList[n].vehicleColorName,vehicleBrandId:i.vehiclePositionList[n].vehicleBrandName,vehicleStatusName:i.vehiclePositionList[n].vehicleStatusName,cellClassName:{vehicleStatus:"_"+i.vehiclePositionList[n].vehicleStatus}});i.searchDatas=a},getBeginDate:function(e){var i=this;i.dateTimeInfo.beginDate=e},getEndDate:function(e){var i=this;i.dateTimeInfo.endDate=e},getBeginTime:function(e){var i=this;i.dateTimeInfo.beginTime=e},getEndTime:function(e){var i=this;i.dateTimeInfo.endTime=e},getAdressDetail:function(e,i,a){i.gc=new BMap.Geocoder,i.sourceCoor=e,i.point=new BMap.Point(i.sourceCoor[0],i.sourceCoor[1]),i.gc.getLocation(i.point,function(e){e.surroundingPois.length>0?i.address=e.surroundingPois[0].address+"("+e.surroundingPois[0].title+")":i.address=e.address,a&&a()})},showLiveVideo:function(e,i){var a="8080",t="http://43.247.68.26:"+a+"/airport/www/module/liveVideo/liveVideo.html?vehicleInfo="+encodeURI(JSON.stringify(e))+"&isBackPlay="+i;i&&(t="http://43.247.68.26:"+a+"/airport/www/module/playBack/liveVideo.html?vehicleInfo="+encodeURI(JSON.stringify(e))+"&isBackPlay="+i),
2==e.providerId&&(t=i?"http://43.247.68.26:"+a+"/airport/www/module/playBack/liveVideo.html?vehicleInfo="+encodeURI(JSON.stringify(e))+"&isBackPlay="+i:"http://43.247.68.26:"+a+"/airport/www/module/liveVideoTest1/liveVideo.html?vehicleInfo="+encodeURI(JSON.stringify(e))+"&id="+n.id+"&userToken="+n.userToken+"&isBackPlay="+i),window.open(t,"liveVideo","toolbar=yes, location=0, directories=no, status=0, menubar=0, scrollbars=1, resizable=1, copyhistory=1, width="+window.outerWidth+", height="+(window.outerHeight-50))},createVehicleByBaidu:function(e,i){var a=this;if(e.lastPosition){var n=JSON.parse(e.lastPosition).coordinates,t=CONFIG.HOST+"/airport/assets/car/success.gif",o=a.vehicleTypeIconList&&-1!=a.vehicleTypeIconList.indexOf(e.vehicleTypeName)?a.vehicleTypeInfo[e.vehicleTypeName]+e.vehicleStatus:e.vehicleStatus,s=Date.parse(new Date),r=Date.parse(e.lastGpsTime.replace(/\-/g,"/")),l=Date.parse(e.lastOnlineTime.replace(/\-/g,"/")),d=Math.floor((s-r)/864e5),c=Math.floor((s-l)/864e5);e.isOverTime=!1,e.isOnTime=!1,d>=1&&(o=a.vehicleTypeIconList&&-1!=a.vehicleTypeIconList.indexOf(e.vehicleTypeName)?a.vehicleTypeInfo[e.vehicleTypeName]+406:406,e.isOverTime=!0),c>=1&&(e.isOnTime=!0),t=CONFIG.HOST+"/airport/assets/car/"+o+".gif?v=12341234",a.baiduMapInfo.vehicleMarkers["_"+e.id]?e.lastPosition!=a.baiduMapInfo.vehicleMarkers["_"+e.id].item.lastPosition?a.convertorByBaidu(n,function(n,t,o){a.baiduMapInfo.vehicleMarkers["_"+e.id].position.lng-t==0&&a.baiduMapInfo.vehicleMarkers["_"+e.id].position.lat-o==0||(a.baiduMapInfo.vehicleMarkers["_"+e.id].item=e,a.baiduMapInfo.vehicleMarkers["_"+e.id].zIndex=a.baiduMapInfo.vehicleMarkers["_"+e.id].zIndex||0,a.baiduMapInfo.vehicleMarkers["_"+e.id].position={lng:t,lat:o}),i&&i(t,o)}):a.baiduMapInfo.vehicleMarkers["_"+e.id].item=e:a.convertorByBaidu(n,function(n,o,s){a.baiduMapInfo.vehicleMarkers["_"+e.id]={id:"_"+e.id,icon:{url:t,size:{width:28,height:35}},point:new BMap.Point(o,s),position:{lng:o,lat:s},zIndex:0,top:!1,animation:"",item:e},i&&i(o,s)})}},setVehicleTop:function(e,i){var a=this;a.baiduMapInfo.vehicleMarkers[e.id]&&(a.baiduMapInfo.vehicleMarkers[e.id].zIndex=1e10,a.baiduMapInfo.vehicleMarkers[e.id].top=!0,a.baiduMapInfo.vehicleMarkers[e.id].animation=""),a.openInfoWidth=350,a.openInfoHeight=0},cancelVehicleTop:function(e,i){var a=this;a.baiduMapInfo.vehicleMarkers[e.id]&&(a.baiduMapInfo.vehicleMarkers[e.id].zIndex=0,a.baiduMapInfo.vehicleMarkers[e.id].top=!1,a.baiduMapInfo.vehicleMarkers[e.id].animation="")},toAlarmPage:function(e){setTimeout(function(){$(window.parent.document).find("#nav_Alarm").bind("click"),$(window.parent.document).find("#nav_Alarm").trigger("click")},200),setTimeout(function(){utility.setSessionStorage("fromMap",{licenseNumber:e})},500)},vehicleOpenPop:function(e,i){var a=this;a.baiduMapInfo.openInfoWindow.show=!1,a.baiduMapInfo.openInfoWindow.type="",setTimeout(function(){a.isTrackItem=!0,a.vehicleItemPop=e.item,a.singleVehiclePageInfo.licenseNumber=a.vehicleItemPop.licenseNumber,a.trackItem.licenseNumber=a.vehicleItemPop.licenseNumber,a.baiduMapInfo.openInfoWindow.type="isVehiclePopInfo",a.baiduMapInfo.openInfoWindow.position=e.position,a.baiduMapInfo.openInfoWindow.show=!0,a.getAdressDetail([e.position.lng,e.position.lat],a.vehicleItemPop,function(){a.baiduMapInfo.map.getZoom()<17&&a.baiduMapInfo.map.setZoom(17),1==a.modal.isSearch?a.baiduMapInfo.map.panTo(new BMap.Point(e.position.lng-89867e-8,e.position.lat+99867e-8)):a.baiduMapInfo.map.panTo(new BMap.Point(e.position.lng,e.position.lat+99867e-8)),a.drawAlVehicleByBaidu()}),a.openInfoWidth=350,a.openInfoHeight=340},250)},drawAlVehicleByBaidu:function(){var e=this;if(e.isTrackItem){e.baiduMapInfo.vehicleMarkers={};for(var i=0,a=e.vehiclePositionList.length;i<a;i++)if(e.trackItem.licenseNumber==e.vehiclePositionList[i].licenseNumber){e.createVehicleByBaidu(e.vehiclePositionList[i],function(i,a){"isVehiclePopInfo"==e.baiduMapInfo.openInfoWindow.type&&(e.baiduMapInfo.openInfoWindow.position={lng:i,lat:a})});break}}else for(var n=0,t=e.vehiclePositionList.length;n<t;n++)e.createVehicleByBaidu(e.vehiclePositionList[n])},showPositionByBaidu:function(e,i){var a=this,n=[],t="";a.vehiclePositionItem=a.vehiclePositionList[i],a.vehicleItemPop=a.vehiclePositionItem,a.singleVehiclePageInfo.licenseNumber=a.vehicleItemPop.licenseNumber,t=a.vehicleItemPop.lastPosition,t?(n=JSON.parse(t).coordinates,0==n[0]||0==n[1]?a.$Message.error("没有车辆定位数据"):(a.baiduMapInfo.map.getZoom()<17&&a.baiduMapInfo.map.setZoom(17),a.setAnimationByBaidu(n,function(e){1==a.modal.isSearch?a.baiduMapInfo.map.panTo(new BMap.Point(e.lng-89867e-8,e.lat+99867e-8)):a.baiduMapInfo.map.panTo(new BMap.Point(e.lng,e.lat+99867e-8))}),a.openInfoWidth=350,a.openInfoHeight=0,setTimeout(function(){a.convertorByBaidu(n,function(e,i,n){a.getAdressDetail([i,n],a.vehicleItemPop,function(){a.baiduMapInfo.openInfoWindow.position={lng:i,lat:n},a.baiduMapInfo.openInfoWindow.type="isVehiclePopInfo",a.baiduMapInfo.openInfoWindow.show=!0,a.isTrackItem=!0,a.trackItem.licenseNumber=a.singleVehiclePageInfo.licenseNumber,a.drawAlVehicleByBaidu()})})},1e3))):a.$Message.error("没有车辆定位数据")},clearTrackByBaidu:function(){var e=this;e.baiduMapInfo.animationInfo.curveInfo=[],e.baiduMapInfo.animationInfo.pointInfo=[],e.baiduMapInfo.animationInfo.coordinates=[],e.baiduMapInfo.animationInfo.trajectoryInfo=[],e.baiduMapInfo.animationInfo.moveVehicle=null,e.isTrackItem=!1,e.trackItem.licenseNumber="",clearInterval(e.baiduMapInfo.animationInfo.timeInterval),e.drawAlVehicleByBaidu()},showTrackPointInfo:function(e){for(var i=this,a=0,n=0,t=i.baiduMapInfo.animationInfo.trajectoryInfo.length;n<t;n++)if(JSON.stringify(e.point)==JSON.stringify(i.baiduMapInfo.animationInfo.trajectoryInfo[n].point)){a=n;break}i.baiduMapInfo.animationInfo.trajectoryItem=i.baiduMapInfo.animationInfo.trajectoryInfo[a],i.getAdressDetail([e.point.lng,e.point.lat],i.baiduMapInfo.animationInfo.trajectoryItem,function(){i.baiduMapInfo.map.panTo(e.point),i.openInfoWidth=330,i.openInfoHeight=0,i.baiduMapInfo.openInfoWindow.position={lng:e.point.lng,lat:e.point.lat},i.baiduMapInfo.openInfoWindow.type="isTrajectPoint",i.baiduMapInfo.openInfoWindow.show=!0})},countTimeBySeconds:function(e){var i=Math.floor(e/864e5),a=e%864e5,n=Math.floor(a/36e5),t=a%36e5,o=Math.floor(t/6e4),s=t%6e4,r=Math.round(s/1e3);return{day:i,hour:n,minute:o,second:r}},formatTrajectoryInfo:function(){var e,i=this,a=null,n=0,t={},o=[],s=0,r=0,l=[],d=[];if(i.singleVehicleItem&&i.singleVehicleItem.track){a=i.singleVehicleItem.track.split("/"),n=a.length;for(var c=0;c<n;c++){var f=a[c].split(",");0!=f[3]&&c>0&&c<n-1?s++:t["_"+s]=[]}for(var p=0;p<n;p++){var u=a[p].split(","),m={time:(e=void 0,e=utility.getDateDetailInfo(u[2]),e.year+"-"+e.month+"-"+e.date+" "+e.hour+":"+e.min+":"+e.second),timeStmp:Date.parse(new Date(u[2])),speed:u[3],point:null,coordinate:[parseFloat(u[0],10),parseFloat(u[1],10)],vehicleCode:i.singleVehicleItem.vehicleCode,vehicleStatus:i.singleVehicleItem.vehicleStatus,companyName:i.singleVehicleItem.companyName,deptName:i.singleVehicleItem.deptName,vehicleName:i.singleVehicleItem.vehicleName,licenseNumber:i.singleVehicleItem.licenseNumber,lastGpsTime:i.singleVehicleItem.lastGpsTime,vehicleTypeName:i.singleVehicleItem.vehicleTypeName,stayTime:parseFloat(u[4],10)?i.countTimeBySeconds(1e3*parseFloat(u[4],10)):null};0!=p&&p!=n-1||d.push(m),0!=u[3]&&p>0&&p<n-1?(r++,d.push(m)):t["_"+r].push(m)}}for(var I in t)if(t.hasOwnProperty(I)){var h=t[I];if(h.length>0){if(h.length>=2){var g=utility.timeDiff(h[0].lastGpsTime,h[h.length-1].lastGpsTime);0==g.timeStamp?h[0].stayTime=null:h[0].stayTime=g}d.push(h[0])}}d=d.sort(function(e,i){return e.timeStmp-i.timeStmp});for(var v=0;v<d.length;v++)i.convertorByBaidu(d[v].coordinate,function(e,i,a){l.push({lng:i,lat:a}),d[v].point={lng:i,lat:a},d[v].stayTime&&o.push({lng:i,lat:a})});i.baiduMapInfo.animationInfo.trajectoryInfo=d,i.baiduMapInfo.animationInfo.coordinates=l,i.baiduMapInfo.animationInfo.pointInfo=l,i.baiduMapInfo.animationInfo.zeroPointInfo=o,i.baiduMapInfo.animationInfo.curveInfo=l},getSingleVehicleTrackByBaidu:function(){var e,i=this;(i.clearTrackByBaidu(),0!=i.singleVehiclePageInfo.licenseNumber.length)?(0==i.dateTimeInfo.beginDate.length&&(i.dateTimeInfo.beginDate=(e=utility.getDateDetailInfo(),e.year+"-"+e.month+"-"+e.date)),0==i.dateTimeInfo.beginTime.length&&(i.dateTimeInfo.beginTime="00:00:00"),0==i.dateTimeInfo.endDate.length&&(i.dateTimeInfo.endDate=function(){var e=utility.getDateDetailInfo();return e.year+"-"+e.month+"-"+e.date}()),0==i.dateTimeInfo.endTime.length&&(i.dateTimeInfo.endTime="23:59:59"),i.singleVehiclePageInfo.beginTime=i.dateTimeInfo.beginDate+" "+i.dateTimeInfo.beginTime,i.singleVehiclePageInfo.endTime=i.dateTimeInfo.endDate+" "+i.dateTimeInfo.endTime,timeDiff=utility.timeDiff(i.singleVehiclePageInfo.beginTime,i.singleVehiclePageInfo.endTime),i.$Message.destroy(),0!=timeDiff.isOver?timeDiff.day>3?i.$Message.error("时间跨度不能超过3天"):(i.$Message.loading({content:"正在加载轨迹..."}),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getSingleVehicleTrack,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{gpsDeviceCode:i.singleVehiclePageInfo.gpsDeviceCode,licenseNumber:encodeURI(i.singleVehiclePageInfo.licenseNumber),beginTime:i.singleVehiclePageInfo.beginTime,endTime:i.singleVehiclePageInfo.endTime},successCallback:function(e){200==e.code?(i.singleVehicleItem=e.data,i.showModal("isHistory"),i.singleVehicleItem.track?(i.formatTrajectoryInfo(),i.isTrackItem=!0,i.trackItem.licenseNumber=i.singleVehiclePageInfo.licenseNumber):(i.$Message.destroy(),i.$Message.error(i.singleVehiclePageInfo.beginTime+"  "+i.singleVehiclePageInfo.endTime+"查询不到轨迹数据"),setTimeout(function(){i.$Message.destroy()},3e3))):(i.$Message.destroy(),i.$Message.error(e.message),setTimeout(function(){i.$Message.destroy()},3e3))},errorCallback:function(){i.$Message.destroy()}})):i.$Message.error("开始时间大于结束时间")):i.$Message.error("请输入车牌号")},playBackByBaidu:function(){var e=this;if(0==e.baiduMapInfo.animationInfo.pointInfo.length)return e.$Message.destroy(),void e.$Message.error("没有回放轨迹");var i=0,a=e.vehicleItemPop,n=e.baiduMapInfo.animationInfo.coordinates,t=a.vehicleStatus;e.baiduMapInfo.animationInfo.moveVehicle={icon:{url:CONFIG.HOST+"/airport/assets/car/"+t+".gif?v=030303939",size:{width:28,height:35}},position:{lng:n[i].lng,lat:n[i].lat},zIndex:1e5,top:!0},e.baiduMapInfo.openInfoWindow.show=!1,e.baiduMapInfo.map.panTo(new BMap.Point(n[i].lng,n[i].lat)),e.baiduMapInfo.animationInfo.timeInterval=setInterval(function(){i<n.length?(i++,e.baiduMapInfo.animationInfo.moveVehicle.position=n[i],e.baiduMapInfo.map.panTo(new BMap.Point(n[i].lng,n[i].lat))):(e.baiduMapInfo.animationInfo.moveVehicle=null,clearInterval(e.baiduMapInfo.animationInfo.timeInterval))},10*(55-e.baiduMapInfo.animationInfo.speed+55))},getAllVehicleInterval:function(){var e=this;e.timePosition=setInterval(function(){"isCameraPop"!=e.baiduMapInfo.openInfoWindow.type&&"isDefenPop"!=e.baiduMapInfo.openInfoWindow.type&&e.getAllVehiclePositonList()},1500)}},created:function(){var e=this,i=null,a=null;utility.isLogin(!1),e.$Message.config({top:180,duration:3}),e.showModal("isLayer"),i=setInterval(function(){var a=utility.getSessionStorage("fromInfo")||null;e.hindBaiduCopyRight(),a&&(e.showModal(a.type),e.vehiclePositonPageInfo.vehicleStatus=a.vehicleStatus,e.defensPageInfo.areaName=a.areaName||"",e.defensPageInfo.fromInfo=!!a.areaName,setTimeout(function(){utility.cleanSessionStorage(),clearInterval(i)},2e3))},100),e.$watch("vehiclePositonPageInfo",function(){clearInterval(e.timePosition),clearTimeout(a),a=setTimeout(function(){e.getAllVehiclePositonList(!0),e.getAllVehicleInterval()},500)},{deep:!0}),setInterval(function(){t=utility.getLocalStorage("bizParam")},1e4)},mouted:function(){}})})();
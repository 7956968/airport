(function(){var e,t=utility.getLocalStorage("language"),a=utility.getLocalStorage("userInfo"),i=utility.getLocalStorage("bizParam"),n=new Vue({el:"#js-vue",data:{language:t?t.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isModalLoading:!0,modalTitle:"",tableHeight:(e=$(".tableContainer").height(),e-100),pageInfo:{id:0,count:0,companyId:"",deptIds:[],eventTypeId:"",dealFlag:"",vehicleName:"",beginTime:"",endTime:""},page:{pageSize:20,pageNum:1},index:0,selectItem:"",itemInfo:{id:"",dealFlag:"",remark:"",createUserId:a.id,modifyUserId:a.id},columnsList:[{title:{CN:"公司名称",EN:"Company name",TW:"公司名稱"}[t.language],key:"companyName",width:200},{title:{CN:"部门名称",EN:"Department Name",TW:"部門名稱"}[t.language],key:"deptName"},{title:{CN:"报警类型",EN:"Name",TW:"姓名"}[t.language],key:"alarmTypeDesc"},{title:{CN:"处理状态",EN:"Job Title",TW:"職位名稱"}[t.language],key:"dealDesc"},{title:{CN:"警报事件",EN:"Job Title",TW:"職位名稱"}[t.language],key:"eventTypeDesc"},{title:{CN:"车辆名称",EN:"Job Type",TW:"職位類型"}[t.language],key:"vehicleName",width:150},{title:{CN:"报警时间",EN:"Job Type",TW:"職位類型"}[t.language],key:"alarmTime",width:130},{title:{CN:"报警内容",EN:"Job Type",TW:"職位類型"}[t.language],key:"alarmInfo",width:180},{title:{CN:"操作",EN:"Operation",TW:"操作"}[t.language],key:"operation",render:function(e,a){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.index=a.index,n.selectItem=a.row,n.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[t.language]),e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.index=a.index,n.selectItem=a.row,n.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[t.language])])}}],userList:[],companyList:[],tableRowList:[],alarmList:[],superiorDepartmentList:[],deptUserPositionTypeList:i.departmentPositionType},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={remark:"",dealFlag:"",createUserId:a.id,modifyUserId:a.id}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.alarmList[e.index],e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.alarmList[e.index])),e.isShowDetail=!0})},beginRepairTime:function(e,t){var a=this;a.pageInfo.beginTime=e},endRepairTime:function(e,t){var a=this;a.pageInfo.endTime=e},setCurrentRowData:function(e,t){var a=this;e&&(a.index=t,a.selectItem=e)},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.alarmService+"?action="+CONFIG.ACTION.updateAlarmStatus,actionUrl:CONFIG.SERVICE.alarmService,dataObj:{id:e.itemInfo.id,createUserId:a.id,modifyUserId:a.id,dealFlag:e.itemInfo.dealFlag,remark:encodeURI(e.itemInfo.remark)},completeCallback:function(){e.isModalLoading=!1},successCallback:function(t){200==t.code?(e.getAlarmList(!0),e.isShowModal=!1):e.$Message.error(t.message)}})},pageSizeChange:function(e){var t=this;t.page.pageNum=parseInt(e,10),setTimeout(function(){t.getAlarmList(!1)},200)},pageRowChange:function(e){var t=this;t.page.pageSize=parseInt(e,10),setTimeout(function(){t.getAlarmList(!1)},200)},getAlarmList:function(e){var t=this;t.tableRowList=[],1==e&&(t.page.pageNum=1),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.alarmService+"?action="+CONFIG.ACTION.getAlarmList,actionUrl:CONFIG.SERVICE.alarmService,dataObj:{pageNum:t.page.pageNum,pageSize:t.page.pageSize,alarmTypeId:t.pageInfo.alarmTypeId,eventTypeId:t.pageInfo.eventTypeId,dealFlag:t.pageInfo.dealFlag,vehicleName:encodeURI(t.pageInfo.vehicleName),beginTime:t.pageInfo.beginTime,endTime:t.pageInfo.endTime,companyId:t.pageInfo.companyId,deptId:t.pageInfo.deptIds[t.pageInfo.deptIds.length-1]||0},beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.alarmList=e.data,t.pageInfo.count=e.count)}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(t){200==t.code&&(e.companyList=t.data)}})},getSuper:function(e,t,a){for(var i=this,n=0,r=e.length;n<r;n++)if(e[n].value==t){if(a.push(t),0==e[n].paraDeptId)return;i.getSuper(i.superiorDepartmentList,e[n].paraDeptId,a)}else i.getSuper(e[n].children,t,a)},formatSuperiorDeprt:function(e){var t=this,a=JSON.stringify(e).replace(/id/g,"value").replace(/deptName/g,"label").replace(/subDeptList/g,"children");t.superiorDepartmentList=JSON.parse(a)},getSuperiorDeprtList:function(e){var t=this;t.superiorDepartmentList=[],utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptTreeList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:0,pageSize:1e4,companyId:t[e].companyId||0},successCallback:function(a){if(200==a.code){var i=[];t[e].deptIds=[],t.formatSuperiorDeprt(a.data),t.getSuper(t.superiorDepartmentList,t[e].deptId,i),t[e].deptIds=i.reverse()}}})},getUserList:function(e){var t=this;t.userList=[],utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.getUserList,actionUrl:CONFIG.SERVICE.userService,dataObj:{id:0,pageSize:1e4,companyId:t.itemInfo.companyId},successCallback:function(a){200==a.code&&(t.userList=a.data,e&&e())}})},getDepartAndUser:function(){var e=this;e.itemInfo.userIds=[],e.getUserList(),e.getSuperiorDeprtList("itemInfo")}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getAlarmList(!0),e.getCompanyList(),e.$watch("pageInfo",function(){e.getAlarmList(!0)},{deep:!0})},500)}})})();
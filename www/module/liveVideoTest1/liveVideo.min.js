new Vue({el:"#js-vue",data:{mIP:"",mPort:"",mUserName:"",mPwd:"",mVehicleNo:"",mVideoCount:9,maxVideoNum:10,isStop:!0,offLine:!1,isLogin:!1,loginCodeUrl:"http://140.246.113.143:6680/code/verificationCode.do",loginCode:"",loading:!1,uSession:"",errorTip:"",timeOfflineOut:null,timeOffline:5,timeLen:300,timeSelect:"300",timeLenOut:null,netnSignal:"",msgType:"primary",msgInfo:"",isFullScream:!1,channelIndex:1,fullScreamIndex:"",defaultColor:"rgb(255,125,0)",splitNum:1,connectTimeOut:null,playerList:[],mediaDataSourceList:[],splitArea:[1,4,6,8,9],videoWinSplit:[{count:1,param:[{top:"0px",left:"0px",width:"calc(100% - 4px)",height:"calc(100% - 4px)"}]},{count:4,param:[{top:"0px",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"0px",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"}]},{count:6,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 2 - 6px)",height:"calc(100% / 3 * 2 - 8px)"},{top:"calc(100% / 3 * 2 - 4px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 1 - 0px)",width:"calc(100% / 3 * 1 - 6px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"0px",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 2px)",height:"calc(100% / 3 * 1 - 8px)"},{top:"calc(100% / 3 * 1 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]},{count:8,param:[{top:"0px",left:"0px",width:"calc(100% / 4 * 3 - 6px)",height:"calc(100% / 4 * 3 - 8px)"},{top:"calc(100% / 4 * 3 - 4px)",left:"0px",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 1 - 0px)",width:"calc(100% / 4 * 1 - 6px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 2 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 2px)",height:"calc(100% / 4 * 1)"},{top:"0px",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 1 - 2px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 2 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 4px)"}]},{count:9,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 2)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]}]},methods:{init:function(e){var t=this;if(t.mIP=e.ip,t.mPwd=e.pwd,t.mPort=e.port,t.mUserName=e.userName,t.mVehicleNo=e.vehicleNo,t.mVideoCount>t.maxVideoNum||t.mVideoCount<0)return t.$Message.destroy(),t.msgType="error",void(t.msgInfo="视频窗口数量有误");t.updateVideoWin(4),t.loginGetVideo()},changLoginCode:function(){var e=this;e.loginCodeUrl="http://140.246.113.143:6680/code/verificationCode.do?t="+Date.parse(new Date)},loginGetVideo:function(){var e=this;$.ajax({url:"http://39.106.1.200:8080/turkeyApi/user/loginApi.do?userAccount=zyltest&password=000000&languages=cn",beforeSend:function(t){e.loading=!0},complete:function(t,i){e.loading=!1},success:function(t){0==t.result&&(e.isLogin=!1,e.uSession=t.pojo.sessionId,t.pojo.sessionId&&e.startVideo()),e.loading=!1},error:function(e,t,i){console.log(t)}})},onTimeChange:function(e){var t=this;t.timeLen=parseInt(e,10)},setCurrentStyle:function(e){$("body").find(".videoItem").removeClass("active"),$("body").find("#"+e).addClass("active")},connectNet:function(){for(var e=this,t=0;t<e.splitNum;t++)e.playerList.push(null),e.loadVideoSource({type:"flv",url:"http://140.246.113.143:6604/RealplayFlv.do?DevIDNO=015831021100&Channel="+t+"&StreamType=1&uSession="+e.uSession},t);for(var i=0;i<e.splitNum;i++)e.playerList[i].play();e.isStop=!1,e.timeLenOut=null,setTimeout(function(){e.timeLenOut=setInterval(function(){e.timeLen--,e.$Message.destroy(),e.timeLen<=0&&e.stopVideo()},1e3)},5e3)},updateVideoWin:function(e){for(var t=this,i=null,c=0;c<t.videoWinSplit.length;c++)if(t.videoWinSplit[c].count==e){i=t.videoWinSplit[c].param;break}if(null==i)return t.$Message.destroy(),t.msgType="error",t.msgInfo="分屏数据定义有误",void clearInterval(t.timeLenOut);$("body").find(".videoItem").css("display","none");for(var l=0;l<e;l++){var a=$("body").find("#liveVideo"+l);if(null==a)return t.$Message.destroy(),t.msgType="error",t.msgInfo="当前视频窗口定义不存在",void clearInterval(t.timeLenOut);a.css({top:i[l].top,left:i[l].left,width:i[l].width,height:i[l].height,display:"block"})}t.splitNum=e,$("body").find("#liveVideo0").addClass("active")},loadVideoSource:function(e,t){var i=this,c=$("body").find("#video"+t)[0];void 0!==i.playerList[t]&&null!=i.playerList[t]&&(i.playerList[t].unload(),i.playerList[t].detachMediaElement(),i.playerList[t].destroy(),i.playerList[t]=null),i.playerList[t]=flvjs.createPlayer(e,{enableWorker:!1,lazyLoadMaxDuration:180,seekType:"range"}),i.playerList[t].attachMediaElement(c),i.playerList[t].load()},startVideo:function(){var e=this;e.stopVideo(),e.connectNet(),e.$Message.destroy(),e.msgType="error",e.msgInfo=""},stopVideo:function(){for(var e=this,t=0;t<e.splitNum;t++)e.playerList[t]&&(e.playerList[t].pause(),e.playerList[t].unload(),e.playerList[t].detachMediaElement(),e.playerList[t].destroy(),e.playerList[t]=null);e.isStop=!0,e.$Message.destroy(),e.msgType="success",e.msgInfo="视频已经全部关闭",clearInterval(e.timeLenOut),e.timeOffline=5,e.timeLen<=0&&(e.timeLen=parseInt(e.timeSelect))},setFullScream:function(e){var t=this;t.isFullScream=!0,$("body").find("#"+e).parents(".videoWrap").addClass("fullScream"),t.runPrefixMethod($("body").find("#"+e).parents(".videoWrap")[0],"RequestFullScreen")},closeFullScream:function(e){var t=this;t.isFullScream=!1,$("body").find("#"+e).parents(".videoWrap").removeClass("fullScream"),t.runPrefixMethod(document,"CancelFullScreen")},playAudio:function(e){},stopAudio:function(){},runPrefixMethod:function(e,t){var i;return["webkit","moz","ms","o",""].forEach(function(c){if(!i){""===c&&(t=t.slice(0,1).toLowerCase()+t.slice(1));var l=typeof e[c+t];l+""!="undefined"&&(i="function"===l?e[c+t]():e[c+t])}}),i}},mounted:function(){var e=this;e.$Message.config({top:5,duration:0,closable:!0}),e.$Notice.config({top:5,duration:0,closable:!0}),e.init({port:7668,pwd:"888888",userName:"mgkj",ip:"220.231.225.7",vehicleNo:decodeURI(utility.getQueryParams().vehicleNo)})}});
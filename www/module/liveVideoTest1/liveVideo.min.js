new Vue({el:"#js-vue",data:{queryInfo:utility.getQueryParams(),mIP:"",mPort:"",mUserName:"",mPwd:"",mVehicleNo:"",mVideoCount:9,maxVideoNum:10,isStop:!0,offLine:!1,uSession:"",errorTip:"",timeOfflineOut:null,timeOffline:5,timeLen:30,timeSelect:"30",timeLenOut:null,netnSignal:"",msgType:"primary",msgInfo:"",isFullScream:!1,channelIndex:1,fullScreamIndex:"",defaultColor:"rgb(255,125,0)",splitNum:1,connectTimeOut:null,playerList:[],dragAndDrop:{sourceEle:null,targetEle:null,sourceStyle:"",targetStyle:""},mediaDataSourceList:[],splitArea:[1,4,6,8,9],videoWinSplit:[{count:1,param:[{top:"0px",left:"0px",width:"calc(100% - 4px)",height:"calc(100% - 4px)"}]},{count:4,param:[{top:"0px",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"0px",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"}]},{count:6,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 2 - 6px)",height:"calc(100% / 3 * 2 - 8px)"},{top:"calc(100% / 3 * 2 - 4px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 1 - 0px)",width:"calc(100% / 3 * 1 - 6px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"0px",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 2px)",height:"calc(100% / 3 * 1 - 8px)"},{top:"calc(100% / 3 * 1 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]},{count:8,param:[{top:"0px",left:"0px",width:"calc(100% / 4 * 3 - 6px)",height:"calc(100% / 4 * 3 - 8px)"},{top:"calc(100% / 4 * 3 - 4px)",left:"0px",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 1 - 0px)",width:"calc(100% / 4 * 1 - 6px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 2 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 2px)",height:"calc(100% / 4 * 1)"},{top:"0px",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 1 - 2px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 2 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 4px)"}]},{count:9,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 2)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]}]},methods:{init:function(e){var t=this;if(t.mIP=e.ip,t.mPwd=e.pwd,t.mPort=e.port,t.mUserName=e.userName,t.mVehicleNo=e.vehicleNo,t.mVideoCount>t.maxVideoNum||t.mVideoCount<0)return t.$Message.destroy(),t.msgType="error",void(t.msgInfo="视频窗口数量有误");t.updateVideoWin(4)},loginGetVideo:function(){var e=this,t=Date.parse(new Date);$.ajax({url:"http://43.247.68.26:8080"+CONFIG.SERVICE.providerService+"?action="+CONFIG.ACTION.getProviderSessionId+"&platformCode=SZ_YJW",type:"POST",dataType:"json",jsonp:"callback",crossDomain:!0,xhrFields:{withCredentials:!0},headers:{appType:2,version:100,languageVer:"cn",crossDomain:!0,timestamp:t,withCredentials:!0,userId:e.queryInfo.id,"Access-Control-Allow-Origin":"",userToken:e.queryInfo.userToken,actionUrl:CONFIG.SERVICE.providerService,signStr:md5(e.queryInfo.userToken+e.queryInfo.id+t+"100").toUpperCase()},success:function(t){200==t.code&&(e.isLogin=!1,e.uSession=t.data.sessionValue,t.data.sessionValue&&e.startVideo())},error:function(e,t,l){console.log(l)}})},onTimeChange:function(e){var t=this;t.timeLen=parseInt(e,10)},setCurrentStyle:function(e){$("body").find(".videoItem").removeClass("active"),$("body").find("#"+e).addClass("active")},connectNet:function(){for(var e=this,t=0;t<e.splitNum;t++)e.playerList.push(null),e.loadVideoSource({type:"flv",url:"http://39.106.1.200:6604/RealplayFlv.do?DevIDNO="+e.queryInfo.vehicleNo+"&Channel="+t+"&StreamType=0&uSession="+e.uSession},t);setTimeout(function(){for(var t=0;t<e.splitNum;t++)e.playerList[t].play(),$("#video"+t)[0].play()},1e3),e.isStop=!1,e.timeLenOut=null,setTimeout(function(){e.timeLenOut=setInterval(function(){e.timeLen--,e.$Message.destroy(),e.timeLen<=0&&e.stopVideo()},1e3)},5e3)},updateVideoWin:function(e){for(var t=this,l=null,a=0;a<t.videoWinSplit.length;a++)if(t.videoWinSplit[a].count==e){l=t.videoWinSplit[a].param;break}if(null==l)return t.$Message.destroy(),t.msgType="error",t.msgInfo="分屏数据定义有误",void clearInterval(t.timeLenOut);$("body").find(".videoItem").css("display","none");for(var i=0;i<e;i++){var c=$("body").find("#liveVideo"+i);if(null==c)return t.$Message.destroy(),t.msgType="error",t.msgInfo="当前视频窗口定义不存在",void clearInterval(t.timeLenOut);c.css({top:l[i].top,left:l[i].left,width:l[i].width,height:l[i].height,display:"block"})}t.splitNum=e,$("body").find("#liveVideo0").addClass("active"),t.loginGetVideo()},loadVideoSource:function(e,t){var l=this,a=$("body").find("#video"+t)[0];void 0!==l.playerList[t]&&null!=l.playerList[t]&&(l.playerList[t].unload(),l.playerList[t].detachMediaElement(),l.playerList[t].destroy(),l.playerList[t]=null),l.playerList[t]=flvjs.createPlayer(e,{enableWorker:!1,lazyLoadMaxDuration:180,seekType:"range"}),l.playerList[t].attachMediaElement(a),l.playerList[t].load()},startVideo:function(){var e=this;e.stopVideo(),e.connectNet(),e.$Message.destroy(),e.msgType="error",e.msgInfo=""},stopVideo:function(){for(var e=this,t=0;t<e.splitNum;t++)e.playerList[t]&&(e.playerList[t].pause(),e.playerList[t].unload(),e.playerList[t].detachMediaElement(),e.playerList[t].destroy(),e.playerList[t]=null);e.isStop=!0,e.$Message.destroy(),e.msgType="success",e.msgInfo="视频已经全部关闭",clearInterval(e.timeLenOut),e.timeOffline=5,e.timeLen<=0&&(e.timeLen=parseInt(e.timeSelect))},setFullScream:function(e){var t=this;t.isFullScream=!0,$("body").find("#"+e).parents(".videoWrap").addClass("fullScream"),t.runPrefixMethod($("body").find("#"+e).parents(".videoWrap")[0],"RequestFullScreen")},closeFullScream:function(e){var t=this;t.isFullScream=!1,$("body").find("#"+e).parents(".videoWrap").removeClass("fullScream"),t.runPrefixMethod(document,"CancelFullScreen")},playAudio:function(e){},stopAudio:function(){},runPrefixMethod:function(e,t){var l;return["webkit","moz","ms","o",""].forEach(function(a){if(!l){""===a&&(t=t.slice(0,1).toLowerCase()+t.slice(1));var i=typeof e[a+t];i+""!="undefined"&&(l="function"===i?e[a+t]():e[a+t])}}),l},dragEnd:function(e){var t=this,l=$(e.srcElement);t.dragAndDrop.sourceEle=l,t.dragAndDrop.sourceStyle=l.attr("style")},drop:function(e){var t=this,l=$(e.srcElement).parents(".videoItem");e.preventDefault(),t.dragAndDrop.targetEle=l,t.dragAndDrop.targetStyle=l.attr("style"),setTimeout(function(){t.dragAndDrop.targetEle.attr("style",t.dragAndDrop.sourceStyle),t.dragAndDrop.sourceEle.attr("style",t.dragAndDrop.targetStyle)},250)},dragOver:function(e){e.preventDefault()}},mounted:function(){var e=this;e.$Message.config({top:5,duration:0,closable:!0}),e.$Notice.config({top:5,duration:0,closable:!0}),e.init({port:7668,pwd:"888888",userName:"mgkj",ip:"220.231.225.7",vehicleNo:decodeURI(utility.getQueryParams().vehicleNo)})}});
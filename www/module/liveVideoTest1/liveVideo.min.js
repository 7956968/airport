new Vue({el:"#js-vue",data:{isShowDetail:!0,vehicleInfo:JSON.parse(decodeURI(utility.getQueryParams().vehicleInfo)),queryInfo:utility.getQueryParams(),mIP:"",mPort:"",mUserName:"",mPwd:"",mVehicleNo:"",mVideoCount:9,maxVideoNum:10,isStop:!0,offLine:!1,uSession:"",errorTip:"",timeOfflineOut:null,timeOffline:5,timeLen:120,timeSelect:"120",timeLenOut:null,netnSignal:"",msgType:"primary",msgInfo:"",isFullScream:!1,channelIndex:1,fullScreamIndex:"",defaultColor:"rgb(255,125,0)",splitNum:1,connectTimeOut:null,playerList:[],dragAndDrop:{sourceEle:null,targetEle:null,sourceStyle:"",targetStyle:""},backPlay:{isBackPlay:!1,date:"",beginTime:"",endTIme:"",Date:"",BeginSecond:"",EndSecond:""},mediaDataSourceList:[],splitArea:[1,4,6,8,9],videoWinSplit:[{count:1,param:[{top:"0px",left:"0px",width:"calc(100% - 4px)",height:"calc(100% - 4px)"}]},{count:4,param:[{top:"0px",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"0px",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"}]},{count:6,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 2 - 6px)",height:"calc(100% / 3 * 2 - 8px)"},{top:"calc(100% / 3 * 2 - 4px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 1 - 0px)",width:"calc(100% / 3 * 1 - 6px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"0px",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 2px)",height:"calc(100% / 3 * 1 - 8px)"},{top:"calc(100% / 3 * 1 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]},{count:8,param:[{top:"0px",left:"0px",width:"calc(100% / 4 * 3 - 6px)",height:"calc(100% / 4 * 3 - 8px)"},{top:"calc(100% / 4 * 3 - 4px)",left:"0px",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 1 - 0px)",width:"calc(100% / 4 * 1 - 6px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 2 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 2px)",height:"calc(100% / 4 * 1)"},{top:"0px",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 1 - 2px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 2 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 4px)"}]},{count:9,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 2)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]}]},methods:{init:function(e){var t=this;if(t.mIP=e.ip,t.mPwd=e.pwd,t.mPort=e.port,t.mUserName=e.userName,t.mVehicleNo=e.vehicleNo,t.mVideoCount>t.maxVideoNum||t.mVideoCount<0)return t.$Message.destroy(),t.msgType="error",void(t.msgInfo="视频窗口数量有误");t.updateVideoWin(4)},loginGetVideo:function(){var e=this,t=Date.parse(new Date);$.ajax({url:"http://43.247.68.26:8080"+CONFIG.SERVICE.providerService+"?action="+CONFIG.ACTION.getProviderSessionId+"&platformCode=SZ_YJW",type:"POST",dataType:"json",jsonp:"callback",crossDomain:!0,xhrFields:{withCredentials:!0},headers:{appType:2,version:100,languageVer:"cn",crossDomain:!0,timestamp:t,withCredentials:!0,userId:e.queryInfo.id,"Access-Control-Allow-Origin":"",userToken:e.queryInfo.userToken,actionUrl:CONFIG.SERVICE.providerService,signStr:md5(e.queryInfo.userToken+e.queryInfo.id+t+"100").toUpperCase()},success:function(t){200==t.code&&(e.isLogin=!1,e.uSession=t.data.sessionValue,t.data.sessionValue&&(0==e.queryInfo.isBackPlay?e.startLiveVideo():1==e.queryInfo.isBackPlay&&e.getVedioFile()))},error:function(e,t,i){console.log(i)}})},onTimeChange:function(e){var t=this;t.timeLen=parseInt(e,10)},setCurrentStyle:function(e){$("body").find(".videoItem").removeClass("active"),$("body").find("#"+e).addClass("active")},getVedioFile:function(){var e=this;$.ajax({type:"POST",url:"http://39.106.1.200:6604/PlaybackSearch.do?DevIDNO="+e.vehicleInfo.licenseNumber+"&uSession="+e.uSession,crossDomain:!0,xhrFields:{withCredentials:!0},success:function(e){e.code},error:function(e,t,i){console.log(i)}})},playBackVideo:function(){for(var e=this,t=0;t<e.splitNum;t++)e.playerList.push(null),e.loadVideoSource({type:"flv",url:"http://39.106.1.200:6604/PlaybackFlv.do?DevIDNO="+e.vehicleInfo.licenseNumber+"&Channel="+t+"&StreamType=0&uSession="+e.uSession+"&Date="+e.backPlay.Date+"&BeginSecond="+e.backPlay.BeginSecond+"&EndSecond="+e.backPlay.EndSecond},t)},livePreivew:function(){for(var e=this,t="6604",i=0;i<e.splitNum;i++)e.playerList.push(null),i>5&&(t="8604"),0==e.queryInfo.isBackPlay&&e.loadVideoSource({type:"flv",url:"http://39.106.1.200:"+t+"/RealplayFlv.do?DevIDNO="+e.vehicleInfo.licenseNumber+"&Channel="+i+"&StreamType=0&uSession="+e.uSession},i);setInterval(function(){for(var t=0;t<e.splitNum;t++)$("#video"+t)[0].play()},3e3),e.isStop=!1,clearInterval(e.timeLenOut),setTimeout(function(){e.timeLenOut=null,e.timeLenOut=setInterval(function(){e.timeLen--,e.$Message.destroy(),e.timeLen<=0&&(e.stopVideo(),clearInterval(e.timeLenOut))},1e3)},5e3)},updateVideoWin:function(e){for(var t=this,i=null,l=0;l<t.videoWinSplit.length;l++)if(t.videoWinSplit[l].count==e){i=t.videoWinSplit[l].param;break}if(null==i)return t.$Message.destroy(),t.msgType="error",t.msgInfo="分屏数据定义有误",void clearInterval(t.timeLenOut);$("body").find(".videoItem").css("display","none");for(var a=0;a<e;a++){var c=$("body").find("#liveVideo"+a);if(null==c)return t.$Message.destroy(),t.msgType="error",t.msgInfo="当前视频窗口定义不存在",void clearInterval(t.timeLenOut);c.css({top:i[a].top,left:i[a].left,width:i[a].width,height:i[a].height,display:"block"})}t.splitNum=e,$("body").find("#liveVideo0").addClass("active"),0!=t.playerList.length?t.livePreivew():t.loginGetVideo()},loadVideoSource:function(e,t){var i=this,l=$("body").find("#video"+t)[0];void 0!==i.playerList[t]&&null!=i.playerList[t]&&(i.playerList[t].unload(),i.playerList[t].detachMediaElement(),i.playerList[t].destroy(),i.playerList[t]=null),i.playerList[t]=flvjs.createPlayer(e,{enableWorker:!1,lazyLoadMaxDuration:180,seekType:"range"}),i.playerList[t].attachMediaElement(l),i.playerList[t].load(),i.playerList[t].play()},startLiveVideo:function(){var e=this;e.stopVideo(),e.livePreivew(),e.$Message.destroy(),e.msgType="error",e.msgInfo=""},startBackVideo:function(){var e=this;e.stopVideo(),e.playBackVideo(),e.$Message.destroy(),e.msgType="error",e.msgInfo=""},stopVideo:function(){for(var e=this,t=0;t<e.splitNum;t++)e.playerList[t]&&(e.playerList[t].pause(),e.playerList[t].unload(),e.playerList[t].detachMediaElement(),e.playerList[t].destroy(),e.playerList[t]=null);e.isStop=!0,e.$Message.destroy(),e.msgType="success",e.msgInfo="视频已经全部关闭",clearInterval(e.timeLenOut),e.timeOffline=5,e.timeLen=120,e.timeSelect="120"},dragEnd:function(e){var t=this,i=$(e.srcElement);t.dragAndDrop.sourceEle=i,t.dragAndDrop.sourceStyle=i.attr("style")},drop:function(e){var t=this,i=$(e.srcElement).parents(".videoItem");e.preventDefault(),t.dragAndDrop.targetEle=i,t.dragAndDrop.targetStyle=i.attr("style"),setTimeout(function(){t.dragAndDrop.targetEle.attr("style",t.dragAndDrop.sourceStyle),t.dragAndDrop.sourceEle.attr("style",t.dragAndDrop.targetStyle)},250)},dragOver:function(e){e.preventDefault()},dateChange:function(e){var t=this;t.backPlay.Date=e},beginTimeChange:function(e){var t=this,i=e.split(":");t.backPlay.BeginSecond=3600*i[0]+60*i[1]+i[2]},endTimeChange:function(e){var t=this,i=e.split(":");t.backPlay.EndSecond=3600*i[0]+60*i[1]+i[2]},setFullScream:function(e){var t=$("body").find("#"+e)[0],i=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;if(void 0!==i&&i)i.call(t);else if(void 0!==window.ActiveXObject){var l=new ActiveXObject("WScript.Shell");null!=l&&l.SendKeys("{F11}")}},backPage:function(){window.close()}},mounted:function(){var e=this;e.$Message.config({top:5,duration:0,closable:!0}),e.$Notice.config({top:5,duration:0,closable:!0}),e.backPlay.isBackPlay=1==e.queryInfo.isBackPlay,e.init({port:7668,pwd:"888888",userName:"mgkj",ip:"220.231.225.7",vehicleNo:e.vehicleInfo.licenseNumber})}});
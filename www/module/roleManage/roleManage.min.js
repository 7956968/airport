(function(){var e=utility.getLocalStorage("language"),i=utility.getLocalStorage("userInfo"),t=utility.getLocalStorage("bizParam"),o=new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!0,isShowModal:!1,isModalLoading:!0,modalTitle:"",isShowMember:!1,isShowFunctions:!1,isUserList:!1,isFunctionList:!1,tableHeight:function(){var e=$(".tableContainer").height();return e-100}(),groupTypeList:t.groupType,pageInfo:{id:0,count:0,pageNum:1,pageSize:15,roleName:"",companyId:""},index:0,selectItem:null,itemInfo:{id:"",companyId:"",roleName:"",roleCode:"",roleDesc:"",isValid:"",isPublic:"",createUserId:i.id,modifyUserId:i.id},columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"公司名称",EN:"Company Name",TW:"公司名称"}[e.language],key:"companyName"},{title:{CN:"角色编号",EN:"Role Number",TW:"角色編號"}[e.language],key:"roleCode"},{title:{CN:"角色名称",EN:"Role Name",TW:"角色名稱"}[e.language],key:"roleName"},{title:{CN:"公共",EN:"Public",TW:"公共"}[e.language],key:"isPublic"},{title:{CN:"有效",EN:"Effective",TW:"有效"}[e.language],key:"isValid"},{title:{CN:"角色描述",EN:"Role Description",TW:"角色描述"}[e.language],key:"roleDesc"},{title:{CN:"操作",EN:"State",TW:"操作"}[e.language],key:"state",width:200,align:"center",render:function(i,t){return i("div",[i("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.isShowFunctions=!0,o.roleFunctionPageInfo.roleId=o.roleList[t.index].id,o.roleFunctionPageInfo.companyId=o.roleList[t.index].companyId,o.getRoleFunctionsDataList(!0)}}},{CN:"可用功能",EN:"Role Functions",TW:"可用功能"}[e.language]),i("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.isShowMember=!0,o.roleMemberPageInfo.roleId=o.roleList[t.index].id,o.roleMemberPageInfo.companyId=o.roleList[t.index].companyId,o.userPageInfo.companyId=o.roleList[t.index].companyId,o.getRoleMemberList(!0)}}},{CN:"角色成员",EN:"Role Members",TW:"角色成員"}[e.language])])}}],tableRowList:[],companyList:[],roleList:[],departList:[],roleMemberIndex:0,roleMemberPageInfo:{count:0,pageNum:1,pageSize:15,roleId:"",companyId:""},roleMemberItem:{id:"",roleId:"",roleName:"",companyId:"",userId:"",userName:"",createUserId:i.id,modifyUserId:i.id},roleMemberColumsList:[{type:"selection",width:60,align:"center"},{title:{CN:"ID",EN:"ID",TW:"ID"}[e.language],width:60,key:"id"},{title:{CN:"公司名称",EN:"Company Name",TW:"公司名稱"}[e.language],key:"companyName"},{title:{CN:"角色名称",EN:"Role",TW:"角色名稱"}[e.language],key:"roleName"},{title:{CN:"下属姓名",EN:"Subordinate Name",TW:"下屬姓名"}[e.language],key:"userName"}],roleMemberTableRowList:[],selectRoleMember:[],roleMemberList:[],userPageInfo:{count:0,pageNum:1,pageSize:15,companyId:""},userColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"ID",EN:"ID",TW:"ID"}[e.language],width:60,key:"id"},{title:{CN:"姓名",EN:"Name",TW:"姓名"}[e.language],key:"userName"},{title:{CN:"性别",EN:"Gender",TW:"性別"}[e.language],key:"sex"},{title:{CN:"手机号",EN:"cellPhone No.",TW:"手機號"}[e.language],key:"mobile"},{title:{CN:"所属公司",EN:"Company",TW:"所屬公司"}[e.language],key:"company"},{title:{CN:"员工工号",EN:"Staff Number",TW:"員工工號"}[e.language],key:"userSeq"}],userTableRowList:[],userList:[],selectUser:[],roleFunctionPageInfo:{count:0,pageNum:1,pageSize:15,roleId:"",companyId:""},roleFunctionIndex:0,roleFunctionItem:{},roleFunctionList:[],selectRoleFunction:[],roleFunctionColumsList:[{type:"selection",width:60,align:"center"},{title:{CN:"ID",EN:"ID",TW:"ID"}[e.language],width:60,key:"id"},{title:{CN:"公司名称",EN:"Company Name",TW:"公司名稱"}[e.language],key:"companyName"},{title:{CN:"角色名称",EN:"Role",TW:"角色名稱"}[e.language],key:"roleName"},{title:{CN:"功能名称",EN:"Functions Name",TW:"功能名稱"}[e.language],key:"functionName"}],roleFunctionTableRowList:[],functionsPageInfo:{count:0,pageNum:1,pageSize:20},functionList:[],selectFunction:[],permissionFunctionTypeLis:t.permissionFunctionType,functionsColumnsList:[{type:"selection",width:60,align:"center"},{title:{CN:"ID",EN:"ID",TW:"ID"}[e.language],width:60,key:"id"},{title:{CN:"功能层级",EN:"Functions Name",TW:"功能層級"}[e.language],key:"functionLevel"},{title:{CN:"功能类型",EN:"Functions Type",TW:"功能類型"}[e.language],key:"functionType"},{title:{CN:"功能名称",EN:"Functions Name",TW:"功能名稱"}[e.language],key:"functionName"},{title:{CN:"是否可用",EN:"isValid",TW:"是否可用"}[e.language],key:"isValid"}],functionsTableRowList:[]},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",companyId:"",roleName:"",roleCode:"",roleDesc:"",isValid:"",isPublic:"",createUserId:i.id,modifyUserId:i.id}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.roleList[e.index],e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},delItem:function(){var e=this;e.itemInfo=e.roleList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.delRole,actionUrl:CONFIG.SERVICE.permissionService,dataObj:{ids:e.itemInfo.id,modifyUserId:i.id},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(i){200==i.code?e.getRoleDataList(!0):e.$Message.error(i.message)}})})},setCurrentRowData:function(e,i){var t=this;e&&(t.index=i,t.selectItem=e)},pageSizeChange:function(e){var i=this;i.pageInfo.pageNum=parseInt(e,10)-1,setTimeout(function(){i.getRoleDataList(!1)},200)},pageRowChange:function(e){var i=this;console.log(e),i.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getRoleDataList(!1)},200)},showUserLayer:function(){var e=this;e.isUserList=!0,e.getUserList(!0)},formatRoleMember:function(){for(var e=this,i=0,t=e.roleMemberList.length;i<t;i++)e.roleMemberTableRowList.push({id:decodeURI(e.roleMemberList[i].id),roleName:decodeURI(e.roleMemberList[i].roleName),companyName:decodeURI(e.roleMemberList[i].companyName),userName:decodeURI(e.roleMemberList[i].userName)})},getRoleMemberList:function(e){var i=this;1==e&&(i.roleMemberTableRowList=[],i.roleMemberPageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.getRoleUserList,actionUrl:CONFIG.SERVICE.permissionService,dataObj:i.roleMemberPageInfo,beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code?(i.roleMemberList=e.data,i.roleMemberPageInfo.count=e.count,i.formatRoleMember()):i.$Message.error(e.message)}})},deleteRoleMember:function(){var e=this;return 0==e.selectRoleMember.length?void e.$Message.error({content:{CN:"请选择一条数据",EN:"Please select a data",TW:"請選擇一條數據"}[e.language],top:200,duration:3}):(e.isModalLoading=!0,void utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.delRoleUser,actionUrl:CONFIG.SERVICE.permissionService,dataObj:{ids:e.selectRoleMember.join(","),modifyUserId:i.id},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(i){200==i.code?e.getRoleMemberList(!0):e.$Message.error(i.message)}}))},roleMemberPageSizeChange:function(e){var i=this;i.roleMemberPageInfo.pageNum=parseInt(e,10)-1,setTimeout(function(){i.getRoleMemberList(!1)},200)},roleMemberPageRowChange:function(e){var i=this;i.roleMemberPageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getRoleMemberList(!1)},200)},userPageSizeChange:function(e){var i=this;i.userPageInfo.pageNum=parseInt(e,10)-1,setTimeout(function(){i.getUserList(!1)},200)},userPageRowChange:function(e){var i=this;i.userPageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getUserList(!1)},200)},selectMembers:function(){var e=this;utility.showMessageTip(e,function(){e.isShowMember=!0})},companyChange:function(){},selectMemberChange:function(e){for(var i=this,t=[],o=0,n=e.length;o<n;o++)t.push(e[o].id);i.selectRoleMember=t},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.saveRole,actionUrl:CONFIG.SERVICE.permissionService,dataObj:{id:e.itemInfo.id,companyId:e.itemInfo.companyId,roleName:encodeURI(e.itemInfo.roleName),roleCode:encodeURI(e.itemInfo.roleCode),roleDesc:encodeURI(e.itemInfo.roleDesc),isValid:e.itemInfo.isValid,isPublic:e.itemInfo.isPublic,createUserId:i.id,modifyUserId:i.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(i){200==i.code?(e.getRoleDataList(!0),e.isShowModal=!1):e.$Message.error(i.message)}})},formatRoleTableList:function(){for(var e=this,i=0,t=e.roleList.length;i<t;i++)e.tableRowList.push({roleName:decodeURI(e.roleList[i].roleName),companyName:decodeURI(e.roleList[i].companyName),roleCode:e.roleList[i].roleCode,roleDesc:decodeURI(e.roleList[i].roleDesc),isValid:{1:{CN:"是",EN:"Yes",TW:"是"}[e.language],0:{CN:"否",EN:"No",TW:"否"}[e.language]}[e.roleList[i].isValid+""],isPublic:{1:{CN:"是",EN:"Yes",TW:"是"}[e.language],0:{CN:"否",EN:"No",TW:"否"}[e.language]}[e.roleList[i].isPublic+""]})},addRoleMember:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.saveRoleUser,actionUrl:CONFIG.SERVICE.permissionService,dataObj:{roleId:e.roleMemberPageInfo.roleId,companyId:e.roleMemberPageInfo.companyId,userIds:e.selectUser.join(","),createUserId:i.id,modifyUserId:i.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(i){200==i.code?(e.getRoleMemberList(!0),e.isUserList=!1):e.$Message.error(i.message)}})},getRoleDataList:function(e){var i=this;1==e&&(i.tableRowList=[],i.pageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.getRoleList,actionUrl:CONFIG.SERVICE.permissionService,dataObj:i.pageInfo,beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code?(i.roleList=e.data,i.pageInfo.count=e.count,i.formatRoleTableList()):i.$Message.error(e.message)}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(i){200==i.code&&(e.companyList=i.data)}})},selectUserChange:function(e){for(var i=this,t=[],o=0,n=e.length;o<n;o++)t.push(e[o].id);i.selectUser=t},formatUserData:function(){for(var e=this,i=0,t=e.userList.length;i<t;i++)e.userTableRowList.push({id:decodeURI(e.userList[i].id),userName:decodeURI(e.userList[i].userName),sex:e.userList[i].sex,mobile:e.userList[i].mobile,userSeq:decodeURI(e.userList[i].userSeq),company:decodeURI(e.userList[i].companyName)})},getUserList:function(e){var i=this;1==e&&(i.userTableRowList=[],i.userPageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.getUserList,actionUrl:CONFIG.SERVICE.userService,dataObj:i.userPageInfo,beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code?(i.userList=e.data,i.userPageInfo.count=e.count,i.formatUserData()):i.$Message.error(e.message)}})},roleFunctionsPageSizeChange:function(e){var i=this;i.roleFunctionPageInfo.pageNum=parseInt(e,10)-1,setTimeout(function(){i.getRoleFunctionsDataList(!1)},200)},roleFunctionsPageRowChange:function(e){var i=this;i.roleFunctionPageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getRoleFunctionsDataList(!1)},200)},deleteRoleFunctions:function(){var e=this;return 0==e.selectRoleFunction.length?void e.$Message.error({content:{CN:"请选择一条数据",EN:"Please select a data",TW:"請選擇一條數據"}[e.language],top:200,duration:3}):(e.isModalLoading=!0,void utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.delRoleFunction,actionUrl:CONFIG.SERVICE.permissionService,dataObj:{ids:e.selectRoleFunction.join(","),modifyUserId:i.id},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(i){200==i.code?e.getRoleFunctionsDataList(!0):e.$Message.error(i.message)}}))},selectRoleFunctionsChange:function(e){for(var i=this,t=[],o=0,n=e.length;o<n;o++)t.push(e[o].id);i.selectRoleFunction=t},uploadFunctionDataToServer:function(){var e=this,e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.saveRoleFunction,actionUrl:CONFIG.SERVICE.permissionService,dataObj:{roleId:e.roleFunctionPageInfo.roleId,companyId:e.roleFunctionPageInfo.companyId,functionIds:e.selectFunction.join(","),createUserId:i.id,modifyUserId:i.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(i){200==i.code?(e.getRoleFunctionsDataList(!0),e.isUserList=!1):e.$Message.error(i.message)}})},formatRoleFunction:function(){for(var e=this,i=0,t=e.roleFunctionList.length;i<t;i++)e.roleFunctionTableRowList.push({id:e.roleFunctionList[i].id,roleName:decodeURI(e.roleFunctionList[i].roleName),companyName:decodeURI(e.roleFunctionList[i].companyName),functionName:decodeURI(e.roleFunctionList[i].functionName)})},getRoleFunctionsDataList:function(e){var i=this;1==e&&(i.roleFunctionTableRowList=[],i.roleFunctionPageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.getRoleFunctionList,actionUrl:CONFIG.SERVICE.permissionService,dataObj:i.roleFunctionPageInfo,beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code?(i.roleFunctionList=e.data,i.roleFunctionPageInfo.count=e.count,i.formatRoleFunction()):i.$Message.error(e.message)}})},showFunctionsLayer:function(){var e=this;e.isFunctionList=!0,e.getFunctionsDataList(!0)},selectFunctionsChange:function(e){for(var i=this,t=[],o=0,n=e.length;o<n;o++)t.push(e[o].id);i.selectFunction=t},formatFunctions:function(){for(var e=this,i=0,t=e.functionList.length;i<t;i++)e.functionsTableRowList.push({id:e.functionList[i].id,functionLevel:e.functionList[i].functionLevel,functionType:function(){for(var i="",t=0,o=e.permissionFunctionTypeLis.length;t<o;t++)if(e.permissionFunctionTypeLis[t].type==e.functionList[t].functionType){i=e.permissionFunctionTypeLis[t].name;break}return i}(),functionName:decodeURI(e.functionList[i].functionName),functionCode:decodeURI(e.functionList[i].functionCode),isValid:{1:{CN:"是",EN:"Yes",TW:"是"}[e.language],0:{CN:"否",EN:"No",TW:"否"}[e.language]}[e.functionList[i].isValid+""]})},getFunctionsDataList:function(e){var i=this;1==e&&(i.functionsTableRowList=[],i.functionsPageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.getFunctionList,actionUrl:CONFIG.SERVICE.permissionService,dataObj:i.functionsPageInfo,beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code?(i.functionList=e.data,i.functionsPageInfo.count=e.count,i.formatFunctions()):i.$Message.error(e.message)}})},functionsPageSizeChange:function(e){var i=this;i.functionsPageInfo.pageNum=parseInt(e,10)-1,setTimeout(function(){i.getFunctionsDataList(!1)},200)},functionsPageRowChange:function(e){var i=this;console.log(e),i.functionsPageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getFunctionsDataList(!1)},200)}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getRoleDataList(!0),e.getCompanyList()},500)}})})();
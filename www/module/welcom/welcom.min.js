(function(){var e=utility.getLocalStorage("language"),t=utility.getLocalStorage("userInfo"),i=utility.getLocalStorage("bizParam");new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!1,isLoading:!0,innerHeight:window.innerHeight/6,resizeTime:null,copyRight:{CN:"@copyRight 深圳市民贵科技有限公司",EN:"@copyRight Mingui Non-Powered Euipment Management System",TW:"@copyRight 民貴無動力管理系統"}[e.language],vehicleInfo:{list:[],count:0},terminalStatusList:i.terminalStatus,vehicleTypeList:i.vehicleType,vehiclePassTypeList:i.vehiclePassType,vehicleTypeInfo:{},vehiclePassType:{},isloadDefen:!1,totalChartData:null,colorList:["#66CCCC","#CCFF66","#FF99CC","#A0522D","#FFFF00","#336699","#CC9933","#339999"]},methods:{isLogin:function(){t||(alert("请先登录！"),window.parent.window.location.href="/airport/www/login.html")},setTotalEchart:function(){for(var e=this,t=echarts.init(document.getElementById("totalEchart")),i=[],a=[],o=[],n=e.totalChartData.reverse(),l=0,c=n.length;l<c;l++){i.push(n[l].day);for(var r=0,s=n[l].useStat.length;r<s;r++)e.vehicleTypeInfo["_"+n[l].useStat[r].vehicleTypeId].list.push(n[l].useStat[r].totalVehicleNum)}for(var h in e.vehicleTypeInfo)o.push(e.vehicleTypeInfo[h].name),e.vehicleTypeInfo.hasOwnProperty(h)&&a.push({name:e.vehicleTypeInfo[h].name,type:"bar",barWidth:4,itemStyle:{normal:{barBorderRadius:2,color:e.vehicleTypeInfo[h].color}},data:e.vehicleTypeInfo[h].list});option={backgroundColor:"#0f375f",tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{top:20,data:o,textStyle:{color:"#ccc"}},xAxis:{data:i,axisLine:{lineStyle:{color:"#ccc"}}},yAxis:{splitLine:{show:!1},axisLine:{lineStyle:{color:"#ccc"}}},series:a.reverse()},t.setOption(option)},setVehicleEchart:function(){var e=this,t=echarts.init(document.getElementById("vehicleEchart")),i=function(){var t=[];for(var i in e.vehicleTypeInfo)e.vehicleTypeInfo.hasOwnProperty(i)&&0!=e.vehicleTypeInfo[i].value&&t.push(e.vehicleTypeInfo[i]);return t}(),a=function(){var t=[];for(var i in e.vehiclePassType)e.vehiclePassType.hasOwnProperty(i)&&t.push(e.vehiclePassType[i]);return t}();option={tooltip:{trigger:"item",formatter:"{b}:{c} ({d}%)"},legend:{show:!1},series:[{name:"车辆",type:"pie",selectedMode:"single",radius:[0,"30%"],label:{normal:{formatter:"{b}",backgroundColor:"#334455",color:"#fff"}},labelLine:{normal:{length:5,length2:5,smooth:!0,show:!0}},data:i},{name:"状态",type:"pie",radius:["40%","55%"],labelLine:{normal:{smooth:!0}},label:{normal:{formatter:"{b|{b}:}{c}次{per|{d}%}",backgroundColor:"#eee",borderColor:"#aaa",borderWidth:1,borderRadius:4,rich:{a:{color:"#999",lineHeight:22,align:"center"},hr:{borderColor:"#aaa",width:"100%",borderWidth:.5,height:0},b:{fontSize:12,lineHeight:24},per:{color:"#eee",backgroundColor:"#334455",padding:[1,2],borderRadius:2}}}},data:a}]},t.setOption(option)},setTerminateState:function(){var e=echarts.init(document.getElementById("terminateEchart"));option={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["正在静止","活动","开始进入休眠","运动传感器故障","侧翻","离线","GPS未定位","电压采集失败"],textStyle:{color:"#fff"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},textStyle:{color:"#ffffff"},xAxis:[{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"],nameTextStyle:{color:"#ffffff"}}],yAxis:[{type:"value",nameTextStyle:{color:"#ffffff"}}],series:[{name:"正在静止",type:"bar",data:[200,302,310,340,390,330,320]},{name:"活动",type:"bar",stack:"活动",data:[200,120,100,140,300,200,201]},{name:"开始进入休眠",type:"bar",stack:"开始进入休眠",data:[220,120,110,240,200,300,100]},{name:"运动传感器故障",type:"bar",stack:"运动传感器故障",data:[100,302,210,104,190,300,100]},{name:"侧翻",type:"bar",data:[620,180,640,260,160,160,100]},{name:"离线",type:"bar",barWidth:5,stack:"离线",data:[600,320,710,740,900,300,200]},{name:"GPS未定位",type:"bar",stack:"GPS未定位",data:[200,320,110,140,900,300,200]},{name:"电压采集失败",type:"bar",stack:"电压采集失败",data:[600,720,710,740,100,100,100]}]},e.setOption(option)},resetVehicleBizParamInfo:function(){var e=this;e.vehicleTypeInfo={},e.vehiclePassType={},e.vehicleInfo={list:[],count:0};for(var t=0,i=e.vehicleTypeList.length;t<i;t++)302!=e.vehicleTypeList[t].type&&303!=e.vehicleTypeList[t].type&&(e.vehicleTypeInfo["_"+e.vehicleTypeList[t].type]={value:0,name:e.vehicleTypeList[t].name,list:[],color:e.colorList[t]});for(var a=0,o=e.terminalStatusList.length;a<o;a++)e.vehicleInfo["_"+e.terminalStatusList[a].type]=0;for(var n=0,l=e.vehiclePassTypeList.length;n<l;n++)e.vehiclePassType["_"+e.vehiclePassTypeList[n].type]={value:0,name:e.vehiclePassTypeList[n].name,list:[],color:e.colorList[n]}},getCrossAreaList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getCrossAreaList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{pageNum:1,pageSize:1e5},beforeSendCallback:function(){e.isloadDefen=!0},completeCallback:function(){e.isloadDefen=!1},successCallback:function(t){if(200==t.code){for(var i=0,a=t.data.length;i<a;i++)e.vehiclePassType["_"+t.data[i].crossTypeId].value=e.vehiclePassType["_"+t.data[i].crossTypeId].value+1;e.setVehicleEchart()}}})},getVehicleList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{id:"",pageSize:1e4},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){if(200==t.code){e.vehicleInfo.count=t.count,e.vehicleInfo.list=t.data;for(var i=0,a=e.vehicleInfo.list.length;i<a;i++)e.vehicleInfo["_"+e.vehicleInfo.list[i].vehicleStatus]=e.vehicleInfo["_"+e.vehicleInfo.list[i].vehicleStatus]+1,e.vehicleTypeInfo["_"+e.vehicleInfo.list[i].vehicleTypeId].value=e.vehicleTypeInfo["_"+e.vehicleInfo.list[i].vehicleTypeId].value+1}}})},toMapPage:function(e){utility.setSessionStorage("fromInfo",{type:"isSearch",vehicleStatus:e}),setTimeout(function(){$(window.parent.document).find("#nav_Maps").bind("click"),$(window.parent.document).find("#nav_Maps").trigger("click")},200)},getVehicleStatusReport:function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleStatusReport,actionUrl:CONFIG.SERVICE.getVehicleStatusReport,successCallback:function(e){200==e.code&&console.log(e)}})},getVehicleRunReport:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleRunReport,actionUrl:CONFIG.SERVICE.getVehicleRunReport,successCallback:function(t){200==t.code&&(e.totalChartData=t.data,e.setTotalEchart())}})},getVehicleCateReport:function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleCateReport,actionUrl:CONFIG.SERVICE.getVehicleCateReport,successCallback:function(e){200==e.code&&console.log(e)}})},init:function(){var e=this;e.resetVehicleBizParamInfo(),e.getVehicleList(),e.getCrossAreaList(),e.getVehicleRunReport()}},created:function(){var e=this;utility.isLogin(!1),e.init(),setInterval(function(){e.init()},1e4),$(window).resize(function(){clearTimeout(e.resizeTime),e.resizeTime=setTimeout(function(){window.location.href=window.location.href},500)})},mounted:function(){var e=this;setTimeout(function(){e.isLoading=!1,e.setVehicleEchart()},5e3)}})})();
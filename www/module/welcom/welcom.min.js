(function(){var e=utility.getLocalStorage("language"),t=utility.getLocalStorage("userInfo");utility.getLocalStorage("bizParam"),new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!1,isLoading:!0,innerHeight:window.innerHeight/6,resizeTime:null,copyRight:{CN:"@copyRight 民贵无动力设备管理系统",EN:"@copyRight Mingui Non-Powered Euipment Management System",TW:"@copyRight 民貴無動力管理系統"}[e.language],vehicleInfo:{list:[],_401:0,_402:0,_403:0,_404:0,_405:0,_406:0,_407:0,_408:0,count:0},vehicleTypeInfo:{_301:{value:0,name:"牵引车"},_302:{value:0,name:"拖挂车"},_303:{value:0,name:"三面卡"}},vehiclePassType:{_501:{value:0,name:"驶入"},_502:{value:0,name:"驶出"},_503:{value:0,name:"停留"},_504:{value:0,name:"防区内行驶"},_505:{value:0,name:"超速"}},isloadDefen:!1,totalChartData:null},methods:{isLogin:function(){t||(alert("请先登录！"),window.parent.window.location.href="/airport/www/login.html")},setTotalEchart:function(){for(var e=this,t=echarts.init(document.getElementById("totalEchart")),a=[],i=[],l=[],o=[],c=0,n=e.totalChartData.length;c<n;c++){a.push(e.totalChartData[c].day),o.push(e.totalChartData[c].totalUsedNum);for(var r=0,s=e.totalChartData[c].useStat.length;r<s;r++)0==s?(i.push(0),l.push(0)):1==s?301==e.totalChartData[c].useStat[r].vehicleTypeId?(l.push(0),i.push(e.totalChartData[c].useStat[r].totalVehicleNum)):302==e.totalChartData[c].useStat[r].vehicleTypeId&&(i.push(0),l.push(e.totalChartData[c].useStat[r].totalVehicleNum)):2==s&&(301==e.totalChartData[c].useStat[r].vehicleTypeId?i.push(e.totalChartData[c].useStat[r].totalVehicleNum):302==e.totalChartData[c].useStat[r].vehicleTypeId&&l.push(e.totalChartData[c].useStat[r].totalVehicleNum))}a=a.reverse(),o=o.reverse(),i=i.reverse(),l=l.reverse(),option={backgroundColor:"#0f375f",tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{top:20,data:["牵引车使用频率","拖挂车使用频率","所有车辆统计"],textStyle:{color:"#ccc"}},xAxis:{data:a,axisLine:{lineStyle:{color:"#ccc"}}},yAxis:{splitLine:{show:!1},axisLine:{lineStyle:{color:"#ccc"}}},series:[{name:"所有车辆统计",type:"line",smooth:!0,showAllSymbol:!0,symbol:"emptyCircle",symbolSize:15,data:o},{name:"牵引车使用频率",type:"bar",barWidth:10,itemStyle:{normal:{barBorderRadius:5,color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#14c8d4"},{offset:1,color:"#43eec6"}])}},data:i},{name:"拖挂车使用频率",type:"bar",barWidth:10,itemStyle:{normal:{barBorderRadius:5,color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(20,200,212,0.5)"},{offset:.2,color:"rgba(20,200,212,0.2)"},{offset:1,color:"rgba(20,200,212,0)"}])}},z:-12,data:l}]},t.setOption(option)},setVehicleEchart:function(){var e=this,t=echarts.init(document.getElementById("vehicleEchart")),a=function(){var t=[];for(var a in e.vehicleTypeInfo)e.vehicleTypeInfo.hasOwnProperty(a)&&t.push(e.vehicleTypeInfo[a]);return t}(),i=function(){var t=[];for(var a in e.vehiclePassType)e.vehiclePassType.hasOwnProperty(a)&&t.push(e.vehiclePassType[a]);return t}();option={tooltip:{trigger:"item",formatter:"{b}:{c} ({d}%)"},legend:{show:!1},series:[{name:"车辆",type:"pie",selectedMode:"single",radius:[0,"30%"],label:{normal:{position:"inner"}},labelLine:{normal:{show:!1}},data:a},{name:"状态",type:"pie",radius:["40%","55%"],label:{normal:{formatter:"{b|{b}:}{c}次{per|{d}%}",backgroundColor:"#eee",borderColor:"#aaa",borderWidth:1,borderRadius:4,rich:{a:{color:"#999",lineHeight:22,align:"center"},hr:{borderColor:"#aaa",width:"100%",borderWidth:.5,height:0},b:{fontSize:12,lineHeight:24},per:{color:"#eee",backgroundColor:"#334455",padding:[1,2],borderRadius:2}}}},data:i}]},t.setOption(option)},setTerminateState:function(){var e=echarts.init(document.getElementById("terminateEchart"));option={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["正在静止","活动","开始进入休眠","运动传感器故障","侧翻","离线","GPS未定位","电压采集失败"],textStyle:{color:"#fff"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},textStyle:{color:"#ffffff"},xAxis:[{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"],nameTextStyle:{color:"#ffffff"}}],yAxis:[{type:"value",nameTextStyle:{color:"#ffffff"}}],series:[{name:"正在静止",type:"bar",data:[200,302,310,340,390,330,320]},{name:"活动",type:"bar",stack:"活动",data:[200,120,100,140,300,200,201]},{name:"开始进入休眠",type:"bar",stack:"开始进入休眠",data:[220,120,110,240,200,300,100]},{name:"运动传感器故障",type:"bar",stack:"运动传感器故障",data:[100,302,210,104,190,300,100]},{name:"侧翻",type:"bar",data:[620,180,640,260,160,160,100]},{name:"离线",type:"bar",barWidth:5,stack:"离线",data:[600,320,710,740,900,300,200]},{name:"GPS未定位",type:"bar",stack:"GPS未定位",data:[200,320,110,140,900,300,200]},{name:"电压采集失败",type:"bar",stack:"电压采集失败",data:[600,720,710,740,100,100,100]}]},e.setOption(option)},getCrossAreaList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getCrossAreaList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{pageNum:1,pageSize:1e5},beforeSendCallback:function(){e.isloadDefen=!0},completeCallback:function(){e.isloadDefen=!1},successCallback:function(t){if(200==t.code){e.vehiclePassType._501.value=0,e.vehiclePassType._502.value=0,e.vehiclePassType._503.value=0,e.vehiclePassType._504.value=0,e.vehiclePassType._505.value=0;for(var a=0,i=t.data.length;a<i;a++)501==t.data[a].crossTypeId?e.vehiclePassType._501.value=e.vehiclePassType._501.value+1:502==t.data[a].crossTypeId?e.vehiclePassType._502.value=e.vehiclePassType._502.value+1:503==t.data[a].crossTypeId?e.vehiclePassType._503.value=e.vehiclePassType._503.value+1:504==t.data[a].crossTypeId?e.vehiclePassType._504.value=e.vehiclePassType._504.value+1:505==t.data[a].crossTypeId&&(e.vehiclePassType._505.value=e.vehiclePassType._505.value+1);e.setVehicleEchart()}}})},formatVehicle:function(){for(var e=this,t=0,a=e.vehicleInfo.list.length;t<a;t++)401==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._401=e.vehicleInfo._401+1:402==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._402=e.vehicleInfo._402+1:403==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._403=e.vehicleInfo._403+1:404==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._404=e.vehicleInfo._404+1:405==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._405=e.vehicleInfo._405+1:406==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._406=e.vehicleInfo._406+1:407==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._407=e.vehicleInfo._407+1:408==e.vehicleInfo.list[t].vehicleStatus&&(e.vehicleInfo._408=e.vehicleInfo._408+1),301==e.vehicleInfo.list[t].vehicleTypeId?e.vehicleTypeInfo._301.value=e.vehicleTypeInfo._301.value+1:302==e.vehicleInfo.list[t].vehicleTypeId?e.vehicleTypeInfo._302.value=e.vehicleTypeInfo._302.value+1:303==e.vehicleInfo.list[t].vehicleTypeId&&(e.vehicleTypeInfo._303.value=e.vehicleTypeInfo._303.value+1)},getVehicleList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{id:"",pageSize:1e4},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code&&(e.vehicleInfo._401=0,e.vehicleInfo._402=0,e.vehicleInfo._403=0,e.vehicleInfo._404=0,e.vehicleInfo._405=0,e.vehicleInfo._406=0,e.vehicleInfo._407=0,e.vehicleInfo._408=0,e.vehicleTypeInfo._301.value=0,e.vehicleTypeInfo._302.value=0,e.vehicleTypeInfo._303.value=0,e.vehicleInfo.count=t.count,e.vehicleInfo.list=t.data,e.formatVehicle())}})},toMapPage:function(e){utility.setSessionStorage("fromInfo",{type:"isSearch",vehicleStatus:e}),setTimeout(function(){$(window.parent.document).find("#nav_Maps").bind("click"),$(window.parent.document).find("#nav_Maps").trigger("click")},200)},getVehicleStatusReport:function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleStatusReport,actionUrl:CONFIG.SERVICE.getVehicleStatusReport,successCallback:function(e){200==e.code&&console.log(e)}})},getVehicleRunReport:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleRunReport,actionUrl:CONFIG.SERVICE.getVehicleRunReport,successCallback:function(t){200==t.code&&(e.totalChartData=t.data,e.setTotalEchart())}})},getVehicleCateReport:function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleCateReport,actionUrl:CONFIG.SERVICE.getVehicleCateReport,successCallback:function(e){200==e.code&&console.log(e)}})}},created:function(){var e=this;utility.isLogin(!1),e.getVehicleList(),e.getCrossAreaList(),e.getVehicleRunReport(),$(window).resize(function(){clearTimeout(e.resizeTime),e.resizeTime=setTimeout(function(){window.location.href=window.location.href},500)})},mounted:function(){var e=this;setTimeout(function(){e.isLoading=!1,e.setVehicleEchart()},5e3)}})})();
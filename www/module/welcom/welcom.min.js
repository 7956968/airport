(function(){var e=utility.getLocalStorage("language"),t=utility.getLocalStorage("userInfo"),i=new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!1,innerHeight:window.innerHeight/6,resizeTime:null,copyRight:{CN:"@copyRight 民贵无动力设备管理系统",EN:"@copyRight Mingui Non-Powered Euipment Management System",TW:"@copyRight 民貴無動力管理系統"}[e.language],vehicleInfo:{list:[],_401:0,_402:0,_403:0,_404:0,_405:0,_406:0,_407:0,_408:0,count:0},isloadDefen:!1,timeDefensTableList:[],defenColumList:[{title:{CN:"车辆",EN:"Vehicle Name",TW:"車輛"}[e.language],key:"vehicleName",fixed:"left",width:110,render:function(e,t){var a=i.timeDefensTableList[t.index].vehicleName,n=i.timeDefensTableList[t.index].vehicleCode;return e("div",a+"["+n+"]")}},{title:{CN:"状态",EN:"State",TW:"狀態"}[e.language],key:"crossTypeName",width:100},{title:{CN:"位置",EN:"Position",TW:"位置"}[e.language],key:"areaName",width:110},{title:{CN:"时间",EN:"Time",TW:"時間"}[e.language],key:"crossTime",fixed:"right",width:140}],msgTableList:[],msgColumList:[{title:{CN:"车辆",EN:"Vehicle Name",TW:"車輛"}[e.language],key:"vehicleName",render:function(e,t){var a=i.timeDefensTableList[t.index].vehicleName,n=i.timeDefensTableList[t.index].vehicleCode;return e("div",a+"["+n+"]")}},{title:{CN:"状态",EN:"State",TW:"狀態"}[e.language],key:"crossTypeName"},{title:{CN:"时间",EN:"Time",TW:"時間"}[e.language],key:"crossTime",width:150}]},methods:{isLogin:function(){t||(alert("请先登录！"),window.parent.window.location.href="/airport/www/login.html")},setTotalEchart:function(){for(var e=echarts.init(document.getElementById("totalEchart")),t=[],i=+new Date,a=[],n=[],o=[],l=0;l<20;l++){var c=new Date(i-=864e5);t.push([c.getFullYear(),c.getMonth()+1,c.getDate()].join("-"));var r=parseInt(1e3*Math.random()),s=parseInt(1e3*Math.random());o.push(s+r),a.push(r),n.push(s)}option={backgroundColor:"#0f375f",tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{top:20,data:["挂车使用频率","拖头使用频率","所有车辆统计"],textStyle:{color:"#ccc"}},xAxis:{data:t,axisLine:{lineStyle:{color:"#ccc"}}},yAxis:{splitLine:{show:!1},axisLine:{lineStyle:{color:"#ccc"}}},series:[{name:"所有车辆统计",type:"line",smooth:!0,showAllSymbol:!0,symbol:"emptyCircle",symbolSize:15,data:o},{name:"挂车使用频率",type:"bar",barWidth:10,itemStyle:{normal:{barBorderRadius:5,color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#14c8d4"},{offset:1,color:"#43eec6"}])}},data:a},{name:"拖头使用频率",type:"bar",barWidth:10,itemStyle:{normal:{barBorderRadius:5,color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(20,200,212,0.5)"},{offset:.2,color:"rgba(20,200,212,0.2)"},{offset:1,color:"rgba(20,200,212,0)"}])}},z:-12,data:n}]},e.setOption(option)},setVehicleEchart:function(){var e=echarts.init(document.getElementById("vehicleEchart"));option={tooltip:{trigger:"item",formatter:"{b}:{c}({d}%)"},legend:{show:!1},series:[{name:"访问来源",type:"pie",selectedMode:"single",radius:[0,"30%"],label:{normal:{position:"inner"}},labelLine:{normal:{show:!1}},data:[{value:335,name:"牵引车",selected:!0},{value:679,name:"拖挂车"},{value:1548,name:"三面卡"}]},{name:"",type:"pie",radius:["40%","55%"],label:{normal:{formatter:"{b|{b}:}{c}{per|{d}%}  ",backgroundColor:"#eee",borderColor:"#aaa",borderWidth:1,borderRadius:4,rich:{a:{color:"#999",lineHeight:22,align:"center"},hr:{borderColor:"#aaa",width:"100%",borderWidth:.5,height:0},b:{fontSize:12,lineHeight:24},per:{color:"#eee",backgroundColor:"#334455",padding:[1,2],borderRadius:2}}}},data:[{value:35,name:"驶入"},{value:10,name:"驶出"},{value:24,name:"静止"},{value:13,name:"防区内行驶"}]}]},e.setOption(option)},setTerminateState:function(){var e=echarts.init(document.getElementById("terminateEchart"));option={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["正在静止","活动","开始进入休眠","运动传感器故障","侧翻","离线","GPS未定位","电压采集失败"],textStyle:{color:"#fff"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},textStyle:{color:"#ffffff"},xAxis:[{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"],nameTextStyle:{color:"#ffffff"}}],yAxis:[{type:"value",nameTextStyle:{color:"#ffffff"}}],series:[{name:"正在静止",type:"bar",data:[200,302,310,340,390,330,320]},{name:"活动",type:"bar",stack:"活动",data:[200,120,100,140,300,200,201]},{name:"开始进入休眠",type:"bar",stack:"开始进入休眠",data:[220,120,110,240,200,300,100]},{name:"运动传感器故障",type:"bar",stack:"运动传感器故障",data:[100,302,210,104,190,300,100]},{name:"侧翻",type:"bar",data:[620,180,640,260,160,160,100]},{name:"离线",type:"bar",barWidth:5,stack:"离线",data:[600,320,710,740,900,300,200]},{name:"GPS未定位",type:"bar",stack:"GPS未定位",data:[200,320,110,140,900,300,200]},{name:"电压采集失败",type:"bar",stack:"电压采集失败",data:[600,720,710,740,100,100,100]}]},e.setOption(option)},getCrossAreaList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getCrossAreaList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{pageNum:1,pageSize:50},beforeSendCallback:function(){e.isloadDefen=!0},completeCallback:function(){e.isloadDefen=!1},successCallback:function(t){200==t.code&&(e.timeDefensTableList=t.data,e.msgTableList=t.data)}})},formatVehicle:function(){for(var e=this,t=0,i=e.vehicleInfo.list.length;t<i;t++)401==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._401=e.vehicleInfo._401+1:402==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._402=e.vehicleInfo._402+1:403==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._403=e.vehicleInfo._403+1:404==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._404=e.vehicleInfo._404+1:405==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._405=e.vehicleInfo._405+1:406==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._406=e.vehicleInfo._406+1:407==e.vehicleInfo.list[t].vehicleStatus?e.vehicleInfo._407=e.vehicleInfo._407+1:408==e.vehicleInfo.list[t].vehicleStatus&&(e.vehicleInfo._408=e.vehicleInfo._408+1)},getVehicleList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{id:"",pageSize:1e4},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code&&(e.vehicleInfo._401=130,e.vehicleInfo._402=640,e.vehicleInfo._403=200,e.vehicleInfo._404=100,e.vehicleInfo._405=120,e.vehicleInfo._406=110,e.vehicleInfo._407=140,e.vehicleInfo._408=190,e.vehicleInfo.count=1530,e.vehicleInfo.list=t.data)}})},toMapPage:function(e){utility.setSessionStorage("fromInfo",{type:"isSearch",vehicleStatus:e}),setTimeout(function(){$(window.parent.document).find("#nav_Maps").bind("click"),$(window.parent.document).find("#nav_Maps").trigger("click")},200)}},created:function(){var e=this;utility.isLogin(!1),e.getCrossAreaList(),e.getVehicleList(),setInterval(function(){e.msgTableList=[],e.timeDefensTableList=[],setTimeout(function(){e.getCrossAreaList(),e.getVehicleList()},500)},15e3),$(window).resize(function(){clearTimeout(e.resizeTime),e.resizeTime=setTimeout(function(){window.location.href=window.location.href},500)})},mounted:function(){var e=this;setTimeout(function(){e.setTotalEchart(),e.setVehicleEchart(),e.setTerminateState()},500)}})})();
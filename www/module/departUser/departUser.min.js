(function(){var e,t=utility.getLocalStorage("language"),i=utility.getLocalStorage("userInfo"),a=utility.getLocalStorage("bizParam"),o=new Vue({el:"#js-vue",data:{language:t?t.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isModalLoading:!0,modalTitle:"",tableHeight:(e=$(".tableContainer").height(),e-100),pageInfo:{id:0,count:0,pageNum:1,pageSize:20,userCode:"",userName:"",posiName:"",companyId:"",deptIds:[]},index:0,selectItem:"",itemInfo:{deptId:"",deptIds:[],userIds:[],posiType:"",posiName:"",createUserId:i.id,modifyUserId:i.id},columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"公司名称",EN:"Company name",TW:"公司名稱"}[t.language],key:"companyName"},{title:{CN:"部门名称",EN:"Department Name",TW:"部門名稱"}[t.language],key:"deptName"},{title:{CN:"姓名",EN:"Name",TW:"姓名"}[t.language],key:"userName"},{title:{CN:"职位名称",EN:"Job Title",TW:"職位名稱"}[t.language],key:"posiName"},{title:{CN:"职位类型",EN:"Job Type",TW:"職位類型"}[t.language],key:"posiType"},{title:{CN:"操作",EN:"Operation",TW:"操作"}[t.language],key:"operation",width:180,render:function(e,i){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.index=i.index,o.selectItem=i.row,o.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[t.language]),e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.index=i.index,o.selectItem=i.row,o.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[t.language]),e("Button",{props:{type:"error",size:"small"},on:{click:function(){o.index=i.index,o.selectItem=i.row,o.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[t.language])])}}],userList:[],companyList:[],tableRowList:[],departUserList:[],superiorDepartmentList:[],deptUserPositionTypeList:a.departmentPositionType},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={deptIds:[],userIds:[],posiType:"",posiName:"",createUserId:i.id,modifyUserId:i.id}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.departUserList[e.index],e.getUserList(function(){e.itemInfo.userIds=[e.itemInfo.userId]}),e.getSuperiorDeprtList("itemInfo"),e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.departUserList[e.index])),e.itemInfo.posiTypeName=function(){for(var t="",i=0,a=e.deptUserPositionTypeList.length;i<a;i++)if(e.itemInfo.posiType==e.deptUserPositionTypeList[i].type){t=e.deptUserPositionTypeList[i].name;break}return t}(),e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.departUserList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptUserService+"?action="+CONFIG.ACTION.delDeptUser+"&ids="+e.itemInfo.userId+"&modifyUserId="+i.id,actionUrl:CONFIG.SERVICE.deptUserService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code?e.getDepartUserDataList(!0):e.$Message.error(t.message)}})})}})},setCurrentRowData:function(e,t){var i=this;e&&(i.index=t,i.selectItem=e)},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptUserService+"?action="+CONFIG.ACTION.saveDeptUser,actionUrl:CONFIG.SERVICE.deptUserService,dataObj:{id:e.itemInfo.id,createUserId:i.id,modifyUserId:i.id,posiType:e.itemInfo.posiType,userIds:e.itemInfo.userIds.join(","),posiName:encodeURI(e.itemInfo.posiName),deptId:e.itemInfo.deptIds[e.itemInfo.deptIds.length-1]},completeCallback:function(){e.isModalLoading=!1},successCallback:function(t){200==t.code?(e.getDepartUserDataList(!0),e.isShowModal=!1):e.$Message.error(t.message)}})},pageSizeChange:function(e){var t=this;t.pageInfo.pageNum=parseInt(e,10),setTimeout(function(){t.getDepartUserDataList(!1)},200)},pageRowChange:function(e){var t=this;t.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getDepartUserDataList(!1)},200)},formatTableList:function(){for(var e=this,t=0,i=e.departUserList.length;t<i;t++)e.tableRowList.push({deptName:decodeURI(e.departUserList[t].deptName),companyName:decodeURI(e.departUserList[t].companyName),userName:decodeURI(e.departUserList[t].userName),posiName:decodeURI(e.departUserList[t].posiName),posiType:function(){for(var i="",a=0,o=e.deptUserPositionTypeList.length;a<o;a++)if(e.deptUserPositionTypeList[a].type==e.departUserList[t].posiType){i=e.deptUserPositionTypeList[a].name;break}return i}()})},getDepartUserDataList:function(e){var t=this;t.tableRowList=[],1==e&&(t.pageInfo.pageNum=1),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptUserService+"?action="+CONFIG.ACTION.getDeptUserList,actionUrl:CONFIG.SERVICE.deptUserService,dataObj:{pageNum:t.pageInfo.pageNum,pageSize:t.pageInfo.pageSize,userCode:t.pageInfo.userCode,userName:t.pageInfo.userName,posiName:t.pageInfo.posiName,companyId:t.pageInfo.companyId,deptId:t.pageInfo.deptIds[t.pageInfo.deptIds.length-1]||0},beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.departUserList=e.data,t.pageInfo.count=e.count,t.formatTableList())}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(t){200==t.code&&(e.companyList=t.data)}})},getSuper:function(e,t,i){for(var a=this,o=0,s=e.length;o<s;o++)if(e[o].value==t){if(i.push(t),0==e[o].paraDeptId)return;a.getSuper(a.superiorDepartmentList,e[o].paraDeptId,i)}else a.getSuper(e[o].children,t,i)},formatSuperiorDeprt:function(e){var t=this,i=JSON.stringify(e).replace(/id/g,"value").replace(/deptName/g,"label").replace(/subDeptList/g,"children");t.superiorDepartmentList=JSON.parse(i)},getSuperiorDeprtList:function(e){var t=this;t.superiorDepartmentList=[],utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptTreeList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:0,pageSize:1e4,companyId:t[e].companyId||0},beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(i){if(200==i.code){var a=[];t[e].deptIds=[],t.formatSuperiorDeprt(i.data),t.getSuper(t.superiorDepartmentList,t[e].deptId,a),t[e].deptIds=a.reverse()}}})},getUserList:function(e){var t=this;t.userList=[],utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.getUserList,actionUrl:CONFIG.SERVICE.userService,dataObj:{id:0,pageSize:1e4,companyId:t.itemInfo.companyId},beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(i){200==i.code&&(t.userList=i.data,e&&e())}})},getDepartAndUser:function(){var e=this;e.itemInfo.userIds=[],e.getUserList(),e.getSuperiorDeprtList("itemInfo")}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getDepartUserDataList(!0),e.getCompanyList(),e.getSuperiorDeprtList("pageInfo")},500)}})})();
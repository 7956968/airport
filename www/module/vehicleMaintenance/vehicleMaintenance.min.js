(function(){var e=utility.getLocalStorage("language"),i=utility.getLocalStorage("userInfo"),a=utility.getLocalStorage("bizParam"),t=new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isModalLoading:!0,modalTitle:"",tableHeight:function(){var e=$(".tableContainer").height();return e-100}(),vehicleColorList:a.vehicleColor,vehicleTypeList:a.vehicleType,vehicleBrandList:a.vehicleBrand,vehicleRepairTypeList:a.vehicleRepairType,index:0,selectItem:null,itemInfo:{id:"",vehicleId:"",companyId:"",companyName:"",vehicleName:"",vehicleCode:"",remark:"",vehicleColorId:"",vehicleTypeId:"",vehicleBrandId:"",deptId:"",deptName:"",lastMaintainUserId:"",lastMaintainUserName:"",lastMaintainDeptId:"",lastMaintainDeptName:"",currMaintainTime:"",currMiles:"",nextMaintainMiles:"",maintainRemark:"",repairItemIds:[]},pageInfo:{id:"",count:0,pageNum:1,pageSize:20,deptId:"",vehicleId:"",vehicleName:"",vehicleCode:"",vehicleColorId:"",vehicleTypeId:"",vehicleBrandId:"",vehicleTypeId:"",beginRepairTime:"",endRepairTime:"",beginMiles:"",endMiles:""},columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"车辆编号",EN:"Vehicle Number",TW:"車輛编号"}[e.language],key:"vehicleCode"},{title:{CN:"车辆类型",EN:"Vehicle Type",TW:"車輛類型"}[e.language],key:"vehicleTypeName"},{title:{CN:"车辆颜色",EN:"Vehicle Color",TW:"車輛颜色"}[e.language],key:"vehicleColorName"},{title:{CN:"车辆品牌",EN:"Vehicle Brand",TW:"車輛品牌"}[e.language],key:"vehicleBrandName"},{title:{CN:"本次保养日期",EN:"This Maintenance Date",TW:"本次保養日期"}[e.language],key:"currMaintainTime"},{title:{CN:"保养项目",EN:"Maintenance Projects",TW:"保養項目"}[e.language],key:"maintainRemark"},{title:{CN:"保养单位",EN:"Maintenance Company",TW:"保養單位"}[e.language],key:"lastMaintainDeptName"},{title:{CN:"保养责任人",EN:"Maintenance Responsible Person",TW:"保養責任人"}[e.language],key:"lastMaintainUserName"},{title:{CN:"当前里程数",EN:"Current Mileage",TW:"當前里程數"}[e.language],key:"currMiles"},{title:{CN:"下次保养里程",EN:"Number Of Miles Next Maintained",TW:"下次保養里程"}[e.language],key:"nextMaintainMiles"},{title:{CN:"操作",EN:"Operation",TW:"操作"}[e.language],key:"operation",width:180,render:function(i,a){return i("div",[i("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.index=a.index,t.selectItem=a.row,t.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[e.language]),i("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.index=a.index,t.selectItem=a.row,t.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[e.language]),i("Button",{props:{type:"error",size:"small"},on:{click:function(){t.index=a.index,t.selectItem=a.row,t.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[e.language])])}}],dataList:[{id:1,number:"车辆编号",thisDate:"本次保养日期",project:"保养项目",type:"车辆类型",ownerCompnay:"归属公司",maintCompnnay:"保养单位",currentMile:"当前里程数",lastDate:"上次保养日期",lastMile:"上次保养里程数",person:"保养责任人",nextMile:"下次保养里程数"}],maintenanceList:[],vehicleList:[],departmentList:[],userList:[]},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",vehicleId:"",companyId:"",companyName:"",vehicleName:"",vehicleCode:"",remark:"",vehicleColorId:"",vehicleTypeId:"",vehicleBrandId:"",deptId:"",deptName:"",lastMaintainUserId:"",lastMaintainUserName:"",lastMaintainDeptId:"",lastMaintainDeptName:"",currMaintainTime:"",currMiles:"",nextMaintainMiles:"",maintainRemark:""}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.maintenanceList[e.index])),e.itemInfo.repairItemIds=function(){for(var i=[],a=e.itemInfo.repairItemIds.split(","),t=0,n=a.length;t<n;t++)i.push(parseInt(a[t]));return i}(),e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.maintenanceList[e.index])),e.itemInfo.currMaintainTimeName=e.itemInfo.currMaintainTime.split("T")[0],e.itemInfo.repairItemIdName=function(){for(var i=[],a=e.maintenanceList[e.index].repairItemIds.split(","),t=0,n=a.length;t<n;t++)for(var l=0,c=e.vehicleRepairTypeList.length;l<c;l++)parseInt(a[t])==e.vehicleRepairTypeList[l].type&&i.push(e.vehicleRepairTypeList[l].name);return i.join(",")}(),e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.maintenanceList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleRepairService+"?action="+CONFIG.ACTION.delVehicleRepairInfo+"&ids="+e.itemInfo.id+"&modifyUserId="+i.id,actionUrl:CONFIG.SERVICE.vehicleRepairService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(i){200==i.code?e.getmaintenanceList(!0):e.$Message.error(i.message)}})})}})},beginRepairTime:function(e,i){var a=this;a.pageInfo.beginRepairTime=e},endRepairTime:function(e,i){var a=this;a.pageInfo.endRepairTime=e},currMaintainTime:function(e,i){var a=this;a.itemInfo.currMaintainTime=e},pageSizeChange:function(e){var i=this;i.pageInfo.pageNum=parseInt(e,10),setTimeout(function(){i.getmaintenanceList(!1)},200)},pageRowChange:function(e){var i=this;i.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getmaintenanceList(!1)},200)},setCurrentRowData:function(e,i){var a=this;a.index=i,a.selectItem=e},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleRepairService+"?action="+CONFIG.ACTION.saveVehicleRepairInfo,actionUrl:CONFIG.SERVICE.vehicleRepairService,dataObj:{id:e.itemInfo.id,vehicleId:e.itemInfo.vehicleId,lastMaintainUserId:e.itemInfo.lastMaintainUserId,lastMaintainUserName:function(){var i=encodeURI(e.itemInfo.lastMaintainUserName);if(""!=e.itemInfo.lastMaintainUserId)for(var a=0,t=e.userList.length;a<t;a++)e.itemInfo.lastMaintainUserId==e.userList[a].id&&(i=encodeURI(e.userList[a].userName));return i}(),lastMaintainDeptId:e.itemInfo.lastMaintainDeptId,lastMaintainDeptName:function(){var i=encodeURI(e.itemInfo.lastMaintainDeptName);if(""!=e.itemInfo.lastMaintainDeptId)for(var a=0,t=e.departmentList.length;a<t;a++)e.itemInfo.lastMaintainDeptId==e.departmentList[a].id&&(i=encodeURI(e.departmentList[a].deptName));return i}(),currMaintainTime:e.itemInfo.currMaintainTime,currMiles:e.itemInfo.currMiles,nextMaintainMiles:e.itemInfo.nextMaintainMiles,maintainRemark:encodeURI(e.itemInfo.maintainRemark),repairItemIds:e.itemInfo.repairItemIds.join(","),createUserId:i.id,modifyUserId:i.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(i){200==i.code?(e.getmaintenanceList(!0),e.isShowModal=!1):e.$Message.error(i.message)}})},formatMaintenanceData:function(){for(var e=this,i=0,a=e.maintenanceList.length;i<a;i++)e.dataList.push({id:e.maintenanceList[i].id,vehicleId:e.maintenanceList[i].vehicleId,companyId:e.maintenanceList[i].companyId,companyName:decodeURI(e.maintenanceList[i].companyName),vehicleName:decodeURI(e.maintenanceList[i].vehicleName),vehicleCode:decodeURI(e.maintenanceList[i].vehicleCode),maintainRemark:function(){for(var a=[],t=e.maintenanceList[i].repairItemIds.split(","),n=0,l=t.length;n<l;n++)for(var c=0,r=e.vehicleRepairTypeList.length;c<r;c++)parseInt(t[n])==e.vehicleRepairTypeList[c].type&&a.push(e.vehicleRepairTypeList[c].name);return a.join(",")}(),vehicleColorId:e.maintenanceList[i].vehicleColorId,vehicleColorName:e.maintenanceList[i].vehicleColorName,vehicleTypeId:e.maintenanceList[i].vehicleTypeId,vehicleTypeName:e.maintenanceList[i].vehicleTypeName,vehicleBrandId:e.maintenanceList[i].vehicleBrandId,vehicleBrandName:e.maintenanceList[i].vehicleBrandName,deptId:e.maintenanceList[i].deptId,deptName:decodeURI(e.maintenanceList[i].deptName),lastMaintainUserId:e.maintenanceList[i].lastMaintainUserId,lastMaintainUserName:decodeURI(e.maintenanceList[i].lastMaintainUserName),lastMaintainDeptId:e.maintenanceList[i].lastMaintainDeptId,lastMaintainDeptName:decodeURI(e.maintenanceList[i].lastMaintainDeptName),currMaintainTime:e.maintenanceList[i].currMaintainTime,currMiles:e.maintenanceList[i].currMiles,nextMaintainMiles:e.maintenanceList[i].nextMaintainMiles})},getmaintenanceList:function(e){var i=this;i.dataList=[],1==e&&(i.pageInfo.pageNum=1),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleRepairService+"?action="+CONFIG.ACTION.getVehicleRepairList,actionUrl:CONFIG.SERVICE.vehicleRepairService,dataObj:i.pageInfo,beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.maintenanceList=e.data,i.pageInfo.count=e.count,i.formatMaintenanceData())}})},getVehicleList:function(e){var i=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{id:0,pageSize:1e4},beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.vehicleList=e.data)}})},getDepartmentList:function(e){var i=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:0,pageSize:1e4},beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.departmentList=e.data)}})},getUserList:function(e){var i=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.getUserList,actionUrl:CONFIG.SERVICE.userService,dataObj:{id:0,pageSize:1e4},beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.userList=e.data)}})}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getmaintenanceList(!0),e.getVehicleList(),e.getDepartmentList(),e.getUserList()},500)}})})();
(function(){var e,i=utility.getLocalStorage("language"),a=utility.getLocalStorage("userInfo"),t=utility.getLocalStorage("bizParam"),n=new Vue({el:"#js-vue",data:{language:i?i.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isModalLoading:!0,modalTitle:"",tableHeight:(e=$(".tableContainer").height(),e-100),vehicleColorList:t.vehicleColor,vehicleTypeList:t.vehicleType,vehicleBrandList:t.vehicleBrand,vehicleRepairTypeList:t.vehicleRepairType,index:0,selectItem:null,itemInfo:{id:"",vehicleId:"",companyId:"",companyName:"",vehicleName:"",vehicleCode:"",remark:"",vehicleColorId:"",vehicleTypeId:"",vehicleBrandId:"",deptId:"",deptName:"",lastMaintainUserId:"",lastMaintainUserName:"",lastMaintainDeptId:"",lastMaintainDeptName:"",currMaintainTime:"",currMiles:"",nextMaintainMiles:"",maintainRemark:"",repairItemIds:[]},pageInfo:{id:"",count:0,deptId:"",vehicleId:"",vehicleName:"",vehicleCode:"",vehicleColorId:"",vehicleTypeId:"",vehicleBrandId:"",vehicleTypeId:"",beginRepairTime:"",endRepairTime:"",beginMiles:"",endMiles:""},page:{pageNum:1,pageSize:20},columnsList:[{type:"index",width:60,align:"center",title:"序号"},{title:{CN:"车辆编号",EN:"Vehicle Number",TW:"車輛编号"}[i.language],key:"vehicleCode"},{title:{CN:"车辆类型",EN:"Vehicle Type",TW:"車輛類型"}[i.language],key:"vehicleTypeName"},{title:{CN:"本次保养日期",EN:"This Maintenance Date",TW:"本次保養日期"}[i.language],key:"currMaintainTime",align:"center"},{title:{CN:"保养项目",EN:"Maintenance Projects",TW:"保養項目"}[i.language],key:"maintainRemark"},{title:{CN:"保养单位",EN:"Maintenance Company",TW:"保養單位"}[i.language],key:"lastMaintainDeptName"},{title:{CN:"当前里程数(公里)",EN:"Current Mileage",TW:"當前里程數"}[i.language],key:"currMiles",align:"center"},{title:{CN:"下次保养里程(公里)",EN:"Number Of Miles Next Maintained",TW:"下次保養里程"}[i.language],key:"nextMaintainMiles",align:"center"},{title:{CN:"操作",EN:"Operation",TW:"操作"}[i.language],key:"operation",width:180,align:"center",render:function(e,a){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.index=a.index,n.selectItem=a.row,n.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[i.language]),e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.index=a.index,n.selectItem=a.row,n.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[i.language]),e("Button",{props:{type:"error",size:"small"},on:{click:function(){n.index=a.index,n.selectItem=a.row,n.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[i.language])])}}],dataList:[],maintenanceList:[],vehicleList:[],departmentList:[],userList:[]},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",vehicleId:"",companyId:"",companyName:"",vehicleName:"",vehicleCode:"",remark:"",vehicleColorId:"",vehicleTypeId:"",vehicleBrandId:"",deptId:"",deptName:"",lastMaintainUserId:"",lastMaintainUserName:"",lastMaintainDeptId:"",lastMaintainDeptName:"",currMaintainTime:"",currMiles:"",nextMaintainMiles:"",maintainRemark:""}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.maintenanceList[e.index])),e.itemInfo.repairItemIds=function(){for(var i=[],a=e.itemInfo.repairItemIds.split(","),t=0,n=a.length;t<n;t++)i.push(parseInt(a[t]));return i}(),e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.maintenanceList[e.index])),e.itemInfo.currMaintainTimeName=e.itemInfo.currMaintainTime.split("T")[0],e.itemInfo.repairItemIdName=function(){for(var i=[],a=e.maintenanceList[e.index].repairItemIds.split(","),t=0,n=a.length;t<n;t++)for(var c=0,l=e.vehicleRepairTypeList.length;c<l;c++)parseInt(a[t])==e.vehicleRepairTypeList[c].type&&i.push(e.vehicleRepairTypeList[c].name);return i.join(",")}(),e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.maintenanceList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleRepairService+"?action="+CONFIG.ACTION.delVehicleRepairInfo+"&ids="+e.itemInfo.id+"&modifyUserId="+a.id,actionUrl:CONFIG.SERVICE.vehicleRepairService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(i){200==i.code?e.getmaintenanceList(!0):e.$Message.error(i.message)}})})}})},beginRepairTime:function(e,i){var a=this;a.pageInfo.beginRepairTime=e},endRepairTime:function(e,i){var a=this;a.pageInfo.endRepairTime=e},currMaintainTime:function(e,i){var a=this;a.itemInfo.currMaintainTime=e},pageSizeChange:function(e){var i=this;i.page.pageNum=parseInt(e,10),setTimeout(function(){i.getmaintenanceList(!1)},200)},pageRowChange:function(e){var i=this;i.page.pageSize=parseInt(e,10),setTimeout(function(){i.getmaintenanceList(!0)},200)},setCurrentRowData:function(e,i){var a=this;a.index=i,a.selectItem=e},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleRepairService+"?action="+CONFIG.ACTION.saveVehicleRepairInfo,actionUrl:CONFIG.SERVICE.vehicleRepairService,dataObj:{id:e.itemInfo.id,vehicleId:e.itemInfo.vehicleId,lastMaintainUserId:e.itemInfo.lastMaintainUserId,lastMaintainUserName:function(){var i=encodeURI(e.itemInfo.lastMaintainUserName);if(""!=e.itemInfo.lastMaintainUserId)for(var a=0,t=e.userList.length;a<t;a++)e.itemInfo.lastMaintainUserId==e.userList[a].id&&(i=encodeURI(e.userList[a].userName));return i}(),lastMaintainDeptId:e.itemInfo.lastMaintainDeptId,lastMaintainDeptName:function(){var i=encodeURI(e.itemInfo.lastMaintainDeptName);if(""!=e.itemInfo.lastMaintainDeptId)for(var a=0,t=e.departmentList.length;a<t;a++)e.itemInfo.lastMaintainDeptId==e.departmentList[a].id&&(i=encodeURI(e.departmentList[a].deptName));return i}(),currMaintainTime:e.itemInfo.currMaintainTime,currMiles:e.itemInfo.currMiles,nextMaintainMiles:e.itemInfo.nextMaintainMiles,maintainRemark:encodeURI(e.itemInfo.maintainRemark),repairItemIds:e.itemInfo.repairItemIds.join(","),createUserId:a.id,modifyUserId:a.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(i){200==i.code?(e.getmaintenanceList(!0),e.isShowModal=!1):e.$Message.error(i.message)}})},formatMaintenanceData:function(){for(var e=this,i=0,a=e.maintenanceList.length;i<a;i++)e.dataList.push({id:e.maintenanceList[i].id,vehicleId:e.maintenanceList[i].vehicleId,companyId:e.maintenanceList[i].companyId,companyName:decodeURI(e.maintenanceList[i].companyName),vehicleName:decodeURI(e.maintenanceList[i].vehicleName),vehicleCode:decodeURI(e.maintenanceList[i].vehicleCode),maintainRemark:function(){for(var a=[],t=e.maintenanceList[i].repairItemIds.split(","),n=0,c=t.length;n<c;n++)for(var l=0,r=e.vehicleRepairTypeList.length;l<r;l++)parseInt(t[n])==e.vehicleRepairTypeList[l].type&&a.push(e.vehicleRepairTypeList[l].name);return a.join(",")}(),vehicleColorId:e.maintenanceList[i].vehicleColorId,vehicleColorName:e.maintenanceList[i].vehicleColorName,vehicleTypeId:e.maintenanceList[i].vehicleTypeId,vehicleTypeName:e.maintenanceList[i].vehicleTypeName,vehicleBrandId:e.maintenanceList[i].vehicleBrandId,vehicleBrandName:e.maintenanceList[i].vehicleBrandName,deptId:e.maintenanceList[i].deptId,deptName:decodeURI(e.maintenanceList[i].deptName),lastMaintainUserId:e.maintenanceList[i].lastMaintainUserId,lastMaintainUserName:decodeURI(e.maintenanceList[i].lastMaintainUserName),lastMaintainDeptId:e.maintenanceList[i].lastMaintainDeptId,lastMaintainDeptName:decodeURI(e.maintenanceList[i].lastMaintainDeptName),currMaintainTime:e.maintenanceList[i].currMaintainTime,currMiles:e.maintenanceList[i].currMiles,nextMaintainMiles:e.maintenanceList[i].nextMaintainMiles})},getmaintenanceList:function(e){var i=this;i.dataList=[],i.maintenanceList=[],1==e&&(i.page.pageNum=1,i.page.count=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleRepairService+"?action="+CONFIG.ACTION.getVehicleRepairList,actionUrl:CONFIG.SERVICE.vehicleRepairService,dataObj:{pageNum:i.page.pageNum,pageSize:i.page.pageSize,vehicleId:i.pageInfo.vehicleId,vehicleName:encodeURI(i.pageInfo.vehicleName),vehicleCode:encodeURI(i.pageInfo.vehicleCode),vehicleColorId:i.pageInfo.vehicleColorId,vehicleTypeId:i.pageInfo.vehicleTypeId,vehicleBrandId:i.pageInfo.vehicleBrandId,vehicleTypeId:i.pageInfo.vehicleTypeId,beginRepairTime:i.pageInfo.beginRepairTime,endRepairTime:i.pageInfo.endRepairTime,beginMiles:i.pageInfo.beginMiles,endMiles:i.pageInfo.endMiles},beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.maintenanceList=e.data,i.page.count=e.count,i.formatMaintenanceData())}})},getVehicleList:function(e){var i=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{id:0,pageSize:1e4},beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.vehicleList=e.data)}})},getDepartmentList:function(e){var i=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:0,pageSize:1e4},beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.departmentList=e.data)}})},getUserList:function(e){var i=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.getUserList,actionUrl:CONFIG.SERVICE.userService,dataObj:{id:0,pageSize:1e4},beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.userList=e.data)}})}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getmaintenanceList(!0),e.getVehicleList(),e.getDepartmentList(),e.getUserList(),e.$watch("pageInfo",function(){e.getmaintenanceList(!0)},{deep:!0})},500)}})})();
(function(){var e,t=utility.getLocalStorage("language"),a=utility.getLocalStorage("userInfo"),i=utility.getLocalStorage("bizParam"),n=new Vue({el:"#js-vue",data:{language:t?t.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isModalLoading:!0,modalTitle:"",tableHeight:(e=$(".tableContainer").height(),e-100),pageInfo:{id:0,count:0,pageNum:1,pageSize:20,deptName:"",companyId:"",paraDeptId:[]},index:0,selectItem:null,itemInfo:{id:"",deptName:"",companyId:"",paraDeptId:[],paraDeptName:"",deptLevel:"",orderNum:"",leaderUserId:"",leaderUserName:"",deptShortName:"",deptTypeId:"",deptTypeName:"",deptTel:"",deptEmail:"",deptFax:"",deptRemark:"",createUserId:a.id,modifyUserId:a.id},columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"公司名称",EN:"Company name",TW:"公司名稱"}[t.language],key:"companyName"},{title:{CN:"部门名称",EN:"Department Name",TW:"部門名稱"}[t.language],key:"deptName"},{title:{CN:"部门编号",EN:"Department Number",TW:"部門編號"}[t.language],key:"deptCode"},{title:{CN:"部门简称",EN:"Department Abbreviation",TW:"部門簡稱"}[t.language],key:"deptShortName",width:120},{title:{CN:"部门性质",EN:"Department Nature",TW:"部門性質"}[t.language],key:"deptTypeName"},{title:{CN:"负责人",EN:"Head",TW:"負責人"}[t.language],key:"leaderUserName"},{title:{CN:"电话",EN:"Telephone",TW:"電話"}[t.language],key:"deptTel"},{title:{CN:"备注",EN:"Remarks",TW:"備註"}[t.language],key:"deptRemark"},{title:{CN:"操作",EN:"Operation",TW:"操作"}[t.language],key:"operation",width:180,render:function(e,a){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.index=a.index,n.selectItem=a.row,n.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[t.language]),e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.index=a.index,n.selectItem=a.row,n.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[t.language]),e("Button",{props:{type:"error",size:"small"},on:{click:function(){n.index=a.index,n.selectItem=a.row,n.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[t.language])])}}],tableRowList:[],departmentTypeList:i.departmentType,departmentList:[],superiorDepartmentList:[],userList:[],companyList:[]},watch:{},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",deptName:"",companyId:"",paraDeptId:[],paraDeptName:"",deptLevel:"",orderNum:"",leaderUserId:"",leaderUserName:"",deptShortName:"",deptTypeId:"",deptTypeName:"",deptTel:"",deptEmail:"",deptFax:"",deptRemark:"",createUserId:a.id,modifyUserId:a.id}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.departmentList[e.index],e.itemInfo.paraDeptId=[],e.itemInfo.deptName=decodeURI(e.itemInfo.deptName),e.itemInfo.deptShortName=decodeURI(e.itemInfo.deptShortName),e.itemInfo.leaderUserName=decodeURI(e.itemInfo.leaderUserName),e.itemInfo.paraDeptName=decodeURI(e.itemInfo.paraDeptName),e.itemInfo.deptShortName=decodeURI(e.itemInfo.deptShortName),e.itemInfo.deptRemark=decodeURI(e.itemInfo.deptRemark),e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language],e.getSuperiorDepartmentList()})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.departmentList[e.index],e.itemInfo.paraDeptId=decodeURI(e.itemInfo.paraDeptName),e.itemInfo.deptName=decodeURI(e.itemInfo.deptName),e.itemInfo.deptShortName=decodeURI(e.itemInfo.deptShortName),e.itemInfo.leaderUserName=decodeURI(e.itemInfo.leaderUserName),e.itemInfo.paraDeptName=decodeURI(e.itemInfo.paraDeptName),e.itemInfo.deptShortName=decodeURI(e.itemInfo.deptShortName),e.itemInfo.deptRemark=decodeURI(e.itemInfo.deptRemark),e.itemInfo.deptTypeName=function(){for(var t="",a=0,i=e.departmentTypeList.length;a<i;a++)if(e.departmentTypeList[a].type==e.itemInfo.deptTypeId){t=e.departmentTypeList[a].name;break}return t}(),e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.departmentList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.delDept+"&ids="+e.itemInfo.id+"&modifyUserId="+a.id,actionUrl:CONFIG.SERVICE.deptService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code?e.getDepartmentDataList(!0):e.$Message.error(t.message)}})})}})},setCurrentRowData:function(e,t){var a=this;e&&(a.index=t,a.selectItem=e)},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.saveDept,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:e.itemInfo.id,deptName:encodeURI(e.itemInfo.deptName),companyId:e.itemInfo.companyId,paraDeptId:e.itemInfo.paraDeptId[e.itemInfo.paraDeptId.length-1],paraDeptName:encodeURI(e.itemInfo.paraDeptName),deptLevel:e.itemInfo.deptLevel,orderNum:e.itemInfo.orderNum,leaderUserId:e.itemInfo.leaderUserId,leaderUserName:encodeURI(e.itemInfo.leaderUserName),deptShortName:encodeURI(e.itemInfo.deptShortName),deptTypeId:e.itemInfo.deptTypeId,deptTypeName:encodeURI(e.itemInfo.deptTypeName),deptTel:e.itemInfo.deptTel,deptEmail:e.itemInfo.deptEmail,deptFax:e.itemInfo.deptFax,deptRemark:encodeURI(e.itemInfo.deptRemark),createUserId:a.id,modifyUserId:a.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(t){200==t.code?(e.getDepartmentDataList(!0),e.isShowModal=!1):e.$Message.error(t.message)}})},pageSizeChange:function(e){var t=this;t.pageInfo.pageNum=parseInt(e,10),setTimeout(function(){t.getDepartmentDataList(!1)},200)},pageRowChange:function(e){var t=this;t.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getDepartmentDataList(!1)},200)},userChange:function(){for(var e=this,t=0,a=e.userList.length;t<a;t++)if(e.userList[t].id==e.itemInfo.leaderUserId){e.itemInfo.leaderUserName=e.userList[t].modifyUserName;break}},formatTableList:function(){for(var e=this,t=0,a=e.departmentList.length;t<a;t++)e.tableRowList.push({companyName:decodeURI(e.departmentList[t].companyName),deptName:decodeURI(e.departmentList[t].deptName),deptCode:e.departmentList[t].deptCode,deptShortName:decodeURI(e.departmentList[t].deptShortName),deptTypeName:decodeURI(e.departmentList[t].deptTypeName),leaderUserName:decodeURI(e.departmentList[t].leaderUserName),deptTel:e.departmentList[t].deptTel,extension:e.departmentList[t].extension,deptRemark:decodeURI(e.departmentList[t].deptRemark)})},getDepartmentDataList:function(e){var t=this;1==e&&(t.tableRowList=[],t.pageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptList,actionUrl:CONFIG.SERVICE.deptService,dataObj:t.pageInfo,beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.departmentList=e.data,t.pageInfo.count=e.count,t.formatTableList())}})},getSuper:function(e,t,a){for(var i=this,n=0,o=e.length;n<o;n++)if(e[n].value==t){if(a.push(t),0==e[n].paraDeptId)return;i.getSuper(i.superiorDepartmentList,e[n].paraDeptId,a)}else i.getSuper(e[n].children,t,a)},formatSuperiorDeprt:function(e){var t=this,a=JSON.stringify(e).replace(/id/g,"value").replace(/deptName/g,"label").replace(/subDeptList/g,"children");t.superiorDepartmentList=JSON.parse(a)},getSuperiorDepartmentList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptTreeList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{pageNum:1,pageSize:1e4,companyId:e.itemInfo.companyId},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){var a=[];200==t.code&&(e.superiorDepartmentList=[],e.itemInfo.paraDeptId=[],e.formatSuperiorDeprt(t.data),e.getSuper(e.superiorDepartmentList,e.itemInfo.id,a),e.itemInfo.paraDeptId=a.reverse())}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(t){200==t.code&&(e.companyList=t.data)}})},getUserDataList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.getUserList,actionUrl:CONFIG.SERVICE.userService,dataObj:{companyId:e.itemInfo.paraCompanyId,pageNum:1,pageSize:1e3},successCallback:function(t){200==t.code&&(e.userList=t.data)}})}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getDepartmentDataList(!1),e.getCompanyList()},500)}})})();
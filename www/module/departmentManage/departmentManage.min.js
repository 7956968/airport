(function(){var e=utility.getLocalStorage("language"),t=utility.getLocalStorage("userInfo"),a=utility.getLocalStorage("bizParam");new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!0,isShowModal:!1,isModalLoading:!0,modalTitle:"",tableHeight:function(){var e=$(".tableContainer").height();return e-100}(),pageInfo:{id:0,count:0,pageNum:1,pageSize:15,deptName:"",companyId:"",paraDeptId:""},index:0,selectItem:null,itemInfo:{id:"",deptName:"",companyId:"",paraDeptId:"",paraDeptName:"",deptLevel:"",orderNum:"",leaderUserId:"",leaderUserName:"",deptShortName:"",deptTypeId:"",deptTypeName:"",deptTel:"",deptEmail:"",deptFax:"",deptRemark:"",createUserId:t.id,modifyUserId:t.id},columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"部门名称",EN:"Department Name",TW:"部門名稱"}[e.language],key:"deptName"},{title:{CN:"部门编号",EN:"Department Number",TW:"部門編號"}[e.language],key:"deptCode"},{title:{CN:"部门简称",EN:"Department Abbreviation",TW:"部門簡稱"}[e.language],key:"deptShortName",width:120},{title:{CN:"部门性质",EN:"Department Nature",TW:"部門性質"}[e.language],key:"deptTypeName"},{title:{CN:"负责人",EN:"Head",TW:"負責人"}[e.language],key:"leaderUserName"},{title:{CN:"电话",EN:"Telephone",TW:"電話"}[e.language],key:"deptTel"},{title:{CN:"备注",EN:"Remarks",TW:"備註"}[e.language],key:"deptRemark"}],tableRowList:[],departmentTypeList:a.departmentType,departmentList:[],userList:[],companyList:[]},watch:{},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",deptName:"",companyId:"",paraDeptId:"",paraDeptName:"",deptLevel:"",orderNum:"",leaderUserId:"",leaderUserName:"",deptShortName:"",deptTypeId:"",deptTypeName:"",deptTel:"",deptEmail:"",deptFax:"",deptRemark:"",createUserId:t.id,modifyUserId:t.id}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.departmentList[e.index],e.itemInfo.deptName=decodeURI(e.itemInfo.deptName),e.itemInfo.deptShortName=decodeURI(e.itemInfo.deptShortName),e.itemInfo.leaderUserName=decodeURI(e.itemInfo.leaderUserName),e.itemInfo.paraDeptName=decodeURI(e.itemInfo.paraDeptName),e.itemInfo.deptShortName=decodeURI(e.itemInfo.deptShortName),e.itemInfo.deptRemark=decodeURI(e.itemInfo.deptRemark),e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},delItem:function(){var e=this;e.itemInfo=e.departmentList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.delDept+"&ids="+e.itemInfo.id+"&modifyUserId="+t.id,actionUrl:CONFIG.SERVICE.deptService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code?e.getDepartmentDataList(!0):e.$Message.error(t.message)}})})},setCurrentRowData:function(e,t){var a=this;e&&(a.index=t,a.selectItem=e)},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.saveDept,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:e.itemInfo.id,deptName:encodeURI(e.itemInfo.deptName),companyId:e.itemInfo.companyId,paraDeptId:e.itemInfo.paraDeptId,paraDeptName:encodeURI(e.itemInfo.paraDeptName),deptLevel:e.itemInfo.deptLevel,orderNum:e.itemInfo.orderNum,leaderUserId:e.itemInfo.leaderUserId,leaderUserName:encodeURI(e.itemInfo.leaderUserName),deptShortName:encodeURI(e.itemInfo.deptShortName),deptTypeId:e.itemInfo.deptTypeId,deptTypeName:encodeURI(e.itemInfo.deptTypeName),deptTel:e.itemInfo.deptTel,deptEmail:e.itemInfo.deptEmail,deptFax:e.itemInfo.deptFax,deptRemark:encodeURI(e.itemInfo.deptRemark),createUserId:t.id,modifyUserId:t.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(t){200==t.code?(e.getDepartmentDataList(!0),e.isShowModal=!1):e.$Message.error(t.message)}})},pageSizeChange:function(e){var t=this;t.pageInfo.pageNum=parseInt(e,10)-1,setTimeout(function(){t.getDepartmentDataList(!1)},200)},pageRowChange:function(e){var t=this;console.log(e),t.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getDepartmentDataList(!1)},200)},userChange:function(){for(var e=this,t=0,a=e.userList.length;t<a;t++)if(e.userList[t].id==e.itemInfo.leaderUserId){e.itemInfo.leaderUserName=e.userList[t].modifyUserName;break}},formatTableList:function(){for(var e=this,t=0,a=e.departmentList.length;t<a;t++)e.tableRowList.push({deptName:decodeURI(e.departmentList[t].deptName),deptCode:e.departmentList[t].deptCode,deptShortName:decodeURI(e.departmentList[t].deptShortName),deptTypeName:decodeURI(e.departmentList[t].deptTypeName),leaderUserName:decodeURI(e.departmentList[t].leaderUserName),deptTel:e.departmentList[t].deptTel,extension:e.departmentList[t].extension,deptRemark:decodeURI(e.departmentList[t].deptRemark)})},getDepartmentDataList:function(e){var t=this;1==e&&(t.tableRowList=[],t.pageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptList,actionUrl:CONFIG.SERVICE.deptService,dataObj:t.pageInfo,beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.departmentList=e.data,t.pageInfo.count=e.count,t.formatTableList())}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(t){200==t.code&&(e.companyList=t.data)}})},getUserDataList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.getUserList,actionUrl:CONFIG.SERVICE.userService,dataObj:{companyId:e.itemInfo.paraCompanyId,pageNum:1,pageSize:1e3},successCallback:function(t){200==t.code&&(e.userList=t.data)}})}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getDepartmentDataList(!1),e.getCompanyList()},500)}})})();
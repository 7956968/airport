(function(){var e,i=utility.getLocalStorage("language"),t=(utility.getLocalStorage("userInfo"),utility.getLocalStorage("bizParam"));new Vue({el:"#js-vue",data:{language:i?i.language:"CN",isTableLoading:!0,isShowModal:!1,isModalLoading:!0,tableHeight:(e=$(".tableContainer").height(),e-100),vehicleColorList:t.vehicleColor,vehicleTypeList:t.vehicleType,vehicleBrandList:t.vehicleBrand,pageInfo:{id:"",deptId:"",companyId:"",vehicleCode:"",vehicleColorId:"",vehicleTypeId:"",vehicleBrandId:"",vehicleTypeId:"",beginMiles:"",endMiles:"",beginTime:"",endTime:"",orderType:1},page:{count:0,pageNum:1,pageSize:20},columnsList:[{type:"index",width:60,title:"序号",align:"center"},{title:{CN:"公司",EN:"Company",TW:"公司"}[i.language],key:"companyName"},{title:{CN:"部门",EN:"Department",TW:"部門"}[i.language],key:"deptName"},{title:{CN:"车辆名称",EN:"Vehicle Name",TW:"車輛名稱"}[i.language],key:"vehicleName"},{title:{CN:"车辆编码",EN:"Vehicle Name",TW:"車輛編碼"}[i.language],key:"vehicleCode"},{title:{CN:"里程数",EN:"Mileage(km)",TW:"里程數(公里)"}[i.language],key:"miles",sortable:!0,render:function(e,i){return e("div",[e("span",{},i.row.miles+"（公里）")])}}],departmentList:[],vehicleList:[],companyList:[],userList:[],vehicleInfo:{},allVehicleList:[],mileInfo:{xAxisData:[],seriesData:[]}},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},beginRepairTime:function(e,i){var t=this;t.pageInfo.beginTime=e},endRepairTime:function(e,i){var t=this;t.pageInfo.endTime=e},pageSizeChange:function(e){var i=this;i.page.pageNum=parseInt(e,10),setTimeout(function(){i.getVehicleMilesReport(!1)},200)},pageRowChange:function(e){var i=this;i.page.pageSize=parseInt(e,10),setTimeout(function(){i.getVehicleMilesReport(!0)},200)},drawVehicle:function(e){var i=this,t=echarts.init(document.getElementById(e.id));option={title:{text:e.title,top:10,textStyle:{fontSize:13,align:"center"}},color:[e.color],tooltip:{trigger:"axis",textStyle:{fontSize:13},formatter:function(e){var t=e[0].axisValue,a=i.vehicleInfo[t].info,n=[];return n.push("结果："+e[0].value+"<br/>"),n.push("公司："+a.companyName+"<br/>"),n.push("部门："+a.deptName+"<br/>"),n.push("车辆："+a.vehicleName+"<br/>"),n.push("类型："+a.vehicleTypeName+"<br/>"),n.push("品牌："+a.vehicleBrandName+"<br/>"),n.push("颜色："+a.vehicleColorName+"<br/>"),n.join(" ")}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:e.data.xAxisData,axisTick:{alignWithLabel:!0}}],yAxis:[{type:"value"}],series:[{name:"",type:"bar",barWidth:"60%",data:e.data.seriesData}]},t.setOption(option)},formatVehicle:function(){for(var e=this,i={},t=0,a=e.allVehicleList.length;t<a;t++)i[e.allVehicleList[t].vehicleCode]={info:e.allVehicleList[t],list:[]};for(var n in i)if(i.hasOwnProperty(n))for(var l=0,o=e.allVehicleList.length;l<o;l++)e.allVehicleList[l].vehicleCode==n&&i[n].list.push(e.allVehicleList[l]);for(var c in i)if(i.hasOwnProperty(c)){var r=0;e.mileInfo.xAxisData.push(c);for(var p=0,s=i[c].list.length;p<s;p++)r+=i[c].list[p].miles;e.mileInfo.seriesData.push(r)}e.vehicleInfo=i},getAllVehicleList:function(){var e=this;e.mileInfo.xAxisData=[],e.mileInfo.seriesData=[],utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleMilesReport,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{pageNum:1,pageSize:1e7,deptId:e.pageInfo.deptId,companyId:e.pageInfo.companyId,vehicleCode:encodeURI(e.pageInfo.vehicleCode),vehicleColorId:e.pageInfo.vehicleColorId,vehicleTypeId:e.pageInfo.vehicleTypeId,vehicleBrandId:e.pageInfo.vehicleBrandId,vehicleTypeId:e.pageInfo.vehicleTypeId,beginMiles:e.pageInfo.beginMiles,endMiles:e.pageInfo.endMiles,beginTime:e.pageInfo.beginTime,endTime:e.pageInfo.endTime,orderType:1},successCallback:function(i){200==i.code&&(e.allVehicleList=i.data,e.formatVehicle(),e.drawVehicle({id:"milleInfo",color:"#2d8cf0",data:e.mileInfo,title:"车辆行驶里程统计(单位/公里)"}))}})},getVehicleMilesReport:function(e){var i=this;i.vehicleList=[],1==e&&(i.page.pageNum=1,i.page.count=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleMilesReport,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{pageNum:i.page.pageNum,pageSize:i.page.pageSize,deptId:i.pageInfo.deptId,companyId:i.pageInfo.companyId,vehicleCode:encodeURI(i.pageInfo.vehicleCode),vehicleColorId:i.pageInfo.vehicleColorId,vehicleTypeId:i.pageInfo.vehicleTypeId,vehicleBrandId:i.pageInfo.vehicleBrandId,vehicleTypeId:i.pageInfo.vehicleTypeId,beginMiles:i.pageInfo.beginMiles,endMiles:i.pageInfo.endMiles,beginTime:i.pageInfo.beginTime,endTime:i.pageInfo.endTime,orderType:1},beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.vehicleList=e.data,i.page.count=e.count)}})},changeToGetDetp:function(){var e=this;e.getDepartmentList()},getDepartmentList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:0,companyId:e.pageInfo.companyId,pageSize:1e4},successCallback:function(i){200==i.code&&(e.departmentList=i.data)}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(i){200==i.code&&(e.companyList=i.data)}})},getDataBySearch:function(){var e=this;e.getVehicleMilesReport(!0)}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getVehicleMilesReport(!0),e.getDepartmentList(),e.getCompanyList(),e.getAllVehicleList(),e.$watch("pageInfo",function(){e.getVehicleMilesReport(!0)},{deep:!0})},500)}})})();
(function(){var e,a,t=utility.getLocalStorage("language"),i=utility.getLocalStorage("userInfo"),n=utility.getLocalStorage("bizParam"),o=utility.getLocalStorage("userFuncList"),r=new Vue({el:"#js-vue",data:{language:t?t.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isModalLoading:!0,modalTitle:"",cameraFunc:(a=JSON.stringify(o.menu_map),-1!=a.indexOf("device_manage_camera")),tableHeight:(e=$(".tableContainer").height(),e-100),monitorStatusList:n.monitorStatusId,index:0,selectItem:null,pageInfo:{count:0,pageNum:0,pageSize:20,companyId:"",cameraName:"",cameraCode:"",monitorStatus:""},itemInfo:{id:"",companyId:"",companyName:"",deptId:"",deptName:"",cameraName:"",cameraCode:"",cameraDesc:"",cameraPositionStr:"",radius:"",angle:"",monitorStatus:"",remark:"",rtspLiveUrl:"",rtspHisUrl:"",createUserId:i.id,modifyUserId:i.id},columnsList:[{type:"index",align:"center",title:"序号",width:60,fixed:"left"},{title:{CN:"公司",EN:"Company",TW:"公司"}[t.language],key:"companyName",width:180,fixed:"left"},{title:{CN:"名称",EN:"Name",TW:"名稱"}[t.language],key:"cameraName",width:140},{title:{CN:"名称",EN:"Name",TW:"名稱"}[t.language],key:"cameraCode",width:140},{title:{CN:"描述",EN:"Describe",TW:"描述"}[t.language],key:"cameraDesc",width:140},{title:{CN:"Rtsp直播地址",EN:"Live URL",TW:"Rtsp直播地址"}[t.language],key:"rtspLiveUrl",width:140},{title:{CN:"Rtsp录播地址",EN:"Delayed URL",TW:"Rtsp錄播地址"}[t.language],key:"rtspHisUrl",width:140},{title:{CN:"半径",EN:"Radius",TW:"半徑"}[t.language],key:"radius",width:140},{title:{CN:"视野角度",EN:"Angle Of View",TW:"視野角度"}[t.language],key:"angle",width:140},{title:{CN:"状态",EN:"State",TW:"狀態"}[t.language],key:"monitorStatus",width:140},{title:{CN:"操作",EN:"Operation",TW:"操作"}[t.language],key:"operation",width:180,align:"center",fixed:"right",render:function(e,a){var i=JSON.stringify(o.menu_map),n="",c=null;return-1!=i.indexOf("device_manage_camera")?(n={CN:"编辑",EN:"Edite",TW:"編輯"}[t.language],c=e("Button",{props:{type:"error",size:"small"},on:{click:function(){r.index=a.index,r.selectItem=a.row,r.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[t.language])):n={CN:"查看",EN:"View",TW:"查看"}[t.language],e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){r.index=a.index,r.selectItem=a.row,r.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[t.language]),e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){r.index=a.index,r.selectItem=a.row,r.editItem()}}},n),c])}}],dataList:[],cameraList:[],companyList:[]},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",companyId:"",companyName:"",providerId:"",deviceCode:"",remark:"",dataPeriod:"",versionName:"",versionNum:"",deviceStatus:"",deptId:"",deptName:"",speed:"",power:"",lastPosition:"",lastDataTime:""}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.cameraList[e.index])),e.itemInfo.remark=decodeURI(e.cameraList[e.index].remark),e.itemInfo.cameraName=decodeURI(e.cameraList[e.index].cameraName),e.itemInfo.cameraCode=decodeURI(e.cameraList[e.index].cameraCode),e.itemInfo.cameraDesc=decodeURI(e.cameraList[e.index].cameraDesc),e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.cameraList[e.index])),e.itemInfo.remark=decodeURI(e.cameraList[e.index].remark),e.itemInfo.cameraName=decodeURI(e.cameraList[e.index].cameraName),e.itemInfo.cameraCode=decodeURI(e.cameraList[e.index].cameraCode),e.itemInfo.cameraDesc=decodeURI(e.cameraList[e.index].cameraDesc),e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.cameraList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.delCamera+"&ids="+e.itemInfo.id+"&modifyUserId="+i.id,actionUrl:CONFIG.SERVICE.deviceService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(a){200==a.code?e.getCameraList(!0):e.$Message.error(a.message)}})})}})},pageSizeChange:function(e){var a=this;a.pageInfo.pageNum=parseInt(e,10),setTimeout(function(){a.getCameraList(!1)},200)},pageRowChange:function(e){var a=this;a.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){a.getCameraList(!1)},200)},setCurrentRowData:function(e,a){var t=this;t.index=a,t.selectItem=e},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.saveCamera,actionUrl:CONFIG.SERVICE.deviceService,dataObj:{id:e.itemInfo.id,companyId:e.itemInfo.companyId,companyName:encodeURI(e.itemInfo.companyName),deptId:e.itemInfo.deptId,deptName:encodeURI(e.itemInfo.deptName),cameraName:encodeURI(e.itemInfo.cameraName),cameraCode:encodeURI(e.itemInfo.cameraCode),cameraDesc:encodeURI(e.itemInfo.cameraDesc),radius:e.itemInfo.radius,angle:e.itemInfo.angle,monitorStatus:e.itemInfo.monitorStatus,remark:encodeURI(e.itemInfo.remark),rtspLiveUrl:e.itemInfo.rtspLiveUrl,rtspHisUrl:e.itemInfo.rtspHisUrl,createUserId:i.id,modifyUserId:i.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(a){200==a.code?(e.getCameraList(!0),e.isShowModal=!1):e.$Message.error(a.message)}})},formatCameraData:function(){for(var e=this,a=0,t=e.cameraList.length;a<t;a++)e.dataList.push({id:e.cameraList[a].id,companyId:e.cameraList[a].companyId,companyName:decodeURI(e.cameraList[a].companyName),deptId:e.cameraList[a].deptId,deptName:decodeURI(e.cameraList[a].deptName),cameraName:decodeURI(e.cameraList[a].cameraName),cameraCode:decodeURI(e.cameraList[a].cameraCode),cameraDesc:decodeURI(e.cameraList[a].cameraDesc),radius:e.cameraList[a].radius,angle:e.cameraList[a].angle,monitorStatus:e.cameraList[a].monitorStatusName,remark:decodeURI(e.cameraList[a].remark),rtspLiveUrl:e.cameraList[a].rtspLiveUrl,rtspHisUrl:e.cameraList[a].rtspHisUrl})},getCameraList:function(e){var a=this;a.dataList=[],1==e&&(a.pageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.getCameraList,actionUrl:CONFIG.SERVICE.deviceService,dataObj:a.pageInfo,beforeSendCallback:function(){a.isTableLoading=!0},completeCallback:function(){a.isTableLoading=!1},successCallback:function(e){200==e.code&&(a.cameraList=e.data,a.pageInfo.count=e.count,a.formatCameraData())}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(a){200==a.code&&(e.companyList=a.data)}})},toMapPage:function(){utility.setSessionStorage("fromInfo",{type:"isCamera",vehicleStatus:""}),setTimeout(function(){$(window.parent.document).find("#nav_Maps").bind("click"),$(window.parent.document).find("#nav_Maps").trigger("click")},200)}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getCameraList(!0),e.getCompanyList()},500)}})})();
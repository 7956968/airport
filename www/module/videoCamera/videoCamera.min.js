(function(){var e=utility.getLocalStorage("language"),a=utility.getLocalStorage("userInfo"),t=utility.getLocalStorage("bizParam"),i=utility.getLocalStorage("userFuncList"),n=new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isModalLoading:!0,modalTitle:"",cameraFunc:function(){var e=JSON.stringify(i.menu_map);return e.indexOf("device_manage_camera")!=-1}(),tableHeight:function(){var e=$(".tableContainer").height();return e-100}(),monitorStatusList:t.monitorStatusId,index:0,selectItem:null,pageInfo:{count:0,pageNum:0,pageSize:20,companyId:"",cameraName:"",cameraCode:"",monitorStatus:""},itemInfo:{id:"",companyId:"",companyName:"",deptId:"",deptName:"",cameraName:"",cameraCode:"",cameraDesc:"",cameraPositionStr:"",radius:"",angle:"",monitorStatus:"",remark:"",rtspLiveUrl:"",rtspHisUrl:"",createUserId:a.id,modifyUserId:a.id},columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"公司",EN:"Company",TW:"公司"}[e.language],key:"companyName"},{title:{CN:"名称",EN:"Name",TW:"名稱"}[e.language],key:"cameraName"},{title:{CN:"名称",EN:"Name",TW:"名稱"}[e.language],key:"cameraCode"},{title:{CN:"描述",EN:"Describe",TW:"描述"}[e.language],key:"cameraDesc"},{title:{CN:"Rtsp直播地址",EN:"Live URL",TW:"Rtsp直播地址"}[e.language],key:"rtspLiveUrl"},{title:{CN:"Rtsp录播地址",EN:"Delayed URL",TW:"Rtsp錄播地址"}[e.language],key:"rtspHisUrl"},{title:{CN:"半径",EN:"Radius",TW:"半徑"}[e.language],key:"radius"},{title:{CN:"视野角度",EN:"Angle Of View",TW:"視野角度"}[e.language],key:"angle"},{title:{CN:"状态",EN:"State",TW:"狀態"}[e.language],key:"monitorStatus"},{title:{CN:"操作",EN:"Operation",TW:"操作"}[e.language],key:"operation",width:180,render:function(a,t){var o=JSON.stringify(i.menu_map),r="",c=null;return o.indexOf("device_manage_camera")!=-1?(r={CN:"编辑",EN:"Edite",TW:"編輯"}[e.language],c=a("Button",{props:{type:"error",size:"small"},on:{click:function(){n.index=t.index,n.selectItem=t.row,n.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[e.language])):r={CN:"查看",EN:"View",TW:"查看"}[e.language],a("div",[a("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.index=t.index,n.selectItem=t.row,n.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[e.language]),a("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.index=t.index,n.selectItem=t.row,n.editItem()}}},r),c])}}],dataList:[],cameraList:[],companyList:[]},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",companyId:"",companyName:"",providerId:"",deviceCode:"",remark:"",dataPeriod:"",versionName:"",versionNum:"",deviceStatus:"",deptId:"",deptName:"",speed:"",power:"",lastPosition:"",lastDataTime:""}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.cameraList[e.index])),e.itemInfo.remark=decodeURI(e.cameraList[e.index].remark),e.itemInfo.cameraName=decodeURI(e.cameraList[e.index].cameraName),e.itemInfo.cameraCode=decodeURI(e.cameraList[e.index].cameraCode),e.itemInfo.cameraDesc=decodeURI(e.cameraList[e.index].cameraDesc),e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.cameraList[e.index])),e.itemInfo.remark=decodeURI(e.cameraList[e.index].remark),e.itemInfo.cameraName=decodeURI(e.cameraList[e.index].cameraName),e.itemInfo.cameraCode=decodeURI(e.cameraList[e.index].cameraCode),e.itemInfo.cameraDesc=decodeURI(e.cameraList[e.index].cameraDesc),e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.cameraList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.delCamera+"&ids="+e.itemInfo.id+"&modifyUserId="+a.id,actionUrl:CONFIG.SERVICE.deviceService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(a){200==a.code?e.getCameraList(!0):e.$Message.error(a.message)}})})}})},pageSizeChange:function(e){var a=this;a.pageInfo.pageNum=parseInt(e,10),setTimeout(function(){a.getCameraList(!1)},200)},pageRowChange:function(e){var a=this;a.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){a.getCameraList(!1)},200)},setCurrentRowData:function(e,a){var t=this;t.index=a,t.selectItem=e},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.saveCamera,actionUrl:CONFIG.SERVICE.deviceService,dataObj:{id:e.itemInfo.id,companyId:e.itemInfo.companyId,companyName:encodeURI(e.itemInfo.companyName),deptId:e.itemInfo.deptId,deptName:encodeURI(e.itemInfo.deptName),cameraName:encodeURI(e.itemInfo.cameraName),cameraCode:encodeURI(e.itemInfo.cameraCode),cameraDesc:encodeURI(e.itemInfo.cameraDesc),radius:e.itemInfo.radius,angle:e.itemInfo.angle,monitorStatus:e.itemInfo.monitorStatus,remark:encodeURI(e.itemInfo.remark),rtspLiveUrl:e.itemInfo.rtspLiveUrl,rtspHisUrl:e.itemInfo.rtspHisUrl,createUserId:a.id,modifyUserId:a.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(a){200==a.code?(e.getCameraList(!0),e.isShowModal=!1):e.$Message.error(a.message)}})},formatCameraData:function(){for(var e=this,a=0,t=e.cameraList.length;a<t;a++)e.dataList.push({id:e.cameraList[a].id,companyId:e.cameraList[a].companyId,companyName:decodeURI(e.cameraList[a].companyName),deptId:e.cameraList[a].deptId,deptName:decodeURI(e.cameraList[a].deptName),cameraName:decodeURI(e.cameraList[a].cameraName),cameraCode:decodeURI(e.cameraList[a].cameraCode),cameraDesc:decodeURI(e.cameraList[a].cameraDesc),radius:e.cameraList[a].radius,angle:e.cameraList[a].angle,monitorStatus:e.cameraList[a].monitorStatusName,remark:decodeURI(e.cameraList[a].remark),rtspLiveUrl:e.cameraList[a].rtspLiveUrl,rtspHisUrl:e.cameraList[a].rtspHisUrl})},getCameraList:function(e){var a=this;a.dataList=[],1==e&&(a.pageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.getCameraList,actionUrl:CONFIG.SERVICE.deviceService,dataObj:a.pageInfo,beforeSendCallback:function(){a.isTableLoading=!0},completeCallback:function(){a.isTableLoading=!1},successCallback:function(e){200==e.code&&(a.cameraList=e.data,a.pageInfo.count=e.count,a.formatCameraData())}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(a){200==a.code&&(e.companyList=a.data)}})},toMapPage:function(){utility.setSessionStorage("fromInfo",{type:"isCamera",vehicleStatus:""}),setTimeout(function(){$(window.parent.document).find("#nav_Maps").bind("click"),$(window.parent.document).find("#nav_Maps").trigger("click")},200)}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getCameraList(!0),e.getCompanyList()},500)}})})();
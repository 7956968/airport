new Vue({el:"#js-vue",data:{isShowDetail:!0,vehicleInfo:JSON.parse(decodeURI(utility.getQueryParams().vehicleInfo)),queryInfo:utility.getQueryParams(),mIP:"220.231.225.7",mPort:7668,mUserName:"mgkj",mPwd:"888888",msgInfo:"",codeType:!0,netnSignal:"",hd:[],sd:[],dragAndDrop:{sourceEle:null,targetEle:null,sourceStyle:"",targetStyle:""},backPlay:{date:"",beginTime:"",endTIme:"",Date:"",BeginSecond:"",EndSecond:"",num:0,videoCount:0,channelTotal:0,channel:"",channelInfo:{channel0:{channel:0,radioIndex:"",isChannel:!1,list:[]},channel1:{channel:1,radioIndex:"",isChannel:!1,list:[]},channel2:{channel:2,radioIndex:"",isChannel:!1,list:[]},channel3:{channel:3,radioIndex:"",isChannel:!1,list:[]},channel4:{channel:4,radioIndex:"",isChannel:!1,list:[]},channel5:{channel:5,radioIndex:"",isChannel:!1,list:[]},channel6:{channel:6,radioIndex:"",isChannel:!1,list:[]},channel7:{channel:7,radioIndex:"",isChannel:!1,list:[]}},connectError:!1,tabs:"info"},currentChannel:0,radioIndex:"",front:null,splitArea:[1,4,6,8,9],innerHeight:window.innerHeight,videoWinSplit:{count_1:[{top:"0px",left:"0px",width:"calc(100% - 4px)",height:"calc(100% - 4px)"}],count_3:[{top:"0px",left:"0px",width:"calc(70% - 4px)",height:"calc(100% - 4px)"},{top:"0px",left:"70%",width:"calc(30% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"70%",width:"calc(30% - 4px)",height:"calc(50% - 4px)"}],count_4:[{top:"0px",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"0px",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"}],count_5:[{top:"0px",left:"0px",width:"calc(70% - 4px)",height:"calc(100% - 4px)"},{top:"0px",left:"70%",width:"calc(30% - 4px)",height:"calc(25% - 4px)"},{top:"25%",left:"70%",width:"calc(30% - 4px)",height:"calc(25% - 4px)"},{top:"50%",left:"70%",width:"calc(30% - 4px)",height:"calc(25% - 4px)"},{top:"75%",left:"70%",width:"calc(30% - 4px)",height:"calc(25% - 4px)"}],count_6:[{top:"0px",left:"0px",width:"calc(33.333% - 4px)",height:"calc(50% - 4px)"},{top:"0px",left:"33.333%",width:"calc(33.333% - 4px)",height:"calc(50% - 4px)"},{top:"0px",left:"66.666%",width:"calc(33.333% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"0px",width:"calc(33.333% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"33.333%",width:"calc(33.333% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"66.666%",width:"calc(33.333% - 4px)",height:"calc(50% - 4px)"}],count_7:[{top:"0px",left:"0px",width:"calc(100% / 4 * 3 - 6px)",height:"calc(100% / 4 * 3 - 8px)"},{top:"0px",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 1 - 2px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 2 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 4px)"},{top:"calc(100% / 4 * 3 - 4px)",left:"0px",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 1 - 0px)",width:"calc(100% / 4 * 1 - 6px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 2 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"}],count_8:[{top:"0px",left:"0px",width:"calc(100% / 4 * 3 - 6px)",height:"calc(100% / 4 * 3 - 8px)"},{top:"0px",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 1 - 2px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 2 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 4px)"},{top:"calc(100% / 4 * 3 - 4px)",left:"0px",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 1 - 0px)",width:"calc(100% / 4 * 1 - 6px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 2 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 2px)",height:"calc(100% / 4 * 1)"}]},videoInfo:[{},{},{},{},{},{},{},{},{},{},{}],vehicleList:["22","民航-B3521","民航-B3605","民航-B3045","民航-B4321","民航-B7494","民航-B3090","民航-B1787","民航-B4081","民航-B0277","民航-B8596","民航-B1786","民航-B3132"]},methods:{init:function(e){var n=this;if(n.logout(),!n.vehicleInfo.licenseNumber)return n.backPlay.channelTotal=0,void(n.msgInfo="请输入车牌号");setTimeout(function(){n.connectNet()},1e3)},onTimeChange:function(e){var n=this;n.timeLen=parseInt(e,10)},logout:function(){var e=this;"undefined"!=typeof vsclientSession&&vsclientSession&&(vsclientSession.logout(),vsclientSession=null,e.backPlay.channelTotal=0)},setCurrentStyle:function(e){$("body").find(".videoItem").removeClass("active"),$("body").find("#"+e).addClass("active")},getReplayVedio:function(){var e=this,n=utility.getDateDetailInfo(new Date),a=vsclientSession.findFrontByName(e.vehicleInfo.licenseNumber),l="",c="",t="",i="",o="",h=null;e.front=a,l=0==e.backPlay.Date.length?n.year+"-"+n.month+"-"+n.date:e.backPlay.Date,c=0==e.backPlay.beginTime.length?"00:00:00":e.backPlay.beginTime,t=0==e.backPlay.endTIme.length?"23:59:59":e.backPlay.endTIme,i=l+" "+c,o=l+" "+t,h={command:"query_record",front:e.front.id,channel:254,begin_time:parseInt(Date.parse(i.replace(/-/g,"/"))/1e3),end_time:parseInt(Date.parse(o.replace(/-/g,"/"))/1e3),sn:++e.backPlay.num},e.msgInfo="正在获取视频......",e.$Message.loading({content:"正在获取视频......"}),vsclientSession.sendMsg(h)},connectNet:function(){var e=this;if(0!=e.vehicleInfo.licenseNumber.length){var n={onLoginFailed:function(){e.$Message.destroy(),e.msgType="error",e.msgInfo="车辆 【"+e.vehicleInfo.licenseNumber+"】登录失败",setTimeout(function(){vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort)},3e3)},onConnectSuccess:function(){},onVehicleInfo:function(e){},onlogin:function(n){var a=vsclientSession.findFrontByName(e.vehicleInfo.licenseNumber);null==a?(e.msgType="error",e.msgInfo="没有找到车辆【 "+e.vehicleInfo.licenseNumber+" 】",e.isStop=!0):(e.front=a,e.$Message.destroy(),e.msgType="success",e.msgInfo="车辆 【"+e.vehicleInfo.licenseNumber+"】登录成功",console.log("登录"),e.backPlay.connectError=!1,e.getReplayVedio())},onOnOffline:function(n){n.name==e.vehicleInfo.licenseNumber&&(0==n.online?(e.backPlay.tabs="info",e.backPlay.videoCount=0,e.backPlay.channelTotal=0,e.backPlay.channelInfo={},e.msgInfo="车辆【 "+e.vehicleInfo.licenseNumber+" 】已经下线"):(e.backPlay.connectError=!1,e.getReplayVedio()))},onServerConnectionLost:function(){},onStreamPlayStatus:function(e){console.log(e)},onHistoryForListening:function(n){var a=n.streamID;console.log("音频信息"),console.log(n),console.log("channel="+e.currentChannel),vsclientSession.startReplayAudio(a)},onGpsData:function(n){e.netnSignal=n.gps.net_signal,e.hd=n.gps.storage.hd,e.sd=n.gps.storage.sd},onReplayVideoList:function(n){if(e.$Message.destroy(),e.backPlay.connectError=!1,n){e.msgInfo="",e.backPlay.videoCount=0,e.backPlay.channelTotal=0,e.backPlay.channelInfo={channel0:{channel:0,radioIndex:"",isChannel:!1,list:[]},channel1:{channel:1,radioIndex:"",isChannel:!1,list:[]},channel2:{channel:2,radioIndex:"",isChannel:!1,list:[]},channel3:{channel:3,radioIndex:"",isChannel:!1,list:[]},channel4:{channel:4,radioIndex:"",isChannel:!1,list:[]},channel5:{channel:5,radioIndex:"",isChannel:!1,list:[]},channel6:{channel:6,radioIndex:"",isChannel:!1,list:[]},channel7:{channel:7,radioIndex:"",isChannel:!1,list:[]}};for(var a=0,l=n.length;a<l;a++)n[a].channel>=0&&0==n[a].data_type&&(e.backPlay.videoCount=e.backPlay.videoCount+1,e.backPlay.channelInfo["channel"+n[a].channel]={channel:n[a].channel,radioIndex:-1,isChannel:e.backPlay.channelInfo["channel"+n[a].channel].channel==n[a].channel,list:[]});for(var c in e.backPlay.channelInfo)if(e.backPlay.channelInfo.hasOwnProperty(c)){e.backPlay.channelInfo[c].isChannel&&(e.backPlay.channelTotal=e.backPlay.channelTotal+1);for(var t=0,i=n.length;t<i;t++)n[t].channel==e.backPlay.channelInfo[c].channel&&0==n[t].data_type&&e.backPlay.channelInfo[c].list.push({channel:parseInt(n[t].channel,10),date:(o=void 0,o=utility.getDateDetailInfo(1e3*n[t].begin_time),o.year+"/"+o.month+"/"+o.date),beginTime:function(){var e=utility.getDateDetailInfo(1e3*n[t].begin_time);return e.hour+":"+e.min+":"+e.second}(),endTime:function(){var e=utility.getDateDetailInfo(1e3*n[t].end_time);return e.hour+":"+e.min+":"+e.second}(),weekDay:function(){var e=utility.getDateDetailInfo(1e3*n[t].end_time);return e.weekDay}(),source:n[t]})}setTimeout(function(){e.backPlay.channel="",$("body").find("#channel0 .ivu-collapse-header").on("click",function(){console.log("")}),$("body").find("#channel0 .ivu-collapse-header").trigger("click")},500),e.backPlay.tabs="video"}else e.msgType="error",e.msgInfo="车辆【 "+e.vehicleInfo.licenseNumber+" 】没有视频数据",e.backPlay.tabs="info",e.backPlay.videoCount=0,e.backPlay.channelTotal=0,e.backPlay.channelInfo={channel0:{channel:0,radioIndex:"",isChannel:!1,list:[]},channel1:{channel:1,radioIndex:"",isChannel:!1,list:[]},channel2:{channel:2,radioIndex:"",isChannel:!1,list:[]},channel3:{channel:3,radioIndex:"",isChannel:!1,list:[]},channel4:{channel:4,radioIndex:"",isChannel:!1,list:[]},channel5:{channel:5,radioIndex:"",isChannel:!1,list:[]},channel6:{channel:6,radioIndex:"",isChannel:!1,list:[]},channel7:{channel:7,radioIndex:"",isChannel:!1,list:[]}};var o}};window.vsclientSession=new VSClientSession(n),vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort),e.msgInfo="车辆【 "+e.vehicleInfo.licenseNumber+" 】正在登录中......",e.$Message.destroy(),e.$Message.loading({content:"车辆【 "+e.vehicleInfo.licenseNumber+" 】正在登录中......"})}},playVideo:function(e,n,a){var l=this,c=$("#backVedio"+l.backPlay.channelInfo[n].list[e].channel);$("body").find("#hidden"+a).val(e+"-"+n+"-"+a),l.currentChannel=l.backPlay.channelInfo[n].list[e].channel,vsclientSession.stopReplay(c[0]),vsclientSession.stopReAudio(l.currentChannel),setTimeout(function(){l.backPlay.channelInfo[n].radioIndex=e,vsclientSession.startReplay(l.vehicleInfo.licenseNumber,a,c[0],l.backPlay.channelInfo[n].list[e].source)},1e3),l.getVideoFrame(e,n)},reStart:function(){var e=this;vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort),e.msgInfo="车辆【 "+e.vehicleInfo.licenseNumber+" 】正在登录中......",e.$Message.destroy(),e.$Message.loading({content:"车辆【 "+e.vehicleInfo.licenseNumber+" 】正在登录中......"})},backPage:function(){window.close()},dateChange:function(e){var n=this;n.backPlay.Date=e},beginTimeChange:function(e){var n=this,a=e.split(":");n.backPlay.beginTime=e,n.backPlay.BeginSecond=3600*a[0]+60*a[1]+a[2]},endTimeChange:function(e){var n=this,a=e.split(":");n.backPlay.endTIme=e,n.backPlay.EndSecond=3600*a[0]+60*a[1]+a[2]},dragEnd:function(e){var n=this,a=$(e.srcElement);n.dragAndDrop.sourceEle=a,n.dragAndDrop.sourceStyle=a.attr("style")},drop:function(e){var n=this,a=$(e.srcElement).parents(".videoItem");e.preventDefault(),n.dragAndDrop.targetEle=a,n.dragAndDrop.targetStyle=a.attr("style"),setTimeout(function(){n.dragAndDrop.targetEle.attr("style",n.dragAndDrop.sourceStyle),n.dragAndDrop.sourceEle.attr("style",n.dragAndDrop.targetStyle)},250)},setFullScream:function(e){var n=$("body").find("#"+e)[0],a=n.requestFullScreen||n.webkitRequestFullScreen||n.mozRequestFullScreen||n.msRequestFullScreen;if(void 0!==a&&a)a.call(n);else if(void 0!==window.ActiveXObject){var l=new ActiveXObject("WScript.Shell");null!=l&&l.SendKeys("{F11}")}},dragOver:function(e){e.preventDefault()},playSigleVideo:function(e){var n=$("#"+e).val().split("-"),a=$("#backVedio"+n[2]);vsclientSession.stopReplay(a[0])},getVideoFrame:function(e,n){var a=this,l=0,c=0,t=0,i=a.backPlay.channelInfo[n].list[e].channel;setInterval(function(){var e=$("#backVedio"+i)[0].currentTime;if(void 0!==e){var n=$("#backVedio"+i)[0].videoHeight,o=$("#backVedio"+i)[0].videoWidth,h=$("#backVedio"+i)[0].webkitDecodedFrameCount;0==e&&(l=0,c=0),0!=e&&(t=(h-c)/(e-l),l=e,c=h),a.videoInfo[i]={videoWidth:o,videoHeight:n,fps:t.toFixed(0)}}},1e3)}},mounted:function(){var e=this;e.$Message.config({top:3,duration:0,closable:!0}),e.$Notice.config({top:3,duration:0,closable:!0}),console.log(e.vehicleInfo),e.init()}});
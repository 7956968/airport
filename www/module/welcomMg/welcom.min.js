(function(){var e=utility.getLocalStorage("language"),t=utility.getLocalStorage("userInfo"),i=utility.getLocalStorage("bizParam"),n=utility.getLocalStorage("userFuncList"),a=function(){var e={isViewVideo:!1,isSearch:!1,isTrack:!1,isOnlineDetail:!1};for(var t in n)if(n.hasOwnProperty(t))for(var i=0,a=n[t].length;i<a;i++)"device_manage_view_video"==n[t][i].functionCode&&(e.isViewVideo=!0),"map_query_live_vehicle"==n[t][i].functionCode&&(e.isSearch=!0),"map_view_track"==n[t][i].functionCode&&(e.isTrack=!0),"device_manage_secure_area"==n[t][i].functionCode&&(e.isDefense=!0),"device_manage_camera"==n[t][i].functionCode&&(e.isCamera=!0),"device_manage_view_online"==n[t][i].functionCode&&(e.isOnlineDetail=!0);return e}(),o=new Vue({el:"#js-vue",data:{isBaiYun:!0,functionInfo:a,language:e?e.language:"CN",isTableLoading:!1,isLoading:!0,innerHeight:window.innerHeight/2,resizeTime:null,copyRight:{CN:"@copyRight 深圳市民贵科技有限公司",EN:"@copyRight Mingui Non-Powered Euipment Management System",TW:"@copyRight 民貴無動力管理系統"}[e.language],vehicleInfo:{list:[],count:0},terminalStatusList:i.terminalStatus,vehicleTypeList:i.vehicleType,vehicleInfoStr:"",vehicleTypeInfo:{},vehiclePassType:{},isloadDefen:!1,totalChartData:null,colorList:["#66CCCC","#CCFF66","#FF99CC","#A0522D","#FFFF00","#336699","#CC9933","#339999"],statuPageInfo:{online:2,daySpan:0,pageNum:1,pageSize:10,count:0,licenseNumber:""},isTableLoading:!1,showStatuDetail:!1,statuItemInfo:{},statuColumns:[{title:"车辆名称",key:"vehicleName"},{title:"车牌号",key:"licenseNumber"},{title:"车辆编号",key:"vehicleCode"},{title:"最后上线时间",render:function(e,t){var i="normalDay",n=Date.parse(new Date),a=Date.parse(t.row.lastGpsTime.replace("-","/")),o=Math.floor((n-a)/864e5);return o>=1&&(i="overDay"),e("div",[e("span",{class:i},t.row.lastGpsTime)])}},{title:"操作",key:"operation",align:"center",render:function(t,i){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.showStatuDetail=!0,o.statuItemInfo=o.statuDataList[i.index],o.statuItemInfo.lastPosition=JSON.parse(o.statuItemInfo.lastPosition).coordinates.join(",");var e=Date.parse(new Date),t=Date.parse(i.row.lastGpsTime.replace("-","/")),n=Math.floor((e-t)/864e5);n>3&&(o.statuItemInfo.overDay=!0)}}},{CN:"详情",EN:"Detail",TW:"詳情"}[e.language])])}}],statuDataList:[],isloadStae:!1,onlineStatPageInfo:{count:0,pageNum:1,pageSize:10,beginTime:"",endTime:""},onlineStatColumns:[{title:"车牌号",width:100,key:"licenseNumber"},{title:"统计日期",key:"statDay",sortable:!0,sortType:"asc"},{title:"在线次数",key:"onlineCount",sortable:!0,align:"center"},{title:"离线次数",key:"offlineCount",sortable:!0,align:"center"},{title:"在线时长",key:"onlineDuration",sortable:!0,align:"center",render:function(e,t){var i=(t.row.onlineDuration/3600).toFixed(2)+"小时";return e("div",[e("span",{},i)])}},{title:"操作",key:"operation",align:"center",render:function(t,i){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.showOnlineDetail=!0,o.onlineStatItemInfo=o.onlineStatList[i.index]}}},{CN:"详情",EN:"Detail",TW:"詳情"}[e.language])])}}],onlineStatList:[],onlineStatItemInfo:{},showOnlineDetail:!1,current:1},methods:{isLogin:function(){t||(alert("请先登录！"),window.parent.window.location.href="/airport/www/login.html")},setTotalEchart:function(){var e=this,t=echarts.init(document.getElementById("totalEchart")),i=[],n=[],a=[],o=e.totalChartData.reverse();for(var l in e.vehicleTypeInfo){e.vehicleTypeInfo[l].list=new Array(e.totalChartData.length);for(var c=0,r=e.totalChartData.length;c<r;c++)e.vehicleTypeInfo[l].list[c]=0}for(var s=0,u=o.length;s<u;s++){i.push(o[s].day);for(var h=0,f=o[s].useStat.length;h<f;h++)o[s].useStat[h].vehicleTypeId&&(e.vehicleTypeInfo["_"+o[s].useStat[h].vehicleTypeId].list[s]=o[s].useStat[h].totalVehicleNum)}for(var l in e.vehicleTypeInfo)a.push(e.vehicleTypeInfo[l].name),e.vehicleTypeInfo.hasOwnProperty(l)&&n.push({name:e.vehicleTypeInfo[l].name,type:"bar",barWidth:4,itemStyle:{normal:{barBorderRadius:2,color:e.vehicleTypeInfo[l].color}},data:e.vehicleTypeInfo[l].list});option={backgroundColor:"#0f375f",tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{top:20,data:a,textStyle:{color:"#ccc"}},xAxis:{data:i,axisLine:{lineStyle:{color:"#ccc"}}},yAxis:{splitLine:{show:!1},axisLine:{lineStyle:{color:"#ccc"}}},series:n.reverse()},t.setOption(option)},resetVehicleBizParamInfo:function(){var e=this,t=[];e.vehicleTypeInfo={},e.vehiclePassType={},e.vehicleInfo={list:[],count:0};for(var i=0,n=e.vehicleTypeList.length;i<n;i++)302!=e.vehicleTypeList[i].type&&303!=e.vehicleTypeList[i].type&&(e.vehicleTypeInfo["_"+e.vehicleTypeList[i].type]={value:0,name:e.vehicleTypeList[i].name,list:[],color:e.colorList[i]}),t.push(e.vehicleTypeList[i].type);e.vehicleInfoStr=t.join();for(var a=0,o=e.terminalStatusList.length;a<o;a++)e.vehicleInfo["_"+e.terminalStatusList[a].type]=0},startDateChange:function(e){var t=this;t.onlineStatPageInfo.beginTime=e,t.getVehicleOnlineStat()},endDateChange:function(e){var t=this;t.onlineStatPageInfo.endTime=e,t.getVehicleOnlineStat()},onlineStatPageSizeChange:function(e){var t=this;t.onlineStatPageInfo.pageNum=parseInt(e,10),setTimeout(function(){t.getVehicleOnlineStat()},200)},onlineStatPageRowChange:function(e){var t=this;t.onlineStatPageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getVehicleOnlineStat()},200)},getVehicleOnlineStat:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleOnlineStat,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{pageNum:e.onlineStatPageInfo.pageNum,pageSize:e.onlineStatPageInfo.pageSize,beginTime:e.onlineStatPageInfo.beginTime,endTime:e.onlineStatPageInfo.endTime},beforeSendCallback:function(){e.isloadStae=!0},completeCallback:function(){e.isloadStae=!1},successCallback:function(t){200==t.code&&(e.onlineStatPageInfo.count=t.count,e.onlineStatList=t.data)}})},getAllVehicleList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{id:"",pageSize:1e4},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){if(200==t.code){e.vehicleInfo.count=t.count,e.vehicleInfo.list=t.data;for(var i=0,n=e.vehicleInfo.list.length;i<n;i++)e.vehicleInfo["_"+e.vehicleInfo.list[i].vehicleStatus]=e.vehicleInfo["_"+e.vehicleInfo.list[i].vehicleStatus]+1,e.vehicleTypeInfo["_"+e.vehicleInfo.list[i].vehicleTypeId]&&(e.vehicleTypeInfo["_"+e.vehicleInfo.list[i].vehicleTypeId].value=e.vehicleTypeInfo["_"+e.vehicleInfo.list[i].vehicleTypeId].value+1)}}})},statuPageSizeChange:function(e){var t=this;t.current=e,t.statuPageInfo.pageNum=parseInt(e,10),setTimeout(function(){t.getStatuVehicleList()},200)},statuPageRowChange:function(e){var t=this;t.statuPageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getStatuVehicleList()},200)},getStatuVehicleList:function(e){var t=this;1==e&&(t.current=1,t.statuPageInfo.pageNum=1),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{id:"",online:parseInt(t.statuPageInfo.online),daySpan:parseInt(t.statuPageInfo.daySpan),pageSize:t.statuPageInfo.pageSize,pageNum:t.statuPageInfo.pageNum,licenseNumber:encodeURI($.trim(t.statuPageInfo.licenseNumber))},beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.statuPageInfo.count=e.count,t.statuDataList=e.data)}})},toMapPage:function(e){utility.setSessionStorage("fromInfo",{type:"isSearch",vehicleStatus:e}),setTimeout(function(){$(window.parent.document).find("#nav_Maps").bind("click"),$(window.parent.document).find("#nav_Maps").trigger("click")},200)},getVehicleStatusReport:function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleStatusReport,actionUrl:CONFIG.SERVICE.getVehicleStatusReport,successCallback:function(e){200==e.code&&console.log(e)}})},getVehicleRunReport:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleRunReport,actionUrl:CONFIG.SERVICE.getVehicleRunReport,successCallback:function(t){200==t.code&&(e.totalChartData=t.data,e.setTotalEchart())}})},getVehicleCateReport:function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleCateReport,actionUrl:CONFIG.SERVICE.getVehicleCateReport,successCallback:function(e){200==e.code&&console.log(e)}})},toOnlineDetail:function(e){utility.setSessionStorage("onlineStatItemInfo",e),setTimeout(function(){$(window.parent.document).find("#nav_OnlineDetail").bind("click"),$(window.parent.document).find("#nav_OnlineDetail").trigger("click")},200)},init:function(){var e=this;e.resetVehicleBizParamInfo(),e.getVehicleRunReport(),e.getAllVehicleList(),e.getStatuVehicleList(),e.getVehicleOnlineStat()}},created:function(){var e=this;utility.isLogin(!1),e.init(),setInterval(function(){e.init()},1e4),$(window).resize(function(){clearTimeout(e.resizeTime),e.resizeTime=setTimeout(function(){window.location.href=window.location.href},500)})},mounted:function(){var e=this;setTimeout(function(){e.isLoading=!1},5e3)}})})();
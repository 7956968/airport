(function(){var e=utility.getLocalStorage("language"),t=utility.getLocalStorage("userInfo"),i=utility.getLocalStorage("bizParam"),n=new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!1,isLoading:!0,innerHeight:window.innerHeight/6,resizeTime:null,copyRight:{CN:"@copyRight 深圳市民贵科技有限公司",EN:"@copyRight Mingui Non-Powered Euipment Management System",TW:"@copyRight 民貴無動力管理系統"}[e.language],vehicleInfo:{list:[],count:0},terminalStatusList:i.terminalStatus,vehicleTypeList:i.vehicleType,vehicleTypeInfo:{},vehiclePassType:{},isloadDefen:!1,totalChartData:null,colorList:["#66CCCC","#CCFF66","#FF99CC","#A0522D","#FFFF00","#336699","#CC9933","#339999"],statuPageInfo:{online:0,daySpan:0,pageNum:1,pageSize:10,count:0},isTableLoading:!1,showStatuDetail:!1,statuItemInfo:{},statuColumns:[{title:"车辆名称",key:"vehicleName"},{title:"车牌号",key:"licenseNumber"},{title:"车辆编号",key:"vehicleCode"},{title:"最后上线时间",key:"lastGpsTime",render:function(e,t){var i="normalDay",n=Date.parse(new Date),a=Date.parse(t.row.lastGpsTime.replace("-","/")),o=Math.floor((n-a)/864e5);return o>3&&(i="overDay"),e("div",[e("span",{class:i},t.row.lastGpsTime)])}},{title:"操作",key:"operation",align:"center",render:function(t,i){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.showStatuDetail=!0,n.statuItemInfo=n.statuDataList[i.index],n.statuItemInfo.lastPosition=JSON.parse(n.statuItemInfo.lastPosition).coordinates.join(",");var e=Date.parse(new Date),t=Date.parse(i.row.lastGpsTime.replace("-","/")),a=Math.floor((e-t)/864e5);a>3&&(n.statuItemInfo.overDay=!0)}}},{CN:"详情",EN:"Detail",TW:"詳情"}[e.language])])}}],statuDataList:[],isloadStae:!1,onlineStatPageInfo:{count:0,pageNum:1,pageSize:10,beginTime:"",endTime:""},onlineStatColumns:[{title:"车牌号",width:100,key:"licenseNumber"},{title:"统计日期",key:"statDay",sortable:!0,sortType:"asc"},{title:"在线次数",key:"onlineCount",align:"center"},{title:"离线次数",key:"offlineCount",align:"center"},{title:"在线时长",key:"onlineDuration",align:"center",render:function(e,t){var i=(t.row.onlineDuration/3600).toFixed(2)+"小时";return e("div",[e("span",{},i)])}},{title:"操作",key:"operation",align:"center",render:function(t,i){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.showOnlineDetail=!0,n.onlineStatItemInfo=n.onlineStatList[i.index]}}},{CN:"详情",EN:"Detail",TW:"詳情"}[e.language])])}}],onlineStatList:[],onlineStatItemInfo:{},showOnlineDetail:!1},methods:{isLogin:function(){t||(alert("请先登录！"),window.parent.window.location.href="/airport/www/login.html")},setTotalEchart:function(){for(var e=this,t=echarts.init(document.getElementById("totalEchart")),i=[],n=[],a=[],o=e.totalChartData.reverse(),l=0,c=o.length;l<c;l++){i.push(o[l].day);for(var s=0,r=o[l].useStat.length;s<r;s++)o[l].useStat[s].vehicleTypeId&&e.vehicleTypeInfo["_"+o[l].useStat[s].vehicleTypeId].list.push(o[l].useStat[s].totalVehicleNum)}for(var u in e.vehicleTypeInfo)a.push(e.vehicleTypeInfo[u].name),e.vehicleTypeInfo.hasOwnProperty(u)&&n.push({name:e.vehicleTypeInfo[u].name,type:"bar",barWidth:4,itemStyle:{normal:{barBorderRadius:2,color:e.vehicleTypeInfo[u].color}},data:e.vehicleTypeInfo[u].list});option={backgroundColor:"#0f375f",tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{top:20,data:a,textStyle:{color:"#ccc"}},xAxis:{data:i,axisLine:{lineStyle:{color:"#ccc"}}},yAxis:{splitLine:{show:!1},axisLine:{lineStyle:{color:"#ccc"}}},series:n.reverse()},t.setOption(option)},resetVehicleBizParamInfo:function(){var e=this;e.vehicleTypeInfo={},e.vehiclePassType={},e.vehicleInfo={list:[],count:0};for(var t=0,i=e.vehicleTypeList.length;t<i;t++)302!=e.vehicleTypeList[t].type&&303!=e.vehicleTypeList[t].type&&(e.vehicleTypeInfo["_"+e.vehicleTypeList[t].type]={value:0,name:e.vehicleTypeList[t].name,list:[],color:e.colorList[t]});for(var n=0,a=e.terminalStatusList.length;n<a;n++)e.vehicleInfo["_"+e.terminalStatusList[n].type]=0},startDateChange:function(e){var t=this;t.onlineStatPageInfo.beginTime=e,t.getVehicleOnlineStat()},endDateChange:function(e){var t=this;t.onlineStatPageInfo.endTime=e,t.getVehicleOnlineStat()},onlineStatPageSizeChange:function(e){var t=this;t.onlineStatPageInfo.pageNum=parseInt(e,10),setTimeout(function(){t.getVehicleOnlineStat()},200)},onlineStatPageRowChange:function(e){var t=this;t.onlineStatPageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getVehicleOnlineStat()},200)},getVehicleOnlineStat:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleOnlineStat,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{pageNum:e.onlineStatPageInfo.pageNum,pageSize:e.onlineStatPageInfo.pageSize,beginTime:e.onlineStatPageInfo.beginTime,endTime:e.onlineStatPageInfo.endTime},beforeSendCallback:function(){e.isloadStae=!0},completeCallback:function(){e.isloadStae=!1},successCallback:function(t){200==t.code&&(e.onlineStatPageInfo.count=t.count,e.onlineStatList=t.data)}})},getAllVehicleList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{id:"",pageSize:1e4},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){if(200==t.code){e.vehicleInfo.count=t.count,e.vehicleInfo.list=t.data;for(var i=0,n=e.vehicleInfo.list.length;i<n;i++)e.vehicleInfo["_"+e.vehicleInfo.list[i].vehicleStatus]=e.vehicleInfo["_"+e.vehicleInfo.list[i].vehicleStatus]+1,e.vehicleTypeInfo["_"+e.vehicleInfo.list[i].vehicleTypeId].value=e.vehicleTypeInfo["_"+e.vehicleInfo.list[i].vehicleTypeId].value+1}}})},statuPageSizeChange:function(e){var t=this;t.statuPageInfo.pageNum=parseInt(e,10),setTimeout(function(){t.getStatuVehicleList()},200)},statuPageRowChange:function(e){var t=this;t.statuPageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getStatuVehicleList()},200)},getStatuVehicleList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{id:"",online:parseInt(e.statuPageInfo.online),daySpan:parseInt(e.statuPageInfo.daySpan),pageSize:e.statuPageInfo.pageSize,pageNum:e.statuPageInfo.pageNum},beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code&&(e.statuPageInfo.count=t.count,e.statuDataList=t.data)}})},toMapPage:function(e){utility.setSessionStorage("fromInfo",{type:"isSearch",vehicleStatus:e}),setTimeout(function(){$(window.parent.document).find("#nav_Maps").bind("click"),$(window.parent.document).find("#nav_Maps").trigger("click")},200)},getVehicleStatusReport:function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleStatusReport,actionUrl:CONFIG.SERVICE.getVehicleStatusReport,successCallback:function(e){200==e.code&&console.log(e)}})},getVehicleRunReport:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleRunReport,actionUrl:CONFIG.SERVICE.getVehicleRunReport,successCallback:function(t){200==t.code&&(e.totalChartData=t.data,e.setTotalEchart())}})},getVehicleCateReport:function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleCateReport,actionUrl:CONFIG.SERVICE.getVehicleCateReport,successCallback:function(e){200==e.code&&console.log(e)}})},init:function(){var e=this;e.resetVehicleBizParamInfo(),e.getVehicleRunReport(),e.getAllVehicleList(),e.getStatuVehicleList(),e.getVehicleOnlineStat()}},created:function(){var e=this;utility.isLogin(!1),e.init(),setInterval(function(){e.init()},1e4),$(window).resize(function(){clearTimeout(e.resizeTime),e.resizeTime=setTimeout(function(){window.location.href=window.location.href},500)})},mounted:function(){var e=this;setTimeout(function(){e.isLoading=!1},5e3)}})})();
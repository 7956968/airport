(function(){var e=utility.getLocalStorage("language"),i=utility.getLocalStorage("userInfo"),t=utility.getLocalStorage("bizParam"),a=new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isShowTerminal:!1,isModalLoading:!0,modalTitle:"",tableHeight:function(){var e=$(".tableContainer").height();return e-100}(),terminalStatusList:t.terminalStatus,deviceProviderList:t.deviceProviderId,index:0,selectItem:null,itemInfo:{id:"",companyId:"",companyName:"",providerId:"",deviceCode:"",remark:"",dataPeriod:"",versionName:"",versionNum:"",deviceStatus:"",deptId:"",deptName:"",speed:"",power:"",lastPosition:"",lastDataTime:""},pageInfo:{count:0,pageSize:20,pageNum:1,id:"",companyId:"",deptId:"",providerId:"",deviceStatus:"",deviceCode:"",dataPeriod:"",versionName:"",versionNum:"",bindFlag:0,createUserId:i.id,modifyUserId:i.id},columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"公司",EN:"Company",TW:"公司"}[e.language],key:"companyId"},{title:{CN:"运行状态",EN:"Working Condition",TW:"運行狀態"}[e.language],key:"deviceStatus"},{title:{CN:"供应商",EN:"Supplier",TW:"廠家名稱"}[e.language],key:"providerId"},{title:{CN:"上报周期",EN:"Reporting Cycle",TW:"上報周期"}[e.language],key:"dataPeriod"},{title:{CN:"系统版本",EN:"System Version",TW:"系統版本"}[e.language],key:"versionName"},{title:{CN:"系统版本号",EN:"System Version No.",TW:"系統版本號"}[e.language],key:"versionNum"},{title:{CN:"当前速度",EN:"Speed",TW:"當前速度"}[e.language],key:"speed"},{title:{CN:"电量",EN:"Power",TW:"電量"}[e.language],key:"power"},{title:{CN:"操作",EN:"Operation",TW:"操作"}[e.language],key:"operation",width:180,render:function(i,t){return i("div",[i("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){a.index=t.index,a.selectItem=t.row,a.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[e.language]),i("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){a.index=t.index,a.selectItem=t.row,a.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[e.language]),i("Button",{props:{type:"error",size:"small"},on:{click:function(){a.index=t.index,a.selectItem=t.row,a.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[e.language])])}}],dataList:[],terminalList:[],companyList:[],departmentList:[]},watch:{},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",companyId:"",companyName:"",providerId:"",deviceCode:"",remark:"",dataPeriod:"",versionName:"",versionNum:"",deviceStatus:"",deptId:"",deptName:"",speed:"",power:"",lastPosition:"",lastDataTime:""}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.terminalList[e.index],e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.terminalList[e.index],e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.terminalList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.delDevice+"&ids="+e.itemInfo.id+"&modifyUserId="+i.id,actionUrl:CONFIG.SERVICE.deviceService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(i){200==i.code?e.getTerminalList(!1):e.$Message.error(i.message)}})})}})},pageSizeChange:function(e){var i=this;i.pageInfo.pageNum=parseInt(e,10),setTimeout(function(){i.getTerminalList(!1)},200)},pageRowChange:function(e){var i=this;i.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getTerminalList(!1)},200)},setCurrentRowData:function(e,i){var t=this;t.index=i,t.selectItem=e},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.saveDevice,actionUrl:CONFIG.SERVICE.deviceService,dataObj:{id:e.itemInfo.id,companyId:e.itemInfo.companyId,providerId:e.itemInfo.providerId,deviceCode:encodeURI(e.itemInfo.deviceCode),dataPeriod:e.itemInfo.dataPeriod,versionName:encodeURI(e.itemInfo.versionName),versionNum:e.itemInfo.versionNum,deviceStatus:e.itemInfo.deviceStatus,createUserId:i.id,modifyUserId:i.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(i){200==i.code?(e.getTerminalList(!1),e.isShowModal=!1):e.$Message.error(i.message)}})},formatTerminal:function(){for(var e=this,i=0,t=e.terminalList.length;i<t;i++)e.dataList.push({providerId:e.terminalList[i].providerName,deviceCode:decodeURI(e.terminalList[i].deviceCode),dataPeriod:e.terminalList[i].dataPeriod,versionName:decodeURI(e.terminalList[i].versionName),versionNum:e.terminalList[i].versionNum,speed:e.terminalList[i].speed,power:e.terminalList[i].power,lastPosition:e.terminalList[i].lastPosition,lastDataTime:e.terminalList[i].lastDataTime,companyId:e.terminalList[i].companyName,companyName:decodeURI(e.terminalList[i].companyName),deviceStatus:decodeURI(e.terminalList[i].deviceStatusName)})},getTerminalList:function(e){var i=this;i.dataList=[],1==e&&(i.pageInfo.pageNum=1),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.getDeviceList,actionUrl:CONFIG.SERVICE.deviceService,dataObj:i.pageInfo,beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.terminalList=e.data,i.pageInfo.count=e.count,i.formatTerminal())}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(i){200==i.code&&(e.companyList=i.data)}})}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getTerminalList(!0),e.getCompanyList()},500)}})})();
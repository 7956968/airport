(function(){var e,i=utility.getLocalStorage("language"),t=utility.getLocalStorage("userInfo"),a=utility.getLocalStorage("bizParam"),n=utility.getLocalStorage("airPort"),o=[],r=new Vue({el:"#js-vue",data:{isBeijing:"116.5924,40.0791"==n.airPort,language:i?i.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isShowTerminal:!1,isModalLoading:!0,modalTitle:"",tableHeight:(e=$(".tableContainer").height(),e-100),terminalStatusList:a.terminalStatus,deviceProviderList:a.deviceProviderId,index:0,selectItem:null,itemInfo:{id:"",companyId:"",companyName:"",providerId:"",deviceCode:"",remark:"",dataPeriod:30,versionName:"",versionNum:"",deviceStatus:406,deptId:"",deptName:"",speed:"",power:"",lastPosition:"",lastDataTime:""},pageInfo:{id:"",companyId:"",deptId:"",providerId:"",deviceStatus:"",deviceCode:"",dataPeriod:"",versionName:"",versionNum:"",bindFlag:0,createUserId:t.id,modifyUserId:t.id},page:{count:0,pageNum:1,pageSize:20},columnsList:[{type:"index",align:"center",title:"序号",width:60},{title:"公司",key:"companyId",width:200,filters:o,filterMultiple:!1,filterRemote(e,i){r.pageInfo.companyId=e}},{title:"绑定车辆",key:"vehicleCode"},{title:"运行状态",key:"deviceStatus",filters:function(){for(var e=[],i=a.terminalStatus,t=0,n=i.length;t<n;t++)401!=i[t].type&&402!=i[t].type&&403!=i[t].type&&406!=i[t].type||e.push({label:i[t].name,value:i[t].type});return e}(),filterMultiple:!1,filterRemote(e,i){r.pageInfo.deviceStatus=e}},{title:"供应商",key:"providerId",filters:function(){for(var e=[],i=a.deviceProviderId,t=0,n=i.length;t<n;t++)e.push({label:i[t].name,value:i[t].type});return e}(),filterMultiple:!1,filterRemote(e,i){r.pageInfo.providerId=e}},{title:"终端编号",key:"deviceCode",width:150},{title:"上报周期",key:"dataPeriod",align:"center",sortable:!0,sortType:"des",render:function(e,i){return e("div",[e("span",{},i.row.dataPeriod+" 秒")])}},{title:"操作",key:"operation",width:180,align:"center",render:function(e,t){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){r.index=t.index,r.selectItem=t.row,r.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[i.language]),e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){r.index=t.index,r.selectItem=t.row,r.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[i.language]),e("Button",{props:{type:"error",size:"small"},on:{click:function(){r.index=t.index,r.selectItem=t.row,r.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[i.language])])}}],columnsList1:[{type:"index",align:"center",title:"序号",width:60},{title:"公司",key:"companyId",width:200,filters:o,filterMultiple:!1,filterRemote(e,i){r.pageInfo.companyId=e}},{title:"绑定车辆",key:"vehicleCode"},{title:"运行状态",key:"deviceStatus",filters:function(){for(var e=[],i=a.terminalStatus,t=0,n=i.length;t<n;t++)401!=i[t].type&&402!=i[t].type&&403!=i[t].type&&406!=i[t].type||e.push({label:i[t].name,value:i[t].type});return e}(),filterMultiple:!1,filterRemote(e,i){r.pageInfo.deviceStatus=e}},{title:"供应商",key:"providerId",filters:function(){for(var e=[],i=a.deviceProviderId,t=0,n=i.length;t<n;t++)e.push({label:i[t].name,value:i[t].type});return e}(),filterMultiple:!1,filterRemote(e,i){r.pageInfo.providerId=e}},{title:"终端编号",key:"deviceCode",width:150},{title:"上报周期",key:"dataPeriod",align:"center",sortable:!0,sortType:"des",render:function(e,i){return e("div",[e("span",{},i.row.dataPeriod+" 秒")])}},{title:"电量",key:"power",align:"center",sortable:!0,sortType:"des",render:function(e,i){return e("div",[e("span",{},i.row.power+"%")])}},{title:"操作",key:"operation",width:180,align:"center",render:function(e,t){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){r.index=t.index,r.selectItem=t.row,r.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[i.language]),e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){r.index=t.index,r.selectItem=t.row,r.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[i.language]),e("Button",{props:{type:"error",size:"small"},on:{click:function(){r.index=t.index,r.selectItem=t.row,r.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[i.language])])}}],dataList:[],terminalList:[],companyList:[],departmentList:[]},watch:{},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",companyId:"",companyName:"",providerId:"",deviceCode:"",remark:"",dataPeriod:30,versionName:"",versionNum:"",deviceStatus:406,deptId:"",deptName:"",speed:"",power:"",lastPosition:"",lastDataTime:""}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.terminalList[e.index],e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.terminalList[e.index],e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.terminalList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.delDevice+"&ids="+e.itemInfo.id+"&modifyUserId="+t.id,actionUrl:CONFIG.SERVICE.deviceService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(i){200==i.code?e.getTerminalList(!1):e.$Message.error(i.message)}})})}})},pageSizeChange:function(e){var i=this;i.page.pageNum=parseInt(e,10),setTimeout(function(){i.getTerminalList(!1)},200)},pageRowChange:function(e){var i=this;i.page.pageSize=parseInt(e,10),setTimeout(function(){i.getTerminalList(!0)},200)},setCurrentRowData:function(e,i){var t=this;t.index=i,t.selectItem=e},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.saveDevice,actionUrl:CONFIG.SERVICE.deviceService,dataObj:{id:e.itemInfo.id,companyId:e.itemInfo.companyId,providerId:e.itemInfo.providerId,deviceCode:encodeURI(e.itemInfo.deviceCode),dataPeriod:e.itemInfo.dataPeriod||30,versionName:encodeURI(e.itemInfo.versionName),versionNum:e.itemInfo.versionNum,deviceStatus:e.itemInfo.deviceStatus,createUserId:t.id,modifyUserId:t.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(i){200==i.code?(e.getTerminalList(!1),e.isShowModal=!1):e.$Message.error(i.message)}})},formatTerminal:function(){for(var e=this,i=[],t=0,a=e.terminalList.length;t<a;t++)i.push({providerId:e.terminalList[t].providerName,deviceCode:decodeURI(e.terminalList[t].deviceCode),dataPeriod:e.terminalList[t].dataPeriod||30,versionName:decodeURI(e.terminalList[t].versionName),versionNum:e.terminalList[t].versionNum,deviceCode:decodeURI(e.terminalList[t].deviceCode),vehicleName:decodeURI(e.terminalList[t].vehicleName),vehicleCode:e.terminalList[t].vehicleCode,speed:e.terminalList[t].speed,power:e.terminalList[t].power,lastPosition:e.terminalList[t].lastPosition,lastDataTime:e.terminalList[t].lastDataTime,companyId:e.terminalList[t].companyName,companyName:decodeURI(e.terminalList[t].companyName),deviceStatus:decodeURI(e.terminalList[t].deviceStatusName)});e.dataList=i},getTerminalList:function(e){var i=this;i.dataList=[],i.terminalList=[],1==e&&(i.page.pageNum=1,i.page.count=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.getDeviceList,actionUrl:CONFIG.SERVICE.deviceService,dataObj:{pageNum:i.page.pageNum,pageSize:i.page.pageSize,companyId:i.pageInfo.companyId,deptId:i.pageInfo.deptId,providerId:i.pageInfo.providerId,deviceStatus:i.pageInfo.deviceStatus,deviceCode:encodeURI(i.pageInfo.deviceCode),bindFlag:i.pageInfo.bindFlag,createUserId:t.id,modifyUserId:t.id},beforeSendCallback:function(){i.isTableLoading=!0},completeCallback:function(){i.isTableLoading=!1},successCallback:function(e){200==e.code&&(i.dataList=[],i.terminalList=[],i.terminalList=e.data,i.page.count=e.count,i.formatTerminal())}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(i){if(200==i.code){e.companyList=i.data;for(var t=0,a=e.companyList.length;t<a;t++)o.push({label:e.companyList[t].companyName,value:e.companyList[t].id})}}})},downLoadExcel:function(){var e=this,i=Date.parse(new Date),a={companyId:e.pageInfo.companyId,providerId:e.pageInfo.providerId,deviceStatus:e.pageInfo.deviceStatus,deviceCode:encodeURI(e.pageInfo.deviceCode),bindFlag:e.pageInfo.bindFlag,version:100,timestamp:i,languageVer:"cn",appType:2,actionUrl:CONFIG.SERVICE.deviceService,userId:t?t.id:"",userToken:t?t.userToken:"",signStr:md5((t?t.userToken:"")+(t?t.id:"")+i+"100").toUpperCase()},n="",o=CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.downloadDeviceList;for(var r in a)a.hasOwnProperty(r)&&(n=n+"&"+r+"="+a[r]);window.open(o+n)}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getTerminalList(!0),e.getCompanyList(),e.$watch("pageInfo",function(){e.getTerminalList(!0)},{deep:!0})},500)}})})();
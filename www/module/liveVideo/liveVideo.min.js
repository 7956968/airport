new Vue({el:"#js-vue",data:{mIP:"",mPort:"",mUserName:"",mPwd:"",mVehicleNo:"",mVideoCount:9,maxVideoNum:10,isStop:!1,offLine:!1,timeOfflineOut:null,timeOffline:5,timeLen:30,timeSelect:"30",timeLenOut:null,netnSignal:"",msgType:"primary",msgInfo:"",isFullScream:!1,channelIndex:0,fullScreamIndex:"",defaultColor:"rgb(255,125,0)",splitNum:1,connectTimeOut:null,splitArea:[1,4,6,8,9],videoWinSplit:[{count:1,param:[{top:"0px",left:"0px",width:"calc(100% - 4px)",height:"calc(100% - 4px)"}]},{count:4,param:[{top:"0px",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"0px",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"}]},{count:6,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 2 - 6px)",height:"calc(100% / 3 * 2 - 8px)"},{top:"calc(100% / 3 * 2 - 4px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 1 - 0px)",width:"calc(100% / 3 * 1 - 6px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"0px",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 2px)",height:"calc(100% / 3 * 1 - 8px)"},{top:"calc(100% / 3 * 1 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]},{count:8,param:[{top:"0px",left:"0px",width:"calc(100% / 4 * 3 - 6px)",height:"calc(100% / 4 * 3 - 8px)"},{top:"calc(100% / 4 * 3 - 4px)",left:"0px",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 1 - 0px)",width:"calc(100% / 4 * 1 - 6px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 2 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 2px)",height:"calc(100% / 4 * 1)"},{top:"0px",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 1 - 2px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 2 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 4px)"}]},{count:9,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 2)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]}]},methods:{init:function(e){var t=this;if(t.mIP=e.ip,t.mPwd=e.pwd,t.mPort=e.port,t.mUserName=e.userName,t.mVehicleNo=e.vehicleNo,t.mVideoCount>t.maxVideoNum||t.mVideoCount<0)return t.$Message.destroy(),t.msgType="error",void(t.msgInfo="视频窗口数量有误");t.updateVideoWin(4),t.connectNet()},onTimeChange:function(e){var t=this;t.timeLen=parseInt(e,10)},setCurrentStyle:function(e){$("body").find(".videoItem").removeClass("active"),$("body").find("#"+e).addClass("active")},connectNet:function(){var e=this,t={onLoginFailed:function(){e.$Message.destroy(),e.msgType="error",e.msgInfo="车辆 【"+e.mVehicleNo+"】登录失败",clearInterval(e.timeLenOut),setTimeout(function(){vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort)},3e3)},onlogon:function(t){var i=vsclientSession.findFrontByName(e.mVehicleNo);if(e.$Message.destroy(),e.msgType="success",e.msgInfo="车辆 【"+e.mVehicleNo+"】登录成功",null==i)return e.msgType="error",e.msgInfo="车辆【 "+e.mVehicleNo+" 】不存在",e.isStop=!0,void clearInterval(e.timeLenOut);console.log("登录"),e.startVideo()},onOnOffline:function(t){0==t.online?(e.$Message.destroy(),e.msgType="error",e.msgInfo="车辆暂无视频数据，视屏画面即将关闭！",e.offLine=!0,e.timeOfflineOut=null,clearInterval(e.timeLenOut),e.timeOfflineOut=setInterval(function(){e.timeOffline--,e.timeOffline<=0&&(e.offLine=!1,e.stopVideo(e.msgInfo))},1e3)):(e.offLine=!1,console.log("重新执行"),e.reStart())},onSocketClose:function(){console.log("socket关闭了")},onServerConnectionLost:function(){e.$Message.destroy(),e.msgType="error",e.msgInfo="车辆【 "+e.mVehicleNo+" 】连接失败",e.stopVideo(e.msgInfo)},onStreamPlayStatus:function(t){switch(t){case STREAM_PLAY_STATE_REQUESTTING:e.msgInfo="",e.$Message.destroy(),e.$Message.loading({content:"正在请求视频......"}),clearInterval(e.timeLenOut);break;case STREAM_PLAY_STATE_REQ_STREAM_SUCCESS:e.msgInfo="",e.$Message.destroy(),e.$Message.loading({content:"请求完成,等待播放......"});break;case STREAM_PLAY_STATE_PLAY_STRAM_SUCCESS:e.$Message.destroy(),e.msgType="success",e.msgInfo="视频播放成功",e.isStop=!1;break;case STREAM_PLAY_STATE_PLAY_STRAM_FAILED:e.$Message.destroy(),e.msgType="error",e.msgInfo="视频播放失败",clearInterval(e.timeLenOut);break;default:e.$Message.destroy(),e.msgType="error",e.msgInfo="播放状态异常",clearInterval(e.timeLenOut)}},onGpsData:function(t){e.netnSignal=t.gps.net_signal}};window.vsclientSession=new VSClientSession(t),vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort),e.msgInfo="",e.$Message.destroy(),e.$Message.loading({content:"车辆【 "+e.mVehicleNo+" 】登录中......"}),clearInterval(e.timeLenOut)},updateVideoWin:function(e){for(var t=this,i=null,c=0;c<t.videoWinSplit.length;c++)if(t.videoWinSplit[c].count==e){i=t.videoWinSplit[c].param;break}if(null==i)return t.$Message.destroy(),t.msgType="error",t.msgInfo="分屏数据定义有误",void clearInterval(t.timeLenOut);for($("body").find(".videoItem").css("display","none"),c=0;c<e;c++){var o=$("body").find("#liveVideo"+c);if(null==o)return t.$Message.destroy(),t.msgType="error",t.msgInfo="当前视频窗口定义不存在",void clearInterval(t.timeLenOut);o.css({top:i[c].top,left:i[c].left,width:i[c].width,height:i[c].height,display:"block"})}t.splitNum=e,$("body").find("#liveVideo0").addClass("active")},getSplitNumFromChNum:function(e){return e<4?1:e<5?4:e<7?6:e<9?8:9},playVideo:function(e){var t=this;if(!e.online)return t.$Message.destroy(),t.msgType="error",t.msgInfo="车辆 【 "+t.mVehicleNo+" 】不在线",void clearInterval(t.timeLenOut);var i=e.channel_num,c=!1,o=t.getSplitNumFromChNum(i);t.$Message.destroy(),t.msgType="blue",t.msgInfo="车辆【"+t.mVehicleNo+"】，共【 "+i+" 】个通道",t.updateVideoWin(o);for(var n=0;n<i;n++)c=vsclientSession.startPlay(t.mVehicleNo,n,$("#video"+n)[0]);setTimeout(function(){t.playAudio(0)},1e3),c?(t.isStop=!0,t.msgInfo="",t.$Message.destroy(),t.$Message.loading({content:"正在请求视频......"}),clearInterval(t.timeLenOut),t.timeLenOut=null,setTimeout(function(){t.timeLenOut=setInterval(function(){t.timeLen--,t.$Message.destroy(),t.timeLen<=0&&t.stopVideo("视频已经全部关闭")},1e3)},5e3)):(t.$Message.destroy(),t.msgType="error",t.msgInfo="请求视频失败",clearInterval(t.timeLenOut))},reStart:function(){window.location.href=window.location.href},startVideo:function(){var e=this,t=vsclientSession.findFrontByName(e.mVehicleNo);if(null==t)return e.$Message.destroy(),e.msgType="error",e.msgInfo="车辆【 "+e.mVehicleNo+" 】不存在",e.isStop=!0,void clearInterval(e.timeLenOut);e.playVideo(t),e.timeLen<=0&&(e.timeLen=parseInt(e.timeSelect,10))},stopVideo:function(e){for(var t=this,i=0;i<t.mVideoCount;i++)vsclientSession.stopPlay($("body").find("#video"+i)[0]);t.isStop=!0,t.$Message.destroy(),t.msgType="error",t.msgInfo=e||"视频已经全部关闭",clearInterval(t.timeLenOut),clearInterval(t.timeOfflineOut),t.timeOffline=5,t.timeLen<=0&&(t.timeLen=parseInt(t.timeSelect)),t.stopAudio()},setFullScream:function(e){var t=this;t.isFullScream=!0,$("body").find("#"+e).parents(".videoWrap").addClass("fullScream"),t.runPrefixMethod($("body").find("#"+e).parents(".videoWrap")[0],"RequestFullScreen")},closeFullScream:function(e){var t=this;t.isFullScream=!1,$("body").find("#"+e).parents(".videoWrap").removeClass("fullScream"),t.runPrefixMethod(document,"CancelFullScreen")},playAudio:function(e){var t=this;t.channelIndex=e,vsclientSession.stopListening(),vsclientSession.startListening(t.mVehicleNo,t.channelIndex)},stopAudio:function(){var e=this;e.channelIndex=0,vsclientSession.stopListening()},runPrefixMethod:function(e,t){var i;return["webkit","moz","ms","o",""].forEach(function(c){if(!i){""===c&&(t=t.slice(0,1).toLowerCase()+t.slice(1));var o=typeof e[c+t];o+""!="undefined"&&(i="function"===o?e[c+t]():e[c+t])}}),i}},mounted:function(){var e=this;e.$Message.config({top:5,duration:0,closable:!0}),e.$Notice.config({top:5,duration:0,closable:!0}),e.init({port:7668,pwd:"888888",userName:"mgkj",ip:"220.231.225.7",vehicleNo:decodeURI(utility.getQueryParams().vehicleNo)})}});
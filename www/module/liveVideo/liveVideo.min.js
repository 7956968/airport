new Vue({el:"#js-vue",data:{mIP:"",mPort:"",mUserName:"",mPwd:"",mVehicleNo:"",mVideoCount:9,maxVideoNum:10,isStop:!0,netnSignal:"",msgType:"primary",msgInfo:"",isFullScream:!1,channelIndex:1,fullScreamIndex:"",defaultColor:"rgb(255,125,0)",splitNum:1,splitArea:[1,4,6,8,9],videoWinSplit:[{count:1,param:[{top:"0px",left:"0px",width:"calc(100% - 4px)",height:"calc(100% - 4px)"}]},{count:4,param:[{top:"0px",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"0px",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"}]},{count:6,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 2 - 6px)",height:"calc(100% / 3 * 2 - 8px)"},{top:"calc(100% / 3 * 2 - 4px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 1 - 0px)",width:"calc(100% / 3 * 1 - 6px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"0px",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 2px)",height:"calc(100% / 3 * 1 - 8px)"},{top:"calc(100% / 3 * 1 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]},{count:8,param:[{top:"0px",left:"0px",width:"calc(100% / 4 * 3 - 6px)",height:"calc(100% / 4 * 3 - 8px)"},{top:"calc(100% / 4 * 3 - 4px)",left:"0px",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 1 - 0px)",width:"calc(100% / 4 * 1 - 6px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 2 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 2px)",height:"calc(100% / 4 * 1)"},{top:"0px",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 1 - 2px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 2 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 4px)"}]},{count:9,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 2)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]}]},methods:{init:function(e){var t=this;if(t.mIP=e.ip,t.mPwd=e.pwd,t.mPort=e.port,t.mUserName=e.userName,t.mVehicleNo=e.vehicleNo,t.mVideoCount>t.maxVideoNum||t.mVideoCount<0)return t.$Message.destroy(),t.msgType="error",void(t.msgInfo="视频窗口数量有误");t.updateVideoWin(4),t.connectNet()},setCurrentStyle:function(e){$("body").find(".videoItem").removeClass("active"),$("body").find("#"+e).addClass("active")},connectNet:function(){var e=this,t={onLoginFailed:function(){e.$Message.destroy(),e.msgType="error",e.msgInfo="车辆 【"+e.mVehicleNo+"】登录失败",setTimeout(function(){vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort)},5e3)},onlogon:function(t){var c=vsclientSession.findFrontByName(e.mVehicleNo);if(e.$Message.destroy(),e.msgType="success",e.msgInfo="车辆 【"+e.mVehicleNo+"】登录成功",null==c)return e.msgType="error",void(e.msgInfo="车辆【 "+e.mVehicleNo+" 】不存在");e.isStop=!0,e.startVideo()},onServerConnectionLost:function(){e.$Message.destroy(),e.msgType="error",e.msgInfo="车辆【 "+e.mVehicleNo+" 】连接失败";for(var t=0;t<e.mVideoCount;t++)vsclientSession.stopPlay($("#video"+t)[0]);vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort)},onStreamPlayStatus:function(t){switch(t){case STREAM_PLAY_STATE_REQUESTTING:e.msgInfo="",e.$Message.destroy(),e.$Message.loading({content:"正在请求视频......"});break;case STREAM_PLAY_STATE_REQ_STREAM_SUCCESS:e.msgInfo="",e.$Message.destroy(),e.$Message.loading({content:"请求完成,等待播放......"});break;case STREAM_PLAY_STATE_PLAY_STRAM_SUCCESS:e.$Message.destroy(),e.msgType="success",e.msgInfo="视频播放成功",e.isStop=!1;break;case STREAM_PLAY_STATE_PLAY_STRAM_FAILED:e.$Message.destroy(),e.msgType="error",e.msgInfo="视频播放失败";break;default:e.$Message.destroy(),e.msgType="error",e.msgInfo="播放状态异常"}},onGpsData:function(t){e.netnSignal=t.gps.net_signal,console.log(e.netnSignal)}};window.vsclientSession=new VSClientSession(t),vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort),e.msgInfo="",e.$Message.destroy(),e.$Message.loading({content:"车辆【 "+e.mVehicleNo+" 】登录中......"})},updateVideoWin:function(e){for(var t=this,c=null,o=0;o<t.videoWinSplit.length;o++)if(t.videoWinSplit[o].count==e){c=t.videoWinSplit[o].param;break}if(null==c)return t.$Message.destroy(),t.msgType="error",void(t.msgInfo="分屏数据定义有误");for($("body").find(".videoItem").css("display","none"),o=0;o<e;o++){var i=$("body").find("#liveVideo"+o);if(null==i)return t.$Message.destroy(),t.msgType="error",void(t.msgInfo="当前视频窗口定义不存在");i.css({top:c[o].top,left:c[o].left,width:c[o].width,height:c[o].height,display:"block"})}t.splitNum=e,$("body").find("#liveVideo0").addClass("active")},getSplitNumFromChNum:function(e){return e<4?1:e<5?4:e<7?6:e<9?8:9},playVideo:function(e){var t=this;if(!e.online)return t.$Message.destroy(),t.msgType="error",void(t.msgInfo="车辆 【 "+t.mVehicleNo+" 】不在线");var c=e.channel_num,o=!1,i=t.getSplitNumFromChNum(c);t.$Message.destroy(),t.msgType="blue",t.msgInfo="车辆【"+t.mVehicleNo+"】，共【 "+c+" 】个通道",t.updateVideoWin(i);for(var l=0;l<c;l++)o=vsclientSession.startPlay(t.mVehicleNo,l,$("#video"+l)[0]),0==l&&t.playAudio(l+1);o?(t.isStop=!0,t.msgInfo="",t.$Message.destroy(),t.$Message.loading({content:"正在请求视频......"})):(t.$Message.destroy(),t.msgType="error",t.msgInfo="请求视频失败")},startVideo:function(){var e=this,t=vsclientSession.findFrontByName(e.mVehicleNo);if(null==t)return e.$Message.destroy(),e.msgType="error",void(e.msgInfo="车辆【 "+e.mVehicleNo+" 】不存在");e.playVideo(t)},stopVideo:function(){for(var e=this,t=0;t<e.mVideoCount;t++)vsclientSession.stopPlay($("body").find("#video"+t)[0]);e.isStop=!0,e.$Message.destroy(),e.msgType="success",e.msgInfo="视频全部关闭完成"},setFullScream:function(e){var t=this;t.isFullScream=!0,$("body").find("#"+e).parents(".videoWrap").addClass("fullScream"),t.runPrefixMethod($("body").find("#"+e).parents(".videoWrap")[0],"RequestFullScreen")},closeFullScream:function(e){var t=this;t.isFullScream=!1,$("body").find("#"+e).parents(".videoWrap").removeClass("fullScream"),t.runPrefixMethod(document,"CancelFullScreen")},playAudio:function(e){var t=this;t.channelIndex=e,vsclientSession.stopListening(),vsclientSession.startListening(t.mVehicleNo,e)},stopAudio:function(){var e=this;e.channelIndex=0,vsclientSession.stopListening()},runPrefixMethod:function(e,t){var c;return["webkit","moz","ms","o",""].forEach(function(o){if(!c){""===o&&(t=t.slice(0,1).toLowerCase()+t.slice(1));var i=typeof e[o+t];i+""!="undefined"&&(c="function"===i?e[o+t]():e[o+t])}}),c}},mounted:function(){var e=this,t=utility.getQueryParams();e.$Message.config({top:5,duration:0,closable:!0}),e.$Notice.config({top:5,duration:0,closable:!0}),e.init({port:7668,pwd:"888888",userName:"mgkj",ip:"220.231.225.7",vehicleNo:decodeURI(t.vehicleNo)})}});
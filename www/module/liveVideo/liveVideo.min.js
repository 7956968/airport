new Vue({el:"#js-vue",data:{isShowDetail:!0,vehicleInfo:JSON.parse(decodeURI(utility.getQueryParams().vehicleInfo)),queryInfo:utility.getQueryParams(),mIP:"220.231.225.7",mPort:7668,mUserName:"mgkj",mPwd:"888888",mVideoCount:9,maxVideoNum:10,isStop:!1,offLine:!1,timeOfflineOut:null,timeOffline:5,timeLen:120,timeSelect:"120",timeLenOut:null,netnSignal:"",msgType:"primary",msgInfo:"",isFullScream:!1,channelIndex:"-",fullScreamIndex:"",defaultColor:"rgb(255,125,0)",splitNum:1,connectTimeOut:null,dragAndDrop:{sourceEle:null,targetEle:null,sourceStyle:"",targetStyle:""},splitArea:[1,4,6,8,9],videoWinSplit:[{count:1,param:[{top:"0px",left:"0px",width:"calc(100% - 4px)",height:"calc(100% - 4px)"}]},{count:4,param:[{top:"0px",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"0px",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"0px",width:"calc(50% - 4px)",height:"calc(50% - 4px)"},{top:"50%",left:"50%",width:"calc(50% - 4px)",height:"calc(50% - 4px)"}]},{count:6,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 2 - 6px)",height:"calc(100% / 3 * 2 - 8px)"},{top:"calc(100% / 3 * 2 - 4px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 1 - 0px)",width:"calc(100% / 3 * 1 - 6px)",height:"calc(100% / 3 * 1)"},{top:"calc(100% / 3 * 2 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1)"},{top:"0px",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 2px)",height:"calc(100% / 3 * 1 - 8px)"},{top:"calc(100% / 3 * 1 - 4px)",left:"calc(100% / 3 * 2 - 2px)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]},{count:8,param:[{top:"0px",left:"0px",width:"calc(100% / 4 * 3 - 6px)",height:"calc(100% / 4 * 3 - 8px)"},{top:"calc(100% / 4 * 3 - 4px)",left:"0px",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 1 - 0px)",width:"calc(100% / 4 * 1 - 6px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 2 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1)"},{top:"calc(100% / 4 * 3 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 2px)",height:"calc(100% / 4 * 1)"},{top:"0px",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 1 - 2px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 6px)"},{top:"calc(100% / 4 * 2 - 4px)",left:"calc(100% / 4 * 3 - 2px)",width:"calc(100% / 4 * 1 - 4px)",height:"calc(100% / 4 * 1 - 4px)"}]},{count:9,param:[{top:"0px",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"0px",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 6px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 1 - 2px)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 2px)"},{top:"calc(100% / 3 * 2)",left:"0px",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 1)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"},{top:"calc(100% / 3 * 2)",left:"calc(100% / 3 * 2)",width:"calc(100% / 3 * 1 - 4px)",height:"calc(100% / 3 * 1 - 4px)"}]}]},methods:{init:function(){var e=this;if(e.mVideoCount>e.maxVideoNum||e.mVideoCount<0)return e.$Message.destroy(),e.msgType="error",void(e.msgInfo="视频窗口数量有误");e.updateVideoWin(4),e.connectNet()},onTimeChange:function(e){var t=this;t.timeLen=parseInt(e,10)},setCurrentStyle:function(e){$("body").find(".videoItem").removeClass("active"),$("body").find("#"+e).addClass("active")},connectNet:function(){var e=this,t={onLoginFailed:function(){e.$Message.destroy(),e.msgType="error",e.msgInfo="车辆 【"+e.vehicleInfo.licenseNumber+"】登录失败",clearInterval(e.timeLenOut),setTimeout(function(){vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort)},3e3)},onlogon:function(t){var n=vsclientSession.findFrontByName(e.vehicleInfo.licenseNumber);if(e.$Message.destroy(),e.msgType="success",e.msgInfo="车辆 【"+e.vehicleInfo.licenseNumber+"】登录成功",null==n)return e.msgType="error",e.msgInfo="车辆【 "+e.vehicleInfo.licenseNumber+" 】不存在",e.isStop=!0,void clearInterval(e.timeLenOut);console.log("登录"),e.startVideo()},onOnOffline:function(t){0==t?(e.$Message.destroy(),e.msgType="error",e.msgInfo="车辆【 "+e.vehicleInfo.licenseNumber+" 】已经下线",e.isStop=!0,e.timeOfflineOut=null,clearInterval(e.timeLenOut),e.timeOfflineOut=setInterval(function(){e.timeOffline--,e.timeOffline<=0&&e.stopVideo(e.msgInfo)},1e3)):(vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort),e.msgInfo="",e.$Message.destroy(),e.$Message.loading({content:"车辆【 "+e.vehicleInfo.licenseNumber+" 】登录中......"}))},onServerConnectionLost:function(){e.$Message.destroy(),e.msgType="error",e.msgInfo="车辆【 "+e.vehicleInfo.licenseNumber+" 】连接失败",e.stopVideo(e.msgInfo)},onStreamPlayStatus:function(t){switch(t){case STREAM_PLAY_STATE_REQUESTTING:e.msgInfo="",e.$Message.destroy(),e.$Message.loading({content:"正在请求视频......"}),clearInterval(e.timeLenOut);break;case STREAM_PLAY_STATE_REQ_STREAM_SUCCESS:e.msgInfo="",e.$Message.destroy();break;case STREAM_PLAY_STATE_PLAY_STRAM_SUCCESS:e.$Message.destroy(),e.msgType="success",e.msgInfo="",e.isStop=!1;break;case STREAM_PLAY_STATE_PLAY_STRAM_FAILED:e.$Message.destroy(),e.msgType="error",e.msgInfo="视频播放失败",clearInterval(e.timeLenOut);break;default:e.$Message.destroy(),e.msgType="error",e.msgInfo="播放状态异常",clearInterval(e.timeLenOut)}},onGpsData:function(t){e.netnSignal=t.gps.net_signal}};window.vsclientSession=new VSClientSession(t),vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort),e.msgInfo="",e.$Message.destroy(),e.$Message.loading({content:"车辆【 "+e.vehicleInfo.licenseNumber+" 】登录中......"}),clearInterval(e.timeLenOut)},updateVideoWin:function(e){for(var t=this,n=null,i=0;i<t.videoWinSplit.length;i++)if(t.videoWinSplit[i].count==e){n=t.videoWinSplit[i].param;break}if(null==n)return t.$Message.destroy(),t.msgType="error",t.msgInfo="分屏数据定义有误",void clearInterval(t.timeLenOut);for($("body").find(".videoItem").css("display","none"),i=0;i<e;i++){var c=$("body").find("#liveVideo"+i);if(null==c)return t.$Message.destroy(),t.msgType="error",t.msgInfo="当前视频窗口定义不存在",void clearInterval(t.timeLenOut);c.css({top:n[i].top,left:n[i].left,width:n[i].width,height:n[i].height,display:"block"})}t.splitNum=e,$("body").find("#liveVideo0").addClass("active")},getSplitNumFromChNum:function(e){return e<4?1:e<5?4:e<7?6:e<9?8:9},playVideo:function(e){var t=this;if(!e.online)return t.$Message.destroy(),t.msgType="error",t.isStop=!0,t.msgInfo="车辆【 "+t.vehicleInfo.licenseNumber+" 】已经下线",void clearInterval(t.timeLenOut);var n=e.channel_num,i=!1;t.$Message.destroy(),t.msgType="blue";for(var c=0;c<n;c++)i=vsclientSession.startPlay(t.vehicleInfo.licenseNumber,c,$("#video"+c)[0]);i?(t.isStop=!1,t.msgInfo="",t.$Message.destroy(),t.$Message.loading({content:"正在请求视频......"}),setInterval(function(){for(var e=0;e<n;e++)$("#video"+e)[0].play()},3e3),clearInterval(t.timeLenOut),t.timeLenOut=null,setTimeout(function(){t.timeLenOut=setInterval(function(){t.timeLen--,t.$Message.destroy(),t.timeLen<=0&&t.stopVideo("视频已经全部关闭")},1e3),t.stopAudio(),setTimeout(function(){$("body").find("#playAudio_0").on("click"),$("body").find("#playAudio_0").trigger("click")},3e3)},15e3)):(t.$Message.destroy(),t.msgType="error",t.msgInfo="请求视频失败",clearInterval(t.timeLenOut))},reStart:function(){var e=this;vsclientSession.login(e.mUserName,e.mPwd,e.mIP,e.mPort),e.msgInfo="",e.$Message.destroy(),e.$Message.loading({content:"车辆【 "+e.vehicleInfo.licenseNumber+" 】登录中......"}),clearInterval(e.timeLenOut)},startVideo:function(){var e=this,t=vsclientSession.findFrontByName(e.vehicleInfo.licenseNumber);if(null==t)return e.$Message.destroy(),e.msgType="error",e.msgInfo="车辆【 "+e.vehicleInfo.licenseNumber+" 】不存在",e.isStop=!0,void clearInterval(e.timeLenOut);e.playVideo(t),e.timeLen<=0&&(e.timeLen=parseInt(e.timeSelect,10))},stopVideo:function(e){for(var t=this,n=0;n<t.mVideoCount;n++)vsclientSession.stopPlay($("body").find("#video"+n)[0]);t.isStop=!0,t.$Message.destroy(),t.msgType="error",t.msgInfo="string"==typeof e?e:"视频已经全部关闭",clearInterval(t.timeLenOut),clearInterval(t.timeOfflineOut),t.timeOffline=5,t.timeLen<=0&&(t.timeLen=parseInt(t.timeSelect)),t.stopAudio()},setFullScream:function(e){var t=this;t.isFullScream=!0,$("body").find("#"+e).parents(".videoWrap").addClass("fullScream"),t.runPrefixMethod($("body").find("#"+e).parents(".videoWrap")[0],"RequestFullScreen")},closeFullScream:function(e){var t=this;t.isFullScream=!1,$("body").find("#"+e).parents(".videoWrap").removeClass("fullScream"),t.runPrefixMethod(document,"CancelFullScreen")},playAudio:function(e){var t=this;t.channelIndex=e,vsclientSession.stopListening(),setTimeout(function(){vsclientSession.startListening(t.vehicleInfo.licenseNumber,t.channelIndex)},1e3)},stopAudio:function(){var e=this;e.channelIndex="-",vsclientSession.stopListening()},runPrefixMethod:function(e,t){var n;return["webkit","moz","ms","o",""].forEach(function(i){if(!n){""===i&&(t=t.slice(0,1).toLowerCase()+t.slice(1));var c=typeof e[i+t];c+""!="undefined"&&(n="function"===c?e[i+t]():e[i+t])}}),n},dragEnd:function(e){var t=this,n=$(e.srcElement);t.dragAndDrop.sourceEle=n,t.dragAndDrop.sourceStyle=n.attr("style")},drop:function(e){var t=this,n=$(e.srcElement).parents(".videoItem");e.preventDefault(),t.dragAndDrop.targetEle=n,t.dragAndDrop.targetStyle=n.attr("style"),setTimeout(function(){t.dragAndDrop.targetEle.attr("style",t.dragAndDrop.sourceStyle),t.dragAndDrop.sourceEle.attr("style",t.dragAndDrop.targetStyle)},250)},dragOver:function(e){e.preventDefault()},backPage:function(){window.close()}},mounted:function(){var e=this;e.$Message.config({top:5,duration:0,closable:!0}),e.$Notice.config({top:5,duration:0,closable:!0}),e.init()}});
(function(){var e=utility.getLocalStorage("language"),i=utility.getLocalStorage("userInfo"),t=utility.getLocalStorage("bizParam"),a=new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isShowTerminal:!1,isModalLoading:!0,modalTitle:"",tableHeight:function(){var e=$(".tableContainer").height();return e-100}(),vehicleColorList:t.vehicleColor,vehicleTypeList:t.vehicleType,vehicleBrandList:t.vehicleBrand,vehicleStatuList:t.terminalStatus,index:0,selectItem:null,itemInfo:{id:"",companyId:"",companyName:"",vehicleName:"",vehicleCode:"",remark:"",vehicleColorId:"",vehicleTypeId:"",vehicleBrandId:"",deptId:[],deptName:"",gpsDeviceId:"",gpsDeviceCode:"",vehicleStatus:""},pageInfo:{count:0,pageSize:20,pageNum:0,companyId:"",deptId:[],bindDeviceFlag:"",vehicleName:"",vehicleCode:"",gpsDeviceId:"",vehicleColorId:"",vehicleTypeId:"",vehicleBrandId:"",createUserId:i.id,modifyUserId:i.id},vehicleList:[],columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"公司",EN:"Company",TW:"公司"}[e.language],key:"companyId"},{title:{CN:"部门",EN:"Department",TW:"部門"}[e.language],key:"deptId"},{title:{CN:"车辆名称",EN:"Vehicle Name",TW:"車輛名稱"}[e.language],key:"vehicleName"},{title:{CN:"车辆编码",EN:"Vehicle Name",TW:"車輛編碼"}[e.language],key:"vehicleCode"},{title:{CN:"状态",EN:"State",TW:"狀態"}[e.language],key:"vehicleStatus"},{title:{CN:"绑定终端",EN:"Terminal",TW:"綁定終端"}[e.language],key:"gpsDeviceId"},{title:{CN:"车辆类型",EN:"Vehicle Type",TW:"車輛類型"}[e.language],key:"vehicleTypeId"},{title:{CN:"车辆颜色",EN:"Vehicle Color",TW:"車輛顔色"}[e.language],key:"vehicleColorId"},{title:{CN:"品牌",EN:"Brand",TW:"品牌"}[e.language],key:"vehicleBrandId"},{title:{CN:"操作",EN:"Operation",TW:"操作"}[e.language],key:"operation",width:180,render:function(i,t){return i("div",[i("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){a.index=t.index,a.selectItem=t.row,a.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[e.language]),i("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){a.index=t.index,a.selectItem=t.row,a.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[e.language]),i("Button",{props:{type:"error",size:"small"},on:{click:function(){a.index=t.index,a.selectItem=t.row,a.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[e.language])])}}],dataList:[],companyList:[],departmentList:[],terminalList:[]},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",companyId:"",companyName:"",vehicleName:"",vehicleCode:"",remark:"",vehicleColorId:"",vehicleTypeId:"",vehicleBrandId:"",deptId:[],deptName:"",gpsDeviceId:"",gpsDeviceCode:"",vehicleStatus:"",createUserId:i.id,modifyUserId:i.id}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.vehicleList[e.index],e.itemInfo.deptId=[e.vehicleList[e.index].deptId],e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.vehicleList[e.index],e.itemInfo.deptId=[e.vehicleList[e.index].deptId],e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.vehicleList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.delVehicle+"&ids="+e.itemInfo.id+"&modifyUserId="+i.id,actionUrl:CONFIG.SERVICE.vehicleService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(i){200==i.code?e.getVehicleList(!1):e.$Message.error(i.message)}})})}})},pageSizeChange:function(e){var i=this;i.pageInfo.pageNum=parseInt(e,10),setTimeout(function(){i.getVehicleList(!1)},200)},pageRowChange:function(e){var i=this;i.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){i.getVehicleList(!1)},200)},setCurrentRowData:function(e,i){var t=this;t.index=i,t.selectItem=e},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.saveVehicle,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{id:e.itemInfo.id,companyId:e.itemInfo.companyId,deptId:e.itemInfo.deptId[e.itemInfo.deptId.length-1],vehicleName:encodeURI(e.itemInfo.vehicleName),vehicleCode:encodeURI(e.itemInfo.vehicleCode),gpsDeviceId:e.itemInfo.gpsDeviceId,vehicleColorId:e.itemInfo.vehicleColorId,vehicleTypeId:e.itemInfo.vehicleTypeId,vehicleBrandId:e.itemInfo.vehicleBrandId,remark:encodeURI(e.itemInfo.remark),createUserId:i.id,modifyUserId:i.id},completeCallback:function(){e.isModalLoading=!1},successCallback:function(i){200==i.code?(e.getVehicleList(!1),e.isShowModal=!1):e.$Message.error(i.message)}})},formatVehicle:function(){for(var e=this,i=0,t=e.vehicleList.length;i<t;i++)e.dataList.push({companyId:e.vehicleList[i].companyName,deptId:e.vehicleList[i].deptName,vehicleName:decodeURI(e.vehicleList[i].vehicleName),vehicleCode:decodeURI(e.vehicleList[i].vehicleCode),gpsDeviceId:e.vehicleList[i].gpsDeviceCode,vehicleColorId:function(){for(var t="",a=0,n=e.vehicleColorList.length;a<n;a++)if(e.vehicleList[i].vehicleColorId==e.vehicleColorList[a].type){t=e.vehicleColorList[a].name;break}return t}(),vehicleTypeId:function(){for(var t="",a=0,n=e.vehicleTypeList.length;a<n;a++)if(e.vehicleList[i].vehicleTypeId==e.vehicleTypeList[a].type){t=e.vehicleTypeList[a].name;break}return t}(),vehicleBrandId:function(){for(var t="",a=0,n=e.vehicleBrandList.length;a<n;a++)if(e.vehicleList[i].vehicleBrandId==e.vehicleBrandList[a].type){t=e.vehicleBrandList[a].name;break}return t}(),vehicleStatus:function(){for(var t="",a=0,n=e.vehicleStatuList.length;a<n;a++)if(e.vehicleList[i].vehicleStatus==e.vehicleStatuList[a].type){t=e.vehicleStatuList[a].name;break}return t}()})},getVehicleList:function(e){var t=this;t.dataList=[],1==e&&(t.pageInfo.pageNum=1),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{createUserId:i.id,modifyUserId:i.id,pageNum:t.pageInfo.pageNum,pageSize:t.pageInfo.pageSize,companyId:t.pageInfo.companyId,vehicleName:t.pageInfo.vehicleName,vehicleCode:t.pageInfo.vehicleCode,gpsDeviceId:t.pageInfo.gpsDeviceId,vehicleTypeId:t.pageInfo.vehicleTypeId,bindDeviceFlag:t.pageInfo.bindDeviceFlag,vehicleColorId:t.pageInfo.vehicleColorId,vehicleBrandId:t.pageInfo.vehicleBrandId,deptId:t.pageInfo.deptId[t.pageInfo.deptId.length-1]},beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.vehicleList=e.data,t.pageInfo.count=e.count,t.formatVehicle())}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(i){200==i.code&&(e.companyList=i.data)}})},getTerminalList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.getDeviceList,actionUrl:CONFIG.SERVICE.deviceService,dataObj:{id:0,pageSize:1e4},successCallback:function(i){200==i.code&&(e.terminalList=i.data)}})},formatSuperiorDeprt:function(e){var i=this,t=JSON.stringify(e).replace(/id/g,"value").replace(/deptName/g,"label").replace(/subDeptList/g,"children");i.departmentList=JSON.parse(t)},getDepartmentList:function(e){var i=this;i.departmentList=[],i[e].deptId=[],utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptTreeList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:0,pageSize:1e4,companyId:i[e].companyId||0},successCallback:function(e){200==e.code&&i.formatSuperiorDeprt(e.data)}})}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getVehicleList(!0),e.getCompanyList(),e.getTerminalList(),e.getDepartmentList("pageInfo")},500)}})})();
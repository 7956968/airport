(function(){var e,t=utility.getLocalStorage("language"),i=utility.getLocalStorage("userInfo"),s=utility.getLocalStorage("bizParam"),a=new Vue({el:"#js-vue",data:{language:t?t.language:"CN",isTableLoading:!0,isShowModal:!1,isShowReset:!1,isShowDetail:!1,isModalLoading:!0,modalTitle:"",tableHeight:(e=$(".tableContainer").height(),e-100),index:0,selectItem:null,itemInfo:{id:"",userCode:"",userPwd:"",companyId:"",userSeq:"",userName:"",sex:"",birthday:"",mobile:"",telephone:"",email:"",remark:"",status:"",idNo:"",address:"",deptIds:[],isCompanyAdmin:"",roleIds:"",roleIdList:[],deptId:"",posiType:"",posiName:"",createUserId:i.id,modifyUserId:i.id},pageInfo:{id:0,count:0,userCode:"",userName:"",companyId:"",deptId:"",deptIds:[]},page:{pageNum:1,pageSize:20},columnsList:[{type:"index",width:60,align:"center",title:"序号",fixed:"left"},{title:"公司",key:"companyName",fixed:"left",width:180},{title:"部门",key:"deptName",fixed:"left",width:180},{title:{CN:"姓名",EN:"Name",TW:"姓名"}[t.language],key:"userName",width:120},{title:{CN:"账号",EN:"Account",TW:"帳號"}[t.language],key:"userCode",width:120},{title:"角色",key:"roleNames",width:150},{title:"是否公司管理员",key:"isCompanyAdmin",width:120,align:"center"},{title:{CN:"状态",EN:"State",TW:"狀態"}[t.language],key:"state",width:120,align:"center"},{title:"职位类型",key:"posiType",width:120},{title:"职位名称\t",key:"posiName",width:120},{title:{CN:"手机号",EN:"cellPhone No.",TW:"手機號"}[t.language],key:"mobile",width:120},{title:{CN:"员工工号",EN:"Staff Number",TW:"員工工號"}[t.language],key:"userSeq",width:120},{title:{CN:"备注",EN:"Remarks",TW:"備註"}[t.language],key:"remark",width:180},{title:{CN:"操作",EN:"Operation",TW:"操作"}[t.language],key:"operation",width:150,fixed:"right",align:"center",render:function(e,i){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){a.index=i.index,a.selectItem=i.row,a.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[t.language]),e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){a.index=i.index,a.selectItem=i.row,a.editItem()}}},{CN:"编辑",EN:"Edite",TW:"編輯"}[t.language]),e("Button",{props:{type:"error",size:"small"},on:{click:function(){a.index=i.index,a.selectItem=i.row,a.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[t.language])])}}],tableRowList:[],superiorCompanyList:[],userList:[],companyList:[],sexTypeList:s.sexType,userStatusTypeList:s.userStatusType,roleList:[],superiorDepartmentList:[],posiTypeInfo:{_141:"正负责人",_142:"副负责人",_143:"员工"}},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",userCode:"",userPwd:"",companyId:"",userSeq:"",userName:"",sex:"",birthday:"",mobile:"",telephone:"",email:"",remark:"",status:"",idNo:"",address:"",deptIds:[],isCompanyAdmin:"",roleIds:"",roleIdList:[],deptId:"",posiType:"",posiName:"",createUserId:i.id,modifyUserId:i.id}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.userList[e.index],e.itemInfo.roleIdList=function(){for(var t=[],i=e.itemInfo.roleIds.split(","),s=0,a=i.length;s<a;s++)t.push(parseInt(i[s],10));return t}(),e.itemInfo.userName=decodeURI(e.itemInfo.userName),e.itemInfo.remark=decodeURI(e.itemInfo.remark),e.itemInfo.address=decodeURI(e.itemInfo.address),e.itemInfo.posiName=decodeURI(e.itemInfo.posiName),e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language],e.getSuperiorDeprtList("itemInfo"),e.getRoleDataList()})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.userList[e.index],e.itemInfo.userName=decodeURI(e.itemInfo.userName),e.itemInfo.remark=decodeURI(e.itemInfo.remark),e.itemInfo.address=decodeURI(e.itemInfo.address),e.itemInfo.posiName=decodeURI(e.itemInfo.posiName),e.itemInfo.sexName=function(){for(var t="",i=0,s=e.sexTypeList.length;i<s;i++)if(e.sexTypeList[i].type==e.itemInfo.sex){t=e.sexTypeList[i].name;break}return t}(),e.itemInfo.statusName=function(){for(var t="",i=0,s=e.userStatusTypeList.length;i<s;i++)if(e.userStatusTypeList[i].type==e.itemInfo.status){t=e.userStatusTypeList[i].name;break}return t}(),e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",content:"<p>账号："+e.userList[e.index].userCode+"</p><p>用户："+e.userList[e.index].userName+"</p>",width:300,onOk:function(){e.itemInfo=e.userList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.delUser+"&ids="+e.itemInfo.id+"&modifyUserId="+i.id,actionUrl:CONFIG.SERVICE.userService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code?e.getUserList(!0):e.$Message.error(t.message)}})})}})},pageSizeChange:function(e){var t=this;t.page.pageNum=parseInt(e,10),setTimeout(function(){t.getUserList(!1)},200)},pageRowChange:function(e){var t=this;t.page.pageSize=parseInt(e,10),setTimeout(function(){t.getUserList(!1)},200)},setCurrentRowData:function(e,t){var i=this;e&&(i.index=t,i.selectItem=e)},uploadDataToServer:function(e){var t=this,s=utility.getDateDetailInfo(t.itemInfo.birthday);if(t.$Message.config({top:150,duration:3}),0!=t.itemInfo.deptIds.length){if(!t.itemInfo.posiType)return t.$Message.error("请选择职位类型"),t.isModalLoading=!1,!1;if(utility.checkLen(t.itemInfo.posiName,0))return t.$Message.error("请填写职位名称"),t.isModalLoading=!1,!1}utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.saveUser,actionUrl:CONFIG.SERVICE.userService,dataObj:{id:t.itemInfo.id,userCode:t.itemInfo.userCode,userPwd:t.itemInfo.userPwd,companyId:t.itemInfo.companyId,userSeq:t.itemInfo.userSeq,userName:encodeURI(t.itemInfo.userName),sex:t.itemInfo.sex,birthday:s.year+"-"+s.month+"-"+s.date,mobile:t.itemInfo.mobile,telephone:t.itemInfo.telephone,email:t.itemInfo.email,remark:encodeURI(t.itemInfo.remark),status:t.itemInfo.status,idNo:t.itemInfo.idNo,address:encodeURI(t.itemInfo.address),isCompanyAdmin:t.itemInfo.isCompanyAdmin||0,roleIds:t.itemInfo.roleIdList.join(","),deptId:t.itemInfo.deptIds[t.itemInfo.deptIds.length-1],posiType:t.itemInfo.posiType,posiName:encodeURI(t.itemInfo.posiName),createUserId:i.id,modifyUserId:i.id},completeCallback:function(){t.isModalLoading=!1},successCallback:function(e){200==e.code?(t.getUserList(!0),t.isShowModal=!1):t.$Message.error(e.message)}})},formatTableList:function(){for(var e=this,t=0,i=e.userList.length;t<i;t++)e.tableRowList.push({userCode:e.userList[t].userCode,userName:decodeURI(e.userList[t].userName),userSeq:e.userList[t].userSeq,mobile:e.userList[t].mobile,telephone:e.userList[t].telephone,companyName:decodeURI(e.userList[t].companyName),posiName:decodeURI(e.userList[t].posiName),roleNames:decodeURI(e.userList[t].roleNames),deptName:decodeURI(e.userList[t].deptName),posiType:e.posiTypeInfo["_"+e.userList[t].posiType],isCompanyAdmin:e.userList[t].isCompanyAdmin?"是":"否",remark:decodeURI(e.userList[t].remark),sex:function(){for(var i="",s=0,a=e.sexTypeList.length;s<a;s++)if(e.sexTypeList[s].type==e.userList[t].sex){i=e.sexTypeList[s].name;break}return i}(),state:function(){for(var i="",s=0,a=e.userStatusTypeList.length;s<a;s++)if(e.userStatusTypeList[s].type==e.userList[t].status){i=e.userStatusTypeList[s].name;break}return i}()})},getUserList:function(e){var t=this;t.tableRowList=[],1==e&&(t.pageInfo.pageNum=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.getUserList,actionUrl:CONFIG.SERVICE.userService,dataObj:{pageNum:t.page.pageNum,pageSize:t.page.pageSize,userCode:encodeURI(t.pageInfo.userCode),userName:encodeURI(t.pageInfo.userName),companyId:t.pageInfo.companyId,deptId:t.pageInfo.deptIds[t.pageInfo.deptIds.length-1]},beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.userList=e.data,t.pageInfo.count=e.count,t.formatTableList())}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(t){200==t.code&&(e.companyList=t.data)}})},getRoleDataList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.permissionService+"?action="+CONFIG.ACTION.getRoleList,actionUrl:CONFIG.SERVICE.permissionService,dataObj:{companyId:e.itemInfo.companyId,pageNum:1,pageSize:1e5},successCallback:function(t){if(200==t.code&&(e.roleList=t.data,0==e.roleList.length))for(var i=0,s=e.companyList.length;i<s;i++)if(e.itemInfo.companyId==e.companyList[i].id)return void e.$Message.error(e.companyList[i].companyName+"没有可用角色")}})},getSuper:function(e,t,i){for(var s=this,a=0,o=e.length;a<o;a++)if(e[a].value==t){if(i.push(t),0==e[a].paraDeptId)return;s.getSuper(s.superiorDepartmentList,e[a].paraDeptId,i)}else s.getSuper(e[a].children,t,i)},formatSuperiorDeprt:function(e){var t=this,i=JSON.stringify(e).replace(/id/g,"value").replace(/deptName/g,"label").replace(/subDeptList/g,"children");t.superiorDepartmentList=JSON.parse(i)},getSuperiorDeprtList:function(e){var t=this;t.superiorDepartmentList=[],t.getRoleDataList(),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptTreeList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:0,pageSize:1e4,companyId:t[e].companyId||0},successCallback:function(i){if(200==i.code){var s=[];t[e].deptIds=[],t.formatSuperiorDeprt(i.data),t.getSuper(t.superiorDepartmentList,t[e].deptId,s),t[e].deptIds=s.reverse()}}})}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getUserList(!0),e.getCompanyList(),e.$watch("pageInfo",function(){e.getUserList(!0)},{deep:!0})},500)}})})();
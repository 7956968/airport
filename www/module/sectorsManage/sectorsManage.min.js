(function(){var e,t,a=utility.getLocalStorage("language"),i=utility.getLocalStorage("userInfo"),n=utility.getLocalStorage("bizParam"),s=utility.getLocalStorage("userFuncList"),o=new Vue({el:"#js-vue",data:{language:a?a.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isModalLoading:!0,modalTitle:"",defensFunc:(t=JSON.stringify(s.menu_map),-1!=t.indexOf("device_manage_secure_area")),tableHeight:(e=$(".tableContainer").height(),e-100),secureAreaStatusList:n.secureAreaStatus,secureAreaLimitTypeList:n.secureAreaLimitType,index:0,selectItem:null,itemInfo:{id:"",companyId:"",companyName:"",areaName:"",areaCode:"",secureStatus:"",areaRange:"",speedLimit:"",staySecond:""},pageInfo:{areaName:"",companyId:"",secureStatus:"",canEnter:"",canExit:"",canStay:""},page:{count:0,pageSize:20,pageNum:0},columnsList:[{type:"index",align:"center",title:"序号",width:60},{title:{CN:"公司",EN:"Company",TW:"公司"}[a.language],key:"companyName",width:180},{title:{CN:"名称",EN:"Name",TW:"名稱"}[a.language],key:"areaName"},{title:{CN:"编码",EN:"Code",TW:"編碼"}[a.language],key:"areaCode"},{title:{CN:"状态",EN:"Status",TW:"狀態"}[a.language],key:"secureStatus"},{title:{CN:"速度上限",EN:"Speed Limit",TW:"速度上限"}[a.language],key:"speedLimit"},{title:{CN:"停留时长",EN:"Length Of Stay",TW:"停留時長"}[a.language],key:"staySecond"},{title:{CN:"操作",EN:"Operation",TW:"操作"}[a.language],key:"operation",width:240,render:function(e,t){var i=JSON.stringify(s.menu_map),n="",r=null,c=null;return-1!=i.indexOf("device_manage_secure_area")?(n={CN:"编辑",EN:"Edite",TW:"編輯"}[a.language],r=e("Button",{props:{type:"error",size:"small"},on:{click:function(){o.index=t.index,o.selectItem=t.row,o.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[a.language])):n={CN:"查看",EN:"View",TW:"查看"}[a.language],c=e("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.index=t.index,o.selectItem=t.row,o.toMapPageDefense(t.row)}}},"查看地图"),e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.index=t.index,o.selectItem=t.row,o.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[a.language]),e("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){o.index=t.index,o.selectItem=t.row,o.editItem()}}},n),c,r])}}],dataList:[{id:1,number:"编号",name:"名称",active:"是否激活"}],defensList:[],companyList:[]},watch:{},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",companyId:"",companyName:"",areaName:"",areaCode:"",secureStatus:"",areaRange:"",speedLimit:"",staySecond:""}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.defensList[e.index])),e.itemInfo.remark=decodeURI(e.defensList[e.index].remark),e.itemInfo.canEnter=e.itemInfo.canEnter||720,e.itemInfo.canExit=e.itemInfo.canExit||720,e.itemInfo.canStay=e.itemInfo.canStay||720,e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.defensList[e.index],e.itemInfo.remark=decodeURI(e.defensList[e.index].remark),e.itemInfo.secureStatusName=function(){for(var t="",a=0,i=e.secureAreaStatusList.length;a<i;a++)if(e.secureAreaStatusList[a].type==e.itemInfo.secureStatus){t=e.secureAreaStatusList[a].name;break}return t}(),e.itemInfo.canEnterName=function(){for(var t="",a=0,i=e.secureAreaLimitTypeList.length;a<i;a++){e.secureAreaLimitTypeList[a].type,e.itemInfo.canEnter,t=e.secureAreaLimitTypeList[a].name;break}return t}(),e.itemInfo.canStayName=function(){for(var t="",a=0,i=e.secureAreaLimitTypeList.length;a<i;a++){e.secureAreaLimitTypeList[a].type,e.itemInfo.canStay,t=e.secureAreaLimitTypeList[a].name;break}return t}(),e.itemInfo.canExitName=function(){for(var t="",a=0,i=e.secureAreaLimitTypeList.length;a<i;a++){e.secureAreaLimitTypeList[a].type,e.itemInfo.canExit,t=e.secureAreaLimitTypeList[a].name;break}return t}(),e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.defensList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.delSecureArea+"&ids="+e.itemInfo.id+"&modifyUserId="+i.id,actionUrl:CONFIG.SERVICE.areaService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code?e.getDefensAreaList(!0):e.$Message.error(t.message)}})})}})},pageSizeChange:function(e){var t=this;t.page.pageNum=parseInt(e,10),setTimeout(function(){t.getDefensAreaList(!1)},200)},pageRowChange:function(e){var t=this;t.page.pageSize=parseInt(e,10),setTimeout(function(){t.getDefensAreaList(!0)},200)},setCurrentRowData:function(e,t){var a=this;a.index=t,a.selectItem=e},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.saveSecureArea,actionUrl:CONFIG.SERVICE.areaService,dataObj:{id:e.itemInfo.id,opType:2,companyId:e.itemInfo.companyId,deptId:e.itemInfo.deptId,areaName:encodeURI(e.itemInfo.areaName),areaCode:encodeURI(e.itemInfo.areaCode),secureStatus:e.itemInfo.secureStatus,areaRangeStr:e.itemInfo.areaRange,speedLimit:e.itemInfo.speedLimit,staySecond:e.itemInfo.staySecond,remark:encodeURI(e.itemInfo.remark),createUserId:e.itemInfo.createUserId,modifyUserId:e.itemInfo.modifyUserId},completeCallback:function(){e.isModalLoading=!1},successCallback:function(t){200==t.code?e.getDefensAreaList(!0):e.$Message.error(t.message)}})},formatDefensData:function(){for(var e=this,t=0,a=e.defensList.length;t<a;t++)e.dataList.push({companyName:decodeURI(e.defensList[t].companyName),areaName:decodeURI(e.defensList[t].areaName),areaCode:decodeURI(e.defensList[t].areaCode),canEnter:e.defensList[t].canEnter||720,canExit:e.defensList[t].canExit||720,canStay:e.defensList[t].canStay||720,areaRange:e.defensList[t].areaRange,secureStatus:function(){for(var a="",i=0,n=e.secureAreaStatusList.length;i<n;i++)if(e.secureAreaStatusList[i].type==e.defensList[t].secureStatus){a=e.secureAreaStatusList[i].name;break}return a}(),speedLimit:e.defensList[t].speedLimit,staySecond:e.defensList[t].staySecond})},getDefensAreaList:function(e){var t=this;t.dataList=[],t.defensList=[],1==e&&(t.page.pageNum=0,t.page.count=0),setTimeout(function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.getSecureAreaList,actionUrl:CONFIG.SERVICE.areaService,dataObj:{pageNum:t.page.pageNum,pageSize:t.page.pageSize,areaName:encodeURI(t.pageInfo.areaName),companyId:t.pageInfo.companyId,secureStatus:t.pageInfo.secureStatus,canEnter:t.pageInfo.canEnter,canExit:t.pageInfo.canExit,canStay:t.pageInfo.canStay},beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.defensList=e.data,t.page.count=e.count,t.formatDefensData())}})},500)},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(t){200==t.code&&(e.companyList=t.data)}})},toMapPage:function(){utility.setSessionStorage("fromInfo",{type:"isDefense",vehicleStatus:""}),setTimeout(function(){$(window.parent.document).find("#nav_Maps").bind("click"),$(window.parent.document).find("#nav_Maps").trigger("click")},200)},toMapPageDefense:function(e){var t=JSON.parse(e.areaRange).coordinates[0];utility.setSessionStorage("fromInfo",{type:"isDefense",areaName:e.areaName,coordinate:t[0]}),setTimeout(function(){$(window.parent.document).find("#nav_Maps").bind("click"),$(window.parent.document).find("#nav_Maps").trigger("click")},200)}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getDefensAreaList(!0),e.getCompanyList(),e.$watch("pageInfo",function(){e.getDefensAreaList(!0)},{deep:!0})},500)}})})();
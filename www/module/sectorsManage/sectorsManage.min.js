(function(){var e=utility.getLocalStorage("language"),t=utility.getLocalStorage("userInfo"),a=utility.getLocalStorage("bizParam"),i=utility.getLocalStorage("userFuncList"),n=new Vue({el:"#js-vue",data:{language:e?e.language:"CN",isTableLoading:!0,isShowModal:!1,isShowDetail:!1,isModalLoading:!0,modalTitle:"",defensFunc:function(){var e=JSON.stringify(i.menu_map);return e.indexOf("device_manage_secure_area")!=-1}(),tableHeight:function(){var e=$(".tableContainer").height();return e-100}(),secureAreaStatusList:a.secureAreaStatus,secureAreaLimitTypeList:a.secureAreaLimitType,index:0,selectItem:null,itemInfo:{id:"",companyId:"",companyName:"",areaName:"",areaCode:"",secureStatus:"",areaRange:"",speedLimit:"",staySecond:""},pageInfo:{count:0,pageSize:20,pageNum:0,areaName:"",companyId:"",secureStatus:"",canEnter:"",canExit:"",canStay:"",createUserId:t.id,modifyUserId:t.id},columnsList:[{type:"index",width:60,align:"center"},{title:{CN:"公司",EN:"Company",TW:"公司"}[e.language],key:"companyName"},{title:{CN:"名称",EN:"Name",TW:"名稱"}[e.language],key:"areaName"},{title:{CN:"编码",EN:"Code",TW:"編碼"}[e.language],key:"areaCode"},{title:{CN:"状态",EN:"Status",TW:"狀態"}[e.language],key:"secureStatus"},{title:{CN:"速度上限",EN:"Speed Limit",TW:"速度上限"}[e.language],key:"speedLimit"},{title:{CN:"停留时长",EN:"Length Of Stay",TW:"停留時長"}[e.language],key:"staySecond"},{title:{CN:"操作",EN:"Operation",TW:"操作"}[e.language],key:"operation",render:function(t,a){var r=JSON.stringify(i.menu_map),s="",o=null;return r.indexOf("device_manage_secure_area")!=-1?(s={CN:"编辑",EN:"Edite",TW:"編輯"}[e.language],o=t("Button",{props:{type:"error",size:"small"},on:{click:function(){n.index=a.index,n.selectItem=a.row,n.delItem()}}},{CN:"删除",EN:"Delete",TW:"刪除"}[e.language])):s={CN:"查看",EN:"View",TW:"查看"}[e.language],t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.index=a.index,n.selectItem=a.row,n.showDetail()}}},{CN:"详情",EN:"Detail",TW:"詳情"}[e.language]),t("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){n.index=a.index,n.selectItem=a.row,n.editItem()}}},s),o])}}],dataList:[{id:1,number:"编号",name:"名称",active:"是否激活"}],defensList:[],companyList:[]},watch:{},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},addItem:function(){var e=this;e.isShowModal=!0,e.isModalLoading=!0,e.modalTitle={CN:"新增",EN:"Add",TW:"新增"}[e.language],e.itemInfo={id:"",companyId:"",companyName:"",areaName:"",areaCode:"",secureStatus:"",areaRange:"",speedLimit:"",staySecond:""}},editItem:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=JSON.parse(JSON.stringify(e.defensList[e.index])),e.itemInfo.remark=decodeURI(e.defensList[e.index].remark),e.itemInfo.canEnter=e.itemInfo.canEnter||720,e.itemInfo.canExit=e.itemInfo.canExit||720,e.itemInfo.canStay=e.itemInfo.canStay||720,e.isShowModal=!0,e.modalTitle={CN:"修改",EN:"Edit",TW:"修改"}[e.language]})},showDetail:function(){var e=this;utility.showMessageTip(e,function(){e.itemInfo=e.defensList[e.index],e.itemInfo.remark=decodeURI(e.defensList[e.index].remark),e.itemInfo.secureStatusName=function(){for(var t="",a=0,i=e.secureAreaStatusList.length;a<i;a++)if(e.secureAreaStatusList[a].type==e.itemInfo.secureStatus){t=e.secureAreaStatusList[a].name;break}return t}(),e.itemInfo.canEnterName=function(){for(var t="",a=0,i=e.secureAreaLimitTypeList.length;a<i;a++)if(e.secureAreaLimitTypeList[a].type==e.itemInfo.canEnter,!0){t=e.secureAreaLimitTypeList[a].name;break}return t}(),e.itemInfo.canStayName=function(){for(var t="",a=0,i=e.secureAreaLimitTypeList.length;a<i;a++)if(e.secureAreaLimitTypeList[a].type==e.itemInfo.canStay,!0){t=e.secureAreaLimitTypeList[a].name;break}return t}(),e.itemInfo.canExitName=function(){for(var t="",a=0,i=e.secureAreaLimitTypeList.length;a<i;a++)if(e.secureAreaLimitTypeList[a].type==e.itemInfo.canExit,!0){t=e.secureAreaLimitTypeList[a].name;break}return t}(),e.isShowDetail=!0})},delItem:function(){var e=this;e.$Modal.confirm({title:"确定删除？",width:200,onOk:function(){e.itemInfo=e.defensList[e.index],utility.showMessageTip(e,function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.delSecureArea+"&ids="+e.itemInfo.id+"&modifyUserId="+t.id,actionUrl:CONFIG.SERVICE.areaService,beforeSendCallback:function(){e.isTableLoading=!0},completeCallback:function(){e.isTableLoading=!1},successCallback:function(t){200==t.code?e.getDefensAreaList(!0):e.$Message.error(t.message)}})})}})},pageSizeChange:function(e){var t=this;t.pageInfo.pageNum=parseInt(e,10),setTimeout(function(){t.getDefensAreaList(!1)},200)},pageRowChange:function(e){var t=this;t.pageInfo.pageSize=parseInt(e,10),setTimeout(function(){t.getDefensAreaList(!1)},200)},setCurrentRowData:function(e,t){var a=this;a.index=t,a.selectItem=e},uploadDataToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.saveSecureArea,actionUrl:CONFIG.SERVICE.areaService,dataObj:{id:e.itemInfo.id,opType:2,companyId:e.itemInfo.companyId,deptId:e.itemInfo.deptId,areaName:encodeURI(e.itemInfo.areaName),areaCode:encodeURI(e.itemInfo.areaCode),secureStatus:e.itemInfo.secureStatus,areaRangeStr:e.itemInfo.areaRange,speedLimit:e.itemInfo.speedLimit,staySecond:e.itemInfo.staySecond,remark:encodeURI(e.itemInfo.remark),createUserId:e.itemInfo.createUserId,modifyUserId:e.itemInfo.modifyUserId},completeCallback:function(){e.isModalLoading=!1},successCallback:function(t){200==t.code?e.getDefensAreaList(!0):e.$Message.error(t.message)}})},formatDefensData:function(){for(var e=this,t=0,a=e.defensList.length;t<a;t++)e.dataList.push({companyName:decodeURI(e.defensList[t].companyName),areaName:decodeURI(e.defensList[t].areaName),areaCode:decodeURI(e.defensList[t].areaCode),canEnter:e.defensList[t].canEnter||720,canExit:e.defensList[t].canExit||720,canStay:e.defensList[t].canStay||720,secureStatus:function(){for(var a="",i=0,n=e.secureAreaStatusList.length;i<n;i++)if(e.secureAreaStatusList[i].type==e.defensList[t].secureStatus){a=e.secureAreaStatusList[i].name;break}return a}(),speedLimit:e.defensList[t].speedLimit,staySecond:e.defensList[t].staySecond})},getDefensAreaList:function(e){var t=this;t.dataList=[],1==e&&(t.pageInfo.pageNum=0),setTimeout(function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.getSecureAreaList,actionUrl:CONFIG.SERVICE.areaService,dataObj:t.pageInfo,beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.defensList=e.data,t.pageInfo.count=e.count,t.formatDefensData())}})},500)},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(t){200==t.code&&(e.companyList=t.data)}})},toMapPage:function(){utility.setSessionStorage("fromInfo",{type:"isDefense",vehicleStatus:""}),setTimeout(function(){$(window.parent.document).find("#nav_Maps").bind("click"),$(window.parent.document).find("#nav_Maps").trigger("click")},200)}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.getDefensAreaList(!0),e.getCompanyList()},500)}})})();
(function(){var e,t=utility.getLocalStorage("language"),i=utility.getLocalStorage("userInfo"),a=utility.getLocalStorage("bizParam"),n=utility.getSessionStorage("onlineStatItemInfo"),o=[],p=[],c=new Vue({el:"#js-vue",data:{language:t?t.language:"CN",isTableLoading:!0,isShowModal:!1,isModalLoading:!0,tableHeight:(e=$(".tableContainer").height(),e-100),vehicleColorList:a.vehicleColor,vehicleTypeList:a.vehicleType,vehicleBrandList:a.vehicleBrand,pageInfo:{id:"",deptId:"",deptIds:"",companyId:"",statusType:-1,vehicleName:"",licenseNumber:"",beginTime:"",endTime:""},page:{count:0,pageSize:20,pageNum:1},columnsList:[{type:"index",width:60,title:"序号",align:"center"},{title:{CN:"公司",EN:"Company",TW:"公司"}[t.language],key:"companyName",width:200,filters:o,filterMultiple:!1,filterRemote(e,t){c.pageInfo.companyId=e,c.getDepartmentList()}},{title:{CN:"部门",EN:"Department",TW:"部門"}[t.language],key:"deptName",filters:p,filterMultiple:!1,filterRemote(e,t){c.pageInfo.deptIds=e}},{title:{CN:"车辆名称",EN:"Vehicle Name",TW:"車輛名稱"}[t.language],key:"vehicleName"},{title:"车牌号",key:"licenseNumber"},{title:"统计日期",key:"statDay",sortable:!0,sortType:"des"},{title:"上下线时间",key:"changeTime",sortable:!0,sortType:"des"},{title:"上下线类型",key:"statusType",render:function(e,t){var i={"_-1":"",_0:"下线",_1:"上线"};return e("div",[e("span",{},i["_"+t.row.statusType])])}}],departmentList:[],vehicleList:[],companyList:[],userList:[]},methods:{refresh:function(){var e=this;window.location.href=window.location.href,0==e.isTableLoading&&(e.isTableLoading=!0,setTimeout(function(){e.isTableLoading=!1},3e3))},beginRepairTime:function(e,t){var i=this;i.pageInfo.beginTime=e},endRepairTime:function(e,t){var i=this;i.pageInfo.endTime=e},pageSizeChange:function(e){var t=this;t.page.pageNum=parseInt(e,10),setTimeout(function(){t.getVehicleOnlineDetail(!1)},200)},pageRowChange:function(e){var t=this;t.page.pageSize=parseInt(e,10),setTimeout(function(){t.getVehicleOnlineDetail(!0)},200)},downLoadExcel:function(){var e=this,t=Date.parse(new Date),a={deptId:e.pageInfo.deptId,companyId:e.pageInfo.companyId,statusType:e.pageInfo.statusType,vehicleName:encodeURI(e.pageInfo.vehicleName),licenseNumber:encodeURI(e.pageInfo.licenseNumber),beginTime:e.pageInfo.beginTime,endTime:e.pageInfo.endTime,version:100,timestamp:t,languageVer:"cn",appType:2,actionUrl:CONFIG.SERVICE.vehicleService,userId:i?i.id:"",userToken:i?i.userToken:"",signStr:md5((i?i.userToken:"")+(i?i.id:"")+t+"100").toUpperCase()},n="",o=CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.downVehicleOnlineDetail;for(var p in a)a.hasOwnProperty(p)&&(n=n+"&"+p+"="+a[p]);window.open(o+n)},getVehicleOnlineDetail:function(e){var t=this;t.vehicleList=[],1==e&&(t.page.pageNum=0,t.page.count=0),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleOnlineDetail,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{pageNum:t.page.pageNum,pageSize:t.page.pageSize,deptId:t.pageInfo.deptIds[t.pageInfo.deptIds.length-1]||0,companyId:t.pageInfo.companyId,statusType:t.pageInfo.statusType,vehicleName:encodeURI(t.pageInfo.vehicleName),licenseNumber:encodeURI(t.pageInfo.licenseNumber),beginTime:t.pageInfo.beginTime,endTime:t.pageInfo.endTime},beforeSendCallback:function(){t.isTableLoading=!0},completeCallback:function(){t.isTableLoading=!1},successCallback:function(e){200==e.code&&(t.vehicleList=e.data,t.page.count=e.count)}})},changeToGetDetp:function(){var e=this;e.getDepartmentTreeList()},getSuper:function(e,t,i){for(var a=this,n=0,o=e.length;n<o;n++)if(e[n].value==t){if(i.push(t),0==e[n].paraDeptId)return;a.getSuper(a.departmentList,e[n].paraDeptId,i)}else a.getSuper(e[n].children,t,i)},formatSuperiorDeprt:function(e){var t=this,i=JSON.stringify(e).replace(/id/g,"value").replace(/deptName/g,"label").replace(/subDeptList/g,"children");t.departmentList=JSON.parse(i)},getDepartmentTreeList:function(){var e=this;e.departmentList=[],utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptTreeList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:0,pageSize:1e4,companyId:e.pageInfo.companyId||0},successCallback:function(t){if(200==t.code){var i=[];e.pageInfo.deptIds=[],e.formatSuperiorDeprt(t.data),e.getSuper(e.departmentList,e.pageInfo.deptId,i),e.pageInfo.deptIds=i.reverse()}}})},getDepartmentList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{pageNum:1,pageSize:1e4,companyId:e.pageInfo.companyId[0]||0},successCallback:function(e){if(200==e.code)for(var t=0,i=e.data.length;t<i;t++)p.push({label:e.data[t].deptName,value:e.data[t].id})}})},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(t){if(200==t.code){e.companyList=t.data;for(var i=0,a=e.companyList.length;i<a;i++)o.push({label:e.companyList[i].companyName,value:e.companyList[i].id})}}})}},created:function(){var e=this;utility.isLogin(!1),n&&(e.pageInfo.licenseNumber=n.licenseNumber),setTimeout(function(){e.getVehicleOnlineDetail(!0),e.getCompanyList(),e.$watch("pageInfo",function(){e.getVehicleOnlineDetail(!0)},{deep:!0})},500)}})})();
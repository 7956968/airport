(function(){var e=utility.getLocalStorage("language");utility.getLocalStorage("userInfo"),new Vue({el:"#js-vue",data:{language:e?e.language:"CN",mapContainer:{map:null,viewInfo:{view:null,zoom:null,center:null,rotation:null},layersInfo:{layer:null,OSM:null,WMS:null},sourceInfo:{draw:null,markerVector:null},controlsInfo:{mousePosition:null,scaleLine:null,overviewMap:null,fullScreen:null},interactionInfo:{type:"None",draw:null},featrueInfo:{gpsAccuracy:null,gpsPosition:null},geolocationInfo:{geolocation:null,params:{tracking:!1,errorInfo:""}},overlayInfo:{gpsFeature:null},geometryInfo:{}},modal:{isVehicle:!1,isHistory:!1,isDefense:!1,isCamera:!1,isLayer:!1,isAlarm:!1,isSearch:!1},vehicleColumns:[{title:{CN:"编号",EN:"Number",TW:"編號"}[e.language],key:"number"},{title:{CN:"车牌号",EN:"License Plate",TW:"車牌號"}[e.language],key:"plate"},{title:{CN:"状态",EN:"State",TW:"狀態"}[e.language],key:"state"}],vehicleDatas:[{number:"编号",plate:"车牌",state:"状态"},{number:"编号",plate:"车牌",state:"状态"},{number:"编号",plate:"车牌",state:"状态"},{number:"编号",plate:"车牌",state:"状态"},{number:"编号",plate:"车牌",state:"状态"}],historyColumns:[],historyDatas:[],defensColumns:[{title:{CN:"名称",EN:"Name",TW:"名稱"}[e.language],key:"name"},{title:{CN:"布防",EN:"protection",TW:"布防"}[e.language],key:"protection"},{title:{CN:"操作",EN:"Operation",TW:"操作"}[e.language],key:"operation",width:80,render:function(e,o){return e("div",[e("Icon",{props:{type:"ios-trash-outline"}})])}}],defensDatas:[{name:"名称",protection:"布防",operation:"操作"},{name:"名称",protection:"布防",operation:"操作"},{name:"名称",protection:"布防",operation:"操作"},{name:"名称",protection:"布防",operation:"操作"},{name:"名称",protection:"布防",operation:"操作"},{name:"名称",protection:"布防",operation:"操作"}],cameraColumns:[{title:{CN:"名称",EN:"Name",TW:"名稱"}[e.language],key:"name",fixed:"left",width:100},{title:{CN:"描述",EN:"Describe",TW:"描述"}[e.language],key:"describe",width:150},{title:{CN:"rtsp",EN:"rtsp",TW:"rtsp"}[e.language],key:"rtsp",width:200},{title:{CN:"方向",EN:"direction",TW:"方向"}[e.language],key:"direction",width:100},{title:{CN:"半径",EN:"raduis",TW:"半徑"}[e.language],key:"raduis",width:100},{title:{CN:"视野角度",EN:"Angle of view",TW:"視野角度"}[e.language],key:"view",width:100},{title:{CN:"操作",EN:"Operation",TW:"操作"}[e.language],key:"operation",width:80,fixed:"right",render:function(e,o){return e("div",[e("Icon",{props:{type:"ios-trash-outline"}})])}}],camersDatas:[{name:"名称",describe:"描述",rtsp:"rtsp","":"方向",raduis:"半径",view:"视野角度",operation:"操作"},{name:"名称",describe:"描述",rtsp:"rtsp","":"方向",raduis:"半径",view:"视野角度",operation:"操作"},{name:"名称",describe:"描述",rtsp:"rtsp","":"方向",raduis:"半径",view:"视野角度",operation:"操作"},{name:"名称",describe:"描述",rtsp:"rtsp","":"方向",raduis:"半径",view:"视野角度",operation:"操作"},{name:"名称",describe:"描述",rtsp:"rtsp","":"方向",raduis:"半径",view:"视野角度",operation:"操作"},{name:"名称",describe:"描述",rtsp:"rtsp","":"方向",raduis:"半径",view:"视野角度",operation:"操作"},{name:"名称",describe:"描述",rtsp:"rtsp","":"方向",raduis:"半径",view:"视野角度",operation:"操作"}],layerColumns:[],layerDatas:[],alarmColumns:[],alarmDatas:[],searchColumns:[{title:{CN:"车辆编号",EN:"Vehicle Number",TW:"車輛編號"}[e.language],key:"number",fixed:"left",width:100},{title:{CN:"车牌",EN:"License Plate",TW:"車牌"}[e.language],key:"plate",width:100},{title:{CN:"车辆类型",EN:"Vehicle Type",TW:"車輛類型"}[e.language],key:"type",width:100},{title:{CN:"归属公司",EN:"Ownership Company",TW:"歸屬公司"}[e.language],key:"company",width:100},{title:{CN:"车辆颜色",EN:"Vehicle Color",TW:"車輛顔色"}[e.language],key:"color",width:100},{title:{CN:"车辆品牌",EN:"Vehicle Brand",TW:"車輛品牌"}[e.language],key:"brand",width:100},{title:{CN:"操作",EN:"Operation",TW:"操作"}[e.language],key:"operation",width:80,fixed:"right",render:function(e,o){return e("div",[e("Icon",{props:{type:"ios-trash-outline"}})])}}],searchDatas:[{number:"车辆编号",plate:"车牌",type:"车辆类型",company:"归属公司",color:"车辆颜色",brand:"车辆品牌",operation:"操作"},{number:"车辆编号",plate:"车牌",type:"车辆类型",company:"归属公司",color:"车辆颜色",brand:"车辆品牌",operation:"操作"},{number:"车辆编号",plate:"车牌",type:"车辆类型",company:"归属公司",color:"车辆颜色",brand:"车辆品牌",operation:"操作"},{number:"车辆编号",plate:"车牌",type:"车辆类型",company:"归属公司",color:"车辆颜色",brand:"车辆品牌",operation:"操作"},{number:"车辆编号",plate:"车牌",type:"车辆类型",company:"归属公司",color:"车辆颜色",brand:"车辆品牌",operation:"操作"},{number:"车辆编号",plate:"车牌",type:"车辆类型",company:"归属公司",color:"车辆颜色",brand:"车辆品牌",operation:"操作"},{number:"车辆编号",plate:"车牌",type:"车辆类型",company:"归属公司",color:"车辆颜色",brand:"车辆品牌",operation:"操作"}]},watch:{},methods:{init:function(){var e=this;e.generateControl();e.createdMap(),e.addWMSLayer(),e.getObjectType(),e.addControls(e.mapContainer.controlsInfo)},createdMap:function(){var e=this;e.mapContainer.map=new ol.Map({target:"map",layers:[new ol.layer.Tile({source:new ol.source.OSM})],view:new ol.View({center:[113.8045,22.6428],zoom:13,projection:"EPSG:4326"})})},addWMSLayer:function(){var e=this;e.mapContainer.map.addLayer(new ol.layer.Tile({source:new ol.source.TileWMS({url:"http://43.247.68.26:9090/geoserver/sz/wms?service=WMS&version=1.1.0&request=GetMap&layers=sz:surface_region&styles=&bbox=113.76931608,22.60251774,113.84250732,22.67499654&width=768&height=760&srs=EPSG:4326&format=application/openlayers"})})),e.mapContainer.map.addLayer(new ol.layer.Tile({source:new ol.source.TileWMS({url:"http://43.247.68.26:9090/geoserver/sz/wms?service=WMS&version=1.1.0&request=GetMap&layers=sz:line_polyline&styles=&bbox=113.76640439999998,22.59093897,113.84873603999999,22.696465319999998&width=599&height=768&srs=EPSG:4326&format=application/openlayers"})})),e.mapContainer.map.addLayer(new ol.layer.Tile({source:new ol.source.TileWMS({url:"http://43.247.68.26:9090/geoserver/sz/wms?service=WMS&version=1.1.0&request=GetMap&layers=sz:point_position_point&styles=&bbox=113.786041,22.616661,113.824471,22.655542&width=759&height=768&srs=EPSG:4326&format=application/openlayers"})}))},addControls:function(e){var o=this;o.mapContainer.map.addControl(e.mousePosition),o.mapContainer.map.addControl(e.scaleLine),o.mapContainer.map.addControl(e.overviewMap),o.mapContainer.map.addControl(e.fullScreen)},addOverlays:function(){},getObjectType:function(){var e=this;e.mapContainer.layersInfo.layer=e.mapContainer.map.getLayers(),e.mapContainer.viewInfo.view=e.mapContainer.map.getView(),e.mapContainer.viewInfo.zoom=e.mapContainer.viewInfo.view.getZoom(),e.mapContainer.viewInfo.center=e.mapContainer.viewInfo.view.getCenter(),e.mapContainer.viewInfo.rotation=e.mapContainer.viewInfo.view.getRotation()},generateControl:function(){var e=this;return e.mapContainer.controlsInfo.mousePosition||(e.mapContainer.controlsInfo.mousePosition=new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(4),projection:"EPSG:4326",className:"mousePositionInner",target:document.getElementById("mousePosition"),undefinedHTML:"&nbsp;"})),e.mapContainer.controlsInfo.scaleLine||(e.mapContainer.controlsInfo.scaleLine=new ol.control.ScaleLine({units:"metric"})),e.mapContainer.controlsInfo.overviewMap||(e.mapContainer.controlsInfo.overviewMap=new ol.control.OverviewMap({className:"overViewMap",layers:[new ol.layer.Tile({source:new ol.source.OSM({url:"http://{a-c}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png"})})],collapseLabel:"»",label:"«",collapsed:!1})),e.mapContainer.controlsInfo.fullScreen||(e.mapContainer.controlsInfo.fullScreen=new ol.control.FullScreen),e.mapContainer.controlsInfo},setdrawVectorLayer:function(){var e=this;e.mapContainer.sourceInfo.draw=new ol.source.Vector({wrapX:!1}),e.mapContainer.layersInfo.drawVector=new ol.layer.Vector({source:e.mapContainer.sourceInfo.draw,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,255,255,.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})}),e.mapContainer.map.addLayer(e.mapContainer.layersInfo.drawVector)},doDrawAction:function(){var e,o,n=this;n.mapContainer.map.removeInteraction(n.mapContainer.interactionInfo.draw),"None"!=n.mapContainer.interactionInfo.type?(null==n.mapContainer.sourceInfo.draw&&(n.mapContainer.sourceInfo.draw=new ol.source.Vector({wrapX:!1}),n.mapContainer.layersInfo.draw.setSource(n.mapContainer.sourceInfo.draw)),"Square"==n.mapContainer.interactionInfo.type?(n.mapContainer.interactionInfo.type="Circle",e=ol.interaction.Draw.createRegularPolygon(4)):"Box"==n.mapContainer.interactionInfo.type&&(n.mapContainer.interactionInfo.type="LineString",o=2,e=function(e,o){o||(o=new ol.geom.Polygon(null));var n=e[0],t=e[1];return o.setCoordinates([[n,[n[0],t[1]],t,[t[0],n[1]],n]]),o}),n.mapContainer.interactionInfo.draw=new ol.interaction.Draw({source:n.mapContainer.sourceInfo.draw,type:n.mapContainer.interactionInfo.type,geometryFunction:e,maxPosition:o}),n.mapContainer.map.addInteraction(n.mapContainer.interactionInfo.draw)):(n.mapContainer.sourceInfo.draw=null,n.mapContainer.layersInfo.draw.setSource(n.mapContainer.sourceInfo.draw))},setGeomtryStyle:function(e){var o=this,n=o.mapContainer.geometryInfo.style,t=o.mapContainer.geometryInfo.type;return new ol.style.Style({image:new ol.style.Circle({radius:parseInt(n[t].radius,10),fill:new ol.style.Fill({color:n[t].fillColor}),stroke:new ol.style.Stroke({color:n[t].strokeColor,width:parseInt(n[t].strokeWidth,10)})}),text:new ol.style.Text({textAlign:n[t].align,textBaseline:n[t].baseline,font:n[t].fontFamily,text:e.get("name"),fill:new ol.style.Fill({color:n[t].fillColor}),stroke:new ol.style.Stroke({color:n[t].outlineColor,width:parseInt(n[t].outlineWidth,10)}),offsetX:parseInt(n[t].offsetX,10),offsetY:parseInt(n[t].offsetY,10),rotation:parseInt(n[t].rotation,10)})})},drawPointLayer:function(){var e=this,o=new ol.Feature({geometry:new ol.geom.Point([0,0]),name:"Point Feature"});return e.mapContainer.layersInfo.point=new ol.layer.Vector({source:new ol.source.Vector({features:[o]}),style:e.setGeomtryStyle(o)}),e.mapContainer.layersInfo.point},drawLineLayer:function(){var e=this,o=new ol.Feature({geometry:new ol.geom.LineString([1e7,1e6],[1e6,3e6]),name:"Line Feature"});return e.mapContainer.layersInfo.line=new ol.layer.Vector({source:new ol.source.Vector({features:[o]}),style:e.setGeomtryStyle(o)}),e.mapContainer.layersInfo.line},drawPolygonLayer:function(){var e=this,o=new ol.Feature({geometry:new ol.geom.Polygon([1e6,-1e6],[1e6,3e6],[3e6,1e6],[3e6,-1e6],[1e6,-1e6]),name:"Polygon Feature"});return e.mapContainer.layersInfo.polygon=new ol.layer.Vector({source:new ol.source.Vector({features:[o]}),style:e.setGeomtryStyle(o)}),e.mapContainer.layersInfo.polygon},drawAllLaryer:function(){var e=this;e.mapContainer.map.addLayer(e.drawPointLayer()),e.mapContainer.map.addLayer(e.drawLineLayer()),e.mapContainer.map.addLayer(e.drawPolygonLayer())},createMarkStyle:function(e){return new ol.style.Style({image:new ol.style.Icon({anchor:[.5,60],anchorOrigin:"top-right",anchorXUnits:"fraction",anchorYUnits:"pixels",offsetOrigin:"top-right",offset:[0,10],scale:.5,opacity:.75,src:"./img/icons/icon09.png"}),text:new ol.style.Text({textAlign:"center",textBaseline:"middle",font:"normal 14px 微软雅黑",text:e.get("name"),fill:new ol.style.Fill({color:"#aa3300"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2})})})},addOverlayerByVector:function(){var e=this,o=ol.proj.fromLonLat([113.8045,22.6428]),n=new ol.Feature({geometry:new ol.geom.Point(o),name:"深圳宝安机场",population:2115});n.setStyle(e.createMarkStyle(n)),e.mapContainer.sourceInfo.markerVector=new ol.source.Vector({features:[n]}),e.mapContainer.layersInfo.markerVector=new ol.layer.Vector({source:e.mapContainer.sourceInfo.markerVector}),e.mapContainer.map.addLayer(e.mapContainer.layersInfo.markerVector)},addOverlayerByOverlayer:function(){var e=this,o=ol.proj.fromLonLat([113.8045,22.6428]),n=new ol.Overlay({position:o,positioning:"center-center",element:document.getElementById("marker"),stopEvent:!1});e.mapContainer.map.addOverlay(n),n.getElement().innerHtml="深圳宝安机场";var t=new ol.Overlay({position:o,element:document.getElementById("address")});e.mapContainer.map.addOverlay(t),t.getElement().innerText=n.getElement().title},setMapClickEvent:function(){var e=this;e.mapContainer.map.on("click",function(o){var n=o.coordinate;if("None"==e.mapContainer.interactionInfo.type){var t=new ol.Feature({geometry:new ol.geom.Point(n),name:"标注点"});t.setStyle(e.createMarkStyle(t)),e.mapContainer.sourceInfo.markerVector.addFeature(t)}})},initGeolocation:function(){var e=this;e.createdGeolocation(),e.bindGeolacationEvent(),e.addAccuracyFeature(),e.addPositionFeature(),e.createdPositionVector()},createdGeolocation:function(){var e=this;e.mapContainer.geolocationInfo.geolocation=new ol.Geolocation({projection:e.mapContainer.viewInfo.view.getProjection(),trackingOptions:{maxnumAgs:1e4,enableHighAccuracy:!0,timeout:6e5}})},bindGeolacationEvent:function(){var e=this;e.mapContainer.geolocationInfo.geolocation.on("change",function(o){e.mapContainer.geolocationInfo.params.accuracy=e.mapContainer.geolocationInfo.geolocation.getAccuracy()+"[m]",e.mapContainer.geolocationInfo.params.altitude=e.mapContainer.geolocationInfo.geolocation.getAltitude()+"[m]",e.mapContainer.geolocationInfo.params.altitudeAccuracy=e.mapContainer.geolocationInfo.geolocation.getAltitudeAccuracy()+"[m]",e.mapContainer.geolocationInfo.params.heading=e.mapContainer.geolocationInfo.geolocation.getHeading()+"[rad]",e.mapContainer.geolocationInfo.params.speed=e.mapContainer.geolocationInfo.geolocation.getSpeed()+"[m/s]"}),e.mapContainer.geolocationInfo.geolocation.on("error",function(o){e.mapContainer.geolocationInfo.params.errorInfo=o.message})},addAccuracyFeature:function(){var e=this;e.mapContainer.featrueInfo.accuracy=new ol.Feature,e.mapContainer.geolocationInfo.geolocation.on("change:accuracyGeometry",function(){e.mapContainer.featrueInfo.accuracy.setGeometry(e.mapContainer.geolocationInfo.geolocation.getAccuracyGeometry())})},addPositionFeature:function(){var e=this;e.mapContainer.featrueInfo.position=new ol.Feature,e.mapContainer.featrueInfo.position.setStyle(new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"#3399cc"}),stroke:new ol.style.Stroke({color:"#fff",width:2})})})),e.mapContainer.geolocationInfo.geolocation.on("change:position",function(){var o=e.mapContainer.geolocationInfo.geolocation.getPosition();e.mapContainer.featrueInfo.position.setGeometry(o?new ol.geo.Point(o):null)})},createdPositionVector:function(){var e=this;e.mapContainer.layersInfo.geolocation=new ol.layer.Vector({source:new ol.source.Vector({features:[e.mapContainer.featrueInfo.accuracy,e.mapContainer.featrueInfo.position]})})},showModal:function(e){var o=this;o.modal[e]=!o.modal[e]}},created:function(){var e=this;utility.isLogin(!1),setTimeout(function(){e.init()},2e3)}})})();
(function(){var e=utility.getLocalStorage("language"),a=utility.getLocalStorage("airPort"),i=utility.getLocalStorage("userInfo"),t=utility.getLocalStorage("bizParam"),n=utility.getLocalStorage("userFuncList"),o=function(){var e={isViewVideo:!1,isSearch:!1,isTrack:!1};for(var a in n)if(n.hasOwnProperty(a))for(var t=0,o=n[a].length;t<o;t++)"device_manage_view_video"==n[a][t].functionCode&&(e.isViewVideo=!0),"map_query_live_vehicle"==n[a][t].functionCode&&(e.isSearch=!0),"map_view_track"==n[a][t].functionCode&&(e.isTrack=!0),"device_manage_secure_area"==n[a][t].functionCode&&(e.isDefense=!0),"device_manage_camera"==n[a][t].functionCode&&(e.isCamera=!0);return e}(),r=new Vue({el:"#js-vue",data:{functionInfo:o,isShenZhen:!1,deleteLoading:!1,addLoading:!1,language:e?e.language:"CN",airPort:a?[parseFloat(a.airPort.split(",")[0],10),parseFloat(a.airPort.split(",")[1],10)]:[113.8077,22.6286],companyList:[],departmentList:[],userFuncList:n,searchId:"",searchCode:"",mapContainer:{map:null,viewInfo:{view:null,zoom:null,center:null,rotation:null},layersInfo:{baiduVectorMap:null,baiduSatellite:null,GPS:null,seat:null,layer:null,alarm:null,camera:null,defens:null,vehicle:null,trajectory:null,airportLine:null,airportPoint:null,airportPolygo:null,OSM:null},sourceInfo:{seat:null,alarm:null,defens:null,camera:null,vehicle:null,trajectory:null,demo:null},controlsInfo:{scaleLine:null,fullScreen:null,overviewMap:null,mousePosition:null},interactionInfo:{defens:null,trajectory:null},featrueInfo:{clickPos:[],clickId:null,circlePoint:{},clickName:null,vehiclePoint:{},trajectory:null},geolocationInfo:{GPS:null},overlayInfo:{defens:null,camera:null,vehicle:null,vehicleList:{},trajectory:null,moveVehicle:null},animationInfo:{speed:90,index:0,time:null,point:null,isMoved:!1,coordinates:[],coordinateLen:0,trajectoryInfo:[],vectorContext:null,trajectoryItem:null}},modal:{isLayer:!1,isAlarm:!1,isCamera:!1,isSearch:!1,isVehicle:!1,isHistory:!1,isDefense:!1},layerControl:["seat","alarm","vehicle","defens","camera"],vehiclePageInfo:{id:"",count:0,pageNum:1,deptId:"",pageSize:15,vehicleName:"",vehicleCode:"",gpsDeviceCode:""},vehiclePositonPageInfo:{span:1e3,count:0,pageNum:1,deptId:"",pageSize:15,companyId:"",id:"",vehicleName:"",vehicleCode:"",licenseNumber:"",gpsDeviceCode:"",vehicleTypeId:"",vehicleStatus:"",useStatus:-1,vehicleColorId:"",vehicleBrandId:"",centerPosition:""},vehicleItem:{id:"",speed:"",power:"",deptId:"",deptName:"",modifyTime:"",gpsDeviceId:"",companyName:"",vehicleName:"",vehicleCode:"",lastPosition:"",vehicleTypeId:"",gpsDeviceCode:"",vehicleStatus:"",vehicleColorId:"",vehicleBrandId:"",vehicleStatusName:""},vehicleItemPop:null,vehicleList:[],isAddVehiclePosition:!1,isDbClickSearch:!1,terminalStatusList:t.terminalStatus,vehicleColorList:t.vehicleColor,vehicleTypeList:t.vehicleType,vehicleBrandList:t.vehicleBrand,secureAreaLimitTypeList:t.secureAreaLimitType,vehicleColumns:[{title:{CN:"\u540D\u79F0",EN:"Name",TW:"\u540D\u7A31"}[e.language],key:"vehicleName"},{title:{CN:"\u7C7B\u578B",EN:"Type",TW:"\u985E\u578B"}[e.language],key:"vehicleTypeId"},{title:{CN:"\u7F16\u7801",EN:"Code",TW:"\u7DE8\u78BC"}[e.language],key:"vehicleCode"},{title:{CN:"\u72B6\u6001",EN:"State",TW:"\u72C0\u614B"}[e.language],key:"vehicleStatus"}],vehicleDatas:[],vehiclePositionItem:{o:"",id:"",speed:"",power:"",deptId:"",deptName:"",modifyTime:"",gpsDeviceId:"",companyName:"",vehicleName:"",vehicleCode:"",lastPosition:"",vehicleTypeId:"",gpsDeviceCode:"",vehicleStatus:"",vehicleColorId:"",vehicleBrandId:"",vehicleStatusName:""},vehiclePositionList:[],singleVehiclePageInfo:{date:new Date,endTime:"",id:"",beginTime:"",lastGpsTime:"",vehicleCode:"",licenseNumber:"",gpsDeviceCode:""},vehicleAddressDetail:"",trackItem:{coordinate:[],licenseNumber:""},isTrackItem:!1,dateTimeInfo:{date:new Date,beginDate:function(){var e=utility.getDateDetailInfo();return e.year+"-"+e.month+"-"+e.date}(),endDate:function(){var e=utility.getDateDetailInfo();return e.year+"-"+e.month+"-"+e.date}(),beginTime:"00:00:00",endTime:"23:59:59"},singleVehicleItem:{},historyColumns:[],historyDatas:[],isAddDefensAction:!1,isAddDefensDetailInfo:!1,isDrawDefening:!1,isDeleteDefens:!1,secureAreaStatusList:t.secureAreaStatus,defensFunc:function(){var e=JSON.stringify(n.menu_map);return-1!=e.indexOf("device_manage_secure_area")}(),defensPageInfo:{count:0,pageNum:1,pageSize:15,areaName:"",companyId:"",secureStatus:""},defensAreaDetailInfo:{id:"",featureId:"",opType:1,companyId:"",deptId:"",deptIds:[],areaName:"",areaCode:"",secureStatus:"",areaRangeStr:"",speedLimit:"",staySecond:"",canEnter:"",canExit:"",canStay:"",remark:"",createUserId:i.id,modifyUserId:i.id},defensColumns:[{title:{CN:"\u540D\u79F0",EN:"Name",TW:"\u540D\u7A31"}[e.language],key:"areaName",fixed:"left",width:120},{title:{CN:"\u7F16\u7801",EN:"Code",TW:"\u7DE8\u78BC"}[e.language],key:"areaCode",width:120},{title:{CN:"\u72B6\u6001",EN:"Status",TW:"\u72C0\u614B"}[e.language],key:"secureStatus",width:120},{title:{CN:"\u901F\u5EA6\u4E0A\u9650",EN:"Speed Limit",TW:"\u901F\u5EA6\u4E0A\u9650"}[e.language],key:"speedLimit",width:120},{title:{CN:"\u505C\u7559\u65F6\u957F",EN:"Length Of Stay",TW:"\u505C\u7559\u6642\u9577"}[e.language],key:"staySecond",width:120},{title:{CN:"\u64CD\u4F5C",EN:"Operation",TW:"\u64CD\u4F5C"}[e.language],key:"operation",fixed:"right",width:80,render:function(a,i){var t=JSON.stringify(n.menu_map),o="";return o=-1==t.indexOf("device_manage_secure_area")?{CN:"\u67E5\u770B",EN:"View",TW:"\u67E5\u770B"}[e.language]:{CN:"\u5220\u9664",EN:"Delete",TW:"\u5220\u9664"}[e.language],a("div",[a("Button",{props:{type:"error",size:"small"},on:{click:function(){r.selectDefensArea(i)}}},o)])}}],defensDatas:[],defensList:[],defensColor:{701:{fill:new ol.style.Fill({color:"rgba(4, 159, 228, 0.4)"}),stroke:new ol.style.Stroke({color:"rgba(33, 121, 160, 0.6)",width:3})},702:{fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.4)"}),stroke:new ol.style.Stroke({color:"rgba(5, 174, 253, .6)",width:2})},703:{fill:new ol.style.Fill({color:"rgba(255, 173, 51, 0.7)"}),stroke:new ol.style.Stroke({color:"rgba(99, 71, 31, 0.8)",width:3})},704:{fill:new ol.style.Fill({color:"rgba(180, 191, 195, 0.5)"}),stroke:new ol.style.Stroke({color:"rgba(122, 150, 162, 0.92)",width:3})}},isAddCameraAction:!1,isAddcameraDetailInfo:!1,isDeleteCamera:!1,monitorStatusList:t.monitorStatusId,cameraFunc:function(){var e=JSON.stringify(n.menu_map);return-1!=e.indexOf("device_manage_camera")}(),cameraPageInfo:{count:0,pageNum:1,pageSize:15,monitorStatus:""},cameraDetailInfo:{id:"",companyId:"",companyName:"",deptId:"",deptIds:[],deptName:"",cameraName:"",cameraCode:"",cameraDesc:"",cameraPositionStr:"",radius:"",angle:"",monitorStatus:"",remark:"",rtspLiveUrl:"",rtspHisUrl:"",createUserId:i.id,modifyUserId:i.id},cameraColumns:[{title:{CN:"\u540D\u79F0",EN:"Name",TW:"\u540D\u7A31"}[e.language],key:"cameraName",fixed:"left",width:100},{title:{CN:"\u72B6\u6001",EN:"State",TW:"\u72C0\u614B"}[e.language],key:"monitorStatus",width:100},{title:{CN:"\u516C\u53F8",EN:"Company",TW:"\u516C\u53F8"}[e.language],key:"companyName",width:150},{title:{CN:"\u7F16\u7801",EN:"Code",TW:"\u7DE8\u78BC"}[e.language],key:"cameraCode",width:150},{title:{CN:"\u63CF\u8FF0",EN:"Describe",TW:"\u63CF\u8FF0"}[e.language],key:"cameraDesc",width:150},{title:{CN:"Rtsp\u76F4\u64AD\u5730\u5740",EN:"Live URL",TW:"Rtsp\u76F4\u64AD\u5730\u5740"}[e.language],key:"rtspLiveUrl",width:150},{title:{CN:"Rtsp\u5F55\u64AD\u5730\u5740",EN:"Delayed URL",TW:"Rtsp\u9304\u64AD\u5730\u5740"}[e.language],key:"rtspHisUrl",width:150},{title:{CN:"\u89C6\u91CE\u89D2\u5EA6",EN:"Angle",TW:"\u8996\u91CE\u89D2\u5EA6"}[e.language],key:"angle",width:100},{title:{CN:"\u534A\u5F84",EN:"Radius",TW:"\u534A\u5F91"}[e.language],key:"radius",width:100},{title:{CN:"\u64CD\u4F5C",EN:"Operation",TW:"\u64CD\u4F5C"}[e.language],key:"operation",width:80,fixed:"right",render:function(a,i){var t=JSON.stringify(n.menu_map),o="";return o=-1==t.indexOf("device_manage_camera")?{CN:"\u67E5\u770B",EN:"View",TW:"\u67E5\u770B"}[e.language]:{CN:"\u5220\u9664",EN:"Delete",TW:"\u5220\u9664"}[e.language],a("div",[a("Button",{props:{type:"error",size:"small"},on:{click:function(){r.selectCamera(i)}}},o)])}}],camersDatas:[],cameraList:[],layerColumns:[],layerDatas:[],alarmColumns:[],alarmDatas:[],isSearchLoading:!1,vehicleUseStatusList:t.vehicleUseStatus,searchColumns:[{title:{CN:"\u8F66\u724C\u53F7",EN:"Plate No.",TW:"\u8ECA\u724C\u865F"}[e.language],key:"licenseNumber",fixed:"left",width:130},{title:{CN:"\u8FD0\u52A8\u72B6\u6001",EN:"Vehicle State",TW:"\u8ECA\u8F1B\u72C0\u614B"}[e.language],key:"vehicleStatus",align:"center",width:100},{title:{CN:"\u8F66\u8F86\u540D\u79F0",EN:"Vehicle Name",TW:"\u8ECA\u8F1B\u540D\u7A31"}[e.language],key:"vehicleName",width:130},{title:{CN:"\u8F66\u8F86\u7F16\u53F7",EN:"Vehicle Number",TW:"\u8ECA\u8F1B\u7DE8\u865F"}[e.language],key:"vehicleCode",width:130},{title:{CN:"\u64CD\u4F5C",EN:"Operation",TW:"\u64CD\u4F5C"}[e.language],key:"operation",width:o.isViewVideo?120:80,fixed:"right",render:function(a,i){var t=a("Button",{props:{size:"small"}},{CN:"\u8BE6\u60C5",EN:"Detail",TW:"\u8A73\u60C5"}[e.language]),n=null;return o.isViewVideo&&r.vehiclePositionList[i.index].licenseNumber&&100>r.vehiclePositionList[i.index].providerId&&(401==r.vehiclePositionList[i.index].vehicleStatus||402==r.vehiclePositionList[i.index].vehicleStatus)&&(t=a("Button",{props:{type:"primary",size:"small"},on:{click:function(){r.showLiveVideo(r.vehiclePositionList[i.index],0)}}},"\u5B9E\u65F6"),2!=r.vehiclePositionList[i.index].providerId&&(n=a("Button",{props:{size:"small",type:"warning"},class:"backPlay",style:{marginLeft:"2px"},on:{click:function(){r.showLiveVideo(r.vehiclePositionList[i.index],1)}}},"\u56DE\u653E"))),a("div",[t,n])}}],searchDatas:[],vehicleFeature:{circlePoint:new ol.style.Style({image:new ol.style.Circle({radius:2,stroke:new ol.style.Stroke({color:"rgb(32, 121, 109)",width:2}),fill:new ol.style.Fill({color:"rgba(208, 219, 245, .3)"})})}),trackFeature:{}},demoInfo:{coordinate:[[113.297475,23.415024],[113.301002,23.419066],[113.301118,23.418697],[113.302135,23.418963],[113.30216,23.419006],[113.29979,23.420711],[113.298613,23.41765],[113.298226,23.417125],[113.297855,23.417242],[113.298047,23.416347],[113.298087,23.416335],[113.298082,23.416337]],time:["2019/7/10 03:01:13","2019/7/10 03:21:42","2019/7/10 04:36:07","2019/7/10 06:29:49","2019/7/10 15:46:49","2019/7/10 17:05:23","2019/7/11 04:36:15","2019/7/11 04:37:41","2019/7/11 05:55:50","2019/7/11 07:18:35","2019/7/11 08:46:16","2019/7/11 08:57:23"],status:["\u8D77\u70B9","\u4F11\u7720\u70B9","\u8D77\u70B9","\u4F11\u7720\u70B9","\u8D77\u70B9","\u4F11\u7720\u70B9","\u8D77\u70B9","\u4F11\u7720\u70B9","\u8D77\u70B9","\u4F11\u7720\u70B9","\u8D77\u70B9","\u4F11\u7720\u70B9"]}},watch:{layerControl:function(e){var a=this,i=-1!=e.indexOf("seat"),t=-1!=e.indexOf("satellite"),n=-1!=e.indexOf("alarm"),o=-1!=e.indexOf("defens"),r=-1!=e.indexOf("camera"),s=-1!=e.indexOf("vehicle"),l=-1!=e.indexOf("background");timeOut=null,a.isShenZhen&&(a.mapContainer.layersInfo.airportLine.setVisible(l),a.mapContainer.layersInfo.airportPoint.setVisible(l),a.mapContainer.layersInfo.airportPolygo.setVisible(l),a.mapContainer.layersInfo.defens.setVisible(o),a.mapContainer.layersInfo.camera.setVisible(r),a.mapContainer.layersInfo.seat.setVisible(i),a.mapContainer.layersInfo.alarm.setVisible(n)),clearTimeout(timeOut),timeOut=setTimeout(function(){t?(a.mapContainer.layersInfo.baiduVectorMap.setVisible(!1),a.mapContainer.layersInfo.baiduSatellite.setVisible(!0),a.mapContainer.viewInfo.view.setMaxZoom(18)):(a.mapContainer.layersInfo.baiduVectorMap.setVisible(!0),a.mapContainer.layersInfo.baiduSatellite.setVisible(!1),a.mapContainer.viewInfo.view.setMaxZoom(20))},50),a.mapContainer.layersInfo.vehicle.setVisible(s)}},methods:{refresh:function(){var e=window.location.href.split("?");window.location.href=e[0]+"?v="+Date.parse(new Date)},searchMap:function(){for(var e=this,a=0,t=e.vehicleList.length;a<t;a++)if(e.searchCode==e.vehicleList[a].vehicleCode){e.searchId=e.vehicleList[a].id,e.showVehicleRowData({},a);break}},autoFocus:function(){this;$("body").find(".detailInfoModal input").on("click",function(){$(this).focus()})},showModal:function(e){var a=this;if("isLayer"!=e)for(var i in a.modal)a.modal[i]=!1;a.modal[e]=!0},initMap:function(e){var a=this;a.createdMap(e),!0==a.isShenZhen&&a.createAirportLayer(),a.createFeatureLayer(),a.createPop("addCamera","camera"),!0==a.isShenZhen&&a.createPop("addDefensArea","defens"),a.createControls(),a.createdGPS()},countNewCoordinate:function(e){return[e[0]+.005511,e[1]-.002568]},transformLat:function(e){var a=this;return ol.proj.fromLonLat(a.countNewCoordinate(e))},baiduMap:function(){var e=this,a=loadMapType.google();e.mapContainer.layersInfo.baiduVectorMap=a.vector,e.mapContainer.layersInfo.baiduSatellite=a.satellite,e.mapContainer.layersInfo.baiduSatellite.setVisible(!1),e.mapContainer.map=new ol.Map({target:"map",layers:[e.mapContainer.layersInfo.baiduSatellite,e.mapContainer.layersInfo.baiduVectorMap],controls:ol.control.defaults({attribution:!1}),loadTilesWhileAnimating:!0,view:new ol.View({center:e.transformLat(e.airPort),zoom:15,minZoom:3,maxZoom:20})})},createdMap:function(e){var a=this;a.baiduMap(e),a.mapContainer.layersInfo.layer=a.mapContainer.map.getLayers(),a.mapContainer.viewInfo.view=a.mapContainer.map.getView(),a.mapContainer.viewInfo.zoom=a.mapContainer.viewInfo.view.getZoom(),a.mapContainer.viewInfo.center=a.mapContainer.viewInfo.view.getCenter(),a.mapContainer.viewInfo.rotation=a.mapContainer.viewInfo.view.getRotation()},bounce:function(e){var a,i=7.5625,n=2.75;return e<1/n?a=i*e*e:e<2/n?(e-=1.5/n,a=i*e*e+.75):e<2.5/n?(e-=2.25/n,a=i*e*e+.9375):(e-=2.625/n,a=i*e*e+.984375),a},setAnimation:function(e,a){var i=this;i.mapContainer.viewInfo.view.animate({center:e||i.transformLat([113.8077,22.6286]),duration:1e3,zoom:a||15})},resetView:function(){var e=this;e.setAnimation(e.transformLat(e.airPort),15)},createAirportLayer:function(){var e=this;e.mapContainer.layersInfo.airportPoint=new ol.layer.Tile({visible:!1,source:new ol.source.TileWMS({url:"https://www.minguicloud.com/geoserver/sz/wms?service=WMS&version=1.1.0&request=GetMap&layers=sz:surface_region&styles=&bbox=113.76931608,22.60251774,113.84250732,22.67499654&width=768&height=760&srs=EPSG:4326&format=application/openlayers"})}),e.mapContainer.layersInfo.airportLine=new ol.layer.Tile({visible:!1,source:new ol.source.TileWMS({url:"https://www.minguicloud.com/geoserver/sz/wms?service=WMS&version=1.1.0&request=GetMap&layers=sz:line_polyline&styles=&bbox=113.76640439999998,22.59093897,113.84873603999999,22.696465319999998&width=599&height=768&srs=EPSG:4326&format=application/openlayers"})}),e.mapContainer.layersInfo.airportPolygo=new ol.layer.Tile({visible:!1,source:new ol.source.TileWMS({url:"https://www.minguicloud.com/geoserver/sz/wms?service=WMS&version=1.1.0&request=GetMap&layers=sz:point_position_point&styles=&bbox=113.786041,22.616661,113.824471,22.655542&width=759&height=768&srs=EPSG:4326&format=application/openlayers"})}),e.mapContainer.map.addLayer(e.mapContainer.layersInfo.airportPoint),e.mapContainer.map.addLayer(e.mapContainer.layersInfo.airportLine),e.mapContainer.map.addLayer(e.mapContainer.layersInfo.airportPolygo)},createFeatureLayer:function(){function e(e,i){a.mapContainer.sourceInfo[e]=!1==i?new ol.source.Vector({features:[]}):new ol.source.Cluster({distance:30,source:new ol.source.Vector({features:[]})}),a.mapContainer.layersInfo[e]=new ol.layer.Vector({source:a.mapContainer.sourceInfo[e]}),a.mapContainer.map.addLayer(a.mapContainer.layersInfo[e])}var a=this;e("seat",!1),e("alarm",!1),e("demo",!1),!0==a.functionInfo.isDefense&&e("defens",!1),!0==a.functionInfo.isTrack&&e("trajectory",!1),e("vehicle",!1),!0==a.functionInfo.isCamera&&e("camera",!1),e("GPS",!1)},createPop:function(e,a){var i=this;i.mapContainer.overlayInfo[a]=new ol.Overlay({autoPan:!0,stopEvent:!1,positioning:"top-center",element:document.getElementById(e),autoPanAnimation:{duration:250}}),i.mapContainer.map.addOverlay(i.mapContainer.overlayInfo[a]),i.mapContainer.overlayInfo[a].setPosition(void 0)},createControls:function(){var e=this;e.mapContainer.controlsInfo.mousePosition||(e.mapContainer.controlsInfo.mousePosition=new ol.control.MousePosition({undefinedHTML:"&nbsp;",projection:"EPSG:4326",className:"mousePositionInner",target:document.getElementById("mousePosition"),coordinateFormat:ol.coordinate.createStringXY(4)})),e.mapContainer.controlsInfo.scaleLine||(e.mapContainer.controlsInfo.scaleLine=new ol.control.ScaleLine({units:"metric"})),e.mapContainer.controlsInfo.overviewMap||(e.mapContainer.controlsInfo.overviewMap=new ol.control.OverviewMap({className:"overViewMap",layers:[e.mapContainer.layersInfo.baiduSatellite,e.mapContainer.layersInfo.baiduVectorMap],collapseLabel:"\xBB",label:"\xAB",collapsed:!1,view:new ol.View({center:e.airPort,zoom:25})})),e.mapContainer.controlsInfo.fullScreen||(e.mapContainer.controlsInfo.fullScreen=new ol.control.FullScreen),e.mapContainer.map.addControl(e.mapContainer.controlsInfo.mousePosition),e.mapContainer.map.addControl(e.mapContainer.controlsInfo.scaleLine),e.mapContainer.map.addControl(e.mapContainer.controlsInfo.overviewMap),e.mapContainer.map.addControl(new ol.control.ZoomSlider)},createDefensFeature:function(e,a){var i=this,t=null,n=null,o=JSON.parse(e.areaRange).coordinates;!i.mapContainer.sourceInfo.defens||(n=i.mapContainer.sourceInfo.defens.getFeatureById("defens_"+e.id)),n?n.setStyle(new ol.style.Style(i.defensColor[e.secureStatus])):(t=new ol.Feature({geometry:new ol.geom.Polygon(o),name:"defens"}),t.setId("defens_"+e.id),t.setStyle(new ol.style.Style(i.defensColor[e.secureStatus])),i.mapContainer.sourceInfo.defens.addFeature(t)),!a||a(e.id,o)},setDefensRowData:function(e,a){var i=this;i.defensAreaDetailInfo=i.defensList[a],i.defensAreaDetailInfo.remark=decodeURI(i.defensList[a].remark),i.defensAreaDetailInfo.deptId=[i.defensList[a].deptId],i.defensAreaDetailInfo.opType=2,i.getDepartmentList("defensAreaDetailInfo"),i.createDefensFeature(i.defensAreaDetailInfo,function(e,a){i.showDefensPopLayer("defens_"+e,a)})},defensStatuChange:function(e){console.log(e)},drawAllDefens:function(){for(var e=this,a=0,t=e.defensList.length;a<t;a++)e.createDefensFeature(e.defensList[a])},createDefensInteraction:function(){var e=this;e.isDrawDefening=!0,e.mapContainer.interactionInfo.defens=new ol.interaction.Draw({source:e.mapContainer.sourceInfo.defens,type:"Polygon",geomertyFunction:function(a,i){var t=e.transformLat(a);i||(i=new ol.geom.Polygon(null));var n=t[0],o=t[1];return i.setCoordinates([[n,[n[0],o[1]],o,[o[0],n[0]],n]]),i}}),e.mapContainer.map.addInteraction(e.mapContainer.interactionInfo.defens),e.bindDefensDrawEndEvent()},bindDefensDrawEndEvent:function(){var e=this;e.mapContainer.interactionInfo.defens.on("drawend",function(a){var t=a.feature,n=e.mapContainer.sourceInfo.defens.getFeatures(),o=t.getGeometry(),r=o.getCoordinates(),s="defens_"+(n.length+1);t.setId(s),t.set("name","defens"),e.defensAreaDetailInfo={id:"",featureId:s,opType:1,companyId:"",deptId:"",deptIds:[],areaName:"",areaCode:"",secureStatus:"",areaRangeStr:function(){for(var e=[],a=r[0],t=0,n=a.length;t<n;t++)e.push(a[t].join(","));return e.join(";")}(),speedLimit:"",staySecond:"",remark:"",createUserId:i.id,modifyUserId:i.id},e.showDefensPopLayer(s,r),e.deleteDefensAction()},this)},formatDefensData:function(){for(var e=this,a=0,t=e.defensList.length;a<t;a++)e.defensDatas.push({areaName:decodeURI(e.defensList[a].areaName),areaCode:decodeURI(e.defensList[a].areaCode),secureStatus:function(){for(var i="",t=0,n=e.secureAreaStatusList.length;t<n;t++)if(e.secureAreaStatusList[t].type==e.defensList[a].secureStatus){i=e.secureAreaStatusList[t].name;break}return i}(),speedLimit:e.defensList[a].speedLimit,staySecond:e.defensList[a].staySecond})},getDefensAreaList:function(e){var a=this;!0==e&&(a.defensDatas=[],a.defensList=[],a.defensPageInfo.pageNum=1),setTimeout(function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.getSecureAreaList,actionUrl:CONFIG.SERVICE.areaService,dataObj:a.defensPageInfo,successCallback:function(e){200==e.code&&(a.defensList=e.data,a.defensPageInfo.count=e.count,a.formatDefensData(),a.drawAllDefens())}})},500)},defensPageSizeChange:function(){var e=this;e.defensPageInfo.pageNum=parseInt(value,10),setTimeout(function(){e.getDefensAreaList(!1)},200)},selectDefensArea:function(e){var a=this,i=JSON.parse(a.defensList[e.index].areaRange).coordinates;!1==a.isDeleteDefens&&(a.defensAreaDetailInfo=a.defensList[e.index],a.isAddDefensDetailInfo=!1,setTimeout(function(){a.isAddDefensDetailInfo=!0,a.mapContainer.overlayInfo.defens.setPosition([i]),a.autoFocus()},200))},showDefensPopLayer:function(e,a){for(var i=this,t=parseInt(e.split("_")[1],10),n=0,o=i.defensList.length;n<o;n++)if(t==i.defensList[n].id){i.defensAreaDetailInfo=i.defensList[n];break}i.getDepartmentList("defensAreaDetailInfo"),i.isAddDefensDetailInfo=!1,setTimeout(function(){i.isAddDefensDetailInfo=!0,i.mapContainer.overlayInfo.defens.setPosition(showDefensPopLayer(a)),i.autoFocus()},500)},addDefensAction:function(){var e=this;e.mapContainer.map.removeInteraction(e.mapContainer.interactionInfo.defens),e.isAddDefensAction=!0,e.createDefensInteraction()},deleteDefensAction:function(){var e=this;e.mapContainer.map.removeInteraction(e.mapContainer.interactionInfo.defens),e.isAddDefensAction=!1,e.isDrawDefening=!1},closeDefensLayer:function(){var e=this,a=null,i=e.defensAreaDetailInfo.id||e.defensAreaDetailInfo.featureId;!!e.defensAreaDetailInfo.id||(e.isAddDefensDetailInfo=!1,a=e.mapContainer.sourceInfo.defens.getFeatureById(i),e.mapContainer.sourceInfo.defens.removeFeature(a))},deleteDefensArea:function(){var e=this,a=null,t=e.defensAreaDetailInfo.id||e.defensAreaDetailInfo.featureId;e.isAddDefensDetailInfo=!1,a=e.mapContainer.sourceInfo.defens.getFeatureById(t),e.mapContainer.sourceInfo.defens.removeFeature(a),!e.defensAreaDetailInfo.id||utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.delSecureArea,actionUrl:CONFIG.SERVICE.areaService,dataObj:{ids:e.defensAreaDetailInfo.id,modifyUserId:i.id},successCallback:function(a){200==a.code?(e.getDefensAreaList(!0),setTimeout(function(){e.deleteLoading=!1,e.isDeleteDefens=!1,e.defensAreaDetailInfo={id:"",opType:1,companyId:"",deptId:"",deptIds:[],areaName:"",areaCode:"",secureStatus:"",areaRangeStr:"",speedLimit:"",staySecond:"",remark:"",createUserId:i.id,modifyUserId:i.id}},500)):e.$Message.error(a.message)}})},uploadDefensAreaDetailInfoToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.areaService+"?action="+CONFIG.ACTION.saveSecureArea,actionUrl:CONFIG.SERVICE.areaService,dataObj:{id:e.defensAreaDetailInfo.id,opType:e.defensAreaDetailInfo.opType,companyId:e.defensAreaDetailInfo.companyId,deptId:e.defensAreaDetailInfo.deptIds[e.defensAreaDetailInfo.deptIds.length-1]||0,areaName:encodeURI(e.defensAreaDetailInfo.areaName),areaCode:encodeURI(e.defensAreaDetailInfo.areaCode),secureStatus:e.defensAreaDetailInfo.secureStatus,areaRangeStr:e.defensAreaDetailInfo.areaRangeStr,speedLimit:e.defensAreaDetailInfo.speedLimit,staySecond:e.defensAreaDetailInfo.staySecond,canEnter:e.defensAreaDetailInfo.canEnter||720,canExit:e.defensAreaDetailInfo.canExit||720,canStay:e.defensAreaDetailInfo.canStay||720,remark:encodeURI(e.defensAreaDetailInfo.remark),createUserId:e.defensAreaDetailInfo.createUserId,modifyUserId:e.defensAreaDetailInfo.modifyUserId},successCallback:function(a){if(200==a.code){e.mapContainer.sourceInfo.defens.getFeatureById("defens_"+e.defensAreaDetailInfo.id);e.getDefensAreaList(!0),setTimeout(function(){e.isAddDefensDetailInfo=!1,e.addLoading=!1},500)}else e.$Message.error(a.message)}})},createCameraFeature:function(e,a,t){var n=this,o=null,r=n.mapContainer.sourceInfo.camera.getFeatures(),s="camera_"+(r.length+1),l=null,c=null;a?(l=n.mapContainer.sourceInfo.camera.getFeatureById(a),c=JSON.parse(e).coordinates,!!l&&n.mapContainer.sourceInfo.camera.removeFeature(l)):c=e,!0==n.isAddCameraAction&&(o=new ol.Feature({geometry:new ol.geom.Point(n.transformLat(c)),name:"camera"}),o.setId(s),o.setStyle(new ol.style.Style({image:new ol.style.Icon({anchor:[.5,.5],anchorOrigin:"top-right",anchorXUnits:"fraction",anchorYUnits:"pixels",offsetOrigin:"top-right",scale:.2,src:"/airport/assets/img/camera.png"})})),o.setId(a||s),n.mapContainer.sourceInfo.camera.addFeature(o),!!!a&&(n.cameraDetailInfo={id:"",featureId:s,id:"",companyId:"",companyName:"",deptId:"",deptIds:[],deptName:"",cameraName:"",cameraCode:"",cameraDesc:"",cameraPositionStr:c.join(","),radius:"",angle:"",monitorStatus:"",remark:"",rtspLiveUrl:"",rtspHisUrl:"",createUserId:i.id,modifyUserId:i.id})),!t||t(a,n.transformLat(c)),n.isAddCameraAction=!1},drawAllCamera:function(){for(var e=this,a=0,t=e.cameraList.length;a<t;a++)e.isAddCameraAction=!0,e.createCameraFeature(e.cameraList[a].cameraPosition,e.cameraList[a].id),e.isAddCameraAction=!1},setCameraRowData:function(e,a){var i=this;i.cameraDetailInfo=i.cameraList[a],i.cameraDetailInfo.remark=decodeURI(i.cameraList[a].remark),i.cameraDetailInfo.cameraName=decodeURI(i.cameraList[a].cameraName),i.cameraDetailInfo.cameraCode=decodeURI(i.cameraList[a].cameraCode),i.cameraDetailInfo.cameraDesc=decodeURI(i.cameraList[a].cameraDesc),i.cameraDetailInfo.deptId=[i.cameraList[a].deptId],i.isAddCameraAction=!0,i.createCameraFeature(i.cameraList[a].cameraPosition,i.cameraList[a].id,function(e,a){i.setAnimation(a,18),i.showCameraPopLayer(e,a)})},showCameraPopLayer:function(e,a){for(var i=this,t=0,n=i.cameraList.length;t<n;t++)if(e==i.cameraList[t].id){i.cameraDetailInfo=i.cameraList[t];break}i.getDepartmentList("cameraDetailInfo"),i.isAddcameraDetailInfo=!1,setTimeout(function(){i.isAddcameraDetailInfo=!0,i.mapContainer.overlayInfo.camera.setPosition(a),i.autoFocus()},500)},selectCamera:function(e){var a=this,i=JSON.parse(a.cameraList[e.index].areaRange.value.replace(/\(/g,"[").replace(/\)/g,"]"));!1==a.isDeleteCamera&&(a.cameraDetailInfo=a.cameraList[e.index],a.isAddcameraDetailInfo=!1,setTimeout(function(){a.isAddcameraDetailInfo=!0,a.mapContainer.overlayInfo.camera.setPosition(a.transformLat([i])),a.autoFocus()},200))},formatCameraData:function(){for(var e=this,a=0,t=e.cameraList.length;a<t;a++)e.camersDatas.push({id:e.cameraList[a].id,companyId:e.cameraList[a].companyId,companyName:decodeURI(e.cameraList[a].companyName),deptId:e.cameraList[a].deptId,deptName:decodeURI(e.cameraList[a].deptName),cameraName:decodeURI(e.cameraList[a].cameraName),cameraCode:decodeURI(e.cameraList[a].cameraCode),cameraDesc:decodeURI(e.cameraList[a].cameraDesc),radius:e.cameraList[a].radius,cameraPositionStr:e.cameraList[a].cameraPositionStr,angle:e.cameraList[a].angle,monitorStatus:e.cameraList[a].monitorStatusName,remark:decodeURI(e.cameraList[a].remark),rtspLiveUrl:e.cameraList[a].rtspLiveUrl,rtspHisUrl:e.cameraList[a].rtspHisUrl})},getCameraList:function(e){var a=this;a.camersDatas=[],a.cameraList=[],!0==e&&(a.cameraPageInfo.pageNum=1),setTimeout(function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.getCameraList,actionUrl:CONFIG.SERVICE.deviceService,dataObj:a.cameraPageInfo,successCallback:function(e){200==e.code&&(a.cameraList=e.data,a.cameraPageInfo.count=e.count,a.formatCameraData(),a.drawAllCamera())}})},500)},cameraPageSizeChange:function(){var e=this;e.cameraPageInfo.pageNum=parseInt(value,10),setTimeout(function(){e.getCameraList(!1)},200)},closeCameraLayer:function(){var e=this,a=null,i=e.cameraDetailInfo.id||e.cameraDetailInfo.featureId;!!e.cameraDetailInfo.id||(e.isAddcameraDetailInfo=!1,a=e.mapContainer.sourceInfo.camera.getFeatureById(i),e.mapContainer.sourceInfo.camera.removeFeature(a))},deleteCamera:function(){var e=this,a=null,t=e.cameraDetailInfo.id||e.cameraDetailInfo.featureId;e.isAddcameraDetailInfo=!1,a=e.mapContainer.sourceInfo.camera.getFeatureById(t),e.mapContainer.sourceInfo.camera.removeFeature(a),!e.cameraDetailInfo.id||utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.delCamera,actionUrl:CONFIG.SERVICE.deviceService,dataObj:{ids:e.cameraDetailInfo.id,modifyUserId:i.id},successCallback:function(a){200==a.code?(e.getCameraList(!0),setTimeout(function(){e.deleteLoading=!1,e.isDeleteCamera=!1,e.cameraDetailInfo={id:"",companyId:"",companyName:"",deptId:"",deptIds:[],deptName:"",cameraName:"",cameraCode:"",cameraDesc:"",cameraPositionStr:"",radius:"",angle:"",monitorStatus:"",remark:"",rtspLiveUrl:"",rtspHisUrl:"",createUserId:i.id,modifyUserId:i.id}},500)):e.$Message.error(a.message)}})},uploadCameraDetailInfoToServer:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deviceService+"?action="+CONFIG.ACTION.saveCamera,actionUrl:CONFIG.SERVICE.deviceService,dataObj:{id:e.cameraDetailInfo.id,companyId:e.cameraDetailInfo.companyId,deptId:e.cameraDetailInfo.deptIds[e.cameraDetailInfo.deptIds.length-1]||0,cameraName:encodeURI(e.cameraDetailInfo.cameraName),cameraCode:encodeURI(e.cameraDetailInfo.cameraCode),cameraDesc:encodeURI(e.cameraDetailInfo.cameraDesc),radius:e.cameraDetailInfo.radius,angle:e.cameraDetailInfo.angle,cameraPositionStr:e.cameraDetailInfo.cameraPositionStr,monitorStatus:e.cameraDetailInfo.monitorStatus,remark:encodeURI(e.cameraDetailInfo.remark),rtspLiveUrl:e.cameraDetailInfo.rtspLiveUrl,rtspHisUrl:e.cameraDetailInfo.rtspHisUrl,createUserId:i.id,modifyUserId:i.id},successCallback:function(a){200==a.code?(e.getCameraList(!0),setTimeout(function(){e.isAddcameraDetailInfo=!1,e.addLoading=!1},500)):e.$Message.error(a.message)}})},formatVehicle:function(){var e=this;e.vehicleDatas=[];for(var a=0,t=e.vehicleList.length;a<t;a++)e.vehicleDatas.push({vehicleCode:e.vehicleList[a].vehicleCode,vehicleTypeId:e.vehicleList[a].vehicleTypeName,vehicleName:e.vehicleList[a].vehicleName,vehicleStatus:function(){for(var i="",t=0,n=e.terminalStatusList.length;t<n;t++)if(e.terminalStatusList[t].type==e.vehicleList[a].vehicleStatus){i=e.terminalStatusList[t].name;break}return i}()})},getVehicleList:function(e){var a=this;a.vehicleDatas=[],a.vehicleList=[],!0==e&&(a.vehiclePageInfo.pageNum=1),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getVehicleList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:a.vehiclePageInfo,successCallback:function(e){200==e.code&&(a.vehicleList=e.data,a.vehiclePageInfo.count=e.count,a.formatVehicle())}})},vehiclePageSizeChange:function(){var e=this;e.vehiclePageInfo.pageNum=parseInt(value,10),setTimeout(function(){e.getVehicleList(!1)},200)},createVehicleFeature:function(e,a,i){var n=this,o=null,r=JSON.parse(e.lastPosition).coordinates,s="/airport/assets/img/success.gif",l=function(){for(var e={},a=0,n=t.vehicleType.length;a<n;a++)e[t.vehicleType[a].name]=t.vehicleType[a].type+"";return e}(),c=l[e.vehicleTypeName]+e.vehicleStatus||e.vehicleStatus,d=.2,m=n.mapContainer.viewInfo.view.getZoom();if(s="/airport/assets/img/"+c+".gif?v="+Date.parse(new Date),0!=r[0]||0!=r[1]){8>m?(d=.01,radius=0,width=0):10>m?(d=.05,radius=0,width=0):11.5>m?(d=.06,radius=0,width=0):12.5>m?(d=.08,radius=0,width=0):13.5>m?(d=.08,radius=0,width=0):14.5>m?(d=.12,radius=2,width=1):(d=.2,radius=4,width=2);var f=new ol.style.Style({image:new ol.style.Icon({scale:d,src:s,anchor:[.5,.5],anchorYUnits:"pixels",anchorXUnits:"fraction",offsetOrigin:"bottom-right",anchorOrigin:"bottom-right"})});n.mapContainer.featrueInfo.vehiclePoint[e.id+"Vehicle"]?(n.mapContainer.featrueInfo.vehiclePoint[e.id+"Vehicle"].setCoordinates(n.transformLat(r)),n.mapContainer.featrueInfo.circlePoint[e.id+"Circle"].setCoordinates(n.transformLat(r)),n.mapContainer.sourceInfo.vehicle.getFeatureById([e.id+"--"+a])&&(n.mapContainer.sourceInfo.vehicle.getFeatureById([e.id+"Circle"]).setStyle(n.vehicleFeature.circlePoint),n.mapContainer.sourceInfo.vehicle.getFeatureById([e.id+"--"+a]).setStyle(f))):!0==n.isAddVehiclePosition&&(n.mapContainer.featrueInfo.circlePoint[e.id+"Circle"]=new ol.geom.Point(n.transformLat(r)),circleFeatrue=new ol.Feature({name:"vehicle",geometry:n.mapContainer.featrueInfo.circlePoint[e.id+"Circle"]}),circleFeatrue.setStyle(n.vehicleFeature.circlePoint),n.mapContainer.featrueInfo.vehiclePoint[e.id+"Vehicle"]=new ol.geom.Point(n.transformLat(r)),o=new ol.Feature({name:"vehicle",geometry:n.mapContainer.featrueInfo.vehiclePoint[e.id+"Vehicle"]}),o.setStyle(f),circleFeatrue.setId(e.id+"Circle"),o.setId(e.id+"--"+a),n.mapContainer.sourceInfo.vehicle.addFeature(circleFeatrue),n.mapContainer.sourceInfo.vehicle.addFeature(o)),n.isAddVehiclePosition=!1,!i||i(n.transformLat(r))}},clearAllVehicle:function(){var e=this;e.mapContainer.sourceInfo.vehicle.clear(),e.mapContainer.featrueInfo.vehiclePoint={},e.mapContainer.featrueInfo.circlePoint={},!e.mapContainer.overlayInfo.vehicle||e.mapContainer.overlayInfo.vehicle.setPosition(void 0)},setSingleVehicle:function(){var e=this;e.isTrackItem=!0,e.mapContainer.sourceInfo.vehicle.clear(),e.mapContainer.featrueInfo.vehiclePoint={},e.mapContainer.featrueInfo.circlePoint={}},setVehicleRowData:function(e,a){var i=this;i.isAddVehiclePosition=!0,i.vehiclePositionItem=i.vehiclePositionList[e],i.vehiclePositionItem.lastPosition&&i.createVehicleFeature(i.vehiclePositionItem,e,function(e){!a||a(e)})},showVehicleOverLayer:function(e){var a=this,i=a.mapContainer.map.getView().getZoom();a.singleVehiclePageInfo.vehicleId=a.vehicleItemPop.id,a.singleVehiclePageInfo.vehicleCode=a.vehicleItemPop.vehicleCode,a.singleVehiclePageInfo.licenseNumber=a.vehicleItemPop.licenseNumber,a.singleVehiclePageInfo.lastGpsTime=a.vehicleItemPop.lastGpsTime,a.singleVehiclePageInfo.lastPosition=a.vehicleItemPop.lastPosition,$("body").find("#ol-vehicle").show(),!!a.mapContainer.overlayInfo.vehicle||(a.mapContainer.overlayInfo.vehicle=new ol.Overlay({autoPan:!0,stopEvent:!1,positioning:"top-center",element:document.getElementById("ol-vehicle"),autoPanAnimation:{duration:250}}),a.mapContainer.map.addOverlay(a.mapContainer.overlayInfo.vehicle)),a.mapContainer.overlayInfo.vehicle.setPosition(e),16>i&&(i=16),a.getAdressDetail(e,a.singleVehiclePageInfo),a.setAnimation(e,i),$("body").on("click","#popup-closer--vehicle",function(){$("body").find("#ol-vehicle").hide(),a.isTrackItem=!1,a.mapContainer.overlayInfo.vehicle.setPosition(void 0)})},showVehicleRowData:function(e,a){var i=this;i.isAddVehiclePosition=!0,i.vehicleItem=i.vehicleList[a],i.vehicleItemPop=i.vehicleItem,i.vehicleItemPop.lastPosition?(i.setSingleVehicle(),i.createVehicleFeature(i.vehiclePositionItem,a,function(e){i.showVehicleOverLayer(e)})):(i.$Message.error("\u6CA1\u6709\u8F66\u8F86\u5B9A\u4F4D\u6570\u636E"),i.mapContainer.overlayInfo.trajectory.setPosition(void 0))},showRowDataPosition:function(e,a){var i=this;i.isAddVehiclePosition=!0,i.vehiclePositionItem=i.vehiclePositionList[a],i.vehicleItemPop=i.vehiclePositionItem,i.trackItem=i.vehicleItemPop,i.vehicleItemPop.lastPosition?0==JSON.parse(i.vehicleItemPop.lastPosition).coordinates[0]||0==JSON.parse(i.vehicleItemPop.lastPosition).coordinates[1]?i.$Message.error("\u6CA1\u6709\u8F66\u8F86\u5B9A\u4F4D\u6570\u636E"):(i.setSingleVehicle(),i.createVehicleFeature(i.vehiclePositionItem,a,function(e){i.showVehicleOverLayer(e)})):i.$Message.error("\u6CA1\u6709\u8F66\u8F86\u5B9A\u4F4D\u6570\u636E")},drawAlVehicle:function(){var e=this;if(e.isTrackItem){for(var a=0,n=e.vehiclePositionList.length;a<n;a++)if(e.trackItem.licenseNumber==e.vehiclePositionList[a].licenseNumber){e.setVehicleRowData(a);break}}else for(var o=0,r=e.vehiclePositionList.length;o<r;o++)e.setVehicleRowData(o)},showVehiclePositionByClick:function(e){var a=this,i=e.split("--"),t=parseInt(i[0],10),n=parseInt(i[1],10),o=[];a.clearTrack(),a.singleVehicleItem.track="",a.isAddVehiclePosition=!0,a.vehicleItemPop=function(){for(var e=null,n=0,o=a.vehiclePositionList.length;n<o;n++)if(t==a.vehiclePositionList[n].id){e=a.vehiclePositionList[n];break}return e}(),a.trackItem=a.vehicleItemPop,a.vehicleItemPop?a.vehicleItemPop.lastPosition?(a.setSingleVehicle(),o=JSON.parse(a.vehicleItemPop.lastPosition).coordinates,a.createVehicleFeature(a.vehicleItemPop,n,function(){a.showVehicleOverLayer(a.transformLat(o))})):(a.$Message.error("\u6CA1\u6709\u8F66\u8F86\u5B9A\u4F4D\u6570\u636E"),a.mapContainer.overlayInfo.trajectory.setPosition(void 0)):(a.$Message.error("\u6CA1\u6709\u8F66\u8F86\u4FE1\u606F"),a.mapContainer.overlayInfo.trajectory.setPosition(void 0))},formatVehiclePositon:function(){for(var e=this,a=0,t=e.vehiclePositionList.length;a<t;a++)e.searchDatas.push({o:e.vehiclePositionList[a].o,id:e.vehiclePositionList[a].id,speed:e.vehiclePositionList[a].speed,power:e.vehiclePositionList[a].power,deptId:e.vehiclePositionList[a].deptId,deptName:e.vehiclePositionList[a].deptName,modifyTime:e.vehiclePositionList[a].modifyTime,gpsDeviceId:e.vehiclePositionList[a].gpsDeviceId,companyName:e.vehiclePositionList[a].companyName,vehicleName:e.vehiclePositionList[a].vehicleName,vehicleCode:e.vehiclePositionList[a].vehicleCode,licenseNumber:e.vehiclePositionList[a].licenseNumber,lastPosition:e.vehiclePositionList[a].lastPosition?JSON.parse(e.vehiclePositionList[a].lastPosition).coordinates:null,vehicleTypeId:e.vehiclePositionList[a].vehicleTypeName,gpsDeviceCode:e.vehiclePositionList[a].gpsDeviceCode,providerId:e.vehiclePositionList[a].providerId,vehicleStatus:function(){var i=$.grep(e.terminalStatusList,function(i){return i.type==e.vehiclePositionList[a].vehicleStatus});return i&&0!=i.length?i[0].name:"--"}(),useStatus:e.vehiclePositionList[a].useStatusName,vehicleColorId:e.vehiclePositionList[a].vehicleColorName,vehicleBrandId:e.vehiclePositionList[a].vehicleBrandName,vehicleStatusName:e.vehiclePositionList[a].vehicleStatusName,cellClassName:{vehicleStatus:"_"+e.vehiclePositionList[a].vehicleStatus}})},cancelAreaSearch:function(){var e=this;e.vehiclePositonPageInfo.centerPosition="",e.vehiclePositonPageInfo.span=1e3,e.clearAllVehicle(),e.getAllVehiclePositonList()},searchTimeVehicle:function(){var e=this;e.clearAllVehicle(),e.getAllVehiclePositonList()},getAllVehiclePositonList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getAllVehiclePositonList,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{span:e.vehiclePositonPageInfo.span||1e3,deptId:e.vehiclePositonPageInfo.deptId,pageNum:e.vehiclePositonPageInfo.pageNum,pageSize:e.vehiclePositonPageInfo.pageSize,id:e.vehiclePositonPageInfo.id,companyId:e.vehiclePositonPageInfo.companyId,gpsDeviceCode:e.vehiclePositonPageInfo.gpsDeviceCode,vehicleTypeId:e.vehiclePositonPageInfo.vehicleTypeId,vehicleStatus:e.vehiclePositonPageInfo.vehicleStatus,useStatus:e.vehiclePositonPageInfo.useStatus,vehicleColorId:e.vehiclePositonPageInfo.vehicleColorId,vehicleBrandId:e.vehiclePositonPageInfo.vehicleBrandId,centerPosition:e.vehiclePositonPageInfo.centerPosition,vehicleName:encodeURI(e.vehiclePositonPageInfo.vehicleName),vehicleCode:encodeURI(e.vehiclePositonPageInfo.vehicleCode),licenseNumber:encodeURI(e.vehiclePositonPageInfo.licenseNumber)},beforeSendCallback:function(){e.isSearchLoading=!0},completeCallback:function(){e.isSearchLoading=!1},successCallback:function(a){200==a.code&&(e.searchDatas=[],e.vehiclePositionList=a.data.sort(function(e,a){return e.vehicleStatus-a.vehicleStatus}),e.vehiclePositonPageInfo.count=a.count,e.formatVehiclePositon(),e.drawAlVehicle())}})},getBeginDate:function(e){var a=this;a.dateTimeInfo.beginDate=e},getEndDate:function(e){var a=this;a.dateTimeInfo.endDate=e},getBeginTime:function(e){var a=this;a.dateTimeInfo.beginTime=e},getEndTime:function(e){var a=this;a.dateTimeInfo.endTime=e},getAdressDetail:function(e,a){this;if(!!a.lastPosition){var i=new BMap.Convertor;a.sourceCoor=JSON.parse(a.lastPosition).coordinates,a.point=new BMap.Point(a.sourceCoor[0],a.sourceCoor[1]),i.translate([a.point],1,5,function(e){a.gc=new BMap.Geocoder,a.gc.getLocation(e.points[0],function(e){a.address=e.address})})}},formatTrajectoryInfo:function(){var e=this,a=null,n=[],o=[],r=[];if(!!e.singleVehicleItem&&e.singleVehicleItem.track){a=e.singleVehicleItem.track.split("/");for(var s,l=0,c=a.length;l<c;l++)s=a[l].split(","),r.push({time:function(){var e=utility.getDateDetailInfo(s[2]);return e.year+"-"+e.month+"-"+e.date+" "+e.hour+":"+e.min+":"+e.second}(),speed:s[3],coordinate:e.transformLat([parseFloat(s[0],10),parseFloat(s[1],10)]),vehicleCode:e.singleVehicleItem.vehicleCode,companyName:e.singleVehicleItem.companyName,deptName:e.singleVehicleItem.deptName,vehicleName:e.singleVehicleItem.vehicleName,licenseNumber:e.singleVehicleItem.licenseNumber,lastGpsTime:e.singleVehicleItem.lastGpsTime,vehicleTypeName:e.singleVehicleItem.vehicleTypeName})}o=r.sort(function(e,a){return e.time-a.time});for(var d=0,m=o.length;d<m;d++)n.push(o[d].coordinate);e.mapContainer.animationInfo.coordinates=n,e.mapContainer.animationInfo.trajectoryInfo=o},getSingleVehicleTrack:function(e){var a=this,i=null;return 0==a.dateTimeInfo.beginDate.length&&(a.dateTimeInfo.beginDate=function(){var e=utility.getDateDetailInfo();return e.year+"-"+e.month+"-"+e.date}()),0==a.dateTimeInfo.beginTime.length&&(a.dateTimeInfo.beginTime="00:00:00"),0==a.dateTimeInfo.endDate.length&&(a.dateTimeInfo.endDate=function(){var e=utility.getDateDetailInfo();return e.year+"-"+e.month+"-"+e.date}()),0==a.dateTimeInfo.endTime.length&&(a.dateTimeInfo.endTime="23:59:59"),a.singleVehiclePageInfo.beginTime=a.dateTimeInfo.beginDate+" "+a.dateTimeInfo.beginTime,a.singleVehiclePageInfo.endTime=a.dateTimeInfo.endDate+" "+a.dateTimeInfo.endTime,i=utility.timeDiff(a.singleVehiclePageInfo.beginTime,a.singleVehiclePageInfo.endTime),a.clearTrack(),a.$Message.destroy(),!1==i.isOver?void a.$Message.error("\u5F00\u59CB\u65F6\u95F4\u5927\u4E8E\u7ED3\u675F\u65F6\u95F4"):3<i.day?void a.$Message.error("\u65F6\u95F4\u8DE8\u5EA6\u4E0D\u80FD\u8D85\u8FC73\u5929"):void(a.$Message.loading({content:"\u6B63\u5728\u52A0\u8F7D\u8F68\u8FF9..."}),utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.getSingleVehicleTrack,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{gpsDeviceCode:a.singleVehiclePageInfo.gpsDeviceCode,licenseNumber:encodeURI(a.singleVehiclePageInfo.licenseNumber),beginTime:a.singleVehiclePageInfo.beginTime,endTime:a.singleVehiclePageInfo.endTime},successCallback:function(i){if(200==i.code){var t=[],n=[],o=[],r=a.mapContainer.map.getView().getZoom();a.singleVehicleItem=i.data,a.vehicleItemPop=i.data,a.showModal("isHistory"),a.singleVehicleItem.track?(o=a.vehicleItemPop.track.split("/"),n=o[o.length-1].split(","),t=a.transformLat([parseFloat(n[0],10),parseFloat(n[1],10)]),a.showVehicleOverLayer(t),a.formatTrajectoryInfo(),a.clearTrack(),a.drawTrajPoint(),a.drawTrajectory(),a.createTrajOverLayer(),setTimeout(function(){a.$Message.destroy(),!0==e&&a.startVehicleAnimation()},3e3)):(a.$Message.destroy(),a.$Message.error(a.singleVehiclePageInfo.beginTime+"  "+a.singleVehiclePageInfo.endTime+"\u67E5\u8BE2\u4E0D\u5230\u8F68\u8FF9\u6570\u636E"),setTimeout(function(){a.$Message.destroy()},3e3))}else a.$Message.destroy(),a.$Message.error(i.message),setTimeout(function(){a.$Message.destroy()},3e3)},errorCallback:function(){a.$Message.destroy()}}))},drawTrajectory:function(){var e=this,a=e.mapContainer.animationInfo.coordinates;e.$Message.destroy(),e.$Message.loading({content:"\u6B63\u5728\u7ED8\u5236\u8F68\u8FF9..."});for(var t=0,n=a.length;t<n;t++)if(t<n-1){var o=new ol.geom.LineString(a.slice(t,t+2)),r=new ol.Feature({geometry:o,name:"trajectoryLine"});r.setStyle(new ol.style.Style({stroke:new ol.style.Stroke({width:5,color:"#ffad33"}),fill:new ol.style.Fill({color:"rgba(0,0,0,0)"})})),r.setId("trajectoryLine"+t),e.mapContainer.sourceInfo.trajectory.addFeature(r)}e.$Message.destroy()},drawTrajectoryVehicle:function(){var e=this,a=function(){for(var e={},a=0,n=t.vehicleType.length;a<n;a++)e[t.vehicleType[a].name]=t.vehicleType[a].type+"";return e}(),i=a[e.vehicleItemPop.vehicleTypeName]+e.vehicleItemPop.vehicleStatus;iconSrc="/airport/assets/img/"+i+".gif",$("body").find("#ol-moveVehicle").css({background:"url("+iconSrc+") no-repeat left center","background-size":"100%"}),$("body").find("#ol-moveVehicle").show(),!!e.mapContainer.overlayInfo.moveVehicle||(e.mapContainer.overlayInfo.moveVehicle=new ol.Overlay({autoPan:!0,stopEvent:!1,positioning:"bottom-left",element:document.getElementById("ol-moveVehicle"),autoPanAnimation:{duration:250}}),e.mapContainer.map.addOverlay(e.mapContainer.overlayInfo.moveVehicle)),e.mapContainer.overlayInfo.moveVehicle.setPosition(e.mapContainer.animationInfo.coordinates[e.mapContainer.animationInfo.index])},drawDbClickVehicle:function(e){var a=this;a.isDbClickSearch=!0,!!a.mapContainer.overlayInfo.dbClickVehicle||(a.mapContainer.overlayInfo.dbClickVehicle=new ol.Overlay({autoPan:!0,stopEvent:!1,positioning:"center-center",element:document.getElementById("ol-dbClickSearch"),autoPanAnimation:{duration:250}}),a.mapContainer.map.addOverlay(a.mapContainer.overlayInfo.dbClickVehicle)),a.mapContainer.overlayInfo.dbClickVehicle.setPosition(e),$("body").find("#ol-dbClickSearch").css({opacity:1}),a.setAnimation(e,15),setTimeout(function(){!0==a.isDbClickSearch&&a.hiddenTwink()},5e3)},hiddenTwink:function(){var e=this;!e.mapContainer.overlayInfo.dbClickVehicle||e.mapContainer.overlayInfo.dbClickVehicle.setPosition(void 0),$("body").find("#ol-dbClickSearch").css({opacity:0}),e.isDbClickSearch=!1},startVehicleAnimation:function(){var e=this,a=e.mapContainer.animationInfo.coordinates;return(e.cancelTrack(),!!!e.singleVehicleItem.track||0==e.singleVehicleItem.track.length)?void e.getSingleVehicleTrack(!0):void(e.drawTrajPoint(),e.drawTrajectory(),!0==e.mapContainer.animationInfo.isMoved?e.stopVehicleAnimation(!1):(e.drawTrajectoryVehicle(),e.mapContainer.animationInfo.isMoved=!0,clearInterval(e.mapContainer.animationInfo.time),e.mapContainer.animationInfo.index=0,e.mapContainer.animationInfo.time=setInterval(function(){++e.mapContainer.animationInfo.index,e.mapContainer.animationInfo.index>=e.mapContainer.animationInfo.coordinates.length?(e.stopVehicleAnimation(!0),clearInterval(e.mapContainer.animationInfo.time)):e.mapContainer.overlayInfo.moveVehicle.setPosition(a[e.mapContainer.animationInfo.index])},10*(55+(55-e.mapContainer.animationInfo.speed)))))},stopVehicleAnimation:function(e){var a=this,i=a.mapContainer.animationInfo.coordinates,t=e?i[i.length-1]:i[0];a.mapContainer.animationInfo.isMoved=!1,a.mapContainer.animationInfo.index=0,clearInterval(a.mapContainer.animationInfo.time),a.mapContainer.overlayInfo.moveVehicle&&setTimeout(function(){$("body").find("#ol-moveVehicle").hide(),a.mapContainer.overlayInfo.moveVehicle.setPosition(void 0)},1e3)},cancelTrack:function(){var e=this;e.isTrackItem=!1},clearTrack:function(){var e=this;e.stopVehicleAnimation(!1),!e.mapContainer.overlayInfo.trajectory||e.mapContainer.overlayInfo.trajectory.setPosition(void 0)},drawTrajPoint:function(){var e=this,a=e.mapContainer.animationInfo.trajectoryInfo.length,t=5;3e4<a?t=500:2e4<a?t=300:1e4<a?t=150:8e3<a?t=120:6e3<a?t=100:4e3<a?t=50:2e3<a&&(t=20);for(var n=0;n<a;n+=t)if(!!e.mapContainer.animationInfo.trajectoryInfo[n]){var o=new ol.Feature({name:"trajPoint",geometry:new ol.geom.Point(e.mapContainer.animationInfo.trajectoryInfo[n].coordinate)});o.set("coordinate",e.mapContainer.animationInfo.trajectoryInfo[n].coordinate),o.setId("trajPoint-"+n),o.setStyle(e.vehicleFeature.circlePoint),e.mapContainer.sourceInfo.trajectory.addFeature(o)}},createTrajOverLayer:function(){var e=this;$("body").find("#popup").show(),e.mapContainer.overlayInfo.trajectory=new ol.Overlay({autoPan:!0,stopEvent:!1,positioning:"top-center",element:document.getElementById("popup"),autoPanAnimation:{duration:250}}),e.mapContainer.map.addOverlay(e.mapContainer.overlayInfo.trajectory),e.mapContainer.overlayInfo.trajectory.setPosition(void 0)},showTrajPopLayer:function(e,a){var i=this,t=parseInt(a.split("-")[1]),n=e;$("body").find("#popup").show(),i.mapContainer.overlayInfo.trajectory.setPosition(n),i.mapContainer.animationInfo.trajectoryItem=i.mapContainer.animationInfo.trajectoryInfo[t],i.getAdressDetail(n,i.mapContainer.animationInfo.trajectoryItem),$("body").on("click","#popup-closer",function(){$("body").find("#popup").hide(),i.isTrackItem=!1,i.mapContainer.overlayInfo.trajectory.setPosition(void 0)})},showLiveVideo:function(e,a){var t=this,n="http://43.247.68.26:8080/airport/www/module/liveVideo/liveVideo.html?vehicleInfo="+encodeURI(JSON.stringify(e))+"&isBackPlay="+a;a&&(n="http://43.247.68.26:8080/airport/www/module/playBack/liveVideo.html?vehicleInfo="+encodeURI(JSON.stringify(e))+"&isBackPlay="+a),2==e.providerId&&(a?n="http://43.247.68.26:8080/airport/www/module/playBack/liveVideo.html?vehicleInfo="+encodeURI(JSON.stringify(e))+"&isBackPlay="+a:n="http://43.247.68.26:8080/airport/www/module/liveVideoTest1/liveVideo.html?vehicleInfo="+encodeURI(JSON.stringify(e))+"&id="+i.id+"&userToken="+i.userToken+"&isBackPlay="+a),window.open(n,"liveVideo","toolbar=yes, location=0, directories=no, status=0, menubar=0, scrollbars=1, resizable=1, copyhistory=1, width="+window.outerWidth+", height="+(window.outerHeight-50))},createdGPS:function(){this},getLocation:function(){var e=this;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){e.setAnimation([a.coords.longitude,a.coords.latitude])},function(e){switch(e.code){case e.PERMISSION_DENIED:console.log("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:console.log("Location information is unavailable.");break;case e.TIMEOUT:console.log("The request to get user location timed out.");break;case e.UNKNOWN_ERROR:console.log("An unknown error occurred.");}}):console.log("\u4E0D\u652F\u6301\u5B9A\u4F4D")},getCompanyList:function(){var e=this;utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.companyService+"?action="+CONFIG.ACTION.getCompanyList,actionUrl:CONFIG.SERVICE.companyService,dataObj:{id:0,pageSize:1e4},successCallback:function(a){200==a.code&&(e.companyList=a.data)}})},getSuper:function(e,a,t){for(var n=this,o=0,r=e.length;o<r;o++)if(e[o].value==a){if(t.push(a),0==e[o].paraDeptId)return;n.getSuper(n.departmentList,e[o].paraDeptId,t)}else n.getSuper(e[o].children,a,t)},formatSuperiorDeprt:function(e){var a=this,i=JSON.stringify(e).replace(/id/g,"value").replace(/deptName/g,"label").replace(/subDeptList/g,"children");a.departmentList=JSON.parse(i)},getDepartmentList:function(e){var a=this;a.departmentList=[],utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.deptService+"?action="+CONFIG.ACTION.getDeptTreeList,actionUrl:CONFIG.SERVICE.deptService,dataObj:{id:0,pageSize:1e4,companyId:a[e].companyId||0},successCallback:function(i){if(200==i.code){var t=[];a[e].deptIds=[],a.formatSuperiorDeprt(i.data),a.getSuper(a.departmentList,a[e].deptId,t),a[e].deptIds=t.reverse()}}})},updateVehiclePosition:function(e){var a=this,i=utility.getDateDetailInfo();utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.vehicleService+"?action="+CONFIG.ACTION.updateVehiclePosition,actionUrl:CONFIG.SERVICE.vehicleService,dataObj:{id:"",vehicleCode:a.searchCode,positionStr:e.join(","),positionTime:i.year+"-"+i.month+"-"+i.date+" "+i.hour+":"+(i.min+2)+":"+i.second},successCallback:function(){}})},drawDemoPoint:function(){for(var e,a=this,t=0,n=a.demoInfo.coordinate.length;t<n;t++)e=new ol.Feature({name:"trajPoint",geometry:new ol.geom.Point(a.transformLat(a.demoInfo.coordinate[t]))}),e.set("coordinate",a.transformLat(a.demoInfo.coordinate[t])),e.setId("demo-"+t),e.setStyle(new ol.style.Style({image:new ol.style.Circle({radius:3,stroke:new ol.style.Stroke({color:"#2d8cf0",width:3}),file:new ol.style.Fill({color:"#2d8cf0"})}),text:new ol.style.Text({text:a.demoInfo.status[t]+" "+a.demoInfo.time[t],offsetX:5,offsetY:15,overflow:!0,file:new ol.style.Fill({color:"#ffffff"}),backgroundFill:new ol.style.Fill({color:"#ffffff"})})})),a.mapContainer.sourceInfo.demo.addFeature(e)}},created:function(){var e=this,a=null;e.isShenZhen="113.8077,22.6286"==e.airPort.join(","),utility.isLogin(!1),e.$Message.config({top:180,duration:3}),setTimeout(function(){e.initMap("vector"),e.getVehicleList(!0),e.functionInfo.isCamera&&e.getCameraList(!0),e.functionInfo.isDefense&&e.getDefensAreaList(!0),e.getCompanyList(),e.getAllVehiclePositonList(),a=setInterval(function(){e.getVehicleList(!0),e.getAllVehiclePositonList()},5e3),setInterval(function(){var a=utility.getSessionStorage("fromInfo")||null;!a||(e.vehiclePositonPageInfo.vehicleStatus=a.vehicleStatus,setTimeout(function(){utility.cleanSessionStorage()},2e3))},100),e.mapContainer.map.on("singleclick",function(a){var i=a.coordinate,t=a.originalEvent.target.nodeName.toLowerCase(),n=e.mapContainer.map.forEachFeatureAtPixel(a.pixel,function(e){return e});if("canvas"==t&&!!n)switch(e.mapContainer.featrueInfo.clickId=n.getId(),e.mapContainer.featrueInfo.clickName=n.get("name"),e.mapContainer.featrueInfo.clickPos=a.pixel,e.mapContainer.featrueInfo.clickName){case"camera":e.showCameraPopLayer(e.mapContainer.featrueInfo.clickId,i);break;case"defens":e.showDefensPopLayer(e.mapContainer.featrueInfo.clickId,i);break;case"vehicle":e.showVehiclePositionByClick(e.mapContainer.featrueInfo.clickId);break;case"trajPoint":e.showTrajPopLayer(i,e.mapContainer.featrueInfo.clickId);break;default:console.log(n);}else!0==e.isAddCameraAction&&e.createCameraFeature(i,"",function(a,i){e.showCameraPopLayer("",i)})}),e.mapContainer.map.on("dblclick",function(a){var i=a.coordinate;e.vehiclePositonPageInfo.centerPosition=ol.proj.transform(i,"EPSG:3857","EPSG:4326").join(","),e.drawDbClickVehicle(i)}),e.$watch("vehiclePositonPageInfo",function(){utility.getSessionStorage("fromInfo")||null;e.clearAllVehicle(),clearInterval(a),e.getAllVehiclePositonList(),a=setInterval(function(){e.getAllVehiclePositonList()},5e3)},{deep:!0}),$(".radar")[0]&&new Radar($(".radar")[0]).init({scanSpeed:2})},2e3)}})})();
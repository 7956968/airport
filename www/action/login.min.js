(function(){var e=utility.getLocalStorage("language"),t=utility.getLocalStorage("userInfo");new Vue({el:"#js-vue",data:{language:e?e.language:"CN",loading:!1,isShowTips:!1,message:"",loginInfo:{userCode:t&&t.userCode?t.userCode:"",userPwd:t&&t.userPwd?t.userPwd:"",remember:!0},languageList:[{value:"CN",label:"中文"}],airPort:"121.812257,31.16046",airPortList:[{value:"0",label:"全部"},{value:"121.34210660807666,31.198845194982827",label:"上海虹桥国际机场"},{value:"121.812257,31.16046",label:"上海浦东国际机场"}],title:{CN:"特种车辆音视频可视化系统",EN:"Mingui Non-Powered Euipment Management System",TW:"民貴無動力管理系統"}},watch:{language:function(e){var t=this;document.title=t.title[e],utility.setLocalStorage("language",{language:e}),setTimeout(function(){t.getBizParam()},500)}},methods:{validateInput:function(){var e=this;return e.$Message.config({top:150,duration:3}),utility.checkLen(e.loginInfo.userCode,0)?(e.$Message.error({CN:"请输入用户名",EN:"Please Enter userCode",TW:"請輸入用戶名"}[e.language]),!1):!utility.checkLen(e.loginInfo.userPwd,0)||(e.$Message.error({CN:"请输入密码",EN:"Please Enter Password",TW:"請輸入密碼"}[e.language]),!1)},formatFunMenu:function(e){for(var t={menu_map:[],menu_org:[],menu_device:[],menu_report:[],menu_system:[]},a=e.userFuncList,i=0,n=a.length;i<n;i++)-1==a[i].functionCode.indexOf("map_")&&"device_manage_vehicle"!=a[i].functionCode&&"device_view_secure_area"!=a[i].functionCode&&"device_manage_secure_area"!=a[i].functionCode&&"device_manage_camera"!=a[i].functionCode&&"device_view_camera"!=a[i].functionCode||t.menu_map.push(a[i]),-1!=a[i].functionCode.indexOf("org_manage_")&&t.menu_org.push(a[i]),-1!=a[i].functionCode.indexOf("device_")&&t.menu_device.push(a[i]),-1!=a[i].functionCode.indexOf("report_")&&t.menu_report.push(a[i]),-1!=a[i].functionCode.indexOf("system_")&&t.menu_system.push(a[i]);utility.setLocalStorage("userFuncList",t)},loginAction:function(){var e=this;e.loading||e.validateInput()&&utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.userService+"?action="+CONFIG.ACTION.userLogin+"&userCode="+e.loginInfo.userCode+"&userPwd="+md5(e.loginInfo.userPwd).toUpperCase(),actionUrl:CONFIG.SERVICE.userService,beforeSendCallback:function(){e.loading=!0},completeCallback:function(){},successCallback:function(t){200==t.code?(utility.cleanSessionStorage(),utility.cleanLocalStorage(),utility.setLocalStorage("userInfo",t.data),utility.setLocalStorage("language",{language:e.language}),utility.setLocalStorage("airPort",{airPort:e.airPort}),utility.setLocalStorage("demo",{demo:!1}),e.formatFunMenu(t.data),e.getBizParam(t.data.companyId,function(){if(e.loading=!1,t.data.modifyTime){var a=t.data.modifyTime.split(" "),i=a[0].split("-"),n=parseInt(i[0],10)+1,o=utility.timeDiff(n+"/"+i[1]+"/"+i[2]+" "+a[1]);o.day<=7&&alert("密码更换周期不低于一年一次 \n 最迟 "+n+"-"+i[1]+"-"+i[2]+" "+a[1]+" 前修改一次密码")}window.location.href="/airport/www/module/index/index.html"})):(e.loading=!1,e.$Message.error(t.message))}})},getBizParam:function(e,t){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.commonService+"?action="+CONFIG.ACTION.getBizParam,actionUrl:CONFIG.SERVICE.commonService,dataObj:{companyId:e},successCallback:function(e){200==e.code&&(utility.setLocalStorage("bizParam",e.data),t&&t())}})},getProvinceList:function(){utility.interactWithServer({url:CONFIG.HOST+CONFIG.SERVICE.commonService+"?action="+CONFIG.ACTION.getProvinceList,actionUrl:CONFIG.SERVICE.commonService,successCallback:function(e){200==e.code&&utility.setLocalStorage("provinceList",e.data)}})}},created:function(){var e=this;utility.setLocalStorage("isPhone",null),document.title=e.title[e.language],document.onkeydown=function(t){t=t||event;var a=t.keyCode||t.while||t.charCode;13==a&&e.loginAction()}}})})();